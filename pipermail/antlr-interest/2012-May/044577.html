<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Addendum%3A%20Trying%20to%20get%20an%20AST%20in%20C%23.%20Not%0A%20working%09-%20could%20use%20a%20sanity%20check.&In-Reply-To=%3C80A5CDD2686EA042AE41C526324D445501050A3A681E%40EXCHANGE2007.signmgmt.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044576.html">
   <LINK REL="Next"  HREF="044578.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.</H1>
    <B>Kevin Carroll</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Addendum%3A%20Trying%20to%20get%20an%20AST%20in%20C%23.%20Not%0A%20working%09-%20could%20use%20a%20sanity%20check.&In-Reply-To=%3C80A5CDD2686EA042AE41C526324D445501050A3A681E%40EXCHANGE2007.signmgmt.local%3E"
       TITLE="[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.">kcarroll at signmgmt.com
       </A><BR>
    <I>Mon May  7 09:14:45 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="044576.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
        <LI>Next message: <A HREF="044578.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44577">[ date ]</a>
              <a href="thread.html#44577">[ thread ]</a>
              <a href="subject.html#44577">[ subject ]</a>
              <a href="author.html#44577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

Change HIDDEN to Hidden.  The C# target attempts to use C# idioms when possible.  Also, look at <A HREF="http://www.antlr.org/wiki/display/ANTLR3/Antlr3CSharpReleases.">http://www.antlr.org/wiki/display/ANTLR3/Antlr3CSharpReleases.</A>

Kevin

-----Original Message-----
From: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A> [mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest-bounces at antlr.org</A>] On Behalf Of Peter Bosch
Sent: Sunday, May 06, 2012 7:53 PM
To: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>
Subject: [antlr-interest] Addendum: Trying to get an AST in C#. Not working - could use a sanity check.

Also, I tried only libraries and tools from antlr-dotnet-csharpbootstrap-3.4.1.9004.7z, per advice from <A HREF="http://www.antlr.org/pipermail/antlr-interest/2012-April/044370.html">http://www.antlr.org/pipermail/antlr-interest/2012-April/044370.html</A> and got the following:

 

[With language=CSharp2;]

C:\Users\pbosch\Desktop\antlr-dotnet-csharpbootstrap-3.4.1.9004&gt;Antlr3
Marbles.g

AST.stg 54:23: premature EOF

 

[With language=CSharp3;]

C:\Users\pbosch\Desktop\antlr-dotnet-csharpbootstrap-3.4.1.9004&gt;Antlr3
Marbles.g

 

C:\Users\pbosch\Desktop\antlr-dotnet-csharpbootstrap-3.4.1.9004&gt;

 

For both versions, I used the generated parser &amp; lexer classes, and got the following errors both times:

The type name 'parse_return' does not exist in the type 'Marbles.MarblesParser'

'Marbles.MarblesParser.parse()' is inaccessible due to its protection level

The name 'HIDDEN' does not exist in the current context &#223; This was in generated code.

The name 'HIDDEN' does not exist in the current context &#223; This was in generated code.

 

This was with 

 

 

From: Peter Bosch [mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">pbosch at highpointsoftware.com</A>]
Sent: Sunday, May 06, 2012 7:19 PM
To: '<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">antlr-interest at antlr.org</A>'
Subject: Trying to get an AST in C#. Not working - could use a sanity check.

 

Hi;

 

I'll preface with &quot;I am a first time Lexer/Parser generator user, but a long time software guy.&quot; That, of course, makes me a &quot;noob.&quot;

 

I'm preparing to build an analysis and round-trip engineering tool in C# for a 3rd party system with its own syntax. I believe I can create the foundation of a persistence layer to and from their custom format through an ANTLR grammar. In order to work out the kinks, I've begun a proof-of-concept on a simple analogue. One thing it needs to do is support an N-ary AST where
N&gt;2, but I think I have reasonable rewrite rules in place to bring that
about.

 

The challenge has been in getting an AST generated from even that simple grammar. I have a grammar that passes code generation from ANTLRWorks, and code (see attached) that seems to have worked for others, in regards to generating an AST.

 

It may have to do with the versions of ANTLRWorks and the ANTLR C# runtimes that I'm linking to. I've tried:

ANTLR 3.1.0 C# Runtimes version (3.1.0.39271) &amp; ANTLRWorks 1.4.3 : Odd partial parsing - skips or duplicates some children.

ANTLR 3.4.1 C# Runtimes version (3.4.1.9004) &amp; ANTLRWorks 1.4.3 : Generated lexer issues (_channel=HIDDEN &#223;not defined) and program issues
(MarblesParser.parse() inaccessible and MarblesParser.parse_return not
defined.)

 

So my question is - *Should* either of these configurations work? (I've seen posts hinting that certain builds of ANTLR C# runtime are not fully-featured, and I'm also wondering if there might have been breaking changes between 3.1.0.x and 3.4.1.x such that my source needs to change to support a different model.)

 

If things *should* work as I've got 'em, I've inlined the grammar, the sample input and the Program.cs below in case anyone cares to beat me about the head and shoulders for some noob-ish-nesses. J 

 

[Note: A sack of marbles was the initial concept. You'll see below, we've now graduated to bags of hammers &amp; boxes of rocks. A subject of which I am currently feeling quite exemplary.]

 

In any case, thanks in advance for whatever help you can offer.

 

Regards, (code after the .sig) 

 

Peter Bosch
Highpoint Software Systems
E-mail : <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">pbosch at highpointsoftware.com</A>
Phone : 262-893-5400
P-Mail : S42 W27451 Oak Grove Lane Waukesha, WI, 53189 Useful and Usable Decision Support &amp; Technical Software

 

 

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

Marbles.g

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

 

grammar Marbles;

 

// options, then tokens, then @header then @members.

options {

  language=CSharp2;

  output=AST;

}

 

tokens {

    ROOT;

}

 

@header {

    //using System;

}

 

@parser::namespace { Marbles }

@lexer::namespace { Marbles }

 

@parser::members { protected void Print(string s){
/*Console.WriteLine(&quot;Token: &quot; + s);*/ } }

 

// Parser Rules.

 

parse

    :  r=box* EOF -&gt; ^(ROOT $r*)

    ;

 

color : K_COLOR '=' s=STRINGLITERAL {Print(&quot;C&quot;);} -&gt;^(K_COLOR $s) 

    ;

 

weight     : K_WEIGHT '=' w=INTEGER -&gt; ^(K_WEIGHT $w)

    ;

 

htype : K_HTYPE '=' t=STRINGLITERAL -&gt; ^(K_HTYPE $t)

    ;

 

rtype : K_RTYPE '=' t=STRINGLITERAL -&gt; ^(K_RTYPE $t)

    ;

    

rock : 

    '{' K_ROCK c=color w=weight t=rtype '}' {Print(&quot;R&quot;);} -&gt;^(K_ROCK $c $w
$t)

    ;

    

hammer     :

    '{' K_HAMMER t=htype? w=weight? '}'  -&gt;^(K_HAMMER $t? $w?)

    ;

    

box  :

    '[' K_BOX r=rock* ']' {Print(&quot;B&quot;);} -&gt; ^(K_BOX $r*)

    ;

    

bag  :

    '[' K_HAMMER h=(hammer)* ']' -&gt; ^(K_HAMMER $h*)

    ;

    

 

 

// Lexer Rules

EOL  : ('\r'? '\n') {$channel=HIDDEN;}

    ;

    

WS      : (' '|'\t'|'\f'| EOL)+ {$channel=HIDDEN;}

    ;

    

K_BOX : 'BOX'

    ;

K_BAG : 'BAG'

    ;

K_ROCK     : 'ROCK'

    ;

K_COLOR    : 'COLOR'

    ;

K_HAMMER

    : 'HAMMER'

    ;

K_HTYPE    : 'H_TYPE'

    ;

K_RTYPE    : 'R_TYPE'

    ;

K_WEIGHT

    : 'WEIGHT'

    ;

    

STRINGLITERAL

    : '&quot;' (~('&quot;' | '\\'))* '&quot;'

    ;

    

INTEGER    : ('0'..'9')+

    ;

 

COMMENT

    : '//' ~('\n'|'\r')* '\r'? '\n' {Skip();} //{$channel=HIDDEN;}

    | '/*' ( options {greedy=false;} : . )* '*/' {Skip();} //{$channel=HIDDEN;}

    ;

 

    

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

SampleMarbles.txt

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

/*[BAG 

{ HAMMER H_TYPE=&quot;Claw&quot;;} // Bob's your uncle.

{ HAMMER H_TYPE=&quot;Ball Peen&quot; WEIGHT=12 ; }

]*/

 

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=41 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=31 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=21 R_TYPE=&quot;Quartz&quot; }

]

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=42 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=32 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=22 R_TYPE=&quot;Quartz&quot; }

]

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=43 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=33 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=23 R_TYPE=&quot;Quartz&quot; }

]

 

 

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

Program.cs

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

using System;

using Antlr.Runtime;

using Antlr.Runtime.Tree;

//using Antlr.StringTemplate;

using System.IO;

 

// <A HREF="http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials">http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials</A>

//
<A HREF="http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials/43977">http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials/43977</A>
99#4397799

namespace Marbles {

    class MainClass {

        public static void Preorder(ITree Tree, int Depth) {

            if (Tree == null) {

                return;

            }

 

            for (int i = 0; i &lt; Depth; i++) {

                Console.Write(&quot;  &quot;);

            }

 

            Console.WriteLine(Tree);

 

            for (int i = 0; i &lt; Tree.ChildCount; i++) {

                Preorder(Tree.GetChild(i), Depth + 1);

            }

        }

 

        public static void Main(string[] args) {

            string s = File.ReadAllText(args[0]);

            ANTLRStringStream Input = new ANTLRStringStream(s);

            MarblesLexer Lexer = new MarblesLexer(Input);

            CommonTokenStream Tokens = new CommonTokenStream(Lexer);

            MarblesParser Parser = new MarblesParser(Tokens);

            MarblesParser.parse_return ParseReturn = Parser.parse();

            CommonTree Tree = (CommonTree)ParseReturn.Tree;

            Preorder(Tree, 0); 

        }

    }

}


List: <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">http://www.antlr.org/mailman/listinfo/antlr-interest</A>
Unsubscribe: <A HREF="http://www.antlr.org/mailman/options/antlr-interest/your-email-address">http://www.antlr.org/mailman/options/antlr-interest/your-email-address</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044576.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
	<LI>Next message: <A HREF="044578.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44577">[ date ]</a>
              <a href="thread.html#44577">[ thread ]</a>
              <a href="subject.html#44577">[ subject ]</a>
              <a href="author.html#44577">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
