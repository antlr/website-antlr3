<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [antlr-interest] Trying to get an AST in C#. Not working - could	use a sanity check.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Trying%20to%20get%20an%20AST%20in%20C%23.%20Not%20working%20-%20could%0A%09use%20a%20sanity%20check.&In-Reply-To=%3C02c801cd2be7%24116a20a0%24343e61e0%24%40highpointsoftware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044574.html">
   <LINK REL="Next"  HREF="044576.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[antlr-interest] Trying to get an AST in C#. Not working - could	use a sanity check.</H1>
    <B>Peter Bosch</B> 
    <A HREF="mailto:antlr-interest%40antlr.org?Subject=Re:%20%5Bantlr-interest%5D%20Trying%20to%20get%20an%20AST%20in%20C%23.%20Not%20working%20-%20could%0A%09use%20a%20sanity%20check.&In-Reply-To=%3C02c801cd2be7%24116a20a0%24343e61e0%24%40highpointsoftware.com%3E"
       TITLE="[antlr-interest] Trying to get an AST in C#. Not working - could	use a sanity check.">pbosch at highpointsoftware.com
       </A><BR>
    <I>Sun May  6 17:19:27 PDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="044574.html">[antlr-interest] Interesting error in attribute access
</A></li>
        <LI>Next message: <A HREF="044576.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44575">[ date ]</a>
              <a href="thread.html#44575">[ thread ]</a>
              <a href="subject.html#44575">[ subject ]</a>
              <a href="author.html#44575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi;

 

I&#146;ll preface with &#147;I am a first time Lexer/Parser generator user, but a long
time software guy.&#148; That, of course, makes me a &#147;noob.&#148;

 

I&#146;m preparing to build an analysis and round-trip engineering tool in C# for
a 3rd party system with its own syntax. I believe I can create the
foundation of a persistence layer to and from their custom format through an
ANTLR grammar. In order to work out the kinks, I&#146;ve begun a proof-of-concept
on a simple analogue. One thing it needs to do is support an N-ary AST where
N&gt;2, but I think I have reasonable rewrite rules in place to bring that
about.

 

The challenge has been in getting an AST generated from even that simple
grammar. I have a grammar that passes code generation from ANTLRWorks, and
code (see attached) that seems to have worked for others, in regards to
generating an AST.

 

It may have to do with the versions of ANTLRWorks and the ANTLR C# runtimes
that I&#146;m linking to. I&#146;ve tried:

ANTLR 3.1.0 C# Runtimes version (3.1.0.39271) &amp; ANTLRWorks 1.4.3 : Odd
partial parsing &#150; skips or duplicates some children.

ANTLR 3.4.1 C# Runtimes version (3.4.1.9004) &amp; ANTLRWorks 1.4.3 : Generated
lexer issues (_channel=HIDDEN &#223;not defined) and program issues
(MarblesParser.parse() inaccessible and MarblesParser.parse_return not
defined.)

 

So my question is - *Should* either of these configurations work? (I&#146;ve seen
posts hinting that certain builds of ANTLR C# runtime are not
fully-featured, and I&#146;m also wondering if there might have been breaking
changes between 3.1.0.x and 3.4.1.x such that my source needs to change to
support a different model.)

 

If things *should* work as I&#146;ve got &#145;em, I&#146;ve inlined the grammar, the
sample input and the Program.cs below in case anyone cares to beat me about
the head and shoulders for some noob-ish-nesses. J 

 

[Note: A sack of marbles was the initial concept. You&#146;ll see below, we&#146;ve
now graduated to bags of hammers &amp; boxes of rocks. A subject of which I am
currently feeling quite exemplary.]

 

In any case, thanks in advance for whatever help you can offer.

 

Regards, (code after the .sig) 

 

Peter Bosch
Highpoint Software Systems
E-mail :  &lt;mailto:<A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">pbosch at highpointsoftware.com</A>&gt; <A HREF="http://www.antlr.org/mailman/listinfo/antlr-interest">pbosch at highpointsoftware.com</A>
Phone : 262-893-5400
P-Mail : S42 W27451 Oak Grove Lane Waukesha, WI, 53189
Useful and Usable Decision Support &amp; Technical Software

 

 

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

Marbles.g

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

 

grammar Marbles;

 

// options, then tokens, then @header then @members.

options {

  language=CSharp2;

  output=AST;

}

 

tokens {

    ROOT;

}

 

@header {

    //using System;

}

 

@parser::namespace { Marbles }

@lexer::namespace { Marbles }

 

@parser::members { protected void Print(string s){
/*Console.WriteLine(&quot;Token: &quot; + s);*/ } }

 

// Parser Rules.

 

parse

    :  r=box* EOF -&gt; ^(ROOT $r*)

    ;

color : K_COLOR '=' s=STRINGLITERAL {Print(&quot;C&quot;);} -&gt;^(K_COLOR $s) 

    ;

 

weight     : K_WEIGHT '=' w=INTEGER -&gt; ^(K_WEIGHT $w)

    ;

htype : K_HTYPE '=' t=STRINGLITERAL -&gt; ^(K_HTYPE $t)

    ;

rtype : K_RTYPE '=' t=STRINGLITERAL -&gt; ^(K_RTYPE $t)

    ;

    

rock : 

    '{' K_ROCK c=color w=weight t=rtype '}' {Print(&quot;R&quot;);} -&gt;^(K_ROCK $c $w
$t)

    ;

    

hammer     :

    '{' K_HAMMER t=htype? w=weight? '}'  -&gt;^(K_HAMMER $t? $w?)

    ;

    

box  :

    '[' K_BOX r=rock* ']' {Print(&quot;B&quot;);} -&gt; ^(K_BOX $r*)

    ;

    

bag  :

    '[' K_HAMMER h=(hammer)* ']' -&gt; ^(K_HAMMER $h*)

    ;

    

 

// Lexer Rules

EOL  : ('\r'? '\n') {$channel=HIDDEN;}

    ;

    

WS      : (' '|'\t'|'\f'| EOL)+ {$channel=HIDDEN;}

    ;

    

K_BOX : 'BOX'

    ;

K_BAG : 'BAG'

    ;

K_ROCK     : 'ROCK'

    ;

K_COLOR    : 'COLOR'

    ;

K_HAMMER

    : 'HAMMER'

    ;

K_HTYPE    : 'H_TYPE'

    ;

K_RTYPE    : 'R_TYPE'

    ;

K_WEIGHT

    : 'WEIGHT'

    ;

    

STRINGLITERAL

    : '&quot;' (~('&quot;' | '\\'))* '&quot;'

    ;

    

INTEGER    : ('0'..'9')+

    ;

 

COMMENT

    : '//' ~('\n'|'\r')* '\r'? '\n' {Skip();} //{$channel=HIDDEN;}

    | '/*' ( options {greedy=false;} : . )* '*/' {Skip();}
//{$channel=HIDDEN;}

    ;

 

    

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

SampleMarbles.txt

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

/*[BAG 

{ HAMMER H_TYPE=&quot;Claw&quot;;} // Bob's your uncle.

{ HAMMER H_TYPE=&quot;Ball Peen&quot; WEIGHT=12 ; }

]*/

 

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=41 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=31 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=21 R_TYPE=&quot;Quartz&quot; }

]

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=42 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=32 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=22 R_TYPE=&quot;Quartz&quot; }

]

[BOX

{ ROCK COLOR=&quot;Blue&quot; WEIGHT=43 R_TYPE=&quot;Schist&quot; }

{ ROCK COLOR=&quot;Yellow&quot; WEIGHT=33 R_TYPE=&quot;Sulfur&quot; }

{ ROCK COLOR=&quot;Black&quot; WEIGHT=23 R_TYPE=&quot;Quartz&quot; }

]

 

 

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

Program.cs

////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////

using System;

using Antlr.Runtime;

using Antlr.Runtime.Tree;

//using Antlr.StringTemplate;

using System.IO;

 

// <A HREF="http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials">http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials</A>

//
<A HREF="http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials/43977">http://stackoverflow.com/questions/4396080/antlr-3-3-c-sharp-tutorials/43977</A>
99#4397799

namespace Marbles {

    class MainClass {

        public static void Preorder(ITree Tree, int Depth) {

            if (Tree == null) {

                return;

            }

 

            for (int i = 0; i &lt; Depth; i++) {

                Console.Write(&quot;  &quot;);

            }

 

            Console.WriteLine(Tree);

 

            for (int i = 0; i &lt; Tree.ChildCount; i++) {

                Preorder(Tree.GetChild(i), Depth + 1);

            }

        }

 

        public static void Main(string[] args) {

            string s = File.ReadAllText(args[0]);

            ANTLRStringStream Input = new ANTLRStringStream(s);

            MarblesLexer Lexer = new MarblesLexer(Input);

            CommonTokenStream Tokens = new CommonTokenStream(Lexer);

            MarblesParser Parser = new MarblesParser(Tokens);

            MarblesParser.parse_return ParseReturn = Parser.parse();

            CommonTree Tree = (CommonTree)ParseReturn.Tree;

            Preorder(Tree, 0); 

        }

    }

}

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044574.html">[antlr-interest] Interesting error in attribute access
</A></li>
	<LI>Next message: <A HREF="044576.html">[antlr-interest] Addendum: Trying to get an AST in C#. Not working	- could use a sanity check.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44575">[ date ]</a>
              <a href="thread.html#44575">[ thread ]</a>
              <a href="subject.html#44575">[ subject ]</a>
              <a href="author.html#44575">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.antlr.org/mailman/listinfo/antlr-interest">More information about the antlr-interest
mailing list</a><br>
</body></html>
