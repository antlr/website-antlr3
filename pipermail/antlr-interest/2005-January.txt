From ric.klaren at gmail.com  Sun Jan  2 07:23:58 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Sun Jan  2 07:24:02 2005
Subject: [antlr-interest] FEATURE REQUEST: continued and memory/speedissues
In-Reply-To: <1104427832.8387@mx9.mysite4now.com>
References: <bc607a4e04123007047a39f56c@mail.gmail.com>
	<1104427832.8387@mx9.mysite4now.com>
Message-ID: <bc607a4e05010207232757a5e3@mail.gmail.com>

On Thu, 30 Dec 2004 12:31:17 -0500, Don Caton
<dcaton@shorelinesoftware.com> wrote:
> Please, NO!  Do something like:
> 
>   #define ANTLR_FACTORY_VIRTUAL
> 
>   #ifdef ANTLR_FACTORY_VIRTUAL
>      #define FACTORY_VIRTUAL virtual
>   #else
>      #define FATORY_VIRTUAL
>   #endif

Not really to my taste to add. Doing stuff like this is the start of
something that's a bother to maintain. Adding a number of virtuals is
no problem. If you need this I suggest making a vendor branch or
something. In the end we'll end up with a define per class or worse.

> > Using more inlining might probably increase the memory footprint.
> > Results in the past have shown that it really depends on the
> > grammar wether Java/C++ performs better (at least in the past
> > it was like
> 
> Actually it's just the opposite in many cases.  Take a look at the code in
> CommonAST.cpp.  Virtually all of the methods do nothing other than set or
> return the value of the associated member variable.  If these were inlined,
> the compiler could optimize them all away.  There's no point at all in
> generating a call to getText() when it does nothing more than return the
> contents of "text".  If this was inlined, the compiler would just generate
> the code to access "text" directly.
> 
> The same thing applies to the CommonAST constructors.  They do nothing
> except initialize member variables and call the BaseAST() constructor (which
> does NOTHING!).  Here again, the compiler could optimize away the
> unnecessary calls.  And the call to text("") in the default CommonAST
> constructor is unnecessary because text is a std::string and it already
> initializes itself.  The compiler could also optimize away the do-nothing
> destructor.
> 
> BaseAST.cpp is nearly as bad.  The constructors do nothing but call the
> AST() constructor, which does nothing except initialize the "ref" member (at
> least this one is inline).

I'll have a look at these.

> > that) The C++ version has performace issues (but so has the
> > java one) It would take really structural changes to improve
> > things. Inlining changes usually are usually low priority for
> > me. If you can tell me which specific ones are the main
> > problems I'll change them. (I'm low on time so the more
> 
> The C++ version has performance issues because it doesn't allow the compiler
> to throw away all the unnecessary code.  The fact that all these unnecessary
> calls are virtual method calls just makes it that much worse.  There's no
> need for the methods to be virtual if you aren't subclassing CommonAST, so
> the virtual keyword should be changed to a #define.

The #define thing is not an option for me..

In general my approach to antlr maintenance is simple:
1. fix bugs
2. make sure functionality that's there works as advertised, still a
lot to be done there.
3. user request.
4. optimization/speed.

Combine that with the fact that I'm limited in time I can spend on
antlr makes things simple optimization stuff goes last period. The
last year has been very busy for me jobwise and next will probably be
even busier for a while due to jobswitching and moving, even now I
*should* be doing other stuff than antlr stuff....

If you want speed wait for antlr3. There I'll get the chance to design
things completely from the bottom up and also with speed in mind. And
to be honest I'd rather spend the little time I have on that than on
the antlr 2 support lib. The current lib is just a direct java to C++
port and it shows.

Cheers,

Ric
From virtualaspirin at yahoo.com  Sun Jan  2 20:33:14 2005
From: virtualaspirin at yahoo.com (Akhilesh Mritunjai)
Date: Sun Jan  2 20:33:17 2005
Subject: [antlr-interest] FEATURE REQUEST: continued and memory/speedissues
In-Reply-To: <bc607a4e05010207232757a5e3@mail.gmail.com>
Message-ID: <20050103043315.59877.qmail@web54706.mail.yahoo.com>


--- Ric Klaren <ric.klaren@gmail.com> wrote:
> >   #ifdef ANTLR_FACTORY_VIRTUAL
> >      #define FACTORY_VIRTUAL virtual
> 
> Not really to my taste to add. Doing stuff like this

Ric, I agree that it will be a maintenance headache.
On the contrary, this is by and large only way to
satisfy both, who need speed and who need flexibility.
Personally, I don't understand why making things
virtual will be so significant change... in Java every
method is virtual by default and in my test case it is
twice as fast as C++ and at same time consumes a third
less memory.

> Combine that with the fact that I'm limited in time
> I can spend on antlr makes things simple
optimization 
> stuff goes last period.

Ric, thanks a ton for your time and efforts :-) You
folks are doing one hell of a job!!

I personally will be very happy to help in this
regard. Can I send you the diffs ? If yes, then
against which release ?

Oh, Happy new year to you all out there!

Regards
- Akhilesh


		
__________________________________ 
Do you Yahoo!? 
Yahoo! Mail - Find what you need with new enhanced search.
http://info.mail.yahoo.com/mail_250
From virtualaspirin at yahoo.com  Sun Jan  2 23:57:58 2005
From: virtualaspirin at yahoo.com (Akhilesh Mritunjai)
Date: Sun Jan  2 23:57:59 2005
Subject: [antlr-interest] FEATURE REQUEST: continued and memory/speedissues
In-Reply-To: <20050103043315.59877.qmail@web54706.mail.yahoo.com>
Message-ID: <20050103075758.5548.qmail@web54708.mail.yahoo.com>


One thing more-

As of now there are three reference counted garbage
collector implementations in C++ code generator (viz-
RefCount, ASTRefCount and ref_ptr/TokenRefCount).

Among these, the ref_ptr is most feature rich
(ASTRefCount is similar, but hard coded for use with
AST class, and TokenRefCount is, I believe, adaptation
in 2.7.5 of ref_ptr (of development snapshot build)
for use with Token class [why???]). RefCount is most
simple and non-intrusive, but most inflexible one.

Is there any specific reason for all of three to
co-exist, or can we do away with all and standardize
on deriving from 'Countable' and using ref_ptr ?

Regards
- Akhilesh


		
__________________________________ 
Do you Yahoo!? 
The all-new My Yahoo! - What will yours do?
http://my.yahoo.com 
From ric.klaren at gmail.com  Mon Jan  3 02:36:47 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan  3 02:36:49 2005
Subject: [antlr-interest] FEATURE REQUEST: continued and memory/speedissues
In-Reply-To: <20050103043315.59877.qmail@web54706.mail.yahoo.com>
References: <bc607a4e05010207232757a5e3@mail.gmail.com>
	<20050103043315.59877.qmail@web54706.mail.yahoo.com>
Message-ID: <bc607a4e050103023634cc54d8@mail.gmail.com>

On Sun, 2 Jan 2005 20:33:14 -0800 (PST), Akhilesh Mritunjai
<virtualaspirin@yahoo.com> wrote:
> Ric, I agree that it will be a maintenance headache.
> On the contrary, this is by and large only way to
> satisfy both, who need speed and who need flexibility.

That's true, yet I want to get rid of most of the preprocessor 'junk'
one of these days. So I'm  not that enthousiastic to start adding now.

> Personally, I don't understand why making things
> virtual will be so significant change... in Java every
> method is virtual by default and in my test case it is
> twice as fast as C++ and at same time consumes a third
> less memory.

Would be interesting to see that grammar. Most of my 'benchmarks'
(only looking at speed) show that C++ is faster, so I guess it could
be a grammar thing. Adding a few virtuals won't hurt that much is my
guess. Making the whole ASTFactory virtual might have more of a hit
depending on the amount of tree building being done. Guess I'll stick
to making the create's virtual and see whoever needs more. The speed
lovers can always make a vendor branch of the runtime to tweak to
their needs and compilers.

> > Combine that with the fact that I'm limited in time
> > I can spend on antlr makes things simple
> optimization
> > stuff goes last period.
> 
> Ric, thanks a ton for your time and efforts :-) You
> folks are doing one hell of a job!!

You're welcome :)

> I personally will be very happy to help in this
> regard. Can I send you the diffs ? If yes, then
> against which release ?

Yesterday I already went through the AST/Parser/CharScanner classes
and moved most small things into the header except for some methods
that aren't that time critical/called that often.

With -O2 optimization this did not make any significant change with
gcc 3.4.1 on win32/mingw :(. -O3 -fexpensive optimizations actually
made things worse speed wise. I should probably retest on linux box
but the linux box I'm using isn't that fast in compiling. Anyway the
changes should appease most people I hope ;)

> Oh, Happy new year to you all out there!

Also happy new year to all =)

Cheers,

Ric
From ric.klaren at gmail.com  Mon Jan  3 02:59:35 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan  3 02:59:40 2005
Subject: [antlr-interest] FEATURE REQUEST: continued and memory/speedissues
In-Reply-To: <20050103075758.5548.qmail@web54708.mail.yahoo.com>
References: <20050103043315.59877.qmail@web54706.mail.yahoo.com>
	<20050103075758.5548.qmail@web54708.mail.yahoo.com>
Message-ID: <bc607a4e050103025973a094be@mail.gmail.com>

On Sun, 2 Jan 2005 23:57:58 -0800 (PST), Akhilesh Mritunjai
<virtualaspirin@yahoo.com> wrote:
> As of now there are three reference counted garbage
> collector implementations in C++ code generator (viz-
> RefCount, ASTRefCount and ref_ptr/TokenRefCount).

Don't get me started on those. I had planned to move to one reference
counter after 2.7.4 release. Someone contributed a pretty nifty
replacement but I didn't get it to work for 2.7.5 release so I had to
revert to the old ones just to get the release out. (The new one
worked ok, but I needed to do some tricky changes to the codegenerator
for heterogeneous AST's and that's not something I want to do 1-2
weeks before releasing a prerelease)

> Among these, the ref_ptr is most feature rich
> (ASTRefCount is similar, but hard coded for use with
> AST class, and TokenRefCount is, I believe, adaptation
> in 2.7.5 of ref_ptr (of development snapshot build)
> for use with Token class [why???]). RefCount is most
> simple and non-intrusive, but most inflexible one.

For heterogenous AST's the current reference counters allow some dirty
casting (up and down). TokenRefCount was added this release just to
get the tokenstream rewrite engine going, I must admit it's a
dirty/shamefull copy paste. Previously the C++ runtime didn't work
100% (convenient) with custom token classes. Considering time I had to
or take out the tokenstream rewrite engine or make changes to the
reference counter. (2.7.5 main goal is to get the python codegen out)

> Is there any specific reason for all of three to
> co-exist, or can we do away with all and standardize
> on deriving from 'Countable' and using ref_ptr ?

If it wasn't for heterogeneous AST support we'd be using one now, the
ones from wheatfarm.org (thanks to Mark Lentczner). Countable/ref_ptr
are not in the 2.7.5 release anymore. I could have release with
Countable/ref_ptr for the tokens/SharedInputStates and the old ones
for the AST's but it seemed better to me to release with just the old
'brand' and leave options open for after 2.7.5 release.

I will probably investigate getting rid of the reference counter for
the AST's and Tokens. This will give a good speed up and make the
heterogenous AST stuff less of a headache on the codegen front.

Cheers,

Ric
From anton.safonov at refactorit.com  Mon Jan  3 03:11:59 2005
From: anton.safonov at refactorit.com (Anton Safonov)
Date: Mon Jan  3 03:18:44 2005
Subject: [antlr-interest] java.g forks
In-Reply-To: <90a60e7604123105243c780e14@mail.gmail.com>
References: <90a60e7604123105243c780e14@mail.gmail.com>
Message-ID: <41D9287F.1020107@refactorit.com>

Hi,
In RefactorIT we used Studman's one, but then eventually fixed a number 
of issues to actually parse real life code.
Will try to extract those fixes from my notes and post it here sometime 
next week!

Anton.

Jeremy Rayner wrote:

>Hi there antlr-interest folk,
>  First a bit of background... I'm currently working on the new groovy grammar
>( http://groovy.codehaus.org ) and we're looking to replace the
>existing hand-rolled
>grammar with a more complete form.
>
>  I'm currently looking at the 'java.g' file and it's many cousins, trying to
>establish the best basis upon which to build the groovy grammar.
>  We have an initial proposal of features added to an early 1.3 grammar,
>but I feel that moving to a stable 1.5 grammar early on would be of benefit
>to all. (Save the later pain...)
>
>  I have noted the excellent work done by Terence, Matt Quail, 
>Michael Stahl and Michael Studman. It does appear that there are
>currently three live versions of the grammar, with only taste and
>functionality between them.
>
>  Terence very kindly pointed me at this analysis of the two 1.5 grammars
>by Andy Tripp...
>  http://www.antlr.org/pipermail/antlr-interest/2004-October/009742.html
>  The vibe I am getting is that Michael Studman's work will become the trunk 
>revision of the java.g file.
>
>  It was all getting a little confusing, so I've tried to put the
>current state of
>java.g into diagrammatical form.
>
>  http://groovy.javanicus.com/java-g.png
>
>I guess I've got three questions
>
>1) Is it generally accepted that Michael Studman's grammar will become core, or
>is Michael Stahl's grammar that little bit more tasteful (and flexible)
>
>2) Will the Java1.3 grammar continue, or will a firm decision be made soon; 
>that you have one true java.g file again.
>
>3) Do you like my pretty diagram :-)
>
>
>Nice to meet you all,
>
>jez.
>
>P.S. As a footnote, I tried to create a Java1.5 language recognizer
>myself using
>Metsker's bpwj API and the preview JLSv3 spec last month (
>http://tinyurl.com/46ugp )
>It is amazing how much of the syntax chapter of the JLS is no longer
>implementable,
>instead it appears that since JLSv2 the syntax in chapter18 is a mix
>of implementable
>grammar and exposition grammar.  I've lodged a few specific issues
>with their feedback
>forms, I hope Sun takes the time to ensure that JLSv3 chapter 18 is
>complete + correct.
>  
>

From jmcclain at tcshealthcare.com  Mon Jan  3 11:26:25 2005
From: jmcclain at tcshealthcare.com (John MccLain)
Date: Mon Jan  3 11:20:58 2005
Subject: [antlr-interest] I am not understanding tree grammar - please help
Message-ID: <JMEOIPJEDGMHCIOMBHLIKEELDJAA.jmcclain@tcshealthcare.com>

What I want to do is fairly straight forward.

I have a grammar (see below) which builds my AST. The AST nodes are function
identifiers, logical comparators (e.g., <,>,etc.) and math operators (e.g.,
+, -, etc..) The children of these nodes are parameters to the operation
being performed.
All I want to do is create an action for each AST node that takes the node's
children (parameters) and calls a java function with those parameters. What
I need to do is walk the tree, replaceing each AST node with the result of
the function call in its action. The goal is to return the final result into
the root node, and then print out that node.

Can I do this with ANTLR tree grammar, and if so, how (code/psuedocode would
be appreciated)???? Are there any tutorials for this kind of treewalking????

----------------------------------------------------------------------------
--

class P extends Parser;
options {buildAST=true;}

class P extends Parser;
options {buildAST=true;}

prog: expression EOF;

procedureCallStatement
  : IDENT^ (actualParameters)?
  ;

actualParameters
  : LPAREN! (expression (COMMA! expression)*)? RPAREN!
  ;

expression
  : relationalExpression (("AND"^|"OR"^) relationalExpression)*
  ;

relationalExpression
  : addingExpression ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LT^|LTE^)
addingExpression)*
  ;

addingExpression
  : multiplyingExpression ((PLUS^|MINUS^) multiplyingExpression)*
  ;

multiplyingExpression
  : signExpression ((TIMES^|DIV^|"mod"^) signExpression)*
  ;

signExpression
  : ((PLUS^|MINUS^))* booleanNegationExpression
  ;

booleanNegationExpression
  : ("not"^)* primitiveElement
  ;

primitiveElement
  :
  constantValue
  | LPAREN! expression RPAREN!
  | procedureCallStatement
  ;

constantValue
  : INTLIT
  | STRING_LITERAL
  ;

 class L extends Lexer;

options {
  charVocabulary = '\0'..'\377';
  testLiterals=false;    // don't automatically test for literals
  k=2;                   // two characters of lookahead
}

// Literals
protected DIGIT : '0'..'9'
{System.out.println("1" + getText());};

INTLIT  :  (DIGIT)+
{System.out.println("2" + getText());};
CHARLIT : '\''! . '\''!
{System.out.println("3" + getText());};

// string literals
STRING_LITERAL
  : '"'!
    ( '"' '"'!
    | ~('"'|'\n'|'\r')
    )*
    ( '"'!
    | // nothing -- write error message
    )
{System.out.println("4" + getText());};


// Keywords are literals in the parser grammar

// Operators
DOT        : '.'   ;
BECOMES    : ":="  ;
COLON      : ':'   ;
SEMI       : ';'   ;
COMMA      : ','   ;
EQUALS     : '='   ;
LBRACKET   : '['   ;
RBRACKET   : ']'   ;
DOTDOT     : ".."  ;
LPAREN     : '('
{System.out.println("5" + getText());};
RPAREN     : ')'
{System.out.println("6" + getText());};
NOT_EQUALS : "/="  ;
LT         : '<'
{System.out.println("7" + getText());};
LTE        : "<="  ;
GT         : '>'   ;
GTE        : ">="  ;
PLUS       : '+'
{System.out.println("8" + getText());};
MINUS      : '-'   ;
TIMES      : '*'   ;
DIV        : '/'   ;



// Whitespace -- ignored
WS
  : ( ' '
    | '\t'
    | '\f'

    // handle newlines
    | ( "\r\n"  // Evil DOS
      | '\r'    // Macintosh
      | '\n'    // Unix (the right way)
      )
      { newline(); }
    )
    { $setType(Token.SKIP); }
  ;


// an identifier.  Note that testLiterals is set to true!  This means
// that after we match the rule, we look in the literals table to see
// if it's a literal or really an identifer
IDENT
  options {testLiterals=true;}
  : ('a'..'z'|'A'..'Z') ('a'..'z'|'A'..'Z'|'0'..'9')*
{System.out.println("10" + getText());};


----------------------------------------------------------------------------
------------



John McClain
Senior Software Engineer
TCS Healthcare
jmcclain@tcshealthcare.com
(530)886-1700x235
"Before you criticize someone, walk a mile in their shoes.
That way, you'll be a mile from them, and you'll have their shoes."

From mstudman at gmx.net  Mon Jan  3 13:45:18 2005
From: mstudman at gmx.net (Michael Studman)
Date: Mon Jan  3 13:44:30 2005
Subject: [antlr-interest] java.g forks
In-Reply-To: <41D9287F.1020107@refactorit.com>
Message-ID: <000f01c4f1dd$84d95ac0$1c00a8c0@Baboo>

Anton,

Glad to see it's getting some use. I'm eager to see what the issues with
the grammar are as I'm also using it in the core of the next version of
Checkstyle.

Jezz,

> >1) Is it generally accepted that Michael Studman's grammar will
become
> core, or
> >is Michael Stahl's grammar that little bit more tasteful (and
flexible)

I don't think there's been a decision either way although I can't recall
anyone stating mine was generally less tasteful or flexible than Stahl's
;)

Seriously though, I've incorporated a few of Stahl's ideas into my
grammar (notably switchable enum/assert keyword support - with opposite
defaults however) so I think they are at least functionally equivalent.
Then it's just a matter of style - which segues nicely into Andy Tripp's
analysis...

I'm not sure if you've seen my response to Andy analysis as they were in
the next month's message thread, so here they are:

http://www.antlr.org/pipermail/antlr-interest/2004-November/009855.
html
http://www.antlr.org/pipermail/antlr-interest/2004-November/009861.
html

> >
> >2) Will the Java1.3 grammar continue, or will a firm decision be made
> soon;
> >that you have one true java.g file again.

I leave that answer to the Antlr illuminati.

> >
> >3) Do you like my pretty diagram :-)

Yeah, they're groovy! I'm sure you saw that one coming.

Michael Studman.

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Anton Safonov
> Sent: 03 January 2005 11:12
> To: Jeremy Rayner; antlr-interest@antlr.org
> Subject: Re: [antlr-interest] java.g forks
> 
> Hi,
> In RefactorIT we used Studman's one, but then eventually fixed a
number
> of issues to actually parse real life code.
> Will try to extract those fixes from my notes and post it here
sometime
> next week!
> 
> Anton.
> 
> Jeremy Rayner wrote:
> 
> >Hi there antlr-interest folk,
> >  First a bit of background... I'm currently working on the new
groovy
> grammar
> >( http://groovy.codehaus.org ) and we're looking to replace the
> >existing hand-rolled
> >grammar with a more complete form.
> >
> >  I'm currently looking at the 'java.g' file and it's many cousins,
> trying to
> >establish the best basis upon which to build the groovy grammar.
> >  We have an initial proposal of features added to an early 1.3
grammar,
> >but I feel that moving to a stable 1.5 grammar early on would be of
> benefit
> >to all. (Save the later pain...)
> >
> >  I have noted the excellent work done by Terence, Matt Quail,
> >Michael Stahl and Michael Studman. It does appear that there are
> >currently three live versions of the grammar, with only taste and
> >functionality between them.
> >
> >  Terence very kindly pointed me at this analysis of the two 1.5
grammars
> >by Andy Tripp...
> >  http://www.antlr.org/pipermail/antlr-interest/2004-
> October/009742.html
> >  The vibe I am getting is that Michael Studman's work will become
the
> trunk
> >revision of the java.g file.
> >
> >  It was all getting a little confusing, so I've tried to put the
> >current state of
> >java.g into diagrammatical form.
> >
> >  http://groovy.javanicus.com/java-g.png
> >
> >I guess I've got three questions
> >
> >1) Is it generally accepted that Michael Studman's grammar will
become
> core, or
> >is Michael Stahl's grammar that little bit more tasteful (and
flexible)
> >
> >2) Will the Java1.3 grammar continue, or will a firm decision be made
> soon;
> >that you have one true java.g file again.
> >
> >3) Do you like my pretty diagram :-)
> >
> >
> >Nice to meet you all,
> >
> >jez.
> >
> >P.S. As a footnote, I tried to create a Java1.5 language recognizer
> >myself using
> >Metsker's bpwj API and the preview JLSv3 spec last month (
> >http://tinyurl.com/46ugp )
> >It is amazing how much of the syntax chapter of the JLS is no longer
> >implementable,
> >instead it appears that since JLSv2 the syntax in chapter18 is a mix
> >of implementable
> >grammar and exposition grammar.  I've lodged a few specific issues
> >with their feedback
> >forms, I hope Sun takes the time to ensure that JLSv3 chapter 18 is
> >complete + correct.
> >
> >
> 
> ---
> 
> Checked by AVG anti-virus system (http://www.grisoft.com).
> Version: 6.0.825 / Virus Database: 563 - Release Date: 30/12/2004
> 

---

Checked by AVG anti-virus system (http://www.grisoft.com).
Version: 6.0.825 / Virus Database: 563 - Release Date: 30/12/2004
 

From pauljlucas at mac.com  Mon Jan  3 21:11:31 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan  3 21:11:34 2005
Subject: [antlr-interest] odd nondeterminism
Message-ID: <Pine.LNX.4.44.0501032106180.16975-100000@g4.pauljlucas.org>

	Given:

		expr : exprSingle (sortByClause)? ;

		sortByClause : SORT BY '(' sortSpec ')' ;

	I get:

		warning:nondeterminism between alts 1 and 2 of block
		upon k==1:SORT

	but I don't understand why.  SORT appears nowhere else in the
	grammar.

	- Paul

From nbsherid at secsme.org.au  Tue Jan  4 00:36:41 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Tue Jan  4 00:36:33 2005
Subject: [antlr-interest] odd nondeterminism
In-Reply-To: <Pine.LNX.4.44.0501032106180.16975-100000@g4.pauljlucas.org>
Message-ID: <000001c4f238$842eb380$0500a8c0@nigel>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Paul J. Lucas
> Sent: Tuesday, 4 January 2005 4:12 PM
> To: ANTLR Interest
> Subject: [antlr-interest] odd nondeterminism
> 
> 	Given:
> 
> 		expr : exprSingle (sortByClause)? ;
> 
> 		sortByClause : SORT BY '(' sortSpec ')' ;
> 
> 	I get:
> 
> 		warning:nondeterminism between alts 1 and 2 of block
> 		upon k==1:SORT
> 
> 	but I don't understand why.  SORT appears nowhere else in the
> 	grammar.
> 


Do you use any recursion? Maybe you can send us more of the grammar, and the
specific line number that is reported... It's difficult to help you without
more information, since you need to see the other possible alternatives.

Nigel 

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435


From ArnarB at oddi.is  Tue Jan  4 01:38:14 2005
From: ArnarB at oddi.is (Arnar Birgisson)
Date: Tue Jan  4 01:39:10 2005
Subject: [antlr-interest] I am not understanding tree grammar - please help
Message-ID: <s1da6431.060@emil.oddi.is>

Hi there,

You could have your treeparer-rules return values. Like this:

constantValue returns [Object r]
   : i:INTLIT { r = Integer.valueOf(i.getText()); }
   | s:STRING_LITERAL { r = s.getText(); }
   ;

... and ...

addingExpression returns [Object r]
   : #(PLUS op1:multiplyingExpression op2:multiplyingExpression)
          { r = YourClassWithStaticMethods.sum(a, b); }
  |  #(MINUS op3:multiplyingExpression op4:multiplyingExpression)
          { r = YourClassWithStaticMethods.subtract(a, b); }
   etc.

Look at http://www.antlr.org/doc/metalang.html#_bb12 for reference.

Happy new year everyone!

Arnar


>>> "John MccLain" <jmcclain@tcshealthcare.com> 01/03 7:26  >>>
What I want to do is fairly straight forward.

I have a grammar (see below) which builds my AST. The AST nodes are
function
identifiers, logical comparators (e.g., <,>,etc.) and math operators
(e.g.,
+, -, etc..) The children of these nodes are parameters to the
operation
being performed.
All I want to do is create an action for each AST node that takes the
node's
children (parameters) and calls a java function with those parameters.
What
I need to do is walk the tree, replaceing each AST node with the result
of
the function call in its action. The goal is to return the final result
into
the root node, and then print out that node.

Can I do this with ANTLR tree grammar, and if so, how (code/psuedocode
would
be appreciated)???? Are there any tutorials for this kind of
treewalking????

----------------------------------------------------------------------------
--

class P extends Parser;
options {buildAST=true;}

class P extends Parser;
options {buildAST=true;}

prog: expression EOF;

procedureCallStatement
  : IDENT^ (actualParameters)?
  ;

actualParameters
  : LPAREN! (expression (COMMA! expression)*)? RPAREN!
  ;

expression
  : relationalExpression (("AND"^|"OR"^) relationalExpression)*
  ;

relationalExpression
  : addingExpression ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LT^|LTE^)
addingExpression)*
  ;

addingExpression
  : multiplyingExpression ((PLUS^|MINUS^) multiplyingExpression)*
  ;

multiplyingExpression
  : signExpression ((TIMES^|DIV^|"mod"^) signExpression)*
  ;

signExpression
  : ((PLUS^|MINUS^))* booleanNegationExpression
  ;

booleanNegationExpression
  : ("not"^)* primitiveElement
  ;

primitiveElement
  :
  constantValue
  | LPAREN! expression RPAREN!
  | procedureCallStatement
  ;

constantValue
  : INTLIT
  | STRING_LITERAL
  ;

 class L extends Lexer;

options {
  charVocabulary = '\0'..'\377';
  testLiterals=false;    // don't automatically test for literals
  k=2;                   // two characters of lookahead
}

// Literals
protected DIGIT : '0'..'9'
{System.out.println("1" + getText());};

INTLIT  :  (DIGIT)+
{System.out.println("2" + getText());};
CHARLIT : '\''! . '\''!
{System.out.println("3" + getText());};

// string literals
STRING_LITERAL
  : '"'!
    ( '"' '"'!
    | ~('"'|'\n'|'\r')
    )*
    ( '"'!
    | // nothing -- write error message
    )
{System.out.println("4" + getText());};


// Keywords are literals in the parser grammar

// Operators
DOT        : '.'   ;
BECOMES    : ":="  ;
COLON      : ':'   ;
SEMI       : ';'   ;
COMMA      : ','   ;
EQUALS     : '='   ;
LBRACKET   : '['   ;
RBRACKET   : ']'   ;
DOTDOT     : ".."  ;
LPAREN     : '('
{System.out.println("5" + getText());};
RPAREN     : ')'
{System.out.println("6" + getText());};
NOT_EQUALS : "/="  ;
LT         : '<'
{System.out.println("7" + getText());};
LTE        : "<="  ;
GT         : '>'   ;
GTE        : ">="  ;
PLUS       : '+'
{System.out.println("8" + getText());};
MINUS      : '-'   ;
TIMES      : '*'   ;
DIV        : '/'   ;



// Whitespace -- ignored
WS
  : ( ' '
    | '\t'
    | '\f'

    // handle newlines
    | ( "\r\n"  // Evil DOS
      | '\r'    // Macintosh
      | '\n'    // Unix (the right way)
      )
      { newline(); }
    )
    { $setType(Token.SKIP); }
  ;


// an identifier.  Note that testLiterals is set to true!  This means
// that after we match the rule, we look in the literals table to see
// if it's a literal or really an identifer
IDENT
  options {testLiterals=true;}
  : ('a'..'z'|'A'..'Z') ('a'..'z'|'A'..'Z'|'0'..'9')*
{System.out.println("10" + getText());};


----------------------------------------------------------------------------
------------



John McClain
Senior Software Engineer
TCS Healthcare
jmcclain@tcshealthcare.com 
(530)886-1700x235
"Before you criticize someone, walk a mile in their shoes.
That way, you'll be a mile from them, and you'll have their shoes."

From ArnarB at oddi.is  Tue Jan  4 01:45:54 2005
From: ArnarB at oddi.is (Arnar Birgisson)
Date: Tue Jan  4 01:46:41 2005
Subject: [antlr-interest] I am not understanding tree grammar - please help
Message-ID: <s1da65fe.068@emil.oddi.is>

Hi again,

I'm sorry, I made a mistake, here's the correction.

The latter rule should be
addingExpression returns [Object r]
   : #(PLUS op1:multiplyingExpression op2:multiplyingExpression)
          { r = YourClassWithStaticMethods.sum(op1, op2); }
  |  #(MINUS op3:multiplyingExpression op4:multiplyingExpression)
          { r = YourClassWithStaticMethods.subtract(op3, op4); }
   etc.

Sorry for this.

Arnar

>>> "Arnar Birgisson" <ArnarB@oddi.is> 01/04 9:38  >>>
Hi there,

You could have your treeparer-rules return values. Like this:

constantValue returns [Object r]
   : i:INTLIT { r = Integer.valueOf(i.getText()); }
   | s:STRING_LITERAL { r = s.getText(); }
   ;

... and ...

addingExpression returns [Object r]
   : #(PLUS op1:multiplyingExpression op2:multiplyingExpression)
          { r = YourClassWithStaticMethods.sum(a, b); }
  |  #(MINUS op3:multiplyingExpression op4:multiplyingExpression)
          { r = YourClassWithStaticMethods.subtract(a, b); }
   etc.

Look at http://www.antlr.org/doc/metalang.html#_bb12 for reference.

Happy new year everyone!

Arnar


>>> "John MccLain" <jmcclain@tcshealthcare.com> 01/03 7:26  >>>
What I want to do is fairly straight forward.

I have a grammar (see below) which builds my AST. The AST nodes are
function
identifiers, logical comparators (e.g., <,>,etc.) and math operators
(e.g.,
+, -, etc..) The children of these nodes are parameters to the
operation
being performed.
All I want to do is create an action for each AST node that takes the
node's
children (parameters) and calls a java function with those parameters.
What
I need to do is walk the tree, replaceing each AST node with the
result
of
the function call in its action. The goal is to return the final
result
into
the root node, and then print out that node.

Can I do this with ANTLR tree grammar, and if so, how (code/psuedocode
would
be appreciated)???? Are there any tutorials for this kind of
treewalking????

----------------------------------------------------------------------------
--

class P extends Parser;
options {buildAST=true;}

class P extends Parser;
options {buildAST=true;}

prog: expression EOF;

procedureCallStatement
  : IDENT^ (actualParameters)?
  ;

actualParameters
  : LPAREN! (expression (COMMA! expression)*)? RPAREN!
  ;

expression
  : relationalExpression (("AND"^|"OR"^) relationalExpression)*
  ;

relationalExpression
  : addingExpression ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LT^|LTE^)
addingExpression)*
  ;

addingExpression
  : multiplyingExpression ((PLUS^|MINUS^) multiplyingExpression)*
  ;

multiplyingExpression
  : signExpression ((TIMES^|DIV^|"mod"^) signExpression)*
  ;

signExpression
  : ((PLUS^|MINUS^))* booleanNegationExpression
  ;

booleanNegationExpression
  : ("not"^)* primitiveElement
  ;

primitiveElement
  :
  constantValue
  | LPAREN! expression RPAREN!
  | procedureCallStatement
  ;

constantValue
  : INTLIT
  | STRING_LITERAL
  ;

 class L extends Lexer;

options {
  charVocabulary = '\0'..'\377';
  testLiterals=false;    // don't automatically test for literals
  k=2;                   // two characters of lookahead
}

// Literals
protected DIGIT : '0'..'9'
{System.out.println("1" + getText());};

INTLIT  :  (DIGIT)+
{System.out.println("2" + getText());};
CHARLIT : '\''! . '\''!
{System.out.println("3" + getText());};

// string literals
STRING_LITERAL
  : '"'!
    ( '"' '"'!
    | ~('"'|'\n'|'\r')
    )*
    ( '"'!
    | // nothing -- write error message
    )
{System.out.println("4" + getText());};


// Keywords are literals in the parser grammar

// Operators
DOT        : '.'   ;
BECOMES    : ":="  ;
COLON      : ':'   ;
SEMI       : ';'   ;
COMMA      : ','   ;
EQUALS     : '='   ;
LBRACKET   : '['   ;
RBRACKET   : ']'   ;
DOTDOT     : ".."  ;
LPAREN     : '('
{System.out.println("5" + getText());};
RPAREN     : ')'
{System.out.println("6" + getText());};
NOT_EQUALS : "/="  ;
LT         : '<'
{System.out.println("7" + getText());};
LTE        : "<="  ;
GT         : '>'   ;
GTE        : ">="  ;
PLUS       : '+'
{System.out.println("8" + getText());};
MINUS      : '-'   ;
TIMES      : '*'   ;
DIV        : '/'   ;



// Whitespace -- ignored
WS
  : ( ' '
    | '\t'
    | '\f'

    // handle newlines
    | ( "\r\n"  // Evil DOS
      | '\r'    // Macintosh
      | '\n'    // Unix (the right way)
      )
      { newline(); }
    )
    { $setType(Token.SKIP); }
  ;


// an identifier.  Note that testLiterals is set to true!  This means
// that after we match the rule, we look in the literals table to see
// if it's a literal or really an identifer
IDENT
  options {testLiterals=true;}
  : ('a'..'z'|'A'..'Z') ('a'..'z'|'A'..'Z'|'0'..'9')*
{System.out.println("10" + getText());};


----------------------------------------------------------------------------
------------



John McClain
Senior Software Engineer
TCS Healthcare
jmcclain@tcshealthcare.com 
(530)886-1700x235
"Before you criticize someone, walk a mile in their shoes.
That way, you'll be a mile from them, and you'll have their shoes."

From alexsedow at mail.ru  Tue Jan  4 02:50:56 2005
From: alexsedow at mail.ru (Alex Sedow)
Date: Tue Jan  4 02:48:50 2005
Subject: [antlr-interest] Formatter Implementation
Message-ID: <004501c4f24b$44dcb340$07060b0a@home>

I try to write formatter which generates the program using a AST-tree. How
it is better for making? It is necessary to use AST-visitor or to write
corresponding function in each AST-node?

The basic problem with AST-visitor consists that AST-node can contain a
number of tokens and children. Each child can generate any number of tokens.
For example for-statement generates the following sequence of tokens:

"for" "(" initializer-tokens ";" condition-tokens ";" iterator-tokens ")"
statement-tokens

The task of the formatter will consist in pasting tokens of the parent and
children and adding additional tokens like whitespace, newline, etc. The
variant with classical AST-visitor does not approach because each AST-node
is visited only once. Therefore I while have stopped on a variant with
expanded AST-visitor which in addition visits AST-node after each child. For
for-statement it will look so:

<-visitForStatementBefore
visit initializer
<-visitForStatementInner1AfterInitializer
visit condition
<-visitForStatementInner2AfterCondition
visit iterator
<-visitForStatementInner3AfterIterator
visit statement
<-visitForStatamentAfter

For full C# grammar it is rather bulky. About 500 functions in expanded
AST-visitor.

If somebody has experience in a writting formaters then please suggest idea.

Alex.

From ewbank at gmail.com  Tue Jan  4 05:49:54 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Tue Jan  4 05:49:57 2005
Subject: [antlr-interest] IDE for refactoring ANTLR
Message-ID: <dd3a065f050104054948933ee9@mail.gmail.com>

Hi Folks,

I've been chugging away on my ANTLR grammar and various tree grammars
(I'm using a lex-based scanner) in C++,  but now will be doing some
substantial refactoring, and that's typically a pain without the right
tools.

What have you found are the right tools?

Thank you,
- Bryan
From ArnarB at oddi.is  Tue Jan  4 05:56:34 2005
From: ArnarB at oddi.is (Arnar Birgisson)
Date: Tue Jan  4 05:57:00 2005
Subject: [antlr-interest] IDE for refactoring ANTLR
Message-ID: <s1daa0a8.087@emil.oddi.is>

Hello Brian,

>>> Bryan Ewbank <ewbank@gmail.com> 01/04 1:49  >>>
>Hi Folks,
>
>I've been chugging away on my ANTLR grammar and various tree grammars
>(I'm using a lex-based scanner) in C++,  but now will be doing some
>substantial refactoring, and that's typically a pain without the
right
>tools.
>
>What have you found are the right tools?

I have found Eclipse very good for refactoring Java code, but I haven't
tried it for a while. When I last did try it, C/C++ support was not very
good. There are some Eclipse plugins to work with ANTLR source I think
(except my memory is playing tricks on me), but haven't tried them
myself.

Arnar


From ric.klaren at gmail.com  Tue Jan  4 07:24:06 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Tue Jan  4 07:24:08 2005
Subject: [antlr-interest] newbie help with treewalker
In-Reply-To: <loom.20041230T051626-328@post.gmane.org>
References: <loom.20041230T051626-328@post.gmane.org>
Message-ID: <bc607a4e05010407245d5f9be0@mail.gmail.com>

Hi,

On Thu, 30 Dec 2004 04:28:25 +0000 (UTC), jmcclain
<jmcclain1@surewest.net> wrote:
> I am parsing expressions of the form:
> 
> left(f1("a", "b", "c"+f2(f3()), ""), 5) + mid(f1("a", "b", "c"+f2(f3()), ""),
> 5,5)
> 
> I have built the lexer and parser grammar. The parser grammar is setup to
> build an AST where each node is the function name, logical operator or logical
> comparator, and each child is a parameter of said node. What I want to do is
> associate an action with each node that calls the associated function or
> operator. I.E., each node will execute its action that will execute a function
> passing in the child nodes as parameters. 

This very much sounds like a recursive tree walk e.g. it would look
like the calc example. E.g. you recurse down the tree until you get to
the places where you have actual values (the leaves of the tree),
return the value to the level above and there the values of the
children are added/etc.

class CalcTreeWalker extends TreeParser;
expr returns [float r]
{
  float a,b;
  r = 0;
}
:   #(PLUS a=expr b=expr)   {r = a+b;}
|   #(STAR a=expr b=expr)   {r = a*b;}
|   i:INT                               {r = (float)Integer.parseInt(i.getText()
);
}
;

> The result of the function should overwrite the node. What I want is to treewalk the ast, 
> overwriting the ast nodes, until you get to the root, which will hold the final value of the
> expression.

Overwriting AST nodes is not supported you can only build a new tree
when walking or set attributes in the AST nodes.

Cheers,

Ric
From placr at hotmail.com  Tue Jan  4 08:02:37 2005
From: placr at hotmail.com (Pascal Lacroix)
Date: Tue Jan  4 08:32:18 2005
Subject: [antlr-interest] I need help!
Message-ID: <BAY102-F22922DC844D3CF3F764295A3910@phx.gbl>

Hello,

I've written a grammar for the Common Intermediate Language but there are 
some nondeterminisms.

I'm a newbie and I need help to remove these warnings (if it's possible).

There are the errors:
ANTLR Parser Generator   Version 2.7.4   1989-2004 jGuru.com
cil.g:1436: warning:nondeterminism upon
cil.g:1436:     k==1:LBRACK
cil.g:1436:     k==2:INTEGER_LITERAL,TRIPLE_DOT
cil.g:1436:     between alt 6 and exit branch of block
cil.g:1566: warning:nondeterminism upon
cil.g:1566:     k==1:LBRACK
cil.g:1566:     k==2:RBRACK
cil.g:1566:     between alt 1 and exit branch of block
cil.g:519:25: warning:lexical nondeterminism between alts 1 and 2 of block 
upon
cil.g:519:25:     k==1:'E','e'
cil.g:519:25:     k==2:<end-of-token>

Could someone help me?

Pascal.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cil.zip
Type: application/x-zip-compressed
Size: 11259 bytes
Desc: not available
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050104/dac704ee/cil.bin
From parrt at cs.usfca.edu  Tue Jan  4 12:05:52 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan  4 11:59:44 2005
Subject: [antlr-interest] odd nondeterminism
In-Reply-To: <Pine.LNX.4.44.0501032106180.16975-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501032106180.16975-100000@g4.pauljlucas.org>
Message-ID: <08E7CACC-5E8C-11D9-BC63-000A95891192@cs.usfca.edu>


On Jan 3, 2005, at 9:11 PM, Paul J. Lucas wrote:

> 	Given:
>
> 		expr : exprSingle (sortByClause)? ;
>
> 		sortByClause : SORT BY '(' sortSpec ')' ;
>
> 	I get:
>
> 		warning:nondeterminism between alts 1 and 2 of block
> 		upon k==1:SORT
>
> 	but I don't understand why.  SORT appears nowhere else in the
> 	grammar.

Then expr must be in a loop somewhere without another terminal I'd say.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From parrt at cs.usfca.edu  Tue Jan  4 12:20:17 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan  4 12:14:10 2005
Subject: [antlr-interest] tree parsing error messages
Message-ID: <0CC85717-5E8E-11D9-BC63-000A95891192@cs.usfca.edu>

Howdy folks,

It is common practice to create nodes in trees using imaginary tokens 
such as DECL or whatever.  The problem is that, because they are not 
associated with an actual input token with a line number, they have no 
line number.  Upon tree parse error you get "unexpected not DECL at 
0:0".  Not very helpful.

For 2.7.5, how about if I change getLine() so that by default it looks 
at the first child and asks for it's line information?  In one easy 
change, error messages should improve :)

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From joshua.davis at kiodex.com  Tue Jan  4 12:43:02 2005
From: joshua.davis at kiodex.com (Joshua Davis)
Date: Tue Jan  4 12:42:50 2005
Subject: [antlr-interest] tree parsing error messages
Message-ID: <4AE2782C2093B34784E67971035A8160019F755E@ehost011-2.exch011.intermedia.net>

I noticed that synthetic tokens don't produce nice line numbers, if it's
a simple change that sounds like a good idea.

joshua@hibernate.org 

> -----Original Message-----
> From: Terence Parr [mailto:parrt@cs.usfca.edu] 
> Sent: Tuesday, January 04, 2005 3:20 PM
> To: ANTLR Interest
> Subject: [antlr-interest] tree parsing error messages
> 
> Howdy folks,
> 
> It is common practice to create nodes in trees using 
> imaginary tokens such as DECL or whatever.  The problem is 
> that, because they are not associated with an actual input 
> token with a line number, they have no line number.  Upon 
> tree parse error you get "unexpected not DECL at 0:0".  Not 
> very helpful.
> 
> For 2.7.5, how about if I change getLine() so that by default 
> it looks at the first child and asks for it's line 
> information?  In one easy change, error messages should improve :)
> 
> Ter
> --
> CS Professor & Grad Director, University of San Francisco 
> Creator, ANTLR Parser Generator, http://www.antlr.org 
> Cofounder, http://www.jguru.com Cofounder, 
> http://www.knowspam.net enjoy email again!
> 
> 
>                                                               
>                                                       
> Disclaimer: This e-mail may contain confidential and 
> privileged material for the sole use of the intended 
> recipient(s).  If you are not the intended recipient (or 
> authorized to receive this e-mail for the recipient), please 
> note that review, use, distribution or disclosure of any part 
> of this e-mail is strictly prohibited, except that you should 
> please contact the sender or notify Kiodex, Inc. at 
> notices@kiodex.com that you have received this message in 
> error, and delete all copies of the message.  This e-mail and 
> any attachments hereto are the property of Kiodex, Inc. 
> and/or its relevant affiliate, and are not intended to be an 
> offer or an acceptance, and do not create or evidence a 
> binding and enforceable contract between Kiodex, Inc. or any 
> of its affiliates and the intended recipient or any other 
> party, and may not be relied on by anyone as the basis of a 
> contract by estoppel or otherwise.
> 
From parrt at cs.usfca.edu  Tue Jan  4 13:42:30 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan  4 13:36:24 2005
Subject: [antlr-interest] tree parsing error messages
In-Reply-To: <4AE2782C2093B34784E67971035A8160019F755E@ehost011-2.exch011.intermedia.net>
References: <4AE2782C2093B34784E67971035A8160019F755E@ehost011-2.exch011.intermedia.net>
Message-ID: <88B557A3-5E99-11D9-BC63-000A95891192@cs.usfca.edu>


On Jan 4, 2005, at 12:43 PM, Joshua Davis wrote:

> I noticed that synthetic tokens don't produce nice line numbers, if 
> it's
> a simple change that sounds like a good idea.

Hi.  I spoke too soon.  The default implementation of BaseAST and even 
CommonAST are too stupid in current ANTLR.  For example, no setLine() 
method on AST and I don't want to break backward compatibility to add 
it to the interface.  Argh!!!!

In my trees, I carry the token object around as a payload.  Then my 
getLine() override is simply:

     public int getLine() {
		int line=0;
         if ( token!=null ) {
             line = token.getLine();
         }
		if ( line==0 ) {
			AST child = getFirstChild();
			if ( child!=null ) {
				line = child.getLine();
			}
		}
         return line;
     }

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From nbsherid at secsme.org.au  Tue Jan  4 15:14:54 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Tue Jan  4 15:14:58 2005
Subject: [antlr-interest] I need help!
In-Reply-To: <BAY102-F22922DC844D3CF3F764295A3910@phx.gbl>
Message-ID: <000d01c4f2b3$33682eb0$0500a8c0@nigel>

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Pascal Lacroix
> Sent: Wednesday, 5 January 2005 3:03 AM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] I need help!
> 
> Hello,
> 
> I've written a grammar for the Common Intermediate Language but there are
> some nondeterminisms.
> 
> I'm a newbie and I need help to remove these warnings (if it's possible).
> 
> There are the errors:
> ANTLR Parser Generator   Version 2.7.4   1989-2004 jGuru.com
> cil.g:1436: warning:nondeterminism upon
> cil.g:1436:     k==1:LBRACK
> cil.g:1436:     k==2:INTEGER_LITERAL,TRIPLE_DOT
> cil.g:1436:     between alt 6 and exit branch of block
> cil.g:1566: warning:nondeterminism upon
> cil.g:1566:     k==1:LBRACK
> cil.g:1566:     k==2:RBRACK
> cil.g:1566:     between alt 1 and exit branch of block
> cil.g:519:25: warning:lexical nondeterminism between alts 1 and 2 of block
> upon
> cil.g:519:25:     k==1:'E','e'
> cil.g:519:25:     k==2:<end-of-token>
> 


Hey you don't look like a newbie, that's a pretty complicated grammar!!


I couldn't find the first one, the grammar was just too messy and all over
the place, and I've been searching for quite a while.

The second one is between "nativeTypePostFix" and "variantTypePostFix"... it
might be either LBRACK RBRACK in line 1516 or line 1566 (zero or more times
for each of them).

The last one is between the 'e' or 'E' in 'a'..'f' (line 519) and the 'e' or
'E' in EXPONENT (line 523/530) ... 

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435
 



From yjargudo at tiscali.es  Wed Jan  5 01:08:33 2005
From: yjargudo at tiscali.es (yjargudo@tiscali.es)
Date: Wed Jan  5 01:21:54 2005
Subject: [antlr-interest] visual basic .net grammar
Message-ID: <417DFBAD00013118@genova.tiscali.red>

Hello,

I want to know where can I get an ANTLR grammar for visual basic .net. 
I tried to find it in antlr web page but there isn' t any grammar for visula
basic .net

Thanks a lot 

Yolanda

ADSL 640 Kbps + llamadas nacionales y locales 24h  por s?lo 34,95 euros/mes

http://www.tiscali.es/acceso/adsl_dual.jsp



From placr at hotmail.com  Wed Jan  5 01:51:28 2005
From: placr at hotmail.com (Pascal Lacroix)
Date: Wed Jan  5 01:52:20 2005
Subject: [antlr-interest] I need help!
In-Reply-To: <000d01c4f2b3$33682eb0$0500a8c0@nigel>
Message-ID: <BAY102-F370B0CF1C4F076743965EAA3920@phx.gbl>

> > -----Original Message-----
> > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > bounces@antlr.org] On Behalf Of Pascal Lacroix
> > Sent: Wednesday, 5 January 2005 3:03 AM
> > To: antlr-interest@antlr.org
> > Subject: [antlr-interest] I need help!
> >
> > Hello,
> >
> > I've written a grammar for the Common Intermediate Language but there 
>are
> > some nondeterminisms.
> >
> > I'm a newbie and I need help to remove these warnings (if it's 
>possible).
> >
> > There are the errors:
> > ANTLR Parser Generator   Version 2.7.4   1989-2004 jGuru.com
> > cil.g:1436: warning:nondeterminism upon
> > cil.g:1436:     k==1:LBRACK
> > cil.g:1436:     k==2:INTEGER_LITERAL,TRIPLE_DOT
> > cil.g:1436:     between alt 6 and exit branch of block
> > cil.g:1566: warning:nondeterminism upon
> > cil.g:1566:     k==1:LBRACK
> > cil.g:1566:     k==2:RBRACK
> > cil.g:1566:     between alt 1 and exit branch of block
> > cil.g:519:25: warning:lexical nondeterminism between alts 1 and 2 of 
>block
> > upon
> > cil.g:519:25:     k==1:'E','e'
> > cil.g:519:25:     k==2:<end-of-token>
> >
>
>
>Hey you don't look like a newbie, that's a pretty complicated grammar!!
>
>
>I couldn't find the first one, the grammar was just too messy and all over
>the place, and I've been searching for quite a while.
>
>The second one is between "nativeTypePostFix" and "variantTypePostFix"... 
>it
>might be either LBRACK RBRACK in line 1516 or line 1566 (zero or more times
>for each of them).
>
>The last one is between the 'e' or 'E' in 'a'..'f' (line 519) and the 'e' 
>or
>'E' in EXPONENT (line 523/530) ...
>
>--
>Nigel Sheridan-Smith
>PhD research student
>

It's true that it's a complicated grammar (but that's Microsoft fault!).

Could you give me some advices to make a better grammar?

Thanks for your help, I'll try to remove thoses nondeterminismes.

Pascal Lacroix.


From ewbank at gmail.com  Wed Jan  5 08:10:47 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Wed Jan  5 08:10:52 2005
Subject: [antlr-interest] Rewriting an N-child node to a tree
Message-ID: <dd3a065f0501050810a037cba@mail.gmail.com>

I have a grammar that produces a (very flat) tree that looks like this
- using expressions as an example:

    #(EXPR ID PLUS ID MULT ID)

I want to rewrite this tree to be a standard binary expression tree:
    #(EXPR #(PLUS ID #(MULT ID ID)))

However, when I try any tree rewrite stuff it (of course) trashes the
sibling node of the expression being processed and dies.

How would you do this?  Is it possible/practical, or do I give up and
rewrite the parser to generate the binary expression tree directly?

Thanks,
- Bryan Ewbank
From parrt at cs.usfca.edu  Thu Jan  6 14:56:30 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Thu Jan  6 14:50:22 2005
Subject: [antlr-interest] hmm...is this list still working?
Message-ID: <344C419A-6036-11D9-BC63-000A95891192@cs.usfca.edu>

Howdy...strange drop in traffic.  Bryan Ewbank noticed it too...testing.
Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From Loring.G.Craymer at jpl.nasa.gov  Thu Jan  6 15:02:53 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Thu Jan  6 15:02:58 2005
Subject: [antlr-interest] hmm...is this list still working?
In-Reply-To: <344C419A-6036-11D9-BC63-000A95891192@cs.usfca.edu>
References: <344C419A-6036-11D9-BC63-000A95891192@cs.usfca.edu>
Message-ID: <6.1.1.1.2.20050106145919.01fbab90@mail.jpl.nasa.gov>

I got this one.  It could be the interface.  Despite the downsides of 
yahoo, the web interface was convenient--you could go browse messages at 
leisure rather than having them buried in the email pile.

--Loring


At 02:56 PM 1/6/2005, Terence Parr wrote:
>Howdy...strange drop in traffic.  Bryan Ewbank noticed it too...testing.
>Ter
>--
>CS Professor & Grad Director, University of San Francisco
>Creator, ANTLR Parser Generator, http://www.antlr.org
>Cofounder, http://www.jguru.com
>Cofounder, http://www.knowspam.net enjoy email again!
>
>


From ewbank at gmail.com  Thu Jan  6 16:32:00 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Thu Jan  6 16:32:06 2005
Subject: [antlr-interest] hmm...is this list still working?
In-Reply-To: <6.1.1.1.2.20050106145919.01fbab90@mail.jpl.nasa.gov>
References: <344C419A-6036-11D9-BC63-000A95891192@cs.usfca.edu>
	<6.1.1.1.2.20050106145919.01fbab90@mail.jpl.nasa.gov>
Message-ID: <dd3a065f05010616327a6b7bb9@mail.gmail.com>

Might there be a way to get an RSS feed of the topics?  Alternately,
you can use rules to dump them into a separate place and then browse
them later...

On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
<Loring.G.Craymer@jpl.nasa.gov> wrote:
> I got this one.  It could be the interface.  Despite the downsides of
> yahoo, the web interface was convenient--you could go browse messages at
> leisure rather than having them buried in the email pile.
From ArnarB at oddi.is  Fri Jan  7 01:34:04 2005
From: ArnarB at oddi.is (Arnar Birgisson)
Date: Fri Jan  7 01:34:39 2005
Subject: [antlr-interest] hmm...is this list still working?
Message-ID: <s1de57a2.028@emil.oddi.is>

You always have the archives:
http://www.antlr.org/pipermail/antlr-interest/. You can't reply
to messages there though.

Mailman can also be made to replicate the messages to and from an NNTP
server, for which there are numerous advanced web interfaces available.

Googling for "mailman rss" reveals several implementations, some
patches on mailman itself (see http://www.amk.ca/pipermail/rdfp/rss.xml
for an example), and some are scripts that harvest rss information from
the mailman-generated archives. Patching mailman would be the ideal
solution and http://rogue.amk.ca/pipermail/rdfp/2003-July/000200.html
looks promising but the author doesn't provide the patch. There is
another one at http://rdfweb.org/2003/06/mailman-rss/rsspatch but no
example output provided. These are very simple patches (mailman is
written in Python) so implementing/modifying one for antlr-interest
should be very easy.

Arnar

>>> Bryan Ewbank <ewbank@gmail.com> 01/07 12:32  >>>
Might there be a way to get an RSS feed of the topics?  Alternately,
you can use rules to dump them into a separate place and then browse
them later...

On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
<Loring.G.Craymer@jpl.nasa.gov> wrote:
> I got this one.  It could be the interface.  Despite the downsides
of
> yahoo, the web interface was convenient--you could go browse messages
at
> leisure rather than having them buried in the email pile.
From anakreonmejdi at yahoo.gr  Thu Jan  6 06:04:34 2005
From: anakreonmejdi at yahoo.gr (Anakreon)
Date: Fri Jan  7 05:30:43 2005
Subject: [antlr-interest] Re: visual basic .net grammar
In-Reply-To: <417DFBAD00013118@genova.tiscali.red>
References: <417DFBAD00013118@genova.tiscali.red>
Message-ID: <crjguv$s6u$1@sea.gmane.org>

yjargudo@tiscali.es wrote:
> Hello,
> 
> I want to know where can I get an ANTLR grammar for visual basic .net. 
> I tried to find it in antlr web page but there isn' t any grammar for visula
> basic .net
> 
> Thanks a lot 
> 
> Yolanda
> 
> ADSL 640 Kbps + llamadas nacionales y locales 24h  por s?lo 34,95 euros/mes
> 
> http://www.tiscali.es/acceso/adsl_dual.jsp

There is a grammar for VBScript which you could use as a starting point.

Anakreon

From clockwize at blueyonder.co.uk  Fri Jan  7 14:13:04 2005
From: clockwize at blueyonder.co.uk (clocKwize)
Date: Fri Jan  7 14:13:03 2005
Subject: [antlr-interest] C++ problem, just exits with code -1
Message-ID: <41DF0970.6030206@blueyonder.co.uk>

hi, i'm using dev-c++, i've created a static lib, and used the calc 
example, but change it so it takes a string directly for parsing.

if i give it "1+2;" it parses fine, if i give it "1+2" it says missing 
SEMI, which is great, but if i pass it something totally wrong, like 
"1,2,3,4" it just exits...

any idea why this happens?


thank you,

Mike
From ric.klaren at gmail.com  Fri Jan  7 14:35:57 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Fri Jan  7 14:36:01 2005
Subject: [antlr-interest] C++ problem, just exits with code -1
In-Reply-To: <41DF0970.6030206@blueyonder.co.uk>
References: <41DF0970.6030206@blueyonder.co.uk>
Message-ID: <bc607a4e050107143578467c06@mail.gmail.com>

Hi,

On Fri, 07 Jan 2005 22:13:04 +0000, clocKwize
<clockwize@blueyonder.co.uk> wrote:
> hi, i'm using dev-c++, i've created a static lib, and used the calc
> example, but change it so it takes a string directly for parsing.
> 
> if i give it "1+2;" it parses fine, if i give it "1+2" it says missing
> SEMI, which is great, but if i pass it something totally wrong, like
> "1,2,3,4" it just exits...
> 
> any idea why this happens?

Try adding:

charVocabulary='\u0003'..'\u00FF';

To the lexer options. It is probably exiting due to encountering a
character outside the character vocabulary defined in the lexer rules
so far. Although I'd suspect that it should print an error message
about encountering an exception during lexing.

BTW the default charVocabulary will change to the above in the 2.7.5
release of antlr.

Cheers,

Ric
From oliver.kowalke at gmx.de  Sat Jan  8 01:16:45 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Sat Jan  8 01:16:49 2005
Subject: [antlr-interest] productions in arbitrary order
Message-ID: <8544.1105175805@www29.gmx.net>

Hello,

maybe I've a stupid newbie question.
I want to use antlr in order to parse a spezial file structure.
The entries (starting with a key word followed by some datas and separated
by semicolons) can occur in an arbitrary order. How can I express this in
the antlr grammar file?
with best regards
Oliver

-- 
+++ Sparen Sie mit GMX DSL +++ http://www.gmx.net/de/go/dsl
AKTION fr Wechsler: DSL-Tarife ab 3,99 EUR/Monat + Startguthaben
From oliver.kowalke at gmx.de  Sat Jan  8 02:04:16 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Sat Jan  8 02:04:19 2005
Subject: [antlr-interest] why is second input line not matched?
Message-ID: <22281.1105178656@www29.gmx.net>

Hello,

I need some help. I've no idea (newbie to grammar writing) why the second
input line isn't matched!
thank you for your hints!
with best regards
Oliver

--- input ---

fileVersion 1		0;
FileTimeStamp 0 0;



--- grammar ---

header "pre_include_hpp" 
{
    #include <iostream>
}

options
{
	language="Cpp";
	namespace="kla"; 
}



/////////////////////////////////////////////////////////////////////      
//	Lexer
/////////////////////////////////////////////////////////////////////  
    
class KlarfLexer extends Lexer;

options 
{
    k=2;	
    exportVocab=KLARF;
    charVocabulary='\u0000'..'\u007F';
    caseSensitive=false;
	caseSensitiveLiterals=false;
}

DELIM 
	: ( ' '
	| '\t'
	| '\f'
	|	( "\r\n"
		| '\r'
		| '\n'
		)
		{ newline(); }
	)
;
        
RECORD
	: ( ~( ' ' | ';' | '\r' | '\n' | '\t' | '\f' | '"' ) ( ~( ' ' | ';' | '\r'
| '\t' | '\f' | '\n' ) )* ) 
	| ('"' (~'"')* '"')+ 
; 

EODS 
	: ';' 
; 

      
      
/////////////////////////////////////////////////////////////////////
//	Parser
/////////////////////////////////////////////////////////////////////

class KlarfParser extends Parser;

options 
{	
	k=1;	
    exportVocab=KLARF;
}

parse 
	: ( dataset (EODS)+ )+
;

dataset
	{ std::cout << "begin of dataset" << std::endl; }
	: record ( (DELIM)+ record)*
	{ std::cout << "end of dataset" << std::endl; }
;

record
	: r:RECORD
    { std::cout << r->getText() << std::endl; }
;

-- 
+++ GMX - die erste Adresse fr Mail, Message, More +++
1 GB Mailbox bereits in GMX FreeMail http://www.gmx.net/de/go/mail
From ewbank at gmail.com  Sat Jan  8 03:35:51 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Sat Jan  8 03:35:56 2005
Subject: [antlr-interest] why is second input line not matched?
In-Reply-To: <22281.1105178656@www29.gmx.net>
References: <22281.1105178656@www29.gmx.net>
Message-ID: <dd3a065f050108033577711d89@mail.gmail.com>

The short answer is that the parser stops when it sees something that
doesn't match, and whitespace after a semicolon is not allowed in the
input grammar.  If you used a loop in your main, you would see a
syntax error on the second attempt to call the "parse" production.

--- --- ---

The (perhaps better) answer is a bit more long-winded:

First, add EOF to the end of the parser production if your intention
is to parse a whole file.

If you now rebuild and run your testcase, you will get a syntax error
because there is whitespace (a newline) after the semicolon on the
first line, and that does not match anything in your grammar.

The easiest way to fix this is to hide whitespace from the parser:
(1) Remove reference to DELIM from the parser
(2) Add the following at the end of the production for DELIM in the lexer:
   { $setType(antlr::Token::SKIP); }
This will cause the lexer to eat all DELIM (whitespace), so the parser
never sees it.

Your ANTLR should now eat your input file.

Hope this helps,
- Bryan
From oliver.kowalke at gmx.de  Sat Jan  8 05:19:16 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Sat Jan  8 05:19:21 2005
Subject: [antlr-interest] how to resolve the nondeterminism between INT and
	DATE?
Message-ID: <17654.1105190356@www74.gmx.net>

Hello,
I've a problem resolving a nondeterminism between INT and DATE
('mm'-'dd'-'yy'). Could you give me a hint pleas.
thanks
Oliver

--- grammar ---

header "pre_include_hpp" 
{
    #include <iostream>
}

options
{
	language="Cpp";
	namespace="kla"; 
}



/////////////////////////////////////////////////////////////////////      
//	Lexer
/////////////////////////////////////////////////////////////////////  
    
class KlarfLexer extends Lexer;

options 
{
    k=3;	
    exportVocab=KLARF;
    charVocabulary='\u0000'..'\u007F';
    caseSensitive=false;
    caseSensitiveLiterals=false;
}

tokens
{
	FILEVERSION="fileversion";
	FILETIMESTAMP="filetimestamp";
}

INT
	: ( '0'..'9' )+
;

CHARLIT
	: '\''! . '\''!
;

IDENT
  : ( 'a'..'z' ) ( 'a'..'z' | '0'..'9' )*
;
        
EODS 
	: ';' 
; 

DELIM 
	: ( ' '
	| '\t'
	| '\f'
	|	( "\r\n"
		| '\r'
		| '\n'
		)
		{ newline(); }
	)
	{ $setType(antlr::Token::SKIP); }
;

DATE
	: ( ('0'..'9')('0'..'9') '-')=>
		('0'..'9')('0'..'9') '-' ('0'..'9')('0'..'9') '-' ('0'..'9')('0'..'9')
	| { $setType(INT); }
;
 
      
      
/////////////////////////////////////////////////////////////////////
//	Parser
/////////////////////////////////////////////////////////////////////

class KlarfParser extends Parser;

options 
{	
	k=1;	
    exportVocab=KLARF;
}

parse 
	: ( dataset ( EODS )+ )+ EOF
;

dataset
	: fileversion | filetimestamp
;

fileversion
	{ int i1, i2; }
	: FILEVERSION i1=int32 i2=int32
	{ std::cout << "FileVersion = " << i1 << "." << i2 << std::endl; }
;

filetimestamp
	: FILETIMESTAMP r1:DATE r2:IDENT
	{ std::cout << "FileTimeStamp = " << r1->getText() << " " << r2->getText()
<< std::endl; }
;

int32
	returns [ int ret ]
	: i:INT
	{ ret = atoi( i->getText().c_str() ); }
;

-- 
+++ GMX - die erste Adresse fr Mail, Message, More +++
1 GB Mailbox bereits in GMX FreeMail http://www.gmx.net/de/go/mail
From clockwize at blueyonder.co.uk  Sat Jan  8 11:42:38 2005
From: clockwize at blueyonder.co.uk (clocKwize)
Date: Sat Jan  8 11:42:39 2005
Subject: [antlr-interest] expecting "class", found 'class'
Message-ID: <41E037AE.9060202@blueyonder.co.uk>

anyone know why this would happen, I totally new to antlr and I'm just 
playing, I have:

class_def        :    "class" IDENT ("extends" IDENT)? SEMI;

...

IDENT options {testLiterals=true;}
            : ('a'..'z' | 'A'..'Z') ('a'..'z'|'A'..'Z'|'_'| DIGIT)*;
           
protected
DIGIT            :    '0'..'9';

WS            :    (' ' | '\t' | '\n' | '\r') { _ttype = 
ANTLR_USE_NAMESPACE(antlr)Token::SKIP; };


in my test file i have: "class ClassName extends Moo;"



Thanks,


Mike
From krishanu.debnath at gmail.com  Sun Jan  9 07:13:42 2005
From: krishanu.debnath at gmail.com (Krishanu Debnath)
Date: Sun Jan  9 07:13:46 2005
Subject: [antlr-interest] expecting "class", found 'class'
In-Reply-To: <41E037AE.9060202@blueyonder.co.uk>
References: <41E037AE.9060202@blueyonder.co.uk>
Message-ID: <9fa1fefc05010907137112d3ef@mail.gmail.com>

On Sat, 08 Jan 2005 19:42:38 +0000, clocKwize
<clockwize@blueyonder.co.uk> wrote:
> anyone know why this would happen, I totally new to antlr and I'm just
> playing, I have:
> 
> class_def        :    "class" IDENT ("extends" IDENT)? SEMI;
> 
> ...
> 
> IDENT options {testLiterals=true;}
>            : ('a'..'z' | 'A'..'Z') ('a'..'z'|'A'..'Z'|'_'| DIGIT)*;
> 
> protected
> DIGIT            :    '0'..'9';
> 
> WS            :    (' ' | '\t' | '\n' | '\r') { _ttype =
> ANTLR_USE_NAMESPACE(antlr)Token::SKIP; };
> 
> in my test file i have: "class ClassName extends Moo;"
> 
> Thanks,
> 
> Mike
> 

You need to declare the token "class" in token section of your lexer.

Krishanu

-- 
"When I have to rely on inadequacy, I prefer it to be my own."
--Richard Heathfield
From clockwize at blueyonder.co.uk  Sun Jan  9 08:11:19 2005
From: clockwize at blueyonder.co.uk (clocKwize)
Date: Sun Jan  9 08:11:12 2005
Subject: [antlr-interest] how can i fix this
Message-ID: <41E157A7.6060306@blueyonder.co.uk>

MyParser.g:11: warning:nondeterminism upon
MyParser.g:11:     k==1:"public","private",VAR_TYPE
MyParser.g:11:     between alt 1 and exit branch of block


script        :    class_dec (globalvar_dec)* (function_dec)*;

class_dec    :    TOK_class IDENT (TOK_extends IDENT)? SEMI;

globalvar_dec    :    (TOK_private | TOK_public)? VAR_TYPE IDENT (ASSIGN 
(STR_LIT | INT_LIT))? SEMI;

function_dec    :    (TOK_private | TOK_public)? VAR_TYPE IDENT LPAREN 
(param_dec_list)? RPAREN SEMI;
param_dec_list    :    param_dec (COMMA param_dec)*;
param_dec    :    VAR_TYPE IDENT (ASSIGN (STR_LIT | INT_LIT))?;

with this say i have

class Moo;

public int MyFunc();

it thinks its a globalvar_dec, and says "unexpected token '('".

as i'm very new to antlr i'm not sure how i can fix it


Regards,

Mike

(I'm sure you'll be getting alot more posts like this one :x)

From prashantdeva at yahoo.com  Sun Jan  9 14:17:58 2005
From: prashantdeva at yahoo.com (Prashant Deva)
Date: Sun Jan  9 14:17:59 2005
Subject: [antlr-interest] hmm...is this list still working?
In-Reply-To: <s1de57a2.028@emil.oddi.is>
Message-ID: <20050109221758.60442.qmail@web53806.mail.yahoo.com>

Terrence,
   Why dont you put up a bulleting board like 'phpbb'.
I believe that is a better alternative than mailing
lists, newsgroups, etc.

PRASHANT

--- Arnar Birgisson <ArnarB@oddi.is> wrote:

> You always have the archives:
> http://www.antlr.org/pipermail/antlr-interest/.
> You can't reply
> to messages there though.
> 
> Mailman can also be made to replicate the messages
> to and from an NNTP
> server, for which there are numerous advanced web
> interfaces available.
> 
> Googling for "mailman rss" reveals several
> implementations, some
> patches on mailman itself (see
> http://www.amk.ca/pipermail/rdfp/rss.xml
> for an example), and some are scripts that harvest
> rss information from
> the mailman-generated archives. Patching mailman
> would be the ideal
> solution and
>
http://rogue.amk.ca/pipermail/rdfp/2003-July/000200.html
> looks promising but the author doesn't provide the
> patch. There is
> another one at
> http://rdfweb.org/2003/06/mailman-rss/rsspatch but
> no
> example output provided. These are very simple
> patches (mailman is
> written in Python) so implementing/modifying one for
> antlr-interest
> should be very easy.
> 
> Arnar
> 
> >>> Bryan Ewbank <ewbank@gmail.com> 01/07 12:32  >>>
> Might there be a way to get an RSS feed of the
> topics?  Alternately,
> you can use rules to dump them into a separate place
> and then browse
> them later...
> 
> On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
> <Loring.G.Craymer@jpl.nasa.gov> wrote:
> > I got this one.  It could be the interface. 
> Despite the downsides
> of
> > yahoo, the web interface was convenient--you could
> go browse messages
> at
> > leisure rather than having them buried in the
> email pile.
> 



		
__________________________________ 
Do you Yahoo!? 
Yahoo! Mail - Helps protect you from nasty viruses. 
http://promotions.yahoo.com/new_mail
From nbsherid at secsme.org.au  Sun Jan  9 14:38:24 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Sun Jan  9 14:38:31 2005
Subject: [antlr-interest] Left-factoring and recursion
Message-ID: <000101c4f69b$edfe8260$a428198a@nigelnote>


Hi everyone,

I was wondering if there are any tools out there that help with
left-factoring, or converting from LALR/LR to LL(k)? 

I am trying to do a Structure of Management Information (SMI) grammar for
networking devices. I tried the ANTLR ASN.1 grammar that already exists, but
it had a few non-determinisms and the like, so I started to do my own since
it looked pretty messy to fix up. However, now I have even more
non-determinisms because the X.680-683 standards seem to favour
left-recursion (like just about everyone else). So I'm faced with the huge
and complicated left-factoring task, or I can switch back to the existing
ASN.1 grammar and try and extend that.

Any ideas? 

I found a few links from ANTLR/PCCTS users:

http://www.zenspider.com/Languages/PCCTS/LR2LL.html
http://www.javadude.com/articles/lalrtoll.html

But these are just very high-level. What I really need is a tool that either
helps in clarifying what the non-determinisms are given a particular ANTLR
grammar, or even attempts to left-factor on its own.

Cheers

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435 


From clockwize at blueyonder.co.uk  Sun Jan  9 14:52:01 2005
From: clockwize at blueyonder.co.uk (clocKwize)
Date: Sun Jan  9 14:51:53 2005
Subject: [antlr-interest] my next easy question.. :)
Message-ID: <41E1B591.3050601@blueyonder.co.uk>

hi..again

STR_LIT        :    '"' (ESCAPES | ~('"'|'\\'| NEWLINE))* '"';

protected
NEWLINE
options {paraphrase = "a new line";}
        :    ('\n'
            |'\r'
            );

i want the paraphrase so it gives me a nice message if they have a new 
line inside the string etc, but i can't put a rule inside the invert 
rule, because it only likes 'a' | 'b' | 'c' or ranges, as a matter of 
fact, even if i do ~(NEWLINE)

protected
NEWLINE: '\n' | '\r';

which is the same as ~('\n' | '\r') it doesn't like it...

Thank you

Mike
From Loring.G.Craymer at jpl.nasa.gov  Sun Jan  9 21:00:37 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Sun Jan  9 21:00:42 2005
Subject: [antlr-interest] Left-factoring and recursion
In-Reply-To: <000101c4f69b$edfe8260$a428198a@nigelnote>
Message-ID: <200501100500.j0A50bx5023157@eis-msg-012.jpl.nasa.gov>

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Nigel Sheridan-Smith
> Sent: Sunday, January 09, 2005 2:38 PM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] Left-factoring and recursion
> 
> 
> Hi everyone,
> 
> I was wondering if there are any tools out there that help with
> left-factoring, or converting from LALR/LR to LL(k)?
> 
> I am trying to do a Structure of Management Information (SMI) grammar for
> networking devices. I tried the ANTLR ASN.1 grammar that already exists,
> but
> it had a few non-determinisms and the like, so I started to do my own
> since
> it looked pretty messy to fix up. However, now I have even more
> non-determinisms because the X.680-683 standards seem to favour
> left-recursion (like just about everyone else). So I'm faced with the huge
> and complicated left-factoring task, or I can switch back to the existing
> ASN.1 grammar and try and extend that.
> 
> Any ideas?
> 
> I found a few links from ANTLR/PCCTS users:
> 
> http://www.zenspider.com/Languages/PCCTS/LR2LL.html
> http://www.javadude.com/articles/lalrtoll.html
> 
> But these are just very high-level. What I really need is a tool that
> either
> helps in clarifying what the non-determinisms are given a particular ANTLR
> grammar, or even attempts to left-factor on its own.
> 
> Cheers
> 
> Nigel
> 
> --
> Nigel Sheridan-Smith
> PhD research student
> 
> Faculty of Engineering
> University of Technology, Sydney
> Phone: 02 9514 7946
> Fax: 02 9514 2435

Nigel--

Use syntactic predicates as a first step for removing non-determinisms.
Some of the ANTLR 2 reported non-determinisms are not real, and result from
the approximate LLk algorithm.  Once you have a working grammar, left-factor
if you need the added performance.  I note that ANTLR 3 does/will do
automatic left-factoring and will remove predicates where they are unneeded;
does it make sense to spend a lot of effort manually left-factoring when the
tool will do it for you within a year?

--Loring

From joanpujol at gmail.com  Mon Jan 10 02:55:32 2005
From: joanpujol at gmail.com (Joan Pujol)
Date: Mon Jan 10 02:55:34 2005
Subject: [antlr-interest] how can i fix this
In-Reply-To: <41E157A7.6060306@blueyonder.co.uk>
References: <41E157A7.6060306@blueyonder.co.uk>
Message-ID: <d2d18a1050110025511fd717a@mail.gmail.com>

On Sun, 09 Jan 2005 16:11:19 +0000, clocKwize
<clockwize@blueyonder.co.uk> wrote:
> MyParser.g:11: warning:nondeterminism upon
> MyParser.g:11:     k==1:"public","private",VAR_TYPE
> MyParser.g:11:     between alt 1 and exit branch of block
> 
> script        :    class_dec (globalvar_dec)* (function_dec)*;
> 
> globalvar_dec    :    (TOK_private | TOK_public)? VAR_TYPE IDENT (ASSIGN
> (STR_LIT | INT_LIT))? SEMI;
> 
> function_dec    :    (TOK_private | TOK_public)? VAR_TYPE IDENT LPAREN

With a lookahead of 1 token the parser doesn't know if it have to
match the tokens in globalvar or in function_dec.

You have to factorize your gramar:

script        :    class_dec (TOK_private | TOK_public)? VAR_TYPE
IDENT (globalvar_dec)* (function_dec)*;

globalvar_dec    :   (ASSIGN (STR_LIT | INT_LIT))? SEMI;

function_dec    :   LPAREN (param_dec_list)? RPAREN SEMI;


Cheers,

-- 
Joan Jes?s Pujol Espinar
From joanpujol at gmail.com  Mon Jan 10 04:23:11 2005
From: joanpujol at gmail.com (Joan Pujol)
Date: Mon Jan 10 04:23:15 2005
Subject: [antlr-interest] hmm...is this list still working?
In-Reply-To: <20050109221758.60442.qmail@web53806.mail.yahoo.com>
References: <s1de57a2.028@emil.oddi.is>
	<20050109221758.60442.qmail@web53806.mail.yahoo.com>
Message-ID: <d2d18a1050110042345ad43b6@mail.gmail.com>

I don't agree. I think that a mailing list is a lot better than a web forum.
Because if you (like me) several mailing list I think that's easier to
organize and read the posts.
(but.... it's a personal opinion)

On Sun, 9 Jan 2005 14:17:58 -0800 (PST), Prashant Deva
<prashantdeva@yahoo.com> wrote:
> Terrence,
>   Why dont you put up a bulleting board like 'phpbb'.
> I believe that is a better alternative than mailing
> lists, newsgroups, etc.
> 
> PRASHANT
> 
> --- Arnar Birgisson <ArnarB@oddi.is> wrote:
> 
> > You always have the archives:
> > http://www.antlr.org/pipermail/antlr-interest/.
> > You can't reply
> > to messages there though.
> >
> > Mailman can also be made to replicate the messages
> > to and from an NNTP
> > server, for which there are numerous advanced web
> > interfaces available.
> >
> > Googling for "mailman rss" reveals several
> > implementations, some
> > patches on mailman itself (see
> > http://www.amk.ca/pipermail/rdfp/rss.xml
> > for an example), and some are scripts that harvest
> > rss information from
> > the mailman-generated archives. Patching mailman
> > would be the ideal
> > solution and
> >
> http://rogue.amk.ca/pipermail/rdfp/2003-July/000200.html
> > looks promising but the author doesn't provide the
> > patch. There is
> > another one at
> > http://rdfweb.org/2003/06/mailman-rss/rsspatch but
> > no
> > example output provided. These are very simple
> > patches (mailman is
> > written in Python) so implementing/modifying one for
> > antlr-interest
> > should be very easy.
> >
> > Arnar
> >
> > >>> Bryan Ewbank <ewbank@gmail.com> 01/07 12:32  >>>
> > Might there be a way to get an RSS feed of the
> > topics?  Alternately,
> > you can use rules to dump them into a separate place
> > and then browse
> > them later...
> >
> > On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
> > <Loring.G.Craymer@jpl.nasa.gov> wrote:
> > > I got this one.  It could be the interface.
> > Despite the downsides
> > of
> > > yahoo, the web interface was convenient--you could
> > go browse messages
> > at
> > > leisure rather than having them buried in the
> > email pile.
> >
> 
>                
> __________________________________
> Do you Yahoo!?
> Yahoo! Mail - Helps protect you from nasty viruses.
> http://promotions.yahoo.com/new_mail
> 


-- 
Joan Jes?s Pujol Espinar
From ArnarB at oddi.is  Mon Jan 10 04:30:18 2005
From: ArnarB at oddi.is (Arnar Birgisson)
Date: Mon Jan 10 04:31:15 2005
Subject: [antlr-interest] hmm...is this list still working?
Message-ID: <s1e27587.034@emil.oddi.is>

I agree with Joan, mailing lists are much better in my opinion.

Arnar

>>> Joan Pujol <joanpujol@gmail.com> 01/10 12:23  >>>
I don't agree. I think that a mailing list is a lot better than a web forum.
Because if you (like me) several mailing list I think that's easier to
organize and read the posts.
(but.... it's a personal opinion)

On Sun, 9 Jan 2005 14:17:58 -0800 (PST), Prashant Deva
<prashantdeva@yahoo.com> wrote:
> Terrence,
>   Why dont you put up a bulleting board like 'phpbb'.
> I believe that is a better alternative than mailing
> lists, newsgroups, etc.
> 
> PRASHANT
> 
> --- Arnar Birgisson <ArnarB@oddi.is> wrote:
> 
> > You always have the archives:
> > http://www.antlr.org/pipermail/antlr-interest/.
> > You can't reply
> > to messages there though.
> >
> > Mailman can also be made to replicate the messages
> > to and from an NNTP
> > server, for which there are numerous advanced web
> > interfaces available.
> >
> > Googling for "mailman rss" reveals several
> > implementations, some
> > patches on mailman itself (see
> > http://www.amk.ca/pipermail/rdfp/rss.xml 
> > for an example), and some are scripts that harvest
> > rss information from
> > the mailman-generated archives. Patching mailman
> > would be the ideal
> > solution and
> >
> http://rogue.amk.ca/pipermail/rdfp/2003-July/000200.html 
> > looks promising but the author doesn't provide the
> > patch. There is
> > another one at
> > http://rdfweb.org/2003/06/mailman-rss/rsspatch but
> > no
> > example output provided. These are very simple
> > patches (mailman is
> > written in Python) so implementing/modifying one for
> > antlr-interest
> > should be very easy.
> >
> > Arnar
> >
> > >>> Bryan Ewbank <ewbank@gmail.com> 01/07 12:32  >>>
> > Might there be a way to get an RSS feed of the
> > topics?  Alternately,
> > you can use rules to dump them into a separate place
> > and then browse
> > them later...
> >
> > On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
> > <Loring.G.Craymer@jpl.nasa.gov> wrote:
> > > I got this one.  It could be the interface.
> > Despite the downsides
> > of
> > > yahoo, the web interface was convenient--you could
> > go browse messages
> > at
> > > leisure rather than having them buried in the
> > email pile.
> >
> 
>                
> __________________________________
> Do you Yahoo!?
> Yahoo! Mail - Helps protect you from nasty viruses.
> http://promotions.yahoo.com/new_mail 
> 


-- 
Joan Jes?s Pujol Espinar

From Anthony.Youngman at eca-international.com  Mon Jan 10 05:38:52 2005
From: Anthony.Youngman at eca-international.com (Anthony Youngman)
Date: Mon Jan 10 09:20:44 2005
Subject: [antlr-interest] hmm...is this list still working?
Message-ID: <C7FE35004D40FD45AA342991B88CE40409B0DC@lnml1.eca-international.local>

And a lot cheaper.

Why do people (rich westerners, that is) always assume that others have cheap web access? If you're a poor person, in a poor country, paying for net access by the minute, a web forum can be damn expensive. And it's not that long ago I visited a European country where a 14.4 modem would have had problems running at full speed, or an Asian country where the main international web link didn't work more than half the time...

Okay, I personally don't care about cost any more (I've got a decent ISP, and unmetered off-peak access), but I used to watch my dial-up costs carefully, and I *STILL* prefer to work off-line. News, email etc. The web is a PITA.

Cheers,
Wol

-----Original Message-----
From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-bounces@antlr.org] On Behalf Of Arnar Birgisson
Sent: 10 January 2005 12:30
To: antlr-interest@antlr.org
Subject: Re: [antlr-interest] hmm...is this list still working?

I agree with Joan, mailing lists are much better in my opinion.

Arnar

>>> Joan Pujol <joanpujol@gmail.com> 01/10 12:23  >>>
I don't agree. I think that a mailing list is a lot better than a web forum.
Because if you (like me) several mailing list I think that's easier to
organize and read the posts.
(but.... it's a personal opinion)

On Sun, 9 Jan 2005 14:17:58 -0800 (PST), Prashant Deva
<prashantdeva@yahoo.com> wrote:
> Terrence,
>   Why dont you put up a bulleting board like 'phpbb'.
> I believe that is a better alternative than mailing
> lists, newsgroups, etc.
> 
> PRASHANT
> 
> --- Arnar Birgisson <ArnarB@oddi.is> wrote:
> 
> > You always have the archives:
> > http://www.antlr.org/pipermail/antlr-interest/.
> > You can't reply
> > to messages there though.
> >
> > Mailman can also be made to replicate the messages
> > to and from an NNTP
> > server, for which there are numerous advanced web
> > interfaces available.
> >
> > Googling for "mailman rss" reveals several
> > implementations, some
> > patches on mailman itself (see
> > http://www.amk.ca/pipermail/rdfp/rss.xml 
> > for an example), and some are scripts that harvest
> > rss information from
> > the mailman-generated archives. Patching mailman
> > would be the ideal
> > solution and
> >
> http://rogue.amk.ca/pipermail/rdfp/2003-July/000200.html 
> > looks promising but the author doesn't provide the
> > patch. There is
> > another one at
> > http://rdfweb.org/2003/06/mailman-rss/rsspatch but
> > no
> > example output provided. These are very simple
> > patches (mailman is
> > written in Python) so implementing/modifying one for
> > antlr-interest
> > should be very easy.
> >
> > Arnar
> >
> > >>> Bryan Ewbank <ewbank@gmail.com> 01/07 12:32  >>>
> > Might there be a way to get an RSS feed of the
> > topics?  Alternately,
> > you can use rules to dump them into a separate place
> > and then browse
> > them later...
> >
> > On Thu, 06 Jan 2005 15:02:53 -0800, Loring Craymer
> > <Loring.G.Craymer@jpl.nasa.gov> wrote:
> > > I got this one.  It could be the interface.
> > Despite the downsides
> > of
> > > yahoo, the web interface was convenient--you could
> > go browse messages
> > at
> > > leisure rather than having them buried in the
> > email pile.
> >
> 
>                
> __________________________________
> Do you Yahoo!?
> Yahoo! Mail - Helps protect you from nasty viruses.
> http://promotions.yahoo.com/new_mail 
> 


-- 
Joan Jes?s Pujol Espinar



****************************************************************************

This transmission is intended for the named recipient only. It may contain private and confidential information. If this has come to you in error you must not act on anything disclosed in it, nor must you copy it, modify it, disseminate it in any way, or show it to anyone. Please e-mail the sender to inform us of the transmission error or telephone ECA International immediately and delete the e-mail from your information system.

Telephone numbers for ECA International offices are: Sydney +61 (0)2 8272 5300, Hong Kong + 852 2121 2388, London +44 (0)20 7351 5000 and New York +1 212 582 2333.

****************************************************************************

From vinvinsent at 263.net  Mon Jan 10 08:27:41 2005
From: vinvinsent at 263.net (=?gb2312?B?xe20+tLj?=)
Date: Mon Jan 10 10:12:59 2005
Subject: [antlr-interest] Fail to pass test in C++ Grammar 
Message-ID: <20050110162741.9D4BD3035A@smtp.263.net>

Hi, everyone:
	I'm new to ANTLR, and I desired to do something about analyzing data flow in C++. 
	I downloaded the C++ project led by David from www.antlr.org's grammar section. and compiled in MSVC 7.1, it compiles well. However, I can't even pass the simplest test with below contents:

	#include <stdio.h>
	int main()
	{
 		return 0;
	}
	
	I captured the exception and found from where the exception was thrown:
	//	...
	else if ((LA(1) == 0x23 /* '#' */ ) 
					&& (_tokenSet_0.member(LA(2)))) {
					mPREPROC_DIRECTIVE(true);
					theRetToken=_returnToken;
				}
	// ...
	
	I found _tokenSet_0.member(LA(2))) return false, while LA(2) is 'i', so the switch statement eventually went into the "default" block, and threw an exception.
    I want to ask, is there something wrong with the grammar file? or I made any mistake, any
help would be appriciable :)

Cheers!

Vinsent
vinvinsent@263.net
2005-01-11
-------------- next part --------------
A non-text attachment was scrubbed...
Name: =?gb2312?B?xe20+tLjLnZjZg==?=
Type: text/x-vcard
Size: 514 bytes
Desc: not available
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050111/3fd0981d/gb2312Bxe20tLjLnZjZg-0001.vcf
From nbsherid at secsme.org.au  Mon Jan 10 14:18:16 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Mon Jan 10 14:18:24 2005
Subject: [antlr-interest] Fail to pass test in C++ Grammar 
In-Reply-To: <20050110162741.9D4BD3035A@smtp.263.net>
Message-ID: <000201c4f762$482841b0$a428198a@nigelnote>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of ??????
> Sent: Tuesday, 11 January 2005 3:28 AM
> To: antlr-interest
> Subject: [antlr-interest] Fail to pass test in C++ Grammar
> 
> Hi, everyone:
> 	I'm new to ANTLR, and I desired to do something about analyzing data
> flow in C++.
> 	I downloaded the C++ project led by David from www.antlr.org's
> grammar section. and compiled in MSVC 7.1, it compiles well. However, I
> can't even pass the simplest test with below contents:
> 
> 	#include <stdio.h>
> 	int main()
> 	{
>  		return 0;
> 	}
> 
> 	I captured the exception and found from where the exception was
> thrown:
> 	//	...
> 	else if ((LA(1) == 0x23 /* '#' */ )
> 					&& (_tokenSet_0.member(LA(2)))) {
> 					mPREPROC_DIRECTIVE(true);
> 					theRetToken=_returnToken;
> 				}
> 	// ...
> 


I think I read somewhere that the C++ grammar does not do pre-processing -
so it will hit trouble on the #include line (and hence, the '#' character it
has trouble with). 

Try removing the #include line, and see if it parses the rest of your simple
program.

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435

From nbsherid at secsme.org.au  Mon Jan 10 14:38:55 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Mon Jan 10 14:38:58 2005
Subject: [antlr-interest] Left-factoring and recursion
In-Reply-To: <200501100500.j0A50bx5023157@eis-msg-012.jpl.nasa.gov>
Message-ID: <000501c4f765$2ab83790$a428198a@nigelnote>


> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Loring Craymer
> Sent: Monday, 10 January 2005 4:01 PM
> To: antlr-interest@antlr.org
> Subject: RE: [antlr-interest] Left-factoring and recursion
> 
> > -----Original Message-----
> > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > bounces@antlr.org] On Behalf Of Nigel Sheridan-Smith
> > Sent: Sunday, January 09, 2005 2:38 PM
> > To: antlr-interest@antlr.org
> > Subject: [antlr-interest] Left-factoring and recursion
> >
> >
> 
> Nigel--
> 
> Use syntactic predicates as a first step for removing non-determinisms.
> Some of the ANTLR 2 reported non-determinisms are not real, and result
> from
> the approximate LLk algorithm.  Once you have a working grammar, left-
> factor
> if you need the added performance.  I note that ANTLR 3 does/will do
> automatic left-factoring and will remove predicates where they are
> unneeded;
> does it make sense to spend a lot of effort manually left-factoring when
> the
> tool will do it for you within a year?

Thanks Loring,

Like most projects, I needed this yesterday or about a year ago even, so
waiting for ANTLR 3 is not really an option ;)

Some of the options are:
1) Continue on with the existing ANTLR ASN.1 grammar - I've tried running it
with some simple MIBs but it strikes some trouble when it gets to some of
the SMI-specific things and the processing of OIDs. However, if I strip out
all the actions and extend it from there maybe that will work. The grammar
seems a little incomplete, but I'm still not 100% familiar with ASN.1
syntax, so it's hard to tell if anything is missing.

2) Continue left-factoring, simplifying and removing recursion from my own
LL(k) grammar. I kept doing this yesterday with some success, but there are
multiple levels of recursiveness throughout the grammar and it could
potentially take weeks to sort through it all and then add actions, etc.

3) Try a LALR or other LR parser - I have put almost all of the grammar into
SableCC but I am being to realise how much power ANTLR has in comparison! I
will find out pretty soon how much work it's going to be to get the whole
grammar up and running! In any case, I'm going to end up with several
hundred generated java classes unless I can factorise the grammar down to
less rules. However, it appears that SableCC only allows one copy of each
terminal in any production!! Very annoying! I'd try yacc, etc but I really
just want something that presents the SMI information through a Java API.

4) Link to the 'libsmi' library through the Java Native Interfaces - this
library isn't perfect, and I would lose some cross-platform compatibility,
but it's looking like a relatively easy option at this stage.

5) Buy a licence to Java 'jasmi' library (http://www.mibdesigner.com/jasmi/)
or another equivalent tool. However, I'm a relatively poor student, so would
be reluctant to fork out the money on my own. Also, what happens if this
project then goes commercial later on down the track? If the product I
choose requires single-user licenses or royalties then it will be expensive
to on-sell another product that uses that library.

So I'm leaning towards (3), (1), (2)/(4) or (5) in approximately that order.

If anyone has any suggestions or advice, I'm all ears! :D

Cheers

Nigel



From Loring.G.Craymer at jpl.nasa.gov  Mon Jan 10 20:15:24 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Mon Jan 10 20:15:29 2005
Subject: [antlr-interest] Left-factoring and recursion
In-Reply-To: <000501c4f765$2ab83790$a428198a@nigelnote>
References: <200501100500.j0A50bx5023157@eis-msg-012.jpl.nasa.gov>
	<000501c4f765$2ab83790$a428198a@nigelnote>
Message-ID: <6.1.1.1.2.20050110193631.01bcc508@mail.jpl.nasa.gov>

At 02:38 PM 1/10/2005, Nigel Sheridan-Smith wrote:

> > -----Original Message-----
> > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > bounces@antlr.org] On Behalf Of Loring Craymer
> > Sent: Monday, 10 January 2005 4:01 PM
> > To: antlr-interest@antlr.org
> > Subject: RE: [antlr-interest] Left-factoring and recursion
> >
> > > -----Original Message-----
> > > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > > bounces@antlr.org] On Behalf Of Nigel Sheridan-Smith
> > > Sent: Sunday, January 09, 2005 2:38 PM
> > > To: antlr-interest@antlr.org
> > > Subject: [antlr-interest] Left-factoring and recursion
> > >
> > >
> >
> > Nigel--
> >
> > Use syntactic predicates as a first step for removing non-determinisms.
> > Some of the ANTLR 2 reported non-determinisms are not real, and result
> > from
> > the approximate LLk algorithm.  Once you have a working grammar, left-
> > factor
> > if you need the added performance.  I note that ANTLR 3 does/will do
> > automatic left-factoring and will remove predicates where they are
> > unneeded;
> > does it make sense to spend a lot of effort manually left-factoring when
> > the
> > tool will do it for you within a year?
>
>Thanks Loring,
>
>Like most projects, I needed this yesterday or about a year ago even, so
>waiting for ANTLR 3 is not really an option ;)

Maybe I was too terse in my response.  My point is more "Don't left factor, 
use syntactic predicates first".  In your situation, left factoring is a 
form of premature optimization.  I don't suggest waiting for ANTLR 3; 
however, the fact that it will automatically left factor and remove 
unneeded syntactic predicates should give you pause before you take on the 
task of manually refactoring your grammar.  [Of course, the tradeoffs 
change if performance is a key requirement; even then, the preferred 
strategy is to get a working grammar and then left factor manually if you 
need the performance and cannot wait for ANTLR 3 to solve the performance 
problem.  In that case, you tend to start by refactoring top-level rules 
and working your way down.  In practice, though, left factoring tends to 
buy little improvement over synpreds.]

Synpreds should enable you to remove non-determinisms (even the ones 
arising from LLk-approx) from your grammar within a day, even for a large 
grammar.  Only after you have a working grammar should you worry about 
performance and whether a large scale effort to refactor your grammar makes 
sense.

So I would suggest that you continue with your own grammar (mostly because 
it is most familiar to you and sounds like it is almost working), but 
insert synpreds and defer left-factoring until and unless performance 
becomes a critical issue.  Even then, profile first.

--Loring



>Some of the options are:
>1) Continue on with the existing ANTLR ASN.1 grammar - I've tried running it
>with some simple MIBs but it strikes some trouble when it gets to some of
>the SMI-specific things and the processing of OIDs. However, if I strip out
>all the actions and extend it from there maybe that will work. The grammar
>seems a little incomplete, but I'm still not 100% familiar with ASN.1
>syntax, so it's hard to tell if anything is missing.
>
>2) Continue left-factoring, simplifying and removing recursion from my own
>LL(k) grammar. I kept doing this yesterday with some success, but there are
>multiple levels of recursiveness throughout the grammar and it could
>potentially take weeks to sort through it all and then add actions, etc.
>
>3) Try a LALR or other LR parser - I have put almost all of the grammar into
>SableCC but I am being to realise how much power ANTLR has in comparison! I
>will find out pretty soon how much work it's going to be to get the whole
>grammar up and running! In any case, I'm going to end up with several
>hundred generated java classes unless I can factorise the grammar down to
>less rules. However, it appears that SableCC only allows one copy of each
>terminal in any production!! Very annoying! I'd try yacc, etc but I really
>just want something that presents the SMI information through a Java API.
>
>4) Link to the 'libsmi' library through the Java Native Interfaces - this
>library isn't perfect, and I would lose some cross-platform compatibility,
>but it's looking like a relatively easy option at this stage.
>
>5) Buy a licence to Java 'jasmi' library (http://www.mibdesigner.com/jasmi/)
>or another equivalent tool. However, I'm a relatively poor student, so would
>be reluctant to fork out the money on my own. Also, what happens if this
>project then goes commercial later on down the track? If the product I
>choose requires single-user licenses or royalties then it will be expensive
>to on-sell another product that uses that library.
>
>So I'm leaning towards (3), (1), (2)/(4) or (5) in approximately that order.
>
>If anyone has any suggestions or advice, I'm all ears! :D
>
>Cheers
>
>Nigel


From nbsherid at secsme.org.au  Mon Jan 10 21:30:52 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Mon Jan 10 21:30:55 2005
Subject: [antlr-interest] Left-factoring and recursion
In-Reply-To: <6.1.1.1.2.20050110193631.01bcc508@mail.jpl.nasa.gov>
Message-ID: <000001c4f79e$b76a7fc0$a428198a@nigelnote>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Loring Craymer
> Sent: Tuesday, 11 January 2005 3:15 PM
> To: antlr-interest@antlr.org
> Subject: RE: [antlr-interest] Left-factoring and recursion
> 
> 
> Maybe I was too terse in my response.  My point is more "Don't left
> factor,
> use syntactic predicates first".  In your situation, left factoring is a
> form of premature optimization.  I don't suggest waiting for ANTLR 3;
> however, the fact that it will automatically left factor and remove
> unneeded syntactic predicates should give you pause before you take on the
> task of manually refactoring your grammar.  [Of course, the tradeoffs
> change if performance is a key requirement; even then, the preferred
> strategy is to get a working grammar and then left factor manually if you
> need the performance and cannot wait for ANTLR 3 to solve the performance
> problem.  In that case, you tend to start by refactoring top-level rules
> and working your way down.  In practice, though, left factoring tends to
> buy little improvement over synpreds.]
> 

Hi Loring,

Thanks for the information... As I am working more and more on this I am
discovering that a significant part of the problem is that the grammar of
ASN.1 is highly ambiguous throughout. Curly braces are used for just about
everything, and it's the main source of the heart-ache.

The other problem is that the ASN.1 standard productions are highly
convoluted - to work out *what* the syntactic predicates should be is what
is taking all the time. For each non-determinism, you have to track down
*all* of the exit branches that are being predicted and then work out what
is the best alternative. The recursion that is involved just makes things an
order of magnitude worse. Also, if the grammar didn't excessively use
productions where they weren't necessary then it might be a lot easier to
track down the exit branches.

After spending quite a few hours getting the grammar into SableCC, I managed
to get it to compile but then I started to hit shift-reduce and
reduce-reduce conflicts (I expected this - but didn't know what sort of
conflicts to expect since I've never used LR(1) :( ). After a few hours of
reading on LR parsers, and then removing a few reduce-reduce conflicts by
factoring, I hit my first shift-reduce conflict. Again, it's the same sort
of problem as with LL(k) - find all the possible exit branches and then work
out how to give preferential treatment to one alternative to another. 

Unfortunately, SableCC does not have a way to give shifts preference over
reductions - this is definitely the strength of syntactic predicates.
Yacc/bison (on the other hand) appear to have some sort of "default"
processing for these sort of conflicts, where shifts always take
precendence, etc. The only other option with SableCC is to create
disambiguating rules, which are even more complex in themselves.

So I think using SableCC is definitely less of an option - I think I will
probably forget about doing my own grammar now since I probably have enough
ASN.1 syntax under the belt to work out what is going on with the existing
ANTLR ASN.1 grammar. It's probably going to be good enough for what I need,
and probably less work involved - i.e. the most "bang for my buck". Even if
its not deterministic (or unpredictable) then at least I can work those
things out down the track when they become more relevant.

Still, having some sort of tool to help with solving complex
non-determinisms, left recursion, etc would be handy, even if it sorted
through the grammar and dumped all the relevant production rules. However,
if ANTLR 3.x will solve all these problems, then I guess such a tool will
quickly go out of fashion! In any case, it's only for grammars that are
already well established (i.e. pre-existing standards) - it's a shame the
people involved in designing these languages can't make them deterministic
from the beginning! 

Cheers, and thanks for all the clarification and assistance... 

Nigel



--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435 


From ewbank at gmail.com  Tue Jan 11 06:54:00 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Tue Jan 11 06:54:02 2005
Subject: [antlr-interest] Left-factoring and recursion
In-Reply-To: <000001c4f79e$b76a7fc0$a428198a@nigelnote>
References: <6.1.1.1.2.20050110193631.01bcc508@mail.jpl.nasa.gov>
	<000001c4f79e$b76a7fc0$a428198a@nigelnote>
Message-ID: <dd3a065f05011106542703c42d@mail.gmail.com>

If you're pretty sure that what you have is correct, another part of
the solution could be simply marking loops to be aggressive by using:
   options {greedy=true; };
From ewbank at gmail.com  Tue Jan 11 07:43:43 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Tue Jan 11 07:43:45 2005
Subject: [antlr-interest] C++ debugging weirdness
Message-ID: <dd3a065f05011107431c3fe3d7@mail.gmail.com>

I'm debugging C++ generated code on a linux box with gdb (ANTLR
2.7.4), and have run into a rather strange problem.

The object "inputState", though present in the code, is apparently not
visible to the debugger.

Have other people encountered this problem?  Any work-arounds (other
than writting bug-free code :-) for this?

I'm compiling with "g++ -ggdb", and using gdb 6.1 and g++ 3.2.2.

Thanks for any guidance.
From ric.klaren at gmail.com  Tue Jan 11 11:23:59 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Tue Jan 11 11:24:02 2005
Subject: [antlr-interest] C++ debugging weirdness
In-Reply-To: <dd3a065f05011107431c3fe3d7@mail.gmail.com>
References: <dd3a065f05011107431c3fe3d7@mail.gmail.com>
Message-ID: <bc607a4e05011111232ed767e0@mail.gmail.com>

On Tue, 11 Jan 2005 10:43:43 -0500, Bryan Ewbank <ewbank@gmail.com> wrote:
> I'm debugging C++ generated code on a linux box with gdb (ANTLR
> 2.7.4), and have run into a rather strange problem.
> 
> The object "inputState", though present in the code, is apparently not
> visible to the debugger.
> 
> Have other people encountered this problem?  Any work-arounds (other
> than writting bug-free code :-) for this?
> 
> I'm compiling with "g++ -ggdb", and using gdb 6.1 and g++ 3.2.2.

Mostly somewhat obvious tips I can think of is trying to upgrade g++
and see if that fixes things. There have been loads of debugging info
fixes for g++. Maybe -ggdb3 makes a bit of a difference. It could also
help to use -O0 when compiling so the optimizer doesn't strip away too
much.

Cheers,

Ric
From ewbank at gmail.com  Tue Jan 11 11:58:36 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Tue Jan 11 11:58:41 2005
Subject: [antlr-interest] C++ debugging weirdness
In-Reply-To: <bc607a4e05011111232ed767e0@mail.gmail.com>
References: <dd3a065f05011107431c3fe3d7@mail.gmail.com>
	<bc607a4e05011111232ed767e0@mail.gmail.com>
Message-ID: <dd3a065f0501111158139e0f1@mail.gmail.com>

On Tue, 11 Jan 2005 20:23:59 +0100, Ric Klaren <ric.klaren@gmail.com> wrote:
> Mostly somewhat obvious tips I can think of is trying to upgrade g++
> and see if that fixes things. There have been loads of debugging info
> fixes for g++. Maybe -ggdb3 makes a bit of a difference. It could also
> help to use -O0 when compiling so the optimizer doesn't strip away too
> much.

Upgrading is not an option; this is unfortunately a production
environment where the compilers are locked down.  I got some gentle
help off-list (thanks, Peggy) and now have figured out that what in
the code looks like this:
      inputState->guessing
must be printed like this as a debugging directive:
      p this->inputState->ref.ptr->guessing
From togolmach2 at lycos.com  Thu Jan 13 04:44:09 2005
From: togolmach2 at lycos.com (togol machillan)
Date: Thu Jan 13 04:44:13 2005
Subject: [antlr-interest] Compiling with STLport using VC++ 6.0
Message-ID: <20050113124409.AA97FC6138@ws7-5.us4.outblaze.com>

Hi,

I get the following compilation error messages from VC++ 6.0 during compiling using STLport.

u:\antlr-2.7.4\lib\cpp\antlr\parser.hpp(218) : error C2039: 'uncaught_exception' : Ist kein Element von '_STL'
u:\antlr-2.7.4\lib\cpp\antlr\parser.hpp(218) : error C2065: 'uncaught_exception' : nichtdeklarierter Bezeichner  

What changes should I make to parser.hpp in order to avoid these errors. 

Best Regards,

Mach 
-- 
_______________________________________________
Find what you are looking for with the Lycos Yellow Pages
http://r.lycos.com/r/yp_emailfooter/http://yellowpages.lycos.com/default.asp?SRC=lycos10

From thomas.rolfs at cox.net  Thu Jan 13 22:21:46 2005
From: thomas.rolfs at cox.net (Thomas Rolfs)
Date: Thu Jan 13 22:21:50 2005
Subject: [antlr-interest] expression tree question
In-Reply-To: <bc607a4e05011111232ed767e0@mail.gmail.com>
References: <dd3a065f05011107431c3fe3d7@mail.gmail.com>
	<bc607a4e05011111232ed767e0@mail.gmail.com>
Message-ID: <396820832.20050113222146@cox.net>


This is a very simplified version of my expression grammar.

atom
  : ...
  ;

relationalExpression
  : atmo ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LESS^|LTE^) atom)*
  ;

expression
  : relationalExpression ((AND^|OR^) relationalExpression)*
  ;


The expression:

 1 and 2 and 3 and 4

creates the tree:

 <and <and < and 1 2 > 3 > 4 >

but I would like to have:

 < and 1 < and 2 < and 3 < and 4>>>>
 
What is the best way to do this?

I can get the desired tree by changing the rule to:

expression
  : relationalExpression ((AND^|OR^) expression)*
  ;

but I'm guessing that operator precedence will be broken.

Thanks in advance.
-- 
Thomas Rolfs

From dcaton at shorelinesoftware.com  Fri Jan 14 06:15:52 2005
From: dcaton at shorelinesoftware.com (Don Caton)
Date: Fri Jan 14 06:16:16 2005
Subject: [antlr-interest] expression tree question
In-Reply-To: <396820832.20050113222146@cox.net>
Message-ID: <1105712141.24946@mx9.mysite4now.com>

Thomas:

You need separate rules for operators at difference precedence levels.  Only
group operators in the same rule that share the same precedence level.  Ex:

  expression:            addingExpression;
  addingExpression:      multiplyingExpression ( ( ADD^ | SUBT^ )
multiplyingExpression );
  multiplyingExpression: primaryExpression ( ( MULT^ | DIV^ )
primaryExpression );
  primaryExpression:     literal | ID | whatever...

You don't really need the expression rule, I just do it because it serves as
a sort of "entry point" into the expression rules, which are usually
non-trivial.

The presence levels go higher the deeper you get into the rules.  IOW, the
primaryExpression rule has the highest presence, followed by the
multiplication operators, and the addition operators have the lowest
presence.

Within the rule, ADD and SUBT for example have equal precedence.

Don

 

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org 
> [mailto:antlr-interest-bounces@antlr.org] On Behalf Of Thomas Rolfs
> Sent: Friday, January 14, 2005 1:22 AM
> To: ANTLR Interest
> Subject: [antlr-interest] expression tree question
> 
> 
> This is a very simplified version of my expression grammar.
> 
> atom
>   : ...
>   ;
> 
> relationalExpression
>   : atmo ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LESS^|LTE^) atom)*
>   ;
> 
> expression
>   : relationalExpression ((AND^|OR^) relationalExpression)*
>   ;
> 
> 
> The expression:
> 
>  1 and 2 and 3 and 4
> 
> creates the tree:
> 
>  <and <and < and 1 2 > 3 > 4 >
> 
> but I would like to have:
> 
>  < and 1 < and 2 < and 3 < and 4>>>>
>  
> What is the best way to do this?
> 
> I can get the desired tree by changing the rule to:
> 
> expression
>   : relationalExpression ((AND^|OR^) expression)*
>   ;
> 
> but I'm guessing that operator precedence will be broken.
> 
> Thanks in advance.
> --
> Thomas Rolfs
> 
> 


From pauljlucas at mac.com  Fri Jan 14 10:22:32 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Fri Jan 14 10:22:46 2005
Subject: [antlr-interest] Error messages in other (human) languages
Message-ID: <Pine.LNX.4.44.0501141020110.11155-100000@g4.pauljlucas.org>

	If programming in Java, the canonical way to have error
	messages in other languages is via a .properties file.  I
	haven't seen such for ANTLR.  Hence, is the only way to
	translate ANTLR error messages by catching all exceptions,
	pulling the relevant information out ffrom fields, and
	rethrowing one's own exceptions with new text?

	- Paul

From parrt at cs.usfca.edu  Fri Jan 14 10:33:08 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jan 14 10:33:11 2005
Subject: [antlr-interest] Error messages in other (human) languages
In-Reply-To: <Pine.LNX.4.44.0501141020110.11155-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501141020110.11155-100000@g4.pauljlucas.org>
Message-ID: <BD145D5D-665A-11D9-927D-000393BB647E@cs.usfca.edu>


On Jan 14, 2005, at 10:22 AM, Paul J. Lucas wrote:

> 	If programming in Java, the canonical way to have error
> 	messages in other languages is via a .properties file.  I
> 	haven't seen such for ANTLR.  Hence, is the only way to
> 	translate ANTLR error messages by catching all exceptions,
> 	pulling the relevant information out ffrom fields, and
> 	rethrowing one's own exceptions with new text?

Probably.  I didn't think about this when doing errors previously when 
under the gun during the startup.  Sorry.

[I have fixed this in 3.0.  Only the exception is thrown with relevant 
info; no text at all.  The reporting facilities are required to decode 
and print as human text.  Further, all antlr error messages themselves 
are contained in string template files and ANTLR checks the locale to 
pull in the right messages.] :)

Ter




From tribble at e-dean.com  Sun Jan 16 12:05:21 2005
From: tribble at e-dean.com (Dean Tribble)
Date: Sun Jan 16 12:04:22 2005
Subject: [antlr-interest] Re: Building trees with the correct associativity
Message-ID: <41EAC901.5020304@e-dean.com>

I'm replying to a message that I saw in the archives.  I recently
struggled with building left-associative trees (for the E language), and
stumbled upon a minimal approach that works nicely.

<pauljlucas at m...> wrote:
>     If I have:
>
>         addExpr
>             : e1:mulExpr
>               (ao:addOp! e2:mulExpr!
>                   {
>                 ## = #([ADD_EXPR,"ADD_EXPR"], ao, e1, e2);
>             }
>               )*
>             ;
>
>     then my trees get built the wrong way, e.g.:
>
>         5 - 2 + 3
>
>     is as if it were:
>
>         5 - (2 + 3)
>
>     which is wrong.  Maybe I'm being a but slow, but it's not
>     immediately clear how to build the tree the other way, i.e.:
>
>         (5 - 2) + 3


I wanted "5 - 2 + 3" to result in:

#([CallExpr], ([CallExpr], 5, "-", 3), "+", 3)

so I did not need to reorder the operator.  Here's what finally worked
for me:

//+ and - are left associative
add         :   mult ({##=#([CallExpr],##);}    ("+" | "-") mult)*   ;

// *, /, //, %, and %% are left associative
mult        :   pow ({##=#([CallExpr],##);}     ("*" | "/" | "//" | "%"
| "%%") pow)*  ;
...

Note that since I do not use the caret for those operators, they could
easily be pushed into their own addOp rule.

From Loring.G.Craymer at jpl.nasa.gov  Mon Jan  3 14:06:17 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Sun Jan 16 13:24:19 2005
Subject: [antlr-interest] I am not understanding tree grammar - please help
In-Reply-To: <JMEOIPJEDGMHCIOMBHLIKEELDJAA.jmcclain@tcshealthcare.com>
References: <JMEOIPJEDGMHCIOMBHLIKEELDJAA.jmcclain@tcshealthcare.com>
Message-ID: <6.1.1.1.2.20050103134906.020dbe78@mail.jpl.nasa.gov>

John--

Ter did a class exercise for a simple interpreter (look at the lab 
exercises at http://www.cs.usfca.edu/~parrt/course/652/index.html).  For 
computation during a tree walk, each rule would tend to have a return value 
(an AST node in your example:  things get messy when you directly return 
data types, so you would want to package the type information--INTLIT or 
STRING_LITERAL--with a string representation of the data.  You might also 
do a custom type to support a wider range of computational types).  If you 
plan to extend your language, it probably makes more sense to go the byte 
code and stack interpreter route.

--Loring


At 11:26 AM 1/3/2005, John MccLain wrote:
>What I want to do is fairly straight forward.
>
>I have a grammar (see below) which builds my AST. The AST nodes are function
>identifiers, logical comparators (e.g., <,>,etc.) and math operators (e.g.,
>+, -, etc..) The children of these nodes are parameters to the operation
>being performed.
>All I want to do is create an action for each AST node that takes the node's
>children (parameters) and calls a java function with those parameters. What
>I need to do is walk the tree, replaceing each AST node with the result of
>the function call in its action. The goal is to return the final result into
>the root node, and then print out that node.
>
>Can I do this with ANTLR tree grammar, and if so, how (code/psuedocode would
>be appreciated)???? Are there any tutorials for this kind of treewalking????
>
>----------------------------------------------------------------------------
>--
>
>class P extends Parser;
>options {buildAST=true;}
>
>class P extends Parser;
>options {buildAST=true;}
>
>prog: expression EOF;
>
>procedureCallStatement
>   : IDENT^ (actualParameters)?
>   ;
>
>actualParameters
>   : LPAREN! (expression (COMMA! expression)*)? RPAREN!
>   ;
>
>expression
>   : relationalExpression (("AND"^|"OR"^) relationalExpression)*
>   ;
>
>relationalExpression
>   : addingExpression ((EQUALS^|NOT_EQUALS^|GT^|GTE^|LT^|LTE^)
>addingExpression)*
>   ;
>
>addingExpression
>   : multiplyingExpression ((PLUS^|MINUS^) multiplyingExpression)*
>   ;
>
>multiplyingExpression
>   : signExpression ((TIMES^|DIV^|"mod"^) signExpression)*
>   ;
>
>signExpression
>   : ((PLUS^|MINUS^))* booleanNegationExpression
>   ;
>
>booleanNegationExpression
>   : ("not"^)* primitiveElement
>   ;
>
>primitiveElement
>   :
>   constantValue
>   | LPAREN! expression RPAREN!
>   | procedureCallStatement
>   ;
>
>constantValue
>   : INTLIT
>   | STRING_LITERAL
>   ;
>
>  class L extends Lexer;
>
>options {
>   charVocabulary = '\0'..'\377';
>   testLiterals=false;    // don't automatically test for literals
>   k=2;                   // two characters of lookahead
>}
>
>// Literals
>protected DIGIT : '0'..'9'
>{System.out.println("1" + getText());};
>
>INTLIT  :  (DIGIT)+
>{System.out.println("2" + getText());};
>CHARLIT : '\''! . '\''!
>{System.out.println("3" + getText());};
>
>// string literals
>STRING_LITERAL
>   : '"'!
>     ( '"' '"'!
>     | ~('"'|'\n'|'\r')
>     )*
>     ( '"'!
>     | // nothing -- write error message
>     )
>{System.out.println("4" + getText());};
>
>
>// Keywords are literals in the parser grammar
>
>// Operators
>DOT        : '.'   ;
>BECOMES    : ":="  ;
>COLON      : ':'   ;
>SEMI       : ';'   ;
>COMMA      : ','   ;
>EQUALS     : '='   ;
>LBRACKET   : '['   ;
>RBRACKET   : ']'   ;
>DOTDOT     : ".."  ;
>LPAREN     : '('
>{System.out.println("5" + getText());};
>RPAREN     : ')'
>{System.out.println("6" + getText());};
>NOT_EQUALS : "/="  ;
>LT         : '<'
>{System.out.println("7" + getText());};
>LTE        : "<="  ;
>GT         : '>'   ;
>GTE        : ">="  ;
>PLUS       : '+'
>{System.out.println("8" + getText());};
>MINUS      : '-'   ;
>TIMES      : '*'   ;
>DIV        : '/'   ;
>
>
>
>// Whitespace -- ignored
>WS
>   : ( ' '
>     | '\t'
>     | '\f'
>
>     // handle newlines
>     | ( "\r\n"  // Evil DOS
>       | '\r'    // Macintosh
>       | '\n'    // Unix (the right way)
>       )
>       { newline(); }
>     )
>     { $setType(Token.SKIP); }
>   ;
>
>
>// an identifier.  Note that testLiterals is set to true!  This means
>// that after we match the rule, we look in the literals table to see
>// if it's a literal or really an identifer
>IDENT
>   options {testLiterals=true;}
>   : ('a'..'z'|'A'..'Z') ('a'..'z'|'A'..'Z'|'0'..'9')*
>{System.out.println("10" + getText());};
>
>
>----------------------------------------------------------------------------
>------------
>
>
>
>John McClain
>Senior Software Engineer
>TCS Healthcare
>jmcclain@tcshealthcare.com
>(530)886-1700x235
>"Before you criticize someone, walk a mile in their shoes.
>That way, you'll be a mile from them, and you'll have their shoes."


From mike at fruitioninc.com  Sun Jan  9 19:49:13 2005
From: mike at fruitioninc.com (Mike Bresnahan)
Date: Sun Jan 16 13:25:34 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
Message-ID: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>

I have seen many people comment on how they dislike yacc/lex vs ANTLR.  I'm
curious why people think this.  My limited experience hasn't been so black
and white.  I first learned yacc/lex about 9 years ago and I haven't used
them since.  At the time I found them wonderful tools.  I bought the
O'Reilly nutshell book and within a very short period of time I could whip
out a simple parser in one day.  I found the tools very intiutive.

Speed forward to today.  I first started using ANTLR a few months ago.  I
chose it because it generates C# and that is what I needed.  My experience
with ANTLR has been much different than my experience with yacc/lex.  I have
found it extremely difficult to get my head around the tool.  I don't think
the problem is the tool per se, but rather LL(k) grammers.  I don't find
them to be intuitive.  The grammers are harder for me to read and write.

One very hard concept is that I cannot use left recursion, however "middle
recursion" and "right recursion" are just fine.  Why is left recursion
treated differently?  It just seems asymeteric and ad-hoc to me.

So either I've gotten stupider over the years, my brain is more in tune with
LALR grammers, or LL(k) grammers are simply harder to understand than LALR
grammers.  Why is it that people like ANTLR more than yacc/lex?  Why have I
had a different experience?

Background note: I've never studied the theory of compilers nor do I have a
degree in computer science.  However, I have been programming for 20 years
or so; 10 professionally.

From mop56290 at mail.telepac.pt  Tue Jan 11 07:07:26 2005
From: mop56290 at mail.telepac.pt (JCMetrolho)
Date: Sun Jan 16 13:29:29 2005
Subject: [antlr-interest] antlr -> Velocity or FreeMarker -> output code
Message-ID: <000601c4f7ef$44936010$34640dd5@dei.uminho.pt>

Hello I have the AST representation generated by the antlr tree parser. 

Is it possible to generate the output code using Velocity or FreeMarker? What is the best solution and what are the main steps to achive that?

regards

JC
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050111/a3930c7d/attachment.html
From clockwize at blueyonder.co.uk  Sun Jan 16 14:39:01 2005
From: clockwize at blueyonder.co.uk (clocKwize)
Date: Sun Jan 16 14:38:59 2005
Subject: [antlr-interest] warning:lexical nondeterminism between rules
	VARTYPE and IDENT upon....
Message-ID: <41EAED05.1060804@blueyonder.co.uk>

hey, in my lexer i have this:

VARTYPE
    options { paraphrase = "a variable type"; }
        :    ("int" | "float" | "string" | "bool")
        ;
       
IDENT
    options { paraphrase = "an identifier"; testLiterals = true; }
        :    ('a'..'z' |'A'..'Z') ('a'..'z'|'A'..'Z'|'_'|'0'..'9')*
        ;

MyLexer.g: warning:lexical nondeterminism between rules VARTYPE and 
IDENT upon
MyLexer.g:     k==1:'b','f','i','s'
MyLexer.g:     k==2:'l','n','o','t'

it works ok as far as i know though, i'm not sure how to print a list of 
the tokens from the lexer into the console (cpp)

anyway, how do i turn the warning off?
From christopher.d.schultz at comcast.net  Sun Jan 16 14:49:39 2005
From: christopher.d.schultz at comcast.net (Christopher Schultz)
Date: Sun Jan 16 14:49:49 2005
Subject: [antlr-interest] Would really appreciate some hand-holding with two
 specific parsing issues
Message-ID: <41EAEF83.60006@comcast.net>

All,
First let me say "hello" as I have just joined the list. I have two 
somewhat specific things that I'm encountering that I'm sure I could 
search the archives forever and not find. I'm hoping some kind soul will 
either point me to an archived post or take a few minutes and help me. 
Thanks!

Anyhow, I am attempting to write a mathematical expression evaluator 
(who isn't right?) implemented in Java. I have most everything working, 
but I'm running into two problems which may or not be related to each other.

My grammar can be found here for reference: 
http://www.christopherschultz.net/projects/java/expression.g

The first problem (and something I would like to deal with sooner) is 
that I cannot get "identifiers" to work correctly. I basically define an 
identifier as a token (and then a parser rule) like you probably would 
in any programming language: just strings of word characters or digits 
or underscores. The token (IDENTIFIER) works just fine and the parser 
rule ('identifier') works under certain circumstances.

When my expression is something like "id", I'd like the parser to see 
that as an 'identifier' and execute the appropriate code (which creates 
an IdentifierExpression object as written in the grammar file). 
Unfortunately, the parser gives me an error message: "unexpected token: 
id". That's fine -- it usually means that I forgot to set up a rule 
properly.

However, when the expression is "(id)", it works correctly. I have 
checked my grammer file a few times and can't see anything that jumps 
right out at me. I'd really love it if someone could take a look and 
explain why it's working under one circumstance and not under another 
(or tell me why my grammer is completely foobar'd).

The second problem is that if my top-level expression rule ends with the 
token EOF, the parser chokes on things that I would expect to work. For 
example, "2 + 2" works just fine, but "(2 + 2)" gives me the following 
error message: "line 1:5: expecting EOF, found ')' \n line 1:6: 
expecting RPAREN, found 'null'".

Here's an even weirder thing: adding EOF as a final token to my 
top-level rule makes the first problem go away. (??!)

I would love for someone to take some time and look at my grammar and 
see if they can offer any words of wisdom.

If you'd like to grab the entire package (source code, grammar, tests, 
etc.) you can get it here:

http://www.christopherschultz.net/projects/java/

Thanks in advance,
-chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050116/c9aa282c/signature.bin
From nbsherid at secsme.org.au  Sun Jan 16 15:07:52 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Sun Jan 16 15:07:56 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
In-Reply-To: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>
Message-ID: <000a01c4fc20$348d6050$a428198a@nigelnote>


> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Mike Bresnahan
> Sent: Monday, 10 January 2005 2:49 PM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] ANTLR vs lex/yacc
> 
> I have seen many people comment on how they dislike yacc/lex vs ANTLR.
> I'm
> curious why people think this.  My limited experience hasn't been so black
> and white.  I first learned yacc/lex about 9 years ago and I haven't used
> them since.  At the time I found them wonderful tools.  I bought the
> O'Reilly nutshell book and within a very short period of time I could whip
> out a simple parser in one day.  I found the tools very intiutive.
> 
> Speed forward to today.  I first started using ANTLR a few months ago.  I
> chose it because it generates C# and that is what I needed.  My experience
> with ANTLR has been much different than my experience with yacc/lex.  I
> have
> found it extremely difficult to get my head around the tool.  I don't
> think
> the problem is the tool per se, but rather LL(k) grammers.  I don't find
> them to be intuitive.  The grammers are harder for me to read and write.
> 
> One very hard concept is that I cannot use left recursion, however "middle
> recursion" and "right recursion" are just fine.  Why is left recursion
> treated differently?  It just seems asymeteric and ad-hoc to me.
> 
> So either I've gotten stupider over the years, my brain is more in tune
> with
> LALR grammers, or LL(k) grammers are simply harder to understand than LALR
> grammers.  Why is it that people like ANTLR more than yacc/lex?  Why have
> I
> had a different experience?
> 
> Background note: I've never studied the theory of compilers nor do I have
> a
> degree in computer science.  However, I have been programming for 20 years
> or so; 10 professionally.
> 


Well I have been using ANTLR for around 6 months now, although mostly in the
last month has it become essential to the things I am doing. I have been a
(casual, non-commercial) programmer for around 15 years in various
languages.

I learnt LL(k) first because of ANTLR, and although ANTLR can take some time
to learn, I think that anyone with some Compiler Toolkit experience will
quickly be able to understand the concepts. I think maybe clearer
documentation and HOWTO guides might be the way to go since I found the
reference guide too heavy-handed and the tutorials are only sufficient to
get someone started on simple problems. For example, once I got to Abstract
Syntax Trees it was difficult to understand how then to use them to achieve
different results, particularly when it comes to building a complete
compiler for a programming language. However, ASTs are a common approach
used in probably just about every compiler. 

Anyway, in the last two weeks, I tried learning LR and its variants, like
LALR, because of the LL(k) left-grammar problem. However, I found *LR* to be
quite non-intuitive, because they are bottom-up, rather than top-down, and
my ANTLR-centric way of thinking made it hard to visualise what was going
on. However, once I sat down with a decent book or two from the library, it
became very simple to see how both types of parsers work.

The key thing to remember with both LL(k) and LR is that they have to match
terminals - the non-terminals are simply there to group
terminals/non-terminals into patterns (with/without recursion). With LL(k)
you have to look at every possible alternative diving down into the rules -
if I see TOKEN1 then I will match one path but if I see TOKEN2 then I will
match a different path. Non-determinisms result from not being able to
predict a path with the current amount of look-ahead - this occurs because
of explicit choices in a rule, or because of a ()?, ()* or ()+ component
where you might match the alternative or "exit". 

Similarly, with LR you have to match one or more terminals before a "reduce"
can occur. You have to use the top-down approach first to "predict" what
alternatives might follow, especially in LR(1) and LALR(1) parsers.
Terminals at the front of the stream that cannot be matched are pushed down
into the stack temporarily until a suitable non-terminal can be matched
later on. This type of approach favours left-recursion, because you want to
match as much on the left first so that you can then match more complicated
non-terminals over time.

So its unfortunate that most grammars are LR-oriented, because
left-recursion is a pain to eliminate in LL(k) parsers. However, I think the
results are going to be fairly equivalent whether you choose LL(k) or LR.
Personally, I find that ANTLR is a fantastic tool, and can deal with all
sorts of conflicts and ambiguities using the syntactic predicates and
semantic predicates, and my (limited) experience with other tools is that
they cannot match ANTLR in terms of flexibility and power. It's really just
a matter of diving in and learning how best to use the tools! Whenever I
create a grammar of my own, I think I would prefer it to be LL(k) because it
makes it many times easier to see where the grammar is ambiguous.

Regards 

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435 


From nbsherid at secsme.org.au  Sun Jan 16 15:22:26 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Sun Jan 16 15:22:27 2005
Subject: [antlr-interest] warning:lexical nondeterminism between
	rulesVARTYPE and IDENT upon....
In-Reply-To: <41EAED05.1060804@blueyonder.co.uk>
Message-ID: <000b01c4fc22$3dbed260$a428198a@nigelnote>


You might be better off making "int", "float", etc into proper literals. You
want a section:

class MyParser extends Parser;
tokens
{
  INT="int";
  FLOAT="float";
  ...
}

types: IDENT | basicTypes;

basicTypes: INT | FLOAT | ... ;


They will be matched at first as an IDENT, and then turned into INT, FLOAT,
etc when the literal test is performed.

Alternatively, you can skip the "tokens" section and just put the text
straight into your parser rules like this:

basicTypes: "int" | "float" | ... ;


If you *really* want your literals in the lexer (non-recommended), then
increase "k" so that the look-ahead can distinguish between one token and
another (in this example, at least 6 tokens are required to distinguish
between the alternatives):

class MyLexer extends Lexer;
options {
  k = 6;
}

HELLO: "hello";
HELLOTHERE: "hellothere";


However, I think this really slows down the speed of the lexer (and ANTLR's
generation phase) quite a bit... 

Nigel


> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of clocKwize
> Sent: Monday, 17 January 2005 9:39 AM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] warning:lexical nondeterminism between
> rulesVARTYPE and IDENT upon....
> 
> hey, in my lexer i have this:
> 
> VARTYPE
>     options { paraphrase = "a variable type"; }
>         :    ("int" | "float" | "string" | "bool")
>         ;
> 
> IDENT
>     options { paraphrase = "an identifier"; testLiterals = true; }
>         :    ('a'..'z' |'A'..'Z') ('a'..'z'|'A'..'Z'|'_'|'0'..'9')*
>         ;
> 
> MyLexer.g: warning:lexical nondeterminism between rules VARTYPE and
> IDENT upon
> MyLexer.g:     k==1:'b','f','i','s'
> MyLexer.g:     k==2:'l','n','o','t'
> 
> it works ok as far as i know though, i'm not sure how to print a list of
> the tokens from the lexer into the console (cpp)
> 
> anyway, how do i turn the warning off?



--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435

From iank at bearcave.com  Sun Jan 16 15:50:17 2005
From: iank at bearcave.com (Ian Kaplan)
Date: Sun Jan 16 15:50:33 2005
Subject: [antlr-interest] Re: ANTLR vs lex/yacc, debugging and ANTLR 3
Message-ID: <200501162350.j0GNoH319934@shell2.webquarry.com>


> I have seen many people comment on how they dislike yacc/lex vs
> ANTLR.

  I can't speak for the multitudes of ANTLR users in their preference
  for ANTLR over YACC, but I did write a web page "Why Use ANTLR"
  which can be found here:

   http://www.bearcave.com/software/antlr/antlr_expr.html

  I find ANTLR more sophisticated in the way it handles synthesized
  results (results of grammar productions) and arguments passed down
  the grammar hierarchy.  In a similar vein, I like the way local
  initialization code blocks can be defined.  ANTLR also generates
  readable code code, in contrast to YACC's tables.  So you can see
  that it is generating what you intended.

  The issue of where the recursive is (left or right) does not have
  any traction for me.  I find it easy enough to write the grammar
  either way.  And I'm not a grammar theorist either.

  Debugging both YACC and ANTLR can be difficult.  I was reminded of
  this recently while working on an ANTLR grammar.  Because errors are
  reported as a result of how the grammar logically expands, with both
  YACC and ANTLR you get an error reported for a grammar location that
  may be far away from the place in the grammar that caused the
  problem.  This makes grammars painfully difficult to debug.  Here I
  don't find ANTLR much of an improvement over YACC.

  While on this topic: I've been meaning to write about the issue of
  debugging grammars.  So I guess that I'll use this as an
  opportunity.

  I've just finished a grammar for a query language.  It has
  expressions at a number of different levels and these expressions
  are recursive.  The grammar has been painful to debug.  The only way
  I could debug it was to start with the core expression and keep
  adding the productions above it until I found the production that
  broke the grammar.  This is very time consuming and unpleasant.

  It is very, very difficult to understand the cause of a problem in a
  complex grammar.  This understanding is equivalent to expanding out
  the grammar trees until you understand where the problem lies.  In
  practice this is very difficult to do.

  There has been some discussion here about ANTLR 3.  In considering
  the features for ANTLR 3, I would concentrate on the core of what I
  believe is the advantage that ANTLR delivers: generation of parsers.

  I wrote my own scanner for this query language.  It really was not a
  big deal.  Scanners are pretty easy to write.  ANTLR makes is easy
  to integrate a scanner with the parser.  I would not complain if the
  scanner generation capability disappeared from ANTLR.  The
  concentration on scanner performance in ANTLR 3 is, I think,
  misplaced.  There is only so much time and I think it is a good idea
  to concentrate on the core advantages of ANTLR: parser generation.

  I will not bore y'all again with my discussion on tree generation,
  except to state that this is not a feature I use either and would
  not be sad to see less time spent on it.

  What would have saved me several days of work is better features for
  debugging the grammar.  Perhaps something that would help expand out
  the grammar so I can see where the problem lies.

  Except for the difficulty of debugging ANTLR grammars, I'm pretty
  happy with ANTLR.  There is not a lot that I can think of that I'd
  like to change.

  What would help people in general, Terence, is if you finished your
  book.  One of my colleagues, who is an Oracle specialist who worked
  with me on the back end of the query language tried made a start at
  the query language parser.  He pretty much failed.  He had no idea
  of how to proceed.  Most people who have not written parsers before
  or used parser generators are going to have a pretty difficult time
  with ANTLR.  The existing documentation does not provide much to go
  on and web pages like mine are of limited help as well (my web pages
  concentrate on a C++ parser and our query language parser is
  targeted at Java).

  Ian Kaplan
From pauljlucas at mac.com  Sun Jan 16 17:21:34 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Sun Jan 16 17:21:37 2005
Subject: [antlr-interest] "finally" blocks
Message-ID: <Pine.LNX.4.44.0501161720020.17600-100000@g4.pauljlucas.org>

	In using ANTLR with Java, it would be nice to be able to specify
	"finally" blocks, e.g.:

		someRule
		    : SOME TOKEN
		    ;
		    exception
		    catch [ MyException e ] {
		        // ...
		    }
		    finally {
		    	// ...
		    }

	Or just a "finally" block alone.

	- Paul

From ewbank at gmail.com  Sun Jan 16 17:26:39 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Sun Jan 16 17:26:42 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
In-Reply-To: <000a01c4fc20$348d6050$a428198a@nigelnote>
References: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>
	<000a01c4fc20$348d6050$a428198a@nigelnote>
Message-ID: <dd3a065f050116172635bdb7e1@mail.gmail.com>

I am probably also in the minority here, but I don't think yacc is
really that difficult either -- LALR is fine.

ANTLR is just another tool in my portfolio; the reason I'm using it
for my current project is that I wanted to take advantage of the tree
operation.  In fact, we're not getting quite the benefits we'd
expected.  It's perhaps better than yacc, but perhaps not.

What it is, is a different paradigm.  Another was of looking at
whatever problem you're looking at.

If it works, great.  If yacc works better, great.
From teddemc at yahoo.com  Sun Jan 16 18:41:06 2005
From: teddemc at yahoo.com (Matthew Tedder)
Date: Sun Jan 16 18:41:08 2005
Subject: [antlr-interest] Lexer Performance
In-Reply-To: <dd3a065f050116172635bdb7e1@mail.gmail.com>
Message-ID: <20050117024106.62723.qmail@web52909.mail.yahoo.com>


Question: My understanding (correct me if I am wrong),
is that antlr does not the the table method for
lexical analysis, but just a simple serial processing
method.

Is there any plan on changing this down the road?  I'd
be still working with flex/bison, if only bison would
offer reasonable C++ support.  The thing that brought
me to antlr was C++ support, and possibly easy to
create working grammars.  Being seemingly java-centric
worried me enough about performance... 

I am trying to do contract management--processing
contract terms over millions of financial transaction
records..

Matthew
From mbresnah at visi.com  Sun Jan 16 20:40:32 2005
From: mbresnah at visi.com (Mike Bresnahan)
Date: Sun Jan 16 20:40:16 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
In-Reply-To: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>
Message-ID: <EKEJKOHPOIIALFJMKEIGGEDLGCAA.mbresnah@visi.com>

Here's an example of where I find LL(k)/ANTLR obtuse.  Take the following
standard expression example that is similar to many on the web.

class ExpressionParser extends Parser;

expr     : sumExpr SEMI!;
sumExpr  : prodExpr ((PLUS^|MINUS^) prodExpr)* ;
prodExpr : powExpr ((MUL^|DIV^|MOD^) powExpr)* ;
powExpr  : atom (POW^ atom)? ;
atom     : INT ;

class ExpressionLexer extends Lexer;

PLUS  : '+' ;
MINUS : '-' ;
MUL   : '*' ;
DIV   : '/' ;
MOD   : '%' ;
POW   : '^' ;
SEMI  : ';' ;
protected DIGIT : '0'..'9' ;
INT   : (DIGIT)+ ;


What I find really weird about this grammar is that a "sumExpr" can be not
only "x + y" as I would expect, but it can also be "x * y" and "x^2" and
"5".  That's unintuitive to me.  I don't remember having this issue with
LALR/yacc.  Is the unintuitive to me only because I learned it differently
the first time (i.e. in yacc)?

What's also confusing is that the structure of the grammar above determines
the operator precedence.  With yacc operator precedence is specified more
clearly via special keywords.  Again perhaps I only think this way because I
learned it differently the first time.




From tohagan at itee.uq.edu.au  Sun Jan 16 21:35:33 2005
From: tohagan at itee.uq.edu.au (Tony O'Hagan)
Date: Sun Jan 16 21:35:47 2005
Subject: [antlr-interest] How to extend Java language using ANTLR
Message-ID: <200501170535.j0H5ZbGe017809@luma.itee.uq.edu.au>


I'm considering writing a source to source translator that will extend 
the Java language to include some additional expressions, statements 
and possibly some modified type constructs - all of which will map to 
Java source code.

Q. What approach would you recommend to minimize the code generation effort?

I understand that I'll probably parse the input using a modified version of 
one of the sample Java grammars.  Since this will be a source to source
translator with Java as input and output language, I'd like to try to avoid 
or minimize the coding for all the of one to one mappings that will occur
for most
grammar rules.

I suspect I'll still need to build up a symbol table of declared types and
variables
but for the purposes of a research prototype I may end up using simpler type
declarations 
that will still easily map to existing Java type declarations.  

This sounds like it would a "been there done that".  Perhaps someone can
point me at 
an complete example of how they did a language extension of this type.
A Java, C# or C++ example would be nice.

Thanks,
Tony O'Hagan

------------------------------------
ITEE, University of Queensland
Tony O'Hagan
Senior Research Officer
School of Information Technology & Electrical Engineering
University of Qld., Brisbane, Australia
------------------------------------

From nbsherid at secsme.org.au  Mon Jan 17 02:24:26 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Mon Jan 17 02:24:32 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
In-Reply-To: <EKEJKOHPOIIALFJMKEIGGEDLGCAA.mbresnah@visi.com>
Message-ID: <001001c4fc7e$b8cf51d0$0200a8c0@nigelnote>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Mike Bresnahan
> Sent: Monday, 17 January 2005 3:41 PM
> To: antlr-interest@antlr.org
> Subject: RE: [antlr-interest] ANTLR vs lex/yacc
> 
> Here's an example of where I find LL(k)/ANTLR obtuse.  Take the following
> standard expression example that is similar to many on the web.
> 
> class ExpressionParser extends Parser;
> 
> expr     : sumExpr SEMI!;
> sumExpr  : prodExpr ((PLUS^|MINUS^) prodExpr)* ;
> prodExpr : powExpr ((MUL^|DIV^|MOD^) powExpr)* ;
> powExpr  : atom (POW^ atom)? ;
> atom     : INT ;
> 
> class ExpressionLexer extends Lexer;
> 
> PLUS  : '+' ;
> MINUS : '-' ;
> MUL   : '*' ;
> DIV   : '/' ;
> MOD   : '%' ;
> POW   : '^' ;
> SEMI  : ';' ;
> protected DIGIT : '0'..'9' ;
> INT   : (DIGIT)+ ;
> 
> 
> What I find really weird about this grammar is that a "sumExpr" can be not
> only "x + y" as I would expect, but it can also be "x * y" and "x^2" and
> "5".  That's unintuitive to me.  I don't remember having this issue with
> LALR/yacc.  Is the unintuitive to me only because I learned it differently
> the first time (i.e. in yacc)?

Well as a top-down parser, you get

01) expr

becomes

02) sumExpr SEMI
03) prodExpr ( (PLUS|MINUS) prodExpr )*
04) powExpr ( (MUL|DIV|MOD) powExpr )* ( (PLUS|MINUS) prodExpr )*
05) atom (POW atom)? ( (MUL|DIV|MOD) powExpr )* ( (PLUS|MINUS) prodExpr )*
06) INT (POW INT)? ( (MUL|DIV|MOD) powExpr )* ( (PLUS|MINUS) prodExpr )*

etc etc

So it matches an integer, optionally followed by '^', '*'\'/'\'%' or '+'\'-'
with precedence in that order and equal precedence between alternatives.

When it reaches the (POW INT)? alternative, the parser looks-ahead by 'k'
tokens to determine if POW, MUL, DIV, MOD, PLUS or MINUS is matched and then
consumes more tokens to match the input to the anticipated tokens in that
rule. Hence, for these rules you only need k=1 to determine which
alternative is successful.

By structuring the rules in this way, it guarantees that a POW will always
be matched before a MUL/DIV/MOD, and those before a PLUS/MINUS. Hence
precedence is correctly dealt with. Left and right associativeness depends
only on your actions or AST construction - you can process in either
direction but the rules given there will build a right-associative AST by
default.

> 
> What's also confusing is that the structure of the grammar above
> determines
> the operator precedence.  With yacc operator precedence is specified more
> clearly via special keywords.  Again perhaps I only think this way because
> I
> learned it differently the first time.
> 

Well this seems okay to me, but then I've never used yacc. Is it really
*that* much easier?

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435

From ric.klaren at gmail.com  Mon Jan 17 04:01:22 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan 17 04:01:25 2005
Subject: [antlr-interest] Lexer Performance
In-Reply-To: <20050117024106.62723.qmail@web52909.mail.yahoo.com>
References: <dd3a065f050116172635bdb7e1@mail.gmail.com>
	<20050117024106.62723.qmail@web52909.mail.yahoo.com>
Message-ID: <bc607a4e0501170401633ef062@mail.gmail.com>

On Sun, 16 Jan 2005 18:41:06 -0800 (PST), Matthew Tedder
<teddemc@yahoo.com> wrote:
> Question: My understanding (correct me if I am wrong),
> is that antlr does not the the table method for
> lexical analysis, but just a simple serial processing
> method.

Yup.

> Is there any plan on changing this down the road?  I'd
> be still working with flex/bison, if only bison would
> offer reasonable C++ support.  The thing that brought
> me to antlr was C++ support, and possibly easy to
> create working grammars.  Being seemingly java-centric
> worried me enough about performance...

ANTLR2 does not generate the speediest parsers/scanners. It's easy
though to use a flex scanner with antlr2. ANTLR provides some extra's
over flex/bison in terms of ease and error handling. Also antlr
parsers are very debuggable due to the fact that they're readable.
ANTLR2 performance relies for a lot on how you structure your grammar
(use of syntactic predicates, that introduce backtracking).

In general flex/bison will be faster than antlr2. ANTLR3 is in
prototype stage and will be a lot faster, the hope is to release
ANTLR3 within a year. ANTLR3 might be faster than flex/bison. ANTLR3
will also give much more ease in developing grammars (thanks to the
new LL(*) algorithm and intended tool support).

> I am trying to do contract management--processing
> contract terms over millions of financial transaction
> records..

It is possible to get good performance with ANTLR2 but it might
require some tinkering with the support lib. And it also depends on
what you want/need in the backend.

Cheers,

Ric
From Anthony.Youngman at eca-international.com  Mon Jan 17 04:16:19 2005
From: Anthony.Youngman at eca-international.com (Anthony Youngman)
Date: Mon Jan 17 04:16:32 2005
Subject: [antlr-interest] warning:lexical nondeterminism between
	rulesVARTYPE and IDENT upon....
Message-ID: <C7FE35004D40FD45AA342991B88CE40409B0EC@lnml1.eca-international.local>

The problem is simple - your VARTYPEs can match either the VARTYPE or
IDENT rules. Hence the inderterminism.

I notice you've got "testLiterals" set to true for IDENT, so just
declare "int", "float" etc as literals, and scrap the VARTYPE rule
completely.

You can then either test for them in the IDENT rule, or the parser. (By
declaring them as literals, they will be allocated their own types for
parsing purposes - they won't be type IDENT.)

Cheers,
Wol

-----Original Message-----
From: antlr-interest-bounces@antlr.org
[mailto:antlr-interest-bounces@antlr.org] On Behalf Of clocKwize
Sent: 16 January 2005 22:39
To: antlr-interest@antlr.org
Subject: [antlr-interest] warning:lexical nondeterminism between
rulesVARTYPE and IDENT upon....

hey, in my lexer i have this:

VARTYPE
    options { paraphrase = "a variable type"; }
        :    ("int" | "float" | "string" | "bool")
        ;
       
IDENT
    options { paraphrase = "an identifier"; testLiterals = true; }
        :    ('a'..'z' |'A'..'Z') ('a'..'z'|'A'..'Z'|'_'|'0'..'9')*
        ;

MyLexer.g: warning:lexical nondeterminism between rules VARTYPE and 
IDENT upon
MyLexer.g:     k==1:'b','f','i','s'
MyLexer.g:     k==2:'l','n','o','t'

it works ok as far as i know though, i'm not sure how to print a list of

the tokens from the lexer into the console (cpp)

anyway, how do i turn the warning off?


****************************************************************************

This transmission is intended for the named recipient only. It may contain private and confidential information. If this has come to you in error you must not act on anything disclosed in it, nor must you copy it, modify it, disseminate it in any way, or show it to anyone. Please e-mail the sender to inform us of the transmission error or telephone ECA International immediately and delete the e-mail from your information system.

Telephone numbers for ECA International offices are: Sydney +61 (0)2 8272 5300, Hong Kong + 852 2121 2388, London +44 (0)20 7351 5000 and New York +1 212 582 2333.

****************************************************************************

From oliver.kowalke at gmx.de  Mon Jan 17 04:32:58 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Mon Jan 17 04:33:02 2005
Subject: [antlr-interest] howto ignore unknown tokenstreams/recordsets
Message-ID: <7389.1105965178@www4.gmx.net>

Hi,

I'm writing a parser which parses a dokument (datasets separated by
semicolon). 
How can I ignore unknown datasets (in my example recordsets X and Y)?

with best regards
Oliver

document structure:

A  1 2;
B 2;
X 1 2;
C "xyz";
Y "ijk";
D "uvw" 123;

The parser grammar looks like this:

...

class MyLexer extends Lexer;

options 
{ k=2; }

tokens
{
A="A";
B="B";
C="C";
D="D";
}


INT : ( '0'..'9' )+;
STRING : '"'!
    ( ~( '\'' | '"' | '\n' | '\r' ) )*
    ( '"'!
    | // nothing -- write error message
    )
;

EODS : ';';

DELIM : ( ' '
	| '\t'
	|	( "\r\n"
		| '\r'
		| '\n'
		)
		{ newline(); }
	)
	{ $setType( antlr::Token::SKIP ); }
;


class MyParser extends Parser;

options { k=2; }

start_rule : sec_1_rule sec_2_rule EOF;

sec_1_rule : ( a_rule | b_rule )*;

sec_2_rule : ( c_rule | d_rule )*;

a_rule : A INT INT EODS;

b_rule : B INT EODS;

c_rule : C STRING EODS;

d_rule : D STRING INT EODS;

-- 
10 GB Mailbox, 100 FreeSMS http://www.gmx.net/de/go/topmail
+++ GMX - die erste Adresse fr Mail, Message, More +++
From ric.klaren at gmail.com  Mon Jan 17 04:35:38 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan 17 04:35:40 2005
Subject: [antlr-interest] ANTLR vs lex/yacc
In-Reply-To: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>
References: <EKEJKOHPOIIALFJMKEIGAEPEGBAA.mike@fruitioninc.com>
Message-ID: <bc607a4e05011704357c51fa24@mail.gmail.com>

On Sun, 9 Jan 2005 21:49:13 -0600, Mike Bresnahan <mike@fruitioninc.com> wrote:
> Speed forward to today.  I first started using ANTLR a few months ago.  I
> chose it because it generates C# and that is what I needed.  My experience
> with ANTLR has been much different than my experience with yacc/lex.  I have
> found it extremely difficult to get my head around the tool.  I don't think
> the problem is the tool per se, but rather LL(k) grammers.  I don't find
> them to be intuitive.  The grammers are harder for me to read and write.

I guess this is something to get used to. LL(k) works top down and
LALR works bottom up in matching. (Can't add anything to the excellent
post of Nigel) Some things you get for free in LALR and not in LL(k)

> One very hard concept is that I cannot use left recursion, however "middle
> recursion" and "right recursion" are just fine.  Why is left recursion
> treated differently?  It just seems asymeteric and ad-hoc to me.

It might be enlightening to just read a small antlr generated parser
to see how it matches things (or read a text book on LL(1)/LL(k)). For
instance the calc example. It is really easy to see how an antlr
parser/lexer moves through the input.

> So either I've gotten stupider over the years, my brain is more in tune with
> LALR grammers, or LL(k) grammers are simply harder to understand than LALR
> grammers.  Why is it that people like ANTLR more than yacc/lex?  Why have I
> had a different experience?

Before switching to antlr I've used lex/yacc, slade (an LL(1) parser
generator of the university of twente) and cocktail (has both LALR and
LL(1) parsers based on Modula 2 though which sucks) When I switched to
ANTLR I needed quite a lot of time to get used to some things. A big
handicap is the docs, in general everything you need is in it, but the
structure is somehow very hard to cope with. I'd read it all to start
with even if you don't get everything at start.

> Background note: I've never studied the theory of compilers nor do I have a
> degree in computer science.  However, I have been programming for 20 years
> or so; 10 professionally.

In a sense that's a good background for getting a hang of antlr. Start
reading the generated code and trace through it a few times and things
will start dawning is my guess. One of the big advantages of antlr is
the readability of it's generated code. As a result it's really easy
to debug programming errors in action code. If you debug a yacc parser
then you often think how the heck did I end up here. If you debug an
ANTLR parser you directly can see the lookahead in a rule and combine
that with the follow sets that are used to predict which rule should
be entered next. This gives a lot of intuition as to where problems
are (at least for me it does)

Some other advantages: 

- One algorithm for generated lexers/parsers/treeparsers. They're all
the same. (some small oddities left aside: for a lexer all the token
rules are or'ed into a nextToken method which will give some
unexpected ambiguities for the the newcomer, treeparsers only use a
lookahead of 1 which is also unexpected for some)
- You get much better error messages/handling for practically free
compared to lex/yacc. (although maybe lacking a bit in flexibility,
but as far as I've seen tweaks are hardly ever needed to improve error
messages/handling)
- ANTLR allows you to cheat. If you run into an ambiguity you don't
see how to fix easily you can always use a syntactic predicate to
patch things up so you can get on with it. Later when the complete
grammar is finished you can start removing them when you got the
complete picture.
- You get a lexer that can parse too.... Ok this is in a sense nasty
too. You can sometimes solve things you can't fix in the parser by
doing a little more in the lexer. For newbies it's often the problem
not doing too much in the lexer.
- Once you get the hang of things you start seeing ANTLR as a general
purpose parsing language ;) Especially when dealing with tree parsers
it's really convenient to use tree parsers inside treeparsers. It just
behaves like a function call.
- You get tokenstream filtering. You can stack parsers so one parser
becomes the lexer for the other thus filtering the tokens that come
from a lower layer to the upper layer. This allows to tackle some
really nasty parsing problems.

Currently I'd only grab lex/yacc if I needed speed. ANTLR3 will
probably fix that though. LALR is not necessary faster than LL(1) /
LL(k).

Hope this helps,

Ric
From fanyang_32 at yahoo.ca  Mon Jan 17 06:09:55 2005
From: fanyang_32 at yahoo.ca (Fan Yang)
Date: Mon Jan 17 06:09:58 2005
Subject: [antlr-interest] (no subject)
Message-ID: <20050117140955.92926.qmail@web52801.mail.yahoo.com>

Hi,
 
I have memory leaks on deleting CommonHiddenTokens(double link list) which there exist reference counting circular problem. I have searched on antlr archives, and  found that same problem was discussed in "nodes, hidden tokens, garbage collection" topic in 2002 archive, but it didn't give me the handy solution. Now almost 3 years passed, is there a mature and practical solution on this problem? Has the new antlr release fixed this problem? any suggestion will be appreciated.
 
Best Regards,
 
Fan




---------------------------------
Post your free ad now! Yahoo! Canada Personals
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050117/4799baa8/attachment.html
From fanyang_32 at yahoo.ca  Mon Jan 17 06:22:41 2005
From: fanyang_32 at yahoo.ca (Fan Yang)
Date: Mon Jan 17 06:22:43 2005
Subject: [antlr-interest] How to fix reference counting circular
	problem(C++)?
Message-ID: <20050117142241.29075.qmail@web52804.mail.yahoo.com>

Hi,
 
I have memory leaks on deleting CommonHiddenTokens(double link list) which there exist reference counting circular problem. 
 
I have searched on antlr archives, and  found that same problem was discussed in "nodes, hidden tokens, garbage collection" topic in 2002 archive, but it didn't give me the solution. 
 
Now almost 3 years passed, is there a mature and practical solution on this problem? Has the new antlr release fixed this problem? 
any suggestion will be appreciated.
 
Best Regards,
 
Fan




---------------------------------
Post your free ad now! Yahoo! Canada Personals
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050117/7d6614b9/attachment.html
From krishanu.debnath at gmail.com  Mon Jan 17 06:40:30 2005
From: krishanu.debnath at gmail.com (Krishanu Debnath)
Date: Mon Jan 17 06:40:36 2005
Subject: [antlr-interest] problems with label
In-Reply-To: <9fa1fefc05011705581522f13f@mail.gmail.com>
References: <9fa1fefc05011705581522f13f@mail.gmail.com>
Message-ID: <9fa1fefc050117064046e3167d@mail.gmail.com>

Hello,

My grammer accepts keywords as a identifier. So I use the following identifier
rule in parser.

id returns [_return_type *idObj]
{
    // initialized code
}
    :
        tId:ID
        {
            // retrieve the token that has been set in lexer using $setToken()
            pIdObj = (_return_type *)... //label tId is used to
retrieve the _return_type node
        }
        // Followings are the keywords
    |   tIndex:"index"
        {
             // similar C++ code except it use label 'tIndex'
        }
    |   tOut:"out"
           {
            // similar C++ code except it use label 'tOut'
        }
    // Other keywords

Now to avoid (keyword set is quite large)duplicate codes for each keyword,
I would like to have the 'id' rule as follows ..

id returns [_return_type *idObj]
{
    // initialized code
}
    :
        tId:ID
        {
            // retrieve the token that has been set in lexer using $setToken()
            pIdObj = (_return_type *)... //label tId is used to access
the _return_type node
        }
    |
        // Followings are the keywords
       (
          tKeyword:""index"
       |  tKeyword:"out"
       |
       ... // other keywords ..

       )
       {
            // C++ code using label 'tKeyword'
       }

But Antlr reports error 'already defined label tKeyword' for this. Is there any
options/work around available to by pass this error?

Krishanu

-- 
"When I have to rely on inadequacy, I prefer it to be my own."
--Richard Heathfield
From ric.klaren at gmail.com  Mon Jan 17 06:52:32 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan 17 06:52:34 2005
Subject: [antlr-interest] How to fix reference counting circular
	problem(C++)?
In-Reply-To: <20050117142241.29075.qmail@web52804.mail.yahoo.com>
References: <20050117142241.29075.qmail@web52804.mail.yahoo.com>
Message-ID: <bc607a4e050117065248587b00@mail.gmail.com>

On Mon, 17 Jan 2005 09:22:41 -0500 (EST), Fan Yang <fanyang_32@yahoo.ca> wrote:
> I have memory leaks on deleting CommonHiddenTokens(double link list) which
> there exist reference counting circular problem. 
>   
> I have searched on antlr archives, and  found that same problem was
> discussed in "nodes, hidden tokens, garbage collection" topic in 2002
> archive, but it didn't give me the solution. 

Can't add anything other than the reply I gave then. You could prior
to deleting the AST destroy the double links by setting them to
nullAST.

> Now almost 3 years passed, is there a mature and practical solution on this
> problem? Has the new antlr release fixed this problem?
> any suggestion will be appreciated. 

The 2.7.5 release does not change the reference counter. It was
planned to switch to another but it ran into some trouble I could not
solve quickly in the prerelease track. The new one would not have
solved this problem either.

At some point I intend to get rid of the reference counters and move
to custom allocators with optional garbage collection or manual memory
management. ANTLR3 will probably see that. Don't know if I'll have
time to do it for ANTLR2.

Cheers,

Ric
From ric.klaren at gmail.com  Mon Jan 17 06:59:25 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan 17 06:59:29 2005
Subject: [antlr-interest] howto ignore unknown tokenstreams/recordsets
In-Reply-To: <7389.1105965178@www4.gmx.net>
References: <7389.1105965178@www4.gmx.net>
Message-ID: <bc607a4e05011706592426957@mail.gmail.com>

On Mon, 17 Jan 2005 13:32:58 +0100 (MET), Oliver Kowalke
<oliver.kowalke@gmx.de> wrote:
> I'm writing a parser which parses a dokument (datasets separated by
> semicolon).
> How can I ignore unknown datasets (in my example recordsets X and Y)?

It depends a bit on what defines an unknown recordset. If you know
those start with X and Y then you can just skip them in the lexer like
whitespace. Or you can use tokenstream filtering between lexer and
parser. Although you should take care that there's no (or very
controlled) feedback from parser to lexer (when using tokenstream
filtering). Another approach might be to make some custom error
handlers in your parser that skip the unrecognized bits, that might
interfere with normal error handling though.

Cheers,

Ric
From parrt at cs.usfca.edu  Mon Jan 17 09:30:33 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 09:30:36 2005
Subject: [antlr-interest] problems with label
In-Reply-To: <9fa1fefc05011705581522f13f@mail.gmail.com>
References: <9fa1fefc05011705581522f13f@mail.gmail.com>
Message-ID: <7E17B95E-68AD-11D9-927D-000393BB647E@cs.usfca.edu>

Hi,

[please switch to antlr.org's mailing list now] :)

Anyway, yes.  Use LT(1) before the subrule or in an init action.  That 
will get the token for the next symbol.

Ter
On Jan 17, 2005, at 5:58 AM, Krishanu Debnath wrote:
> id returns [_return_type *idObj]
> {
>     // initialized code
> }
>     :
>         tId:ID
>         {
>             // retrieve the token that has been set in lexer using 
> $setToken()
>             pIdObj = (_return_type *)... //label tId is used to access
> the _return_type node
>         }
>     |
>         // Followings are the keywords
>        (
>           tKeyword:""index"
>        |  tKeyword:"out"
>        |
>        ... // other keywords ..
>
>        )
>        {
>             // C++ code using label 'tKeyword'
>        }
>
>
> But Antlr reports error 'already defined label tKeyword' for this. Is 
> there any
> options/work around available to by pass this error?
>
> Krishanu
>
> -- 
> "When I have to rely on inadequacy, I prefer it to be my own."
> --Richard Heathfield
>
>
>
> Yahoo! Groups Links
>
> <*> To visit your group on the web, go to:
>     http://groups.yahoo.com/group/antlr-interest/
>
> <*> To unsubscribe from this group, send an email to:
>     antlr-interest-unsubscribe@yahoogroups.com
>
> <*> Your use of Yahoo! Groups is subject to:
>     http://docs.yahoo.com/info/terms/
>
>
>
>



From oliver.kowalke at gmx.de  Mon Jan 17 10:44:13 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Mon Jan 17 10:44:19 2005
Subject: [antlr-interest] howto ignore unknown tokenstreams/recordsets
Message-ID: <200501171944.13677.oliver.kowalke@gmx.de>

Am Montag, 17. Januar 2005 15:59 schrieb Ric Klaren:
>> I'm writing a parser which parses a dokument (datasets separated by
>> semicolon).
>> How can I ignore unknown datasets (in my example recordsets X and Y)?
>
>It depends a bit on what defines an unknown recordset. If you know
>those start with X and Y then you can just skip them in the lexer like
>whitespace. Or you can use tokenstream filtering between lexer and
>parser. Although you should take care that there's no (or very
>controlled) feedback from parser to lexer (when using tokenstream
>filtering). Another approach might be to make some custom error
>handlers in your parser that skip the unrecognized bits, that might
>interfere with normal error handling though.

For a unknown recordset the leading key (X or Y in my example, in general 
<something else>) are not known. The ?structure of the to be ignored 
recordsets is <some letters> ( ~(";") )+ ";". 
Because I don't know <some letters> and the following tokens until ";" I can 
not skip them in the lexer. (right ?)

What I want is a parser that recognizes the defined recordsets and ignores all 
other input (must be structured like a recordset).

Hopefuly you can give my some help.

with best regards
Oliver
From ric.klaren at gmail.com  Mon Jan 17 11:52:53 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Mon Jan 17 11:52:57 2005
Subject: [antlr-interest] howto ignore unknown tokenstreams/recordsets
In-Reply-To: <200501171944.13677.oliver.kowalke@gmx.de>
References: <200501171944.13677.oliver.kowalke@gmx.de>
Message-ID: <bc607a4e050117115210a4c82b@mail.gmail.com>

On Mon, 17 Jan 2005 19:44:13 +0100, Oliver Kowalke
<oliver.kowalke@gmx.de> wrote:
> Am Montag, 17. Januar 2005 15:59 schrieb Ric Klaren:
> >> I'm writing a parser which parses a dokument (datasets separated by
> >> semicolon).
> >> How can I ignore unknown datasets (in my example recordsets X and Y)?
> >
> >It depends a bit on what defines an unknown recordset. If you know
> >those start with X and Y then you can just skip them in the lexer like
> >whitespace. Or you can use tokenstream filtering between lexer and
> >parser. Although you should take care that there's no (or very
> >controlled) feedback from parser to lexer (when using tokenstream
> >filtering). Another approach might be to make some custom error
> >handlers in your parser that skip the unrecognized bits, that might
> >interfere with normal error handling though.
> 
> For a unknown recordset the leading key (X or Y in my example, in general
> <something else>) are not known. The  structure of the to be ignored
> recordsets is <some letters> ( ~(";") )+ ";".
> Because I don't know <some letters> and the following tokens until ";" I can
> not skip them in the lexer. (right ?)

Yup. 

But I get the impression that you can tokenize the unknown records? If
that's the case then make a rule in the parser that works as a collect
all. You'll get ambiguity warnings but the first matching alternative
will get matched so things should be ok.

Ok had a closer look at the lexer/parser you posted earlier. It looks
to me that the lexer is not 100% functional. At least I don't see how
it could match the A-D tokens. Without a rule with testLiterals =true;

Try adding a lexer rule :

ID options { testLiterals = true; }:     ( 'A' .. 'Z' )+ ;

This one matches everything that consists of only letters. The
testLiterals option makes sure the items added in the tokens section
get recognized as such (before returning from the ID rule antlr checks
against entries in the tokens table). E.g. they get passed to the
parser as A .. D and the unknown tokens get passed as ID. You could
use that to make the catch all rule. At least that should be the
general idea I think.

Cheers,

Ric
From nan.zhang at sympatico.ca  Mon Jan 17 12:04:41 2005
From: nan.zhang at sympatico.ca (Nan Zhang)
Date: Mon Jan 17 12:03:33 2005
Subject: [antlr-interest] how to define these characters(java)
Message-ID: <008601c4fccf$da50e160$18001fac@nancyzhang>

I tried to build a parser and lexer (java) to do this simple task:
print every '+' encountered and ignore all other characters in the inputstream(or maybe do other actions instead of just ignore it).
Here's my code:
-----------
class P extends Parser;
options {
 defaultErrorHandler = false;
 }
startRule 
 : 
     (n:PLUS {System.out.println(n.getText())}
     )+ NEWLINE
 ;

class L extends Lexer;
PLUS : '+' ;
NEWLINE : '\r''\n'|'\n' ;
NON : ~('+'|'\r''\n'|'\n') {$setType(Token.SKIP); }//and other actions
 ;
------------
but I got an error message: This subrule cannot be inverted. Only subrules of the form:
    (T1|T2|T3...) or
    ('c1'|'c2'|'c3'...)
may be inverted (ranges are also allowed).
Exiting due to errors.

I know there must be something wrong with NON definition in my code, but how to define such a characterSet: not '+' and not newline?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050117/82a3c18e/attachment.html
From oliver.kowalke at gmx.de  Mon Jan 17 13:01:41 2005
From: oliver.kowalke at gmx.de (Oliver Kowalke)
Date: Mon Jan 17 13:01:44 2005
Subject: [antlr-interest] howto ignore unknown tokenstreams/recordsets
References: <bc607a4e050117115210a4c82b@mail.gmail.com>
Message-ID: <11443.1105995701@www58.gmx.net>

> This one matches everything that consists of only letters. The
> testLiterals option makes sure the items added in the tokens section
> get recognized as such (before returning from the ID rule antlr checks
> against entries in the tokens table). E.g. they get passed to the
> parser as A .. D and the unknown tokens get passed as ID. You could
> use that to make the catch all rule. At least that should be the
> general idea I think.

Hi,

thx it seams to work but I get some nondeterminism warnings. How can I
remove them? Are the warnings relevant?
thx
Oliver

-- input --
A 1 2;
B 1;
X 1 2;
C "abc";
d 1 "abc";
Y "test" 123;


-- grammar ---
...    
class MyLexer extends Lexer;

options 
{
    k=2;
    charVocabulary='\u0000'..'\u007F';
    caseSensitive=false;
    caseSensitiveLiterals=false;
    testLiterals = false;
}

tokens
{
	A="a";
	B="b";
	C="c";
	D="d";
}

NUM : ( '0'..'9' )+;

IDENT options { testLiterals = true; } : ( 'a'..'z' ) ( '0'..'9' | 'a'..'z'
)*;

STRING : '"'!
    ( ~( '\'' | '"' | '\n' | '\r' ) )*
    ( '"'!
    | // nothing -- write error message
    )
;
        
EODS : ';'; 

DELIM 
	: ( ' '
	| '\t'
	| '\f'
	|	( "\r\n"
		| '\r'
		| '\n'
		)
		{ newline(); }
	)
	{ $setType(antlr::Token::SKIP); }
;
      
class MyParser extends Parser;

parse : datasets EOF;

datasets : ( headers EODS )* ( section1 EODS )*;

headers : a | b	| ign;

section1 : c | d | ign;

a : A NUM NUM;
b : B NUM;
c : C STRING;
d : D NUM STRING;
ign : IDENT ( ~( EODS ) )* ;

-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl
From parrt at cs.usfca.edu  Mon Jan 17 13:51:30 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 13:45:14 2005
Subject: [antlr-interest] How to extend Java language using ANTLR
In-Reply-To: <200501170535.j0H5ZbGe017809@luma.itee.uq.edu.au>
References: <200501170535.j0H5ZbGe017809@luma.itee.uq.edu.au>
Message-ID: <F225B7A1-68D1-11D9-8292-000A95891192@cs.usfca.edu>


On Jan 16, 2005, at 9:35 PM, Tony O'Hagan wrote:

>
> I'm considering writing a source to source translator that will extend
> the Java language to include some additional expressions, statements
> and possibly some modified type constructs - all of which will map to
> Java source code.
>
> Q. What approach would you recommend to minimize the code generation 
> effort?

For input-output pairs that are very similar, use the 
TokenStreamRewriteEngine; works to good effect, I believe.

http://www.antlr.org/article/rewrite.engine/index.tml

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From parrt at cs.usfca.edu  Mon Jan 17 13:52:08 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 13:45:52 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501161720020.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501161720020.17600-100000@g4.pauljlucas.org>
Message-ID: <08ECE6D9-68D2-11D9-8292-000A95891192@cs.usfca.edu>


On Jan 16, 2005, at 5:21 PM, Paul J. Lucas wrote:

> 	In using ANTLR with Java, it would be nice to be able to specify
> 	"finally" blocks, e.g.:
>
> 		someRule
> 		    : SOME TOKEN
> 		    ;
> 		    exception
> 		    catch [ MyException e ] {
> 		        // ...
> 		    }
> 		    finally {
> 		    	// ...
> 		    }
>
> 	Or just a "finally" block alone.

Good idea Paul.  Is there a decent equiv in all potential targets?

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From pauljlucas at mac.com  Mon Jan 17 13:48:50 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 13:48:51 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <08ECE6D9-68D2-11D9-8292-000A95891192@cs.usfca.edu>
Message-ID: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Terence Parr wrote:

> On Jan 16, 2005, at 5:21 PM, Paul J. Lucas wrote:

> > 	In using ANTLR with Java, it would be nice to be able to specify
> > 	"finally" blocks, e.g.:

> Good idea Paul.  Is there a decent equiv in all potential targets?

	I don't know about all targets, but C++ doesn't need "finally"
	because C++ has destructors.  The only reason Java needs
	"finally" is because it doesn't have destructors.

	- Paul

From parrt at cs.usfca.edu  Mon Jan 17 13:57:51 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 13:51:36 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
Message-ID: <D513659C-68D2-11D9-8292-000A95891192@cs.usfca.edu>


On Jan 17, 2005, at 1:48 PM, Paul J. Lucas wrote:
>>> 	In using ANTLR with Java, it would be nice to be able to 
>>> specify	"finally" blocks, e.g.:
>
>> Good idea Paul.  Is there a decent equiv in all potential targets?
>
> 	I don't know about all targets, but C++ doesn't need "finally"
> 	because C++ has destructors.  The only reason Java needs
> 	"finally" is because it doesn't have destructors.

Yeah, I wonder about C target.  I'd hate to have something that could 
only be done in a few targets.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From ewbank at gmail.com  Mon Jan 17 14:41:09 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Mon Jan 17 14:41:12 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <D513659C-68D2-11D9-8292-000A95891192@cs.usfca.edu>
References: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
	<D513659C-68D2-11D9-8292-000A95891192@cs.usfca.edu>
Message-ID: <dd3a065f05011714415c0de446@mail.gmail.com>

"finally" can be implemented in C the same way the "exceptions" can be
- without setjmp/longjmp, but with control flow such as a dummy
do{...}while(0) statement, and a following switch to manage
exceptions.

No big deal (he says, not having to implement it :-)
From parrt at cs.usfca.edu  Mon Jan 17 14:56:41 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 14:50:26 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <dd3a065f05011714415c0de446@mail.gmail.com>
References: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
	<D513659C-68D2-11D9-8292-000A95891192@cs.usfca.edu>
	<dd3a065f05011714415c0de446@mail.gmail.com>
Message-ID: <0D56D752-68DB-11D9-8292-000A95891192@cs.usfca.edu>


On Jan 17, 2005, at 2:41 PM, Bryan Ewbank wrote:

> "finally" can be implemented in C the same way the "exceptions" can be
> - without setjmp/longjmp, but with control flow such as a dummy
> do{...}while(0) statement, and a following switch to manage
> exceptions.
>
> No big deal (he says, not having to implement it :-)

LOL

Heh, cool idea.  How does this make sure nobody does a "return" in the 
middle of the code though w/o doing the finally bit?

Thanks,
Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From christopher.d.schultz at comcast.net  Mon Jan 17 14:54:01 2005
From: christopher.d.schultz at comcast.net (Christopher Schultz)
Date: Mon Jan 17 14:54:14 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501171347230.17600-100000@g4.pauljlucas.org>
Message-ID: <41EC4209.6000905@comcast.net>

Paul,

>>>	In using ANTLR with Java, it would be nice to be able to specify
>>>	"finally" blocks, e.g.:
> 
>>Good idea Paul.  Is there a decent equiv in all potential targets?
> 
> 	I don't know about all targets, but C++ doesn't need "finally"
> 	because C++ has destructors.  The only reason Java needs
> 	"finally" is because it doesn't have destructors.

I think that's a flawed comparison. Destructors are in C++ what 
finalizers are in Java. A "finally" block is different. I agree with 
Brian Ewbank's comments that Java-style "finally" behavior can be 
achieved in C++. About all you need is "goto" with an in-scope return 
value in the function.

-chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050117/c44d67d3/signature.bin
From pauljlucas at mac.com  Mon Jan 17 15:13:55 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 15:13:56 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <41EC4209.6000905@comcast.net>
Message-ID: <Pine.LNX.4.44.0501171508260.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Christopher Schultz wrote:

> I think that's a flawed comparison. Destructors are in C++ what finalizers
> are in Java.  A "finally" block is different.

	Yes, but I can use destructors in C++ to implement "finally"
	blocks.

		class bool_flag {
		public:
		   bool_flag( bool &b ) : m_b( b ) {
		       m_b = true;
		   }
		   ~bool_flag() {
		       m_b = false;
		   }
		private:
		   bool &m_b;
		};

		bool my_flag;

		void f() {
		    bool_flag( my_flag );
		    // ...
		}

	No matter how f() exits, the "finally" of setting my_flag to
	false will always be done.  Hence, destructors can be used to
	implement "finally" (that's why C++ doesn't need "finally"
	explicitly) but Java having "finally" can't get you
	destructors.

	- Paul

From parrt at cs.usfca.edu  Mon Jan 17 15:23:29 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 15:17:12 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501171508260.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501171508260.17600-100000@g4.pauljlucas.org>
Message-ID: <CBBA52F1-68DE-11D9-8292-000A95891192@cs.usfca.edu>


On Jan 17, 2005, at 3:13 PM, Paul J. Lucas wrote:

> On Mon, 17 Jan 2005, Christopher Schultz wrote:
>
>> I think that's a flawed comparison. Destructors are in C++ what 
>> finalizers
>> are in Java.  A "finally" block is different.
>
> 	Yes, but I can use destructors in C++ to implement "finally"
> 	blocks.
>
> 		class bool_flag {
> 		public:
> 		   bool_flag( bool &b ) : m_b( b ) {
> 		       m_b = true;
> 		   }
> 		   ~bool_flag() {
> 		       m_b = false;
> 		   }
> 		private:
> 		   bool &m_b;
> 		};
>
> 		bool my_flag;
>
> 		void f() {
> 		    bool_flag( my_flag );
> 		    // ...
> 		}
>
> 	No matter how f() exits, the "finally" of setting my_flag to
> 	false will always be done.  Hence, destructors can be used to
> 	implement "finally" (that's why C++ doesn't need "finally"
> 	explicitly) but Java having "finally" can't get you
> 	destructors.

Interesting...was wondering how to do that in C++.  I wonder if it's 
general though.  A finally clause can play with all sorts of local 
variables and call methods etc...  I wonder if you'd need a whole bunch 
of these classes.  I guess so.  Would ANTLR need to analyze C++ actions 
(shudder) in order to construct the bool_flag(arglist) thing?  
Probably.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From pauljlucas at mac.com  Mon Jan 17 15:37:53 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 15:37:54 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <CBBA52F1-68DE-11D9-8292-000A95891192@cs.usfca.edu>
Message-ID: <Pine.LNX.4.44.0501171531420.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Terence Parr wrote:

> Interesting...was wondering how to do that in C++.  I wonder if it's 
> general though.

	It's trivial to make a templated "flag" class that takes any
	type T.

> A finally clause can play with all sorts of local variables and call methods
> etc...

	I don't have Bjarne's book in front of me, but he talks about
	the general concept is about resource aquisition and release
	(which is mostly what "finally" in Java is used for, e.g., open
	a file, make sure it's closed, etc.).

	In practice, "finally" code generally only needs to reset a
	small number of things, so it's not as bad as you might think.

> Would ANTLR need to analyze C++ actions (shudder) in order to construct the
> bool_flag(arglist) thing?  Probably.

	In ANTLR for C++, you don't need "finally" at all because if
	the user wants the functionality, s/he can simply do what I
	did, i.e., create a variable having a destructor.

	The only reason I want "finally" in ANTLR is because I'm using
	Java (only because I'm paid to) and Java needs "finally".

	But this implies that ANTLR for Java and ANTLR for C++ would be
	different.

	- Paul

From ewbank at gmail.com  Mon Jan 17 16:02:19 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Mon Jan 17 16:02:22 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501171531420.17600-100000@g4.pauljlucas.org>
References: <CBBA52F1-68DE-11D9-8292-000A95891192@cs.usfca.edu>
	<Pine.LNX.4.44.0501171531420.17600-100000@g4.pauljlucas.org>
Message-ID: <dd3a065f05011716022716bf21@mail.gmail.com>

Another solution is to use functions - and that deals with the problem
of "return" in an action as well.

action() { ... the true production ... }
action_exception() { switch (action()) { ... exceptions ... } }
action_finally() { action_exception(); ... finally ... }

Nothing fancy - just do it.
From pauljlucas at mac.com  Mon Jan 17 20:07:27 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 20:07:30 2005
Subject: Speaking of "return" (Was: [antlr-interest] "finally" blocks)
In-Reply-To: <dd3a065f05011716022716bf21@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0501172006290.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Bryan Ewbank wrote:

> Another solution is to use functions - and that deals with the problem
> of "return" in an action as well.

	Is one "allowed" to have "return" inside ANTLR productions?

	- Paul

From pauljlucas at mac.com  Mon Jan 17 20:09:36 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 20:09:39 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <dd3a065f05011716022716bf21@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0501172008500.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Bryan Ewbank wrote:

> Another solution is to use functions - and that deals with the problem
> of "return" in an action as well.
> 
> action() { ... the true production ... }
> action_exception() { switch (action()) { ... exceptions ... } }
> action_finally() { action_exception(); ... finally ... }

	OK, maybe I'm being dense, but I don't get it.

	- Paul

From pauljlucas at mac.com  Mon Jan 17 21:08:22 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 21:08:23 2005
Subject: [antlr-interest] Newlines (yet again)
Message-ID: <Pine.LNX.4.44.0501172106110.17600-100000@g4.pauljlucas.org>

	A while ago, I mentioned that I do:

		('\r')? '\n' { newline(); }

	to match newlines.  It seems to be the case that explicitly
	testing for the '\r' is unnecessary: if a '\n' is required, who
	cares what the character immediately before it is?  So this can
	simply be:

		'\n' { newline(); }

	and it will work on both *nix and Windows, right?

	- Paul

From alan-antlr-interest at engrm.com  Mon Jan 17 21:49:29 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Mon Jan 17 21:49:34 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501171531420.17600-100000@g4.pauljlucas.org>
References: <CBBA52F1-68DE-11D9-8292-000A95891192@cs.usfca.edu>
	<Pine.LNX.4.44.0501171531420.17600-100000@g4.pauljlucas.org>
Message-ID: <20050118054929.GA22175@maribor.izzy.net>

* Paul J. Lucas <pauljlucas@mac.com> [2005-01-17 18:38]:
> On Mon, 17 Jan 2005, Terence Parr wrote:
> 
> > Interesting...was wondering how to do that in C++.  I wonder if it's 
> > general though.
> 
> 	It's trivial to make a templated "flag" class that takes any
> 	type T.
> 
> > A finally clause can play with all sorts of local variables and call methods
> > etc...
> 
> 	I don't have Bjarne's book in front of me, but he talks about
> 	the general concept is about resource aquisition and release
> 	(which is mostly what "finally" in Java is used for, e.g., open
> 	a file, make sure it's closed, etc.).

    RAII. Resource Allocation is Initialization. Modern C++ relies
    heavily on the use of destructors to restore state when the
    stack is unwound. The question as to whether it is general, I'm
    not sure I understand. If you're wondering whether it is a
    generally accepted practice in C++, the answer is yes.

> 	In practice, "finally" code generally only needs to reset a
> 	small number of things, so it's not as bad as you might think.
> 
> > Would ANTLR need to analyze C++ actions (shudder) in order to construct the
> > bool_flag(arglist) thing?  Probably.

    No. It simply falls out of proper C++ use.

    int foo()
    {
        std::vector<int> nums(10);      // Create a vector of nums
                                        // possibly allocating heap
                                        // memory.

        do_something_that_might_throw(nums); 

        // ~std::vector<int>() frees the memory no matter what.
    }


> 	In ANTLR for C++, you don't need "finally" at all because if
> 	the user wants the functionality, s/he can simply do what I
> 	did, i.e., create a variable having a destructor.

    And a decent C++ type is built around RAII and a destrcutor that
    does the right thing.

> 	The only reason I want "finally" in ANTLR is because I'm using
> 	Java (only because I'm paid to) and Java needs "finally".

> 	But this implies that ANTLR for Java and ANTLR for C++ would be
> 	different.

    You could still have that finally block for C++, no problem, but
    C++ programmers wouldn't find much use for it. Finally exists in
    C++, but the state of the art is such that it is not the best form.

    Finally strikes me as a universal concept in any langauge that
    has exceptions, Python, C++, Perl 5/6, Java, C# all have it.
    
    A C target is a challenge.

--
Alan Gutierrez - alan@engrm.com
From parrt at cs.usfca.edu  Mon Jan 17 21:58:03 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 21:58:08 2005
Subject: [antlr-interest] Newlines (yet again)
In-Reply-To: <Pine.LNX.4.44.0501172106110.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501172106110.17600-100000@g4.pauljlucas.org>
Message-ID: <EA69A627-6915-11D9-BA97-000393BB647E@cs.usfca.edu>

On Jan 17, 2005, at 9:08 PM, Paul J. Lucas wrote:
> 	cares what the character immediately before it is?  So this can
> 	simply be:
>
> 		'\n' { newline(); }
>
> 	and it will work on both *nix and Windows, right?

Should be ok.  I've started doing that. ;)  Only thing it worked work 
on is pre OS X macs, but I don't care about that ;)

Ter



From parrt at cs.usfca.edu  Mon Jan 17 21:58:39 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 17 21:58:42 2005
Subject: Speaking of "return" (Was: [antlr-interest] "finally" blocks)
In-Reply-To: <Pine.LNX.4.44.0501172006290.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501172006290.17600-100000@g4.pauljlucas.org>
Message-ID: <00284BB1-6916-11D9-BA97-000393BB647E@cs.usfca.edu>

On Jan 17, 2005, at 8:07 PM, Paul J. Lucas wrote:
> On Mon, 17 Jan 2005, Bryan Ewbank wrote:
>
>> Another solution is to use functions - and that deals with the problem
>> of "return" in an action as well.
>
> 	Is one "allowed" to have "return" inside ANTLR productions?

No, but error handling could be implemented that way. :)

Ter



From pauljlucas at mac.com  Mon Jan 17 22:13:41 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 22:13:43 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <20050118054929.GA22175@maribor.izzy.net>
Message-ID: <Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, Alan Gutierrez wrote:

> Paul J Lucas wrote:
> > 	I don't have Bjarne's book in front of me, but he talks about
> > 	the general concept is about resource aquisition and release
> > 	(which is mostly what "finally" in Java is used for, e.g., open
> > 	a file, make sure it's closed, etc.).
> 
>     RAII. Resource Allocation is Initialization. Modern C++ relies heavily on
>     the use of destructors to restore state when the stack is unwound.

	Yes, I know.

>     The question as to whether it is general, I'm not sure I understand. If
>     you're wondering whether it is a generally accepted practice in C++, the
>     answer is yes.

	I wasn't asking.  I think you're misquoting.  Terence was the
	one who was asking.

> > 	In ANTLR for C++, you don't need "finally" at all because if
> > 	the user wants the functionality, s/he can simply do what I
> > 	did, i.e., create a variable having a destructor.
> 
>     And a decent C++ type is built around RAII and a destrcutor that
>     does the right thing.

	Yes, I agree, but there's no such standard type wrappers for
	built-in types which is exactly what my example was for.

	The lone standard such wrapper is auto_ptr<T>.

>     You could still have that finally block for C++ ...

	How, exactly?  if I have:

		myRule
		{
		    bool flag = true;
		}
		    : SOME TOKEN
		        {
			    if ( disaster )
			       throw outta_here;
			}
		    ;
		    exception
		    finally {
		        flag = false;
		    }

	How is ANTLR going to "know" to do the right thing?  It would
	have to actually parse the C++ code looking for "throw" or
	"return" and copy the finally code like:

		myRule() {
		    bool flag = true;
		    // ...
		    if ( disaster ) {
		        flag = false;
			throw outta_here;
		    }
		    // ...
		    flag = false;
		}

>     Finally exists in C++ ...

	No it doesn't.

	- Paul

From pauljlucas at mac.com  Mon Jan 17 22:21:36 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 22:21:36 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>
Message-ID: <Pine.LNX.4.44.0501172220490.17600-100000@g4.pauljlucas.org>

On Mon, 17 Jan 2005, Paul J. Lucas wrote:

> On Tue, 18 Jan 2005, Alan Gutierrez wrote:

> >     Finally exists in C++ ...
> 
> 	No it doesn't.

	From the man himself:

		http://www.research.att.com/~bs/bs_faq2.html#finally

	- Paul

From alan-antlr-interest at engrm.com  Mon Jan 17 22:26:50 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Mon Jan 17 22:26:52 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>
References: <20050118054929.GA22175@maribor.izzy.net>
	<Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>
Message-ID: <20050118062650.GC22175@maribor.izzy.net>

* Paul J. Lucas <pauljlucas@mac.com> [2005-01-18 01:13]:
> On Tue, 18 Jan 2005, Alan Gutierrez wrote:
> 
> > Paul J Lucas wrote:

> > > 	I don't have Bjarne's book in front of me, but he talks about
> > > 	the general concept is about resource aquisition and release
> > > 	(which is mostly what "finally" in Java is used for, e.g., open
> > > 	a file, make sure it's closed, etc.).

> >     RAII. Resource Allocation is Initialization. Modern C++
> >     relies heavily on the use of destructors to restore state
> >     when the stack is unwound.

> 	Yes, I know.

> >     The question as to whether it is general, I'm not sure I
> >     understand. If you're wondering whether it is a generally
> >     accepted practice in C++, the answer is yes.

> 	I wasn't asking.  I think you're misquoting.  Terence was the
> 	one who was asking.

    Yes. I know. And if Terrence was asking if reliance of
    destructors is prevelent in C++, in leiu of finally, I'm saying,
    the answer is yes.

> > > 	In ANTLR for C++, you don't need "finally" at all because if
> > > 	the user wants the functionality, s/he can simply do what I
> > > 	did, i.e., create a variable having a destructor.

> >     And a decent C++ type is built around RAII and a destrcutor that
> >     does the right thing.

> 	Yes, I agree, but there's no such standard type wrappers for
> 	built-in types which is exactly what my example was for.

> 	The lone standard such wrapper is auto_ptr<T>.

    Boost has a number of such wrappers. I also consider the
    std::string, std::list, std::vector to be RAII wappers.

> >     You could still have that finally block for C++ ...
> 
> 	How, exactly?  if I have:

> >     Finally exists in C++ ...

> 	No it doesn't.

    My mistake. I'll go back to saying, for C++, forget about it.

--
Alan Gutierrez - alan@engrm.com

From pauljlucas at mac.com  Mon Jan 17 22:38:01 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Mon Jan 17 22:38:03 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <20050118062650.GC22175@maribor.izzy.net>
Message-ID: <Pine.LNX.4.44.0501172231240.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, Alan Gutierrez wrote:

> * Paul J. Lucas <pauljlucas@mac.com> [2005-01-18 01:13]:

> > 	I wasn't asking.  I think you're misquoting.  Terence was the
> > 	one who was asking.
> 
>     Yes. I know. And if Terrence was asking if reliance of
>     destructors is prevelent in C++, in leiu of finally, I'm saying,
>     the answer is yes.

	OK, if you knew, then you intentionally misquoted (for reasons
	that aren't clear).

> > 	The lone standard such wrapper is auto_ptr<T>.
> 
>     Boost has a number of such wrappers.

	I clearly said "standard": Boost isn't part of ISO C++.

>     I also consider the std::string, std::list, std::vector to be RAII
>     wappers.

	std::string is; std::list is, but only if T is an object that
	has a destructor.  If T is really MyObject*, then, although the
	list will be properly destroyed, all the MyObjects will be
	leaked.  Same with vector.

	In my own code, I've created variants of auto_ptr<T>, i.e.,
	various flavors of managed_ptr<T> that properly destroys the T
	object when the pointer to it gets destroyed.

	But I digress...

>     My mistake. I'll go back to saying, for C++, forget about it.

	And, IMHO, it's not such a bad thing.  A C++ programmer would
	never want to have a "finally" block in ANTLR anyway because a
	C++ programmer doesn't think about "finally" blocks at all
	since C++ doesn't have them.

	But a Java programmer wants/expects a "finally" block in ANTLR
	because Java has them.

	- Paul

From wiggjd at lsbu.ac.uk  Tue Jan 18 05:49:38 2005
From: wiggjd at lsbu.ac.uk (David Wigg)
Date: Tue Jan 18 05:44:16 2005
Subject: [antlr-interest] Newlines (yet again)
Message-ID: <41ED13F2.50801@lsbu.ac.uk>

With reference to this message,

Message: 5
Date: Mon, 17 Jan 2005 21:08:22 -0800 (PST)
From: "Paul J. Lucas" <pauljlucas@mac.com>
Subject: [antlr-interest] Newlines (yet again)
To: ANTLR Interest <antlr-interest@antlr.org>
Message-ID:
	<Pine.LNX.4.44.0501172106110.17600-100000@g4.pauljlucas.org>
Content-Type: TEXT/PLAIN; charset=US-ASCII

A while ago, I mentioned that I do:

		('\r')? '\n' { newline(); }

to match newlines.  It seems to be the case that explicitly
testing for the '\r' is unnecessary: if a '\n' is required, who
cares what the character immediately before it is?  So this can
simply be:

		'\n' { newline(); }

and it will work on both *nix and Windows, right?

	- Paul

I have the following comments to make;

Admittedly I have not seen any previous correspondence on this 
subject but I don't see how you can ignore the possibility of a 
'\r' appearing here.

In any case I don't think it will work on a Mac file, or has 
this been changed now?

I use the following following for C++ which I believe is simple 
  and comprehensive.

Whitespace	
    :	(	(' ' |'\t' | '\f')

		// handle newlines
	|	(	"\r\n"  // MS
		|	'\r'    // Mac
		|	'\n'    // Unix
		)	{newline();}

		// handle continuation lines
	|	(	"\\\r\n"  // MS
		|	"\\\r"    // Mac
		|	"\\\n"    // Unix
		)	{deferredNewline();}
	)	
	{_ttype = ANTLR_USE_NAMESPACE(antlr)Token::SKIP;}
	;

David.

From pauljlucas at mac.com  Tue Jan 18 10:45:52 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Tue Jan 18 10:45:57 2005
Subject: [antlr-interest] Newlines (yet again)
In-Reply-To: <41ED13F2.50801@lsbu.ac.uk>
Message-ID: <Pine.LNX.4.44.0501181043140.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, David Wigg wrote:

> Admittedly I have not seen any previous correspondence on this 
> subject but I don't see how you can ignore the possibility of a 
> '\r' appearing here.
> 
> In any case I don't think it will work on a Mac file, or has 
> this been changed now?

	MacOS is now Unix.  Only really old MacOS 9 files use '\r'.

> 		// handle newlines
> 	|	(	"\r\n"  // MS
> 		|	'\r'    // Mac
> 		|	'\n'    // Unix
> 		)	{newline();}

	You definitely do not need "\r\n" for Windows.  Since the '\n'
	is always present and required for a newline, why do you care
	whether a '\r' came before it?  Answer: you don't care what
	came before it.

	- Paul

From parrt at cs.usfca.edu  Tue Jan 18 10:58:27 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan 18 10:58:34 2005
Subject: [antlr-interest] Newlines (yet again)
In-Reply-To: <Pine.LNX.4.44.0501181043140.17600-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501181043140.17600-100000@g4.pauljlucas.org>
Message-ID: <EFF1F54F-6982-11D9-BA97-000393BB647E@cs.usfca.edu>


On Jan 18, 2005, at 10:45 AM, Paul J. Lucas wrote:
> 	You definitely do not need "\r\n" for Windows.  Since the '\n'
> 	is always present and required for a newline, why do you care
> 	whether a '\r' came before it?  Answer: you don't care what
> 	came before it.

You still have to consume it.  The implicit assumption here is that 
some other construct matches it.  For example, the (..)* loop in a 
single-line // comment.  So, on the end you can just look for '\n'. :)

Ter



From pauljlucas at mac.com  Tue Jan 18 11:21:19 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Tue Jan 18 11:21:21 2005
Subject: [antlr-interest] Newlines (yet again)
In-Reply-To: <EFF1F54F-6982-11D9-BA97-000393BB647E@cs.usfca.edu>
Message-ID: <Pine.LNX.4.44.0501181118340.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, Terence Parr wrote:

> On Jan 18, 2005, at 10:45 AM, Paul J. Lucas wrote:
> > 	You definitely do not need "\r\n" for Windows.  Since the '\n'
> > 	is always present and required for a newline, why do you care
> > 	whether a '\r' came before it?  Answer: you don't care what
> > 	came before it.
> 
> You still have to consume it.  The implicit assumption here is that some
> other construct matches it.

	Yes, and typically it's the '.' in the very same rule as in:

		"//"
		    ( options { greedy = false; }
		    : '\n' { newline(); }
		    | '.'
		    )
		;

	So it's part of the comment just like the '\n' is.

	- Paul

From pauljlucas at mac.com  Tue Jan 18 11:23:18 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Tue Jan 18 11:23:23 2005
Subject: [antlr-interest] Re: Error messages in other (human) languages
In-Reply-To: <Pine.LNX.4.44.0501141020110.11155-100000@g4.pauljlucas.org>
Message-ID: <Pine.LNX.4.44.0501181122240.17600-100000@g4.pauljlucas.org>

	Speaking of other human languages, it would be nice if somehow
	the value for the "paraphrase" option could be multilingual.

	- Paul

From pauljlucas at mac.com  Tue Jan 18 11:24:11 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Tue Jan 18 11:24:12 2005
Subject: [antlr-interest] Newlines (yet again)
In-Reply-To: <Pine.LNX.4.44.0501181118340.17600-100000@g4.pauljlucas.org>
Message-ID: <Pine.LNX.4.44.0501181123420.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, Paul J. Lucas wrote:

> 	Yes, and typically it's the '.' in the very same rule as in:
> 
> 		"//"
> 		    ( options { greedy = false; }
> 		    : '\n' { newline(); }
> 		    | '.'
> 		    )
> 		;

	I forgot the '*' as in:

		    )*

	- Paul

From philip.dye at cs.cmu.edu  Tue Jan 18 13:05:34 2005
From: philip.dye at cs.cmu.edu (Philip Dye)
Date: Tue Jan 18 13:06:01 2005
Subject: [antlr-interest] Oracle 7 Sql Grammar - any actual working
	configurations ?
Message-ID: <1106082334.7883.312.camel@cozette.fac.cs.cmu.edu>

I would be very interested in hearing about any working configurations of antlr that will build the Oracle 7 SQL Grammar.

I am trying to build the Oracle 7 SQL parser (http://www.antlr.org/grammar/ORACLE-7-SQL) but have had no success.

Using:

  java antlr.Tool sql.g

with either version 2.7.2 or 2.7.4 of the antlr.jar file results in a long list of grammar errors.

All relevant files may be found at:

  http://www.cs.cmu.edu/~phdye/antlr/o7-grammar

In particular, the antlr.Tool output is:

  http://www.cs.cmu.edu/~phdye/antlr/o7-grammar/o7-grammar-errors.log

I am running OS Redhat 9 on a Dell Optiplex GX 270 with java sdk 1.5.0_01.

Thank you in advance,

Philip Dye
Senior Oracle Developer
School of Computer Science
Carnegie Mellon University
philip.dye@cs.cmu.edu


From mail at martin-probst.com  Tue Jan 18 13:29:03 2005
From: mail at martin-probst.com (Martin Probst)
Date: Tue Jan 18 13:29:19 2005
Subject: [antlr-interest] how to define these characters(java)
In-Reply-To: <008601c4fccf$da50e160$18001fac@nancyzhang>
References: <008601c4fccf$da50e160$18001fac@nancyzhang>
Message-ID: <1106083743.2062.7.camel@narr.homeip.net>

Hi,

Am Montag, den 17.01.2005, 15:04 -0500 schrieb Nan Zhang:

> class L extends Lexer;
> PLUS : '+' ;
> NEWLINE : '\r''\n'|'\n' ;
> NON : ~('+'|'\r''\n'|'\n') {$setType(Token.SKIP); }//and other actions
>  ;
> ------------
> but I got an error message: This subrule cannot be inverted. Only
> subrules of the form:
>     (T1|T2|T3...) or
>     ('c1'|'c2'|'c3'...)
> may be inverted (ranges are also allowed).
> Exiting due to errors.

The simple solution is to write:
NON : ~ ( '+' | '\r' | '\n' ) { $set... }

You can't invert groups whose single elements are more than one
character (this is a limitation of the underlying ANTLR algorithm). With
k=1 in the Lexer you will get ambiguities because the \r may either be
matcher by NEWLINE or by NON - remove the \r from the NEWLINE statement
or increase k to 2 to fix that.

Regards,
Martin

From Peter.Robinson at t-online.de  Tue Jan 18 14:11:06 2005
From: Peter.Robinson at t-online.de (Peter Robinson)
Date: Tue Jan 18 14:10:43 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <1106083743.2062.7.camel@narr.homeip.net>
References: <008601c4fccf$da50e160$18001fac@nancyzhang>
	<1106083743.2062.7.camel@narr.homeip.net>
Message-ID: <1106086266.4990.11.camel@localhost.localdomain>

Hi,

I recently stumbled upon antlr -- it seems so much easier to use
productively than lex/yacc that I have been trying to learn it, even
though Java is not my "first" language. I hope these questions are not
to obvious, but I have been frutilessly googling for a few hours, so
please forgive...

1) The file type I am trying to parse has thousands of individual
records, each of which contain multiple specifications such as
status xx
where xx can be one of 2-30 keywords. I have a rule that contains the
following.

	STATUS_KW 
		s:status_type {
		  myJavaObject.setStatus(Integer.parseInt(s.getText())); }

;

status_type returns [ int x ]:  ( LIVE_KW { x = LIVE_KW; } |
	                         SECONDARY_KW { x = SECONDARY_KW; } |
				DISCONTINUED_KW { x = DISCONTINUED_KW; }|
				NEWENTRY_KW {  x = NEWENTRY_KW; } )
;

==>> However, I keep getting error messages when transforming the .g
file that "s" cannot be identified. What am I doing wrong?

2) The grammar file generates a java interface with int constants for
tokens. Assuming I have some java class files in subdirectories and want
them to know about these constants, how does one do that (just class foo
implements bar doesnt work).
==>> WHat is the best way to get other Java classes to use these tokens?

Thanks!,
Peter
:-}

-- 
Peter N. Robinson
peter.robinson@t-online.de
peter.robinson@charite.de
http://www.charite.de/ch/medgen/robinson/

From monty at codetransform.com  Tue Jan 18 11:15:46 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Tue Jan 18 14:16:02 2005
Subject: [antlr-interest] Oracle 7 Sql Grammar - any actual
	working	configurations ?
In-Reply-To: <1106082334.7883.312.camel@cozette.fac.cs.cmu.edu>
References: <1106082334.7883.312.camel@cozette.fac.cs.cmu.edu>
Message-ID: <41ED6062.5090904@codetransform.com>

Philip Dye wrote:
> I would be very interested in hearing about any working configurations of antlr that will build the Oracle 7 SQL Grammar.
> 
> I am trying to build the Oracle 7 SQL parser (http://www.antlr.org/grammar/ORACLE-7-SQL) but have had no success.
> 
> Using:
> 
>   java antlr.Tool sql.g
> 
> with either version 2.7.2 or 2.7.4 of the antlr.jar file results in a long list of grammar errors.
> 
> All relevant files may be found at:
> 
>   http://www.cs.cmu.edu/~phdye/antlr/o7-grammar
> 
> In particular, the antlr.Tool output is:
> 
>   http://www.cs.cmu.edu/~phdye/antlr/o7-grammar/o7-grammar-errors.log
> 

I didn't see any errors at that link, only warnings.  Did it generate 
the .java files?  If so, you are set.

It is typical for grammars to have nondeterminisms that can't be 
resolved.  Especially ugly grammars like SQL.

Monty

ANTLR & Java Consultant
http://www.codetransform.com
From pauljlucas at mac.com  Tue Jan 18 14:19:17 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Tue Jan 18 14:19:20 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <1106086266.4990.11.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.44.0501181416230.17600-100000@g4.pauljlucas.org>

On Tue, 18 Jan 2005, Peter Robinson wrote:

> status_type returns [ int x ]:  ( LIVE_KW { x = LIVE_KW; } |
> 	                         SECONDARY_KW { x = SECONDARY_KW; } |
> 				DISCONTINUED_KW { x = DISCONTINUED_KW; }|
> 				NEWENTRY_KW {  x = NEWENTRY_KW; } )
> ;

	That's much easier to do if you simply do:

		status_type returns [ int x ]
		{
		    x = LA(1);
		}
		    : LIVE_KW | SECONDARY_KW | ...
		    ;

> ==>> However, I keep getting error messages when transforming the .g
> file that "s" cannot be identified. What am I doing wrong?

	You can just do getText() without the 's' also I believe.

> 2) The grammar file generates a java interface with int constants for
> tokens. Assuming I have some java class files in subdirectories and want
> them to know about these constants, how does one do that (just class foo
> implements bar doesnt work).

	Uhm.... it should work.

	- Paul

From nbsherid at secsme.org.au  Tue Jan 18 14:32:52 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Tue Jan 18 14:33:01 2005
Subject: [antlr-interest] Oracle 7 Sql Grammar - any actual
	workingconfigurations ?
In-Reply-To: <1106082334.7883.312.camel@cozette.fac.cs.cmu.edu>
Message-ID: <000801c4fdad$a5e3dd40$a428198a@nigelnote>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Philip Dye
> Sent: Wednesday, 19 January 2005 8:06 AM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] Oracle 7 Sql Grammar - any actual
> workingconfigurations ?
> 
> with either version 2.7.2 or 2.7.4 of the antlr.jar file results in a long
> list of grammar errors.
> 

Hi Phillip,

Non-determinisms are just warnings - the parser/lexer that is generated will
be greedy and consume input in one particular way when it has a number of
alternatives to choose between.

For example, if my tokens are "IDENT NUMBER NUMBER" and I have to choose
between the rules (with, "k", the lookahead equal to 1 or 2):

options: option1 | option2;
protected option1: IDENT NUMBER IDENT;
protected option2: IDENT NUMBER NUMBER;


Then the parser will not be able to work out what alternative to choose. In
this case, I think it more or less assumes that the first option is the way
to go and tries that alternative.

Whilst non-determinisms are not ideal, it least try out the generated
parser/lexer with some test input and see if it does what you expect. In
most cases, it will only be obscure input that trips the problem. When you
are more familiar with ANTLR and the grammar, a lot of these
non-determinisms can be weeded out with syntactic (or semantic) predicates.

Cheers

Nigel



--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435


From nbsherid at secsme.org.au  Tue Jan 18 14:38:04 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Tue Jan 18 14:38:10 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <1106086266.4990.11.camel@localhost.localdomain>
Message-ID: <000901c4fdae$5fbfaaf0$a428198a@nigelnote>

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Peter Robinson
> Sent: Wednesday, 19 January 2005 9:11 AM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] Using token values in other java classes
> (newbie)
> 
> Hi,
> 
> I recently stumbled upon antlr -- it seems so much easier to use
> productively than lex/yacc that I have been trying to learn it, even
> though Java is not my "first" language. I hope these questions are not
> to obvious, but I have been frutilessly googling for a few hours, so
> please forgive...
> 
> 1) The file type I am trying to parse has thousands of individual
> records, each of which contain multiple specifications such as
> status xx
> where xx can be one of 2-30 keywords. I have a rule that contains the
> following.
> 
> 	STATUS_KW
> 		s:status_type {
> 		  myJavaObject.setStatus(Integer.parseInt(s.getText())); }
> 
> ;
> 

s=status_type is needed for return values... also, you won't need
s.getText() or Integer.parseInt() as the return value is an integer, not a
token. So just "myJavaObject.setStatus (s);" will work just fine :D


> status_type returns [ int x ]:  ( LIVE_KW { x = LIVE_KW; } |
> 	                         SECONDARY_KW { x = SECONDARY_KW; } |
> 				DISCONTINUED_KW { x = DISCONTINUED_KW; }|
> 				NEWENTRY_KW {  x = NEWENTRY_KW; } )
> ;
> 
> ==>> However, I keep getting error messages when transforming the .g
> file that "s" cannot be identified. What am I doing wrong?
> 
> 2) The grammar file generates a java interface with int constants for
> tokens. Assuming I have some java class files in subdirectories and want
> them to know about these constants, how does one do that (just class foo
> implements bar doesnt work).
> ==>> WHat is the best way to get other Java classes to use these tokens?
> 

Ummm... I think referencing them as ClassName.Identifier should work just
fine... so just refer to them as "MyTokenTypes.IDENT" from other classes.

Nigel


--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435 


From nbsherid at secsme.org.au  Tue Jan 18 17:06:52 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Tue Jan 18 17:06:59 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <000901c4fdae$5fbfaaf0$a428198a@nigelnote>
Message-ID: <000401c4fdc3$2950d5b0$a428198a@nigelnote>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Nigel Sheridan-Smith
> Sent: Wednesday, 19 January 2005 9:38 AM
> To: 'Peter Robinson'; antlr-interest@antlr.org
> Subject: RE: [antlr-interest] Using token values in other java classes
> (newbie)
> 
> > -----Original Message-----
> > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > bounces@antlr.org] On Behalf Of Peter Robinson
> > Sent: Wednesday, 19 January 2005 9:11 AM
> > To: antlr-interest@antlr.org
> > Subject: [antlr-interest] Using token values in other java classes
> > (newbie)
> >
> >
> > 	STATUS_KW
> > 		s:status_type {
> > 		  myJavaObject.setStatus(Integer.parseInt(s.getText())); }
> >

Oh yeah! One other thing, you need to declare s (for saving return values):

	STATUS_KW
					{int s=0;}
		: s=status_type 	{myJavaObject.setStatus(s);};

Nigel



--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435

From Peter.Robinson at t-online.de  Tue Jan 18 22:49:27 2005
From: Peter.Robinson at t-online.de (Peter Robinson)
Date: Tue Jan 18 22:48:55 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <000401c4fdc3$2950d5b0$a428198a@nigelnote>
References: <000401c4fdc3$2950d5b0$a428198a@nigelnote>
Message-ID: <1106117367.3238.6.camel@localhost.localdomain>

Thanks to Nigel and Paul for the prompt and useful answers. Now it
works. To summarize the correct solution:

myrule {int tt;}: tt=status_type { myJavaObject.setStatus(tt); }
	;

status_type returns [ int x = LIVE_KW /* the default */ ]
		{
                    x = LA(1);
                }:
  ( LIVE_KW  |  SECONDARY_KW  | DISCONTINUED_KW  |  NEWENTRY_KW  )
;

-peter

On Wed, 2005-01-19 at 02:06, Nigel Sheridan-Smith wrote:
> > -----Original Message-----
> > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > bounces@antlr.org] On Behalf Of Nigel Sheridan-Smith
> > Sent: Wednesday, 19 January 2005 9:38 AM
> > To: 'Peter Robinson'; antlr-interest@antlr.org
> > Subject: RE: [antlr-interest] Using token values in other java classes
> > (newbie)
> > 
> > > -----Original Message-----
> > > From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> > > bounces@antlr.org] On Behalf Of Peter Robinson
> > > Sent: Wednesday, 19 January 2005 9:11 AM
> > > To: antlr-interest@antlr.org
> > > Subject: [antlr-interest] Using token values in other java classes
> > > (newbie)
> > >
> > >
> > > 	STATUS_KW
> > > 		s:status_type {
> > > 		  myJavaObject.setStatus(Integer.parseInt(s.getText())); }
> > >
> 
> Oh yeah! One other thing, you need to declare s (for saving return values):
> 
> 	STATUS_KW
> 					{int s=0;}
> 		: s=status_type 	{myJavaObject.setStatus(s);};
> 
> Nigel
> 
> 
> 
> --
> Nigel Sheridan-Smith
> PhD research student
> 
> Faculty of Engineering
> University of Technology, Sydney
> Phone: 02 9514 7946
> Fax: 02 9514 2435
-- 
Peter N. Robinson
peter.robinson@t-online.de
peter.robinson@charite.de
http://www.charite.de/ch/medgen/robinson/

From alan-antlr-interest at engrm.com  Wed Jan 19 00:05:10 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Wed Jan 19 00:05:15 2005
Subject: [antlr-interest] DFA and XML
Message-ID: <20050119080510.GA28227@maribor.izzy.net>

    I was wondering where I could read more on the pattern matching
    in version 3.0 of ANTLR. I'm interested in developing a pattern
    matching langauge that operated against SAX. Could ANTLR code be
    so targeted?

--
Alan Gutierrez - alan@engrm.com
From alan at engrm.com  Mon Jan 17 22:25:16 2005
From: alan at engrm.com (Alan Gutierrez)
Date: Wed Jan 19 10:41:50 2005
Subject: [antlr-interest] "finally" blocks
In-Reply-To: <Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>
References: <20050118054929.GA22175@maribor.izzy.net>
	<Pine.LNX.4.44.0501172158280.17600-100000@g4.pauljlucas.org>
Message-ID: <20050118062516.GB22175@maribor.izzy.net>

* Paul J. Lucas <pauljlucas@mac.com> [2005-01-18 01:13]:
> On Tue, 18 Jan 2005, Alan Gutierrez wrote:
> 
> > Paul J Lucas wrote:

> > > 	I don't have Bjarne's book in front of me, but he talks about
> > > 	the general concept is about resource aquisition and release
> > > 	(which is mostly what "finally" in Java is used for, e.g., open
> > > 	a file, make sure it's closed, etc.).

> >     RAII. Resource Allocation is Initialization. Modern C++
> >     relies heavily on the use of destructors to restore state
> >     when the stack is unwound.

> 	Yes, I know.

> >     The question as to whether it is general, I'm not sure I
> >     understand. If you're wondering whether it is a generally
> >     accepted practice in C++, the answer is yes.

> 	I wasn't asking.  I think you're misquoting.  Terence was the
> 	one who was asking.

    Yes. I know. And if Terrence was asking if reliance of
    destructors is prevelent in C++, in leiu of finally, I'm saying,
    the answer is yes.

> > > 	In ANTLR for C++, you don't need "finally" at all because if
> > > 	the user wants the functionality, s/he can simply do what I
> > > 	did, i.e., create a variable having a destructor.

> >     And a decent C++ type is built around RAII and a destrcutor that
> >     does the right thing.

> 	Yes, I agree, but there's no such standard type wrappers for
> 	built-in types which is exactly what my example was for.

> 	The lone standard such wrapper is auto_ptr<T>.

    Boost has a number of such wrappers. I also consider the
    std::string, std::list, std::vector to be RAII wappers.

> >     You could still have that finally block for C++ ...
> 
> 	How, exactly?  if I have:

> >     Finally exists in C++ ...

> 	No it doesn't.

    My mistake. I'll go back to saying, for C++, forget about it.

--
Alan Gutierrez - alan@engrm.com
From philip.dye at cs.cmu.edu  Mon Jan 17 14:17:30 2005
From: philip.dye at cs.cmu.edu (Philip Dye)
Date: Wed Jan 19 10:41:57 2005
Subject: [antlr-interest] Sql Grammar - any actual working configurations ?
Message-ID: <1106000250.7882.249.camel@cozette.fac.cs.cmu.edu>

I would be very interested in hearing about any working configurations
of antlr that will build the Oracle 7 SQL Grammar.

I am trying to build the Oracle 7 SQL parser
(http://www.antlr.org/grammar/ORACLE-7-SQL) but have had no success.

Using:

  java antlr.Tool sql.g

with either version 2.7.2 or 2.7.4 of the antlr.jar file results
in a long list of grammar errors.

All relevant files may be found at:

  http://www.cs.cmu.edu/~phdye/antlr/o7-grammar

In particular, the antlr.Tool output is:

  http://www.cs.cmu.edu/~phdye/antlr/o7-grammar/o7-grammar-errors.log

My OS Redhat 9, on a dell GX 270.

I am using java sdk 1.5.0_01.

Philip Dye
Senior Oracle Developer
School of Computer Science
Carnegie Mellon University
philip.dye@cs.cmu.edu


From pauljlucas at mac.com  Wed Jan 19 11:01:43 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Wed Jan 19 11:02:18 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <1106117367.3238.6.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.44.0501191101100.17600-100000@g4.pauljlucas.org>

On Wed, 19 Jan 2005, Peter Robinson wrote:

> status_type returns [ int x = LIVE_KW /* the default */ ]
> 		{
>                     x = LA(1);
>                 }:
>   ( LIVE_KW  |  SECONDARY_KW  | DISCONTINUED_KW  |  NEWENTRY_KW  )
> ;

	You don't need the default assigment: it's immediately
	reassigned.

	- Paul

From Jim.Annerton at msfc.nasa.gov  Wed Jan 19 11:00:55 2005
From: Jim.Annerton at msfc.nasa.gov (Annerton, Jim)
Date: Wed Jan 19 11:24:55 2005
Subject: [antlr-interest] Installing ANTLR 2.7.4
Message-ID: <8A4446DE224CEC408F6054D6F3834CE1797238@msecho4.msfc.nasa.gov>

I am trying to do a configure/make of ANTLR 2.7.4 on an Alphaserver running
Tru64 Unix 5.1. I am getting an error on the make that says "Make:
Makefile:   Must be a separator on line n.   Stop." where 'n' is a line
number in the Makefile. Does ANTLR require gmake?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050119/e14699f8/attachment.html
From hanasaki at hanaden.com  Wed Jan 19 12:13:55 2005
From: hanasaki at hanaden.com (hanasaki)
Date: Wed Jan 19 12:11:22 2005
Subject: [antlr-interest] expr for package dependencies
Message-ID: <41EEBF83.6080900@hanaden.com>

Been looking at the way package dependencies are shown and used.  An 
example from a Debian Linux system is shown below.

Parsing the expression isn't a big deal.  I am interested in how folks 
would represent what is parsed to determine the below.  This is more 
related to consuming the parsed info than actual parsing so please 
excuse it being semiOffTopic.

does one build a db/rdbms out of the Packages.gz (this file contains 
multiple text entries like the one shown below) that apt-get (the that 
interprets package info and determines what gets upgraded and / or 
conflicts) gets?

how are the "and/or" and version >=, > ... consumed, recursively? to 
determine requested packageA needs packageB and C and B needs D and 
maybe even D conflicts with A?

thanks.

=== example from debian ====
http://security.debian.org/dists/woody/updates/main/binary-i386/Packages.gz
===
Package: abiword-common
Priority: optional
Section: editors
Installed-Size: 2344
Maintainer: Masayuki Hatta <mhatta@debian.org>
Architecture: i386
Source: abiword
Version: 1.0.2+cvs.2002.06.05-1woody2
Replaces: abisuite, abiword-xml, abiword-expat, abiword (<< 0.99.2)
Depends: libc6 (>= 2.2.4-4), debconf, defoma (>= 0.10.2), gsfonts (>= 
6.0-2), libpspell-ispell1 | aspell-dictionary | aspell-en | aspell-da | 
aspell-de | aspell-es | aspell-fo | aspell-fr | aspell-no | aspell-pt, 
psfontmgr, xbase-clients
Recommends: abiword-gtk | abiword-gnome, abiword-doc, abiword-plugins, 
xfonts-abi, x-ttcidfont-conf
Suggests: xfs
Conflicts: abi-fonts, abisuite, abiword-xml, abiword-expat, abiword (<< 
0.99.2), abiword-doc (<< 1.0.2)
Filename: 
pool/updates/main/a/abiword/abiword-common_1.0.2+cvs.2002.06.05-1woody2_i386.deb
Size: 533908
MD5sum: f3d4e7035c0d0e9fcf6c53386f9305f6
Description: WYSIWYG word processor
  AbiWord is the first application of a complete, open source office
  suite. The upstream source includes cross-platform support for Win32,
  BeOS, and QNX as well as GTK+ on Unix.
  .
  AbiWord is still being developed. It's quite usable but not yet full-
  featured or polished. For many applications, however, it should prove
  effective and efficient.
  .
  This program includes support for reading Microsoft Word files,
  RTF files, and many other foreign file formats. Natively, it uses a
  custom XML-based file format.
From ric.klaren at gmail.com  Wed Jan 19 13:03:45 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Wed Jan 19 13:03:47 2005
Subject: [antlr-interest] Installing ANTLR 2.7.4
In-Reply-To: <8A4446DE224CEC408F6054D6F3834CE1797238@msecho4.msfc.nasa.gov>
References: <8A4446DE224CEC408F6054D6F3834CE1797238@msecho4.msfc.nasa.gov>
Message-ID: <bc607a4e050119130348d4af5b@mail.gmail.com>

On Wed, 19 Jan 2005 13:00:55 -0600, Annerton, Jim
<Jim.Annerton@msfc.nasa.gov> wrote:
>  
> I am trying to do a configure/make of ANTLR 2.7.4 on an Alphaserver running
> Tru64 Unix 5.1. I am getting an error on the make that says "Make:  
> Makefile:   Must be a separator on line n.   Stop." where 'n' is a line
> number in the Makefile. Does ANTLR require gmake? 

2.7.4's makefiles depend on gmake. For 2.7.5 the dependency is less
(cheers to Wolfgang for his efforts!) but not completely gone I think.

Cheers,

Ric
From Peter.Robinson at t-online.de  Wed Jan 19 13:52:01 2005
From: Peter.Robinson at t-online.de (Peter Robinson)
Date: Wed Jan 19 13:51:56 2005
Subject: [antlr-interest] strategy for parsing large repeated records
Message-ID: <1106171521.3667.14.camel@localhost.localdomain>

Dear List,

I am working on a parser to read in information from one of the NCBI
bioinformatics resources in ASN.1 format. These files contain up to
10,000s of individual records that each contain up to several kb of
information. Although I am still learning my way around ANTLR, I don't
think the actual parsing of these files will be difficult. I would like
to ask about ideas for the best strategy. My current plan

1) Call from a main method the method which corresponds to the rule for
individual records.
2) Each time this method is called, create a Java object which will
receive the parsed information.
3) Within each rule, call methods from the above object to put
information from the parse in
4) When the method returns to main, use something else to do something
with the information (print to file, enter to a database etc).

Does that sound reasonable? I have not been able to find any comparable
projects on the antlr website or by google. Sorry if the above is either
obvious or ridiculous, I am still new to this game...
-Peter
-- 
Peter N. Robinson
peter.robinson@t-online.de
peter.robinson@charite.de
http://www.charite.de/ch/medgen/robinson/

From ewbank at gmail.com  Wed Jan 19 14:04:04 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Wed Jan 19 14:04:06 2005
Subject: [antlr-interest] Using token values in other java classes (newbie)
In-Reply-To: <1106117367.3238.6.camel@localhost.localdomain>
References: <000401c4fdc3$2950d5b0$a428198a@nigelnote>
	<1106117367.3238.6.camel@localhost.localdomain>
Message-ID: <dd3a065f05011914042911eb80@mail.gmail.com>

Isn't this better written to simply use the normal returned state
information?  For example:

myrule:
   status_type { myJavaObject.setStatus(#status_type.getType()); }
   ;

status_type:
   LIVE_KW  |  SECONDARY_KW  | DISCONTINUED_KW  |  NEWENTRY_KW
   ;

> Thanks to Nigel and Paul for the prompt and useful answers. Now it
> works. To summarize the correct solution:
> 
> myrule {int tt;}: tt=status_type { myJavaObject.setStatus(tt); }
>         ;
> 
> status_type returns [ int x = LIVE_KW /* the default */ ]
>                 {
>                     x = LA(1);
>                 }:
>   ( LIVE_KW  |  SECONDARY_KW  | DISCONTINUED_KW  |  NEWENTRY_KW  )
> ;
From mail at martin-probst.com  Thu Jan 20 00:48:58 2005
From: mail at martin-probst.com (Martin Probst)
Date: Thu Jan 20 00:49:12 2005
Subject: [antlr-interest] expr for package dependencies
In-Reply-To: <41EEBF83.6080900@hanaden.com>
References: <41EEBF83.6080900@hanaden.com>
Message-ID: <1106210938.11704.5.camel@narr.homeip.net>

Hi,
if you need a relational schema this depends largely on the degree of
normalization you want to reach. E.g. you could either split up
everything into specific tables which would result in quite an amount of
tables, more programming effort and more load on the dbms. If you opt
for less normalization you could just write some of the fields into
single varchar entries which would have to be parsed by the application.
To achieve the "or" relations you might need to invent some kind of
"meta-packages" (like spell-check engine) which can be provided by
several other packages. Gentoo does this via "virtual" packages, e.g.
both Xfree and X.org provide "virtual/X11" in Gentoo.
Anyway for resolving complete dependencies you would either write a
_really_ complex SQL query or just pull the logic "A needs B, B needs C
--> A needs C" into your application.

HTH,
Martin

Am Mittwoch, den 19.01.2005, 14:13 -0600 schrieb hanasaki:
> Been looking at the way package dependencies are shown and used.  An 
> example from a Debian Linux system is shown below.
> 
> Parsing the expression isn't a big deal.  I am interested in how folks 
> would represent what is parsed to determine the below.  This is more 
> related to consuming the parsed info than actual parsing so please 
> excuse it being semiOffTopic.
> 
> does one build a db/rdbms out of the Packages.gz (this file contains 
> multiple text entries like the one shown below) that apt-get (the that 
> interprets package info and determines what gets upgraded and / or 
> conflicts) gets?
> 
> how are the "and/or" and version >=, > ... consumed, recursively? to 
> determine requested packageA needs packageB and C and B needs D and 
> maybe even D conflicts with A?
> 
> thanks.
> 
> === example from debian ====
> http://security.debian.org/dists/woody/updates/main/binary-i386/Packages.gz
> ===
> Package: abiword-common
> Priority: optional
> Section: editors
> Installed-Size: 2344
> Maintainer: Masayuki Hatta <mhatta@debian.org>
> Architecture: i386
> Source: abiword
> Version: 1.0.2+cvs.2002.06.05-1woody2
> Replaces: abisuite, abiword-xml, abiword-expat, abiword (<< 0.99.2)
> Depends: libc6 (>= 2.2.4-4), debconf, defoma (>= 0.10.2), gsfonts (>= 
> 6.0-2), libpspell-ispell1 | aspell-dictionary | aspell-en | aspell-da | 
> aspell-de | aspell-es | aspell-fo | aspell-fr | aspell-no | aspell-pt, 
> psfontmgr, xbase-clients
> Recommends: abiword-gtk | abiword-gnome, abiword-doc, abiword-plugins, 
> xfonts-abi, x-ttcidfont-conf
> Suggests: xfs
> Conflicts: abi-fonts, abisuite, abiword-xml, abiword-expat, abiword (<< 
> 0.99.2), abiword-doc (<< 1.0.2)
> Filename: 
> pool/updates/main/a/abiword/abiword-common_1.0.2+cvs.2002.06.05-1woody2_i386.deb
> Size: 533908
> MD5sum: f3d4e7035c0d0e9fcf6c53386f9305f6
> Description: WYSIWYG word processor
>   AbiWord is the first application of a complete, open source office
>   suite. The upstream source includes cross-platform support for Win32,
>   BeOS, and QNX as well as GTK+ on Unix.
>   .
>   AbiWord is still being developed. It's quite usable but not yet full-
>   featured or polished. For many applications, however, it should prove
>   effective and efficient.
>   .
>   This program includes support for reading Microsoft Word files,
>   RTF files, and many other foreign file formats. Natively, it uses a
>   custom XML-based file format.
> 

From hanasaki at hanaden.com  Thu Jan 20 01:18:48 2005
From: hanasaki at hanaden.com (hanasaki)
Date: Thu Jan 20 01:16:05 2005
Subject: [antlr-interest] expr for package dependencies
In-Reply-To: <1106210938.11704.5.camel@narr.homeip.net>
References: <41EEBF83.6080900@hanaden.com>
	<1106210938.11704.5.camel@narr.homeip.net>
Message-ID: <41EF7778.7000603@hanaden.com>

any thoughts on topological sorting?  the concept seems to hold some 
promise but its a new topic for me.

Martin Probst wrote:
> Hi,
> if you need a relational schema this depends largely on the degree of
> normalization you want to reach. E.g. you could either split up
> everything into specific tables which would result in quite an amount of
> tables, more programming effort and more load on the dbms. If you opt
> for less normalization you could just write some of the fields into
> single varchar entries which would have to be parsed by the application.
> To achieve the "or" relations you might need to invent some kind of
> "meta-packages" (like spell-check engine) which can be provided by
> several other packages. Gentoo does this via "virtual" packages, e.g.
> both Xfree and X.org provide "virtual/X11" in Gentoo.
> Anyway for resolving complete dependencies you would either write a
> _really_ complex SQL query or just pull the logic "A needs B, B needs C
> --> A needs C" into your application.
> 
> HTH,
> Martin
> 
> Am Mittwoch, den 19.01.2005, 14:13 -0600 schrieb hanasaki:
> 
>>Been looking at the way package dependencies are shown and used.  An 
>>example from a Debian Linux system is shown below.
>>
>>Parsing the expression isn't a big deal.  I am interested in how folks 
>>would represent what is parsed to determine the below.  This is more 
>>related to consuming the parsed info than actual parsing so please 
>>excuse it being semiOffTopic.
>>
>>does one build a db/rdbms out of the Packages.gz (this file contains 
>>multiple text entries like the one shown below) that apt-get (the that 
>>interprets package info and determines what gets upgraded and / or 
>>conflicts) gets?
>>
>>how are the "and/or" and version >=, > ... consumed, recursively? to 
>>determine requested packageA needs packageB and C and B needs D and 
>>maybe even D conflicts with A?
>>
>>thanks.
>>
>>=== example from debian ====
>>http://security.debian.org/dists/woody/updates/main/binary-i386/Packages.gz
>>===
>>Package: abiword-common
>>Priority: optional
>>Section: editors
>>Installed-Size: 2344
>>Maintainer: Masayuki Hatta <mhatta@debian.org>
>>Architecture: i386
>>Source: abiword
>>Version: 1.0.2+cvs.2002.06.05-1woody2
>>Replaces: abisuite, abiword-xml, abiword-expat, abiword (<< 0.99.2)
>>Depends: libc6 (>= 2.2.4-4), debconf, defoma (>= 0.10.2), gsfonts (>= 
>>6.0-2), libpspell-ispell1 | aspell-dictionary | aspell-en | aspell-da | 
>>aspell-de | aspell-es | aspell-fo | aspell-fr | aspell-no | aspell-pt, 
>>psfontmgr, xbase-clients
>>Recommends: abiword-gtk | abiword-gnome, abiword-doc, abiword-plugins, 
>>xfonts-abi, x-ttcidfont-conf
>>Suggests: xfs
>>Conflicts: abi-fonts, abisuite, abiword-xml, abiword-expat, abiword (<< 
>>0.99.2), abiword-doc (<< 1.0.2)
>>Filename: 
>>pool/updates/main/a/abiword/abiword-common_1.0.2+cvs.2002.06.05-1woody2_i386.deb
>>Size: 533908
>>MD5sum: f3d4e7035c0d0e9fcf6c53386f9305f6
>>Description: WYSIWYG word processor
>>  AbiWord is the first application of a complete, open source office
>>  suite. The upstream source includes cross-platform support for Win32,
>>  BeOS, and QNX as well as GTK+ on Unix.
>>  .
>>  AbiWord is still being developed. It's quite usable but not yet full-
>>  featured or polished. For many applications, however, it should prove
>>  effective and efficient.
>>  .
>>  This program includes support for reading Microsoft Word files,
>>  RTF files, and many other foreign file formats. Natively, it uses a
>>  custom XML-based file format.
>>
> 
> 
From Anthony.Youngman at eca-international.com  Thu Jan 20 03:14:17 2005
From: Anthony.Youngman at eca-international.com (Anthony Youngman)
Date: Thu Jan 20 03:14:28 2005
Subject: [antlr-interest] expr for package dependencies
Message-ID: <C7FE35004D40FD45AA342991B88CE40409B104@lnml1.eca-international.local>

Look at post-relational. The obvious problem is that I don't know of a
fully-functional Free implementation. MaVerick is getting close, though
:-)

Basically, that gives you a normal-form database, but that would
probably drive relational purists nuts. Describing it in terms I don't
quite understand myself ...

Think of each "row" in a post-relational "table" as an object - bit like
a relational view, or actually probably more like a tree. It's been
normalised, so a mechanical transform enables you to present it to a
relational client. And you can relate fields across tables, although the
mechanism is very different from a SQL/relational join.

I've been thinking about this sort of thing, and was thinking that
trying to get MaVerick or some other post-relational engine into either
an LDAP server or gentoo portage would actually be an excellent
demonstration of its power ...

For your problem, once you've parsed all the dependencies into a
database, I would use a simple procedural routine to look for loops etc.

Cheers,
Wol

-----Original Message-----
From: antlr-interest-bounces@antlr.org
[mailto:antlr-interest-bounces@antlr.org] On Behalf Of Martin Probst
Sent: 20 January 2005 08:49
To: hanasaki
Cc: ANTLR Interest
Subject: Re: [antlr-interest] expr for package dependencies

Hi,
if you need a relational schema this depends largely on the degree of
normalization you want to reach. E.g. you could either split up
everything into specific tables which would result in quite an amount of
tables, more programming effort and more load on the dbms. If you opt
for less normalization you could just write some of the fields into
single varchar entries which would have to be parsed by the application.
To achieve the "or" relations you might need to invent some kind of
"meta-packages" (like spell-check engine) which can be provided by
several other packages. Gentoo does this via "virtual" packages, e.g.
both Xfree and X.org provide "virtual/X11" in Gentoo.
Anyway for resolving complete dependencies you would either write a
_really_ complex SQL query or just pull the logic "A needs B, B needs C
--> A needs C" into your application.

HTH,
Martin

Am Mittwoch, den 19.01.2005, 14:13 -0600 schrieb hanasaki:
> Been looking at the way package dependencies are shown and used.  An 
> example from a Debian Linux system is shown below.
> 
> Parsing the expression isn't a big deal.  I am interested in how folks

> would represent what is parsed to determine the below.  This is more 
> related to consuming the parsed info than actual parsing so please 
> excuse it being semiOffTopic.
> 
> does one build a db/rdbms out of the Packages.gz (this file contains 
> multiple text entries like the one shown below) that apt-get (the that

> interprets package info and determines what gets upgraded and / or 
> conflicts) gets?
> 
> how are the "and/or" and version >=, > ... consumed, recursively? to 
> determine requested packageA needs packageB and C and B needs D and 
> maybe even D conflicts with A?
> 
> thanks.
> 
> === example from debian ====
>
http://security.debian.org/dists/woody/updates/main/binary-i386/Packages
.gz
> ===
> Package: abiword-common
> Priority: optional
> Section: editors
> Installed-Size: 2344
> Maintainer: Masayuki Hatta <mhatta@debian.org>
> Architecture: i386
> Source: abiword
> Version: 1.0.2+cvs.2002.06.05-1woody2
> Replaces: abisuite, abiword-xml, abiword-expat, abiword (<< 0.99.2)
> Depends: libc6 (>= 2.2.4-4), debconf, defoma (>= 0.10.2), gsfonts (>= 
> 6.0-2), libpspell-ispell1 | aspell-dictionary | aspell-en | aspell-da
| 
> aspell-de | aspell-es | aspell-fo | aspell-fr | aspell-no | aspell-pt,

> psfontmgr, xbase-clients
> Recommends: abiword-gtk | abiword-gnome, abiword-doc, abiword-plugins,

> xfonts-abi, x-ttcidfont-conf
> Suggests: xfs
> Conflicts: abi-fonts, abisuite, abiword-xml, abiword-expat, abiword
(<< 
> 0.99.2), abiword-doc (<< 1.0.2)
> Filename: 
>
pool/updates/main/a/abiword/abiword-common_1.0.2+cvs.2002.06.05-1woody2_
i386.deb
> Size: 533908
> MD5sum: f3d4e7035c0d0e9fcf6c53386f9305f6
> Description: WYSIWYG word processor
>   AbiWord is the first application of a complete, open source office
>   suite. The upstream source includes cross-platform support for
Win32,
>   BeOS, and QNX as well as GTK+ on Unix.
>   .
>   AbiWord is still being developed. It's quite usable but not yet
full-
>   featured or polished. For many applications, however, it should
prove
>   effective and efficient.
>   .
>   This program includes support for reading Microsoft Word files,
>   RTF files, and many other foreign file formats. Natively, it uses a
>   custom XML-based file format.
> 



****************************************************************************

This transmission is intended for the named recipient only. It may contain private and confidential information. If this has come to you in error you must not act on anything disclosed in it, nor must you copy it, modify it, disseminate it in any way, or show it to anyone. Please e-mail the sender to inform us of the transmission error or telephone ECA International immediately and delete the e-mail from your information system.

Telephone numbers for ECA International offices are: Sydney +61 (0)2 8272 5300, Hong Kong + 852 2121 2388, London +44 (0)20 7351 5000 and New York +1 212 582 2333.

****************************************************************************

From ewbank at gmail.com  Thu Jan 20 06:15:42 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Thu Jan 20 06:15:48 2005
Subject: [antlr-interest] Node types, versus node classes
Message-ID: <dd3a065f050120061559b91abb@mail.gmail.com>

I'm working with tree parsers quite a bit, and have noticed that there
is quite a bit of repeated code when there are classes of related
operators.  For example, the six binary comparison operators (==, !=,
>=, <=, >, <) have very similar characteristics.

I'm considering folding these into a single BINARY_COMPARISON node
with different texts, but that requires the actions decode the
specific operator.

What is the "ANTLR way" (or "ways" :-) here?

   // one operator class, then decode operator in action
   bin_compare
     : #(BINARY_COMPARISON lhs:root rhs:root) { ... decode operator field ... }
     ;

   // distinct operators, possibly duplicate actions.
   bin_compare : eq | ne | ... ;
   eq: #(EQ lhs:root rhs:root) { ... code ... } ;
   ne: #(NE lhs:root rhs:root) { ... code ... } ;

   // another option, using syntactic predicates
   // here too I would need to decode the operator field in the action
   bin_compare : ( compare_op ) => #(.:op lhs:root rhs:root) { ... } ;
   compare_op : EQ | NE | GE | LE | GT | LT ;
From hanasaki at hanaden.com  Thu Jan 20 15:52:19 2005
From: hanasaki at hanaden.com (hanasaki)
Date: Thu Jan 20 15:49:29 2005
Subject: [antlr-interest] Any thoughts of using java.util.Scanner (jdk5.x)
	for tokenizing?
Message-ID: <41F04433.5080607@hanaden.com>

http://java.sun.com/developer/JDCTechTips/2004/tt1201.html#1

Any thoughts of using java.util.Scanner (jdk5.x) for tokenizing?

thanks
From christopher.d.schultz at comcast.net  Thu Jan 20 21:08:36 2005
From: christopher.d.schultz at comcast.net (Christopher Schultz)
Date: Thu Jan 20 21:06:42 2005
Subject: [antlr-interest] Any thoughts of using java.util.Scanner (jdk5.x)
	for tokenizing?
In-Reply-To: <41F04433.5080607@hanaden.com>
References: <41F04433.5080607@hanaden.com>
Message-ID: <41F08E54.3090907@comcast.net>

Hanasaki,

> http://java.sun.com/developer/JDCTechTips/2004/tt1201.html#1
> 
> Any thoughts of using java.util.Scanner (jdk5.x) for tokenizing?

One major problem with the new Scanner class is that it doesn't work 
well with hererogenius tokens. ANTLR's scanner (tokenizer), as well as 
the tokenizers shipped with many other compiler compilers, works very 
well recognizing tokens that are completely orthogonal.

You simply can't write an expression that returns tokens which sometimes 
look like "AN_IDENTIFIER" and sometimes look like "3.141592654288". 
Sure, you can split on whitespace, but that doesn't always work very well.

The approach given in this article for handling heterogenious tokens is 
to layer one Scanner on top of another. However, the base-level Scanner 
needs to generate very simple tokens, and then you have to layer 
successively smarter Scanners on top of it. I think that having a 
custom-generated tokenizer (a la ANTLR, lex/yacc, JavaCC, JLex/CUP, 
etc.) makes more sense than using a very generic Scanner class (which is 
essentially a regex used to split a String).

Probably a better reason not to use java.util.Scanner is breaking 
compatibility: ANTLR will require Java 1.5, whereas today it only 
requires Java 1.1.

-chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050121/91a3b6a3/signature.bin
From olczyk2002 at yahoo.com  Thu Jan 20 20:47:23 2005
From: olczyk2002 at yahoo.com (Thaddeus Olczyk)
Date: Thu Jan 20 22:28:51 2005
Subject: [antlr-interest] Writing a two pass compiler.
Message-ID: <20050121044723.36906.qmail@web30405.mail.mud.yahoo.com>

First, I sent this message via gmane.
It has been two hours since I sent it,
and it has not shown up here, so I assume
that it did not go through ( many groups
on gmane do that ). If it did but I did 
not see it yet, my appologies for sending
this message twice.
---
I have a grammar for a language which I discover is
written quite poorly. Certain types of strings can
have different meanings depending on context, so
I cannot unambiguously tokenise the strings.
Mainly this is do to the fact that there is
no way to distinguish text data from "source".

Having examined the language closely, I believe it
can be parsed using antlr to generate a two pass
compiler. Pass2 being a context sensitive parse.

A difficuly for me is that I've only written a few
very trivial parsers ( at the calcualtor level ). I
was wondering if there were any simple samples of
antlr being used to implement a two pass compiler to
guide 
me along the way.

Thank you
Thaddeus L. Olczyk

PS: Something going for me is that the language is
relatively simple. I suspect that most people parse
it using regular expressions, but I would like to have
a more genric solution.





		
__________________________________ 
Do you Yahoo!? 
Yahoo! Mail - Easier than ever with enhanced search. Learn more.
http://info.mail.yahoo.com/mail_250
From alan-antlr-interest at engrm.com  Fri Jan 21 09:06:28 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Fri Jan 21 09:06:33 2005
Subject: [antlr-interest] XML Character Classes
Message-ID: <20050121170628.GA12910@maribor.izzy.net>

    My first ANTLR grammar.

    Attempting to create a regular expression language to match SAX
    event streams. Starting by trying to define character classes as
    specified in the XML Spec.

    I'm getting these error messages:

    lexical nondeterminism between rules LETTER and BASE_CHAR upon
        k==1:'A'..'Z','a'..'z','\u00c0'..'\u00d6' ... and so on

    lexical nondeterminism between rules LETTER and IDEOGRAPHIC upon

    I found this article. Is there anything else I can read on this
        subject? Did I really mess something up?

    http://www.jguru.com/faq/view.jsp?EID=64316

    My grammar looks like:

    class XPatternParser extends Parser;
    options {
        k = 2;
    }

    pattern :  letter:LETTER
            {
                System.out.println("<" + letter.getText() + ">");
            }
            ;

    class XPatternLexer extends Lexer;

    LETTER
        : (BASE_CHAR | IDEOGRAPHIC)
        ;

    BASE_CHAR
        : 
        ( '\u0041'..'\u005A' | '\u0061'..'\u007A' | '\u00C0'..'\u00D6' 
        | '\u00D8'..'\u00F6' | '\u00F8'..'\u00FF' | '\u0100'..'\u0131'
        | '\u0134'..'\u013E' | '\u0141'..'\u0148' | '\u014A'..'\u017E'

            /* snip */

        | '\u30A1'..'\u30FA' | '\u3105'..'\u312C' | '\uAC00'..'\uD7A3'
        )
        ;

    IDEOGRAPHIC
      :
      ( '\u4E00'..'\u9FA5' | '\u3007' | '\u3021'..'\u3029'
      )
      ;

--
Alan Gutierrez - alan@engrm.com
From ewbank at gmail.com  Fri Jan 21 13:15:40 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Fri Jan 21 13:15:46 2005
Subject: [antlr-interest] C++ code - removing Reference?
Message-ID: <dd3a065f05012113156b31e19b@mail.gmail.com>

Has anyone explored removing the "Ref" portion of the base tree node
in the C++ code?  I ask because debugging is quite a bit more exciting
with all the tiny functions that do counting.

Thanks
- Bryan Ewbank
From madcapmaggie at yahoo.com  Fri Jan 21 18:58:25 2005
From: madcapmaggie at yahoo.com (Peggy Fieland)
Date: Fri Jan 21 18:58:27 2005
Subject: [antlr-interest] C++ code - removing Reference?
In-Reply-To: <dd3a065f05012113156b31e19b@mail.gmail.com>
Message-ID: <20050122025825.93746.qmail@web30201.mail.mud.yahoo.com>

No, but I find the "ref" stuff a major debugging
headache -- application is multithreaded and we were
stomping on some of the reference counters for a while
there.

Peggy
--- Bryan Ewbank <ewbank@gmail.com> wrote:

> Has anyone explored removing the "Ref" portion of
> the base tree node
> in the C++ code?  I ask because debugging is quite a
> bit more exciting
> with all the tiny functions that do counting.
> 
> Thanks
> - Bryan Ewbank
> 

From moviem at web.de  Sat Jan 22 03:57:09 2005
From: moviem at web.de (Tomasz Bluszcz)
Date: Sat Jan 22 03:57:07 2005
Subject: [antlr-interest] Parse simle list
In-Reply-To: <200501162350.j0GNoH319934@shell2.webquarry.com>
Message-ID: <GCENJBNDIDEDENFIGNENMEOBCAAA.moviem@web.de>

hi all,
sorry for my bad english first..

I'm a beginner in antlr and don't want do build a compiler...
I'm trying to parse a simle file and tranfere this to my own structures.
Programming language is C++.

Example file content:

"ELEMENT Name1
'{'
	"BOOL" bool1;
	"BOOL" bool11;
	...
'}'

"ELEMENT" Name2
'{'
	"BOOL" bool2;
	"BOOL" bool22;
	...
'}'
...

Because i get an stack overflow with the automatic generated flat ast on
leaving a method where the ast is used ("Refast t = parser.getAst();")
(filesize 15K, 1000 lines) I would like to generate a simple tree like:

ELEMENT - Name1 - BOOL - bool1 - bool11 - ...
   |
ELEMENT - Name2 - BOOL - bool2 - bool22 - ...
   |
ELEMENT - ...
   |
 .....  - ...

When i made the "ELEMENT"^ token to a root Token then i works fine (no stack
overflow) but my list is then a tree and i cannot walk the list down to
initialise my structures.

Here is the very simple parser grammar:

parse		:	(KW_ELEMENT LEGALNAME attribs)* ;
attribs	:	'{'! (CCBOOL LEGALNAME)* '}'!;

Can anybody point my an example or give my some hints?


What modification i have to do to get the tree structure described above?
Exist a c++ class to view the ast like the java class ASTviewer?
Have anyone a similar exsamle for me?

Many Thx, Tom.




From moviem at web.de  Sat Jan 22 04:28:16 2005
From: moviem at web.de (Tomasz Bluszcz)
Date: Sat Jan 22 04:28:14 2005
Subject: AW: [antlr-interest] Parse simle list - correction
In-Reply-To: <GCENJBNDIDEDENFIGNENMEOBCAAA.moviem@web.de>
Message-ID: <GCENJBNDIDEDENFIGNENIEOCCAAA.moviem@web.de>

The right format of the Tree:


ELEMENT - Name1 - BOOL - bool1 - BOOL - bool11 - ...
   |
ELEMENT - Name2 - BOOL - bool2 - BOOL - bool22 - ...
   |
ELEMENT - ...
   |
From anakreonmejdi at yahoo.gr  Sat Jan 22 04:47:06 2005
From: anakreonmejdi at yahoo.gr (Anakreon)
Date: Sat Jan 22 04:53:57 2005
Subject: [antlr-interest] Optional Tree path not followed
Message-ID: <41F24B4A.6040107@yahoo.gr>

Hello everyone.

I have a problem with a TreeParser rule.
The antlr code for the rule is:
sub_call
  :
<tsub> #(SUB_CALL sub_name:expression <sub_call>
            (argListValues)?
      <sub_call_end>)
;
where the tokens <name> is some action code.

and the argListValues definition is:
argListValues
  :
  !#(ARGLIST_VALUES <arg_val> (arg:expression <arg_val_end>)+)
  ;

The problem is that when a argListValues could be matched from the sub_call
rule, it isn't.

I checked the code produced when the sub_call defines the match of rule argListValues
as mandatory.

Here is the code:
			case SUB_CALL:
			{
				AST __t27 = _t;
				AST tmp18_AST = null;
				AST tmp18_AST_in = null;
				tmp18_AST = astFactory.create((AST)_t);
				tmp18_AST_in = (AST)_t;
				ASTPair __currentAST27 = currentAST.copy();
				currentAST.root = currentAST.child;
				currentAST.child = null;
				match(_t,SUB_CALL);
				_t = _t.getFirstChild();
				sub_name = _t==ASTNULL ? null : (AST)_t;
				expression(_t);
				_t = _retTree;
				sub_name_AST = (AST)returnAST;
				
					lastStackSize = argStack.size();
					boolean isArray = sub_name_AST != null
						&& sub_name_AST.getType() == IDENTIFIER
						&& getIdentifierType(sub_name_AST.getText()) == ARRAY;
					//this added by me in the generated code
					log.debug(Boolean.toString(_t == null));
				argListValues(_t);
				_t = _retTree;
				statement_AST = (AST)currentAST.root;
				
					if (isArray) {
						statement_AST = translateArray(sub_name_AST, lastStackSize);
					} else {
						statement_AST = handleFunctionSubEnd(sub_name_AST, lastStackSize); 
					}
					if (statement_AST != null) {
						statement_AST = (AST)astFactory.make( (new ASTArray(2)).add(astFactory.create(EXPR,"EXPR")).add(statement_AST));
					}
				
				currentAST.root = statement_AST;
				currentAST.child = statement_AST!=null &&statement_AST.getFirstChild()!=null ?
					statement_AST.getFirstChild() : statement_AST;
				currentAST.advanceChildToEnd();
				currentAST = __currentAST27;
				_t = __t27;
				_t = _t.getNextSibling();
				break;
			}
  
The diff when the argListValues rule is optional is:
.................................
				{
				if (_t==null) _t=ASTNULL;
				switch ( _t.getType()) {
				case ARGLIST_VALUES:
				{
					argListValues(_t);
					_t = _retTree;
					break;
				}
				case 3:
				{
					break;
				}
				default:
				{
					throw new NoViableAltException(_t);
				}
				}
				}
............................

The interesting thing is that in both cases the statement
log.debug(Boolean.toString(_t == null));
prints true. When the match of argListValues is mandatory and
and the tree analyzed can be matched by argListValues _t is null
but argListValues does not fail. It seems to me that _t is allways null
no matter if argListValues can be matched or not. 

antlr version: 1.7.4

What should I do to investigate if this happens because of action code or
it is a bug in the code generated from antlr?

Anakreon

From ewbank at gmail.com  Sat Jan 22 06:20:15 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Sat Jan 22 06:20:18 2005
Subject: [antlr-interest] Parse simle list
In-Reply-To: <GCENJBNDIDEDENFIGNENMEOBCAAA.moviem@web.de>
References: <200501162350.j0GNoH319934@shell2.webquarry.com>
	<GCENJBNDIDEDENFIGNENMEOBCAAA.moviem@web.de>
Message-ID: <dd3a065f05012206205e93c2a4@mail.gmail.com>

On Sat, 22 Jan 2005 12:57:09 +0100, Tomasz Bluszcz <moviem@web.de> wrote:
> Here is the very simple parser grammar:
> 
> parse           :       (KW_ELEMENT LEGALNAME attribs)* ;
> attribs :       '{'! (CCBOOL LEGALNAME)* '}'!;
> 
> Can anybody point my an example or give my some hints?
> 
> What modification i have to do to get the tree structure described above?

I think what you want is to change "parse" to be:
   parse : (KW_ELEMENT^ LEGALNAME attribs) *;
I did not test this

> Exist a c++ class to view the ast like the java class ASTviewer?

There is an example C++ tree printer in the antlr manual.  It displays
a textual representation of the tree.  You can all used toStringList()
to emit the tree in a parenthesized form.

Hope this helps,
- Bryan
From Jbspine at aol.com  Fri Jan 21 09:32:52 2005
From: Jbspine at aol.com (Jbspine@aol.com)
Date: Sat Jan 22 08:17:54 2005
Subject: [antlr-interest] java.g forks
Message-ID: <cd.2037b796.2f2296c4@aol.com>

Hi micheal
    I am not sure if you are the person I am looking  for or not, Do you, or 
did you live at AD518 North Plum Carlinville illinois zip  62626?, if so I 
would appreciate you contacting me,  thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050121/4e571b50/attachment.html
From monty at codetransform.com  Sat Jan 22 10:52:40 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Sat Jan 22 10:52:39 2005
Subject: [antlr-interest] Writing a two pass compiler.
In-Reply-To: <20050121044723.36906.qmail@web30405.mail.mud.yahoo.com>
References: <20050121044723.36906.qmail@web30405.mail.mud.yahoo.com>
Message-ID: <CAEDC536-6CA6-11D9-8B55-000393B5606C@codetransform.com>

	From: 	  monty@codetransform.com
	Subject: 	Re: [antlr-interest] Writing a two pass compiler.
	Date: 	January 21, 2005 8:21:28 AM PST
	To: 	  olczyk2002@yahoo.com

\On Jan 20, 2005, at 8:47 PM, Thaddeus Olczyk wrote:
> I have a grammar for a language which I discover is
> written quite poorly. Certain types of strings can
> have different meanings depending on context, so
> I cannot unambiguously tokenise the strings.
> Mainly this is do to the fact that there is
> no way to distinguish text data from "source".
>
> Having examined the language closely, I believe it
> can be parsed using antlr to generate a two pass
> compiler. Pass2 being a context sensitive parse.
>
> A difficuly for me is that I've only written a few
> very trivial parsers ( at the calcualtor level ). I
> was wondering if there were any simple samples of
> antlr being used to implement a two pass compiler to
> guide
> me along the way.
>

I'm not aware of any full blown examples of two pass parsing.  I do 
have a small example of something similar, where I embed another parser 
in a TokenFilter in order to disambiguate strings, numbers and labels 
based on things like whether they follow a GOTO or not.  Read my 
article at http://www.codetransform.com/filterexample.html and then 
post any questions here.  Perhaps you will have some tricky examples 
you will need help with.  If so please post some sample code to be 
parsed as well as your best guess for the rules involved.

Monty Zukowski

ANTLR & Java Consultant -- http://www.codetransform.com
ANSI C/GCC transformation toolkit -- 
http://www.codetransform.com/gcc.html
Embrace the Decay -- http://www.codetransform.com/EmbraceDecay.html

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/enriched
Size: 2105 bytes
Desc: not available
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050122/88b59aae/attachment.bin
From monty at codetransform.com  Sat Jan 22 10:53:12 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Sat Jan 22 10:53:04 2005
Subject: [antlr-interest] Optional Tree path not followed
In-Reply-To: <41F24B4A.6040107@yahoo.gr>
References: <41F24B4A.6040107@yahoo.gr>
Message-ID: <DDDFA06A-6CA6-11D9-8B55-000393B5606C@codetransform.com>


On Jan 22, 2005, at 4:47 AM, Anakreon wrote:
>
> What should I do to investigate if this happens because of action code 
> or
> it is a bug in the code generated from antlr?
>
>

First I would print the tree there as you enter, and turn on 
-traceTreeParser to see what is really going on.  From your description 
it seems that the ARGLIST_VALUES part of the tree isn't there.

Monty

ANTLR & Java Consultant -- http://www.codetransform.com
ANSI C/GCC transformation toolkit -- 
http://www.codetransform.com/gcc.html
Embrace the Decay -- http://www.codetransform.com/EmbraceDecay.html

From parrt at cs.usfca.edu  Sat Jan 22 11:45:56 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sat Jan 22 11:39:38 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
Message-ID: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>

Howdy,

Just cut the final 2.1 StringTemplate release.  Lots of little fixes 
and feature enhancements.  Here are the release notes:

http://www.stringtemplate.org/doc/release-2.1.tml

Enjoy :)

BTW, an article is almost done where I show how to translate a simple 
language, "C-", to both Java and Python using ANTLR+StringTemplate. :)  
Can generate a new target language w/o recompiling.  Just add a new 
template file. :)

Terence
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From ewbank at gmail.com  Sat Jan 22 12:58:23 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Sat Jan 22 12:58:26 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
Message-ID: <dd3a065f0501221258136c7045@mail.gmail.com>

Is it feasible to use StringTemplate for code generation in 2.7.5? 
I'd really like to see, for example, C code generation w/o an
associated library.

Thanks,
- Bryan

Ter the master of ANTLR said:
> Just cut the final 2.1 StringTemplate release.  Lots of little fixes
> and feature enhancements.  Here are the release notes:
> 
> http://www.stringtemplate.org/doc/release-2.1.tml
From monty at codetransform.com  Sat Jan 22 10:32:25 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Sat Jan 22 13:32:34 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <dd3a065f0501221258136c7045@mail.gmail.com>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
Message-ID: <41F29C39.9050206@codetransform.com>

Bryan Ewbank wrote:
> Is it feasible to use StringTemplate for code generation in 2.7.5? 
> I'd really like to see, for example, C code generation w/o an
> associated library.
> 

Well, if you're generating the code, you can do it any way you want with 
respect to libraries.

If you were hoping for C as a target language for  2.7.5 you're out of 
luck, that's extremely unlikely to happen until version 3.

Monty
From Loring.G.Craymer at jpl.nasa.gov  Sat Jan 22 13:51:48 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Sat Jan 22 13:51:47 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <41F29C39.9050206@codetransform.com>
Message-ID: <200501222151.j0MLpjx5004688@eis-msg-012.jpl.nasa.gov>

Bryan--

If you mean "Can my translator use String Template to generate output", then
the answer is yes--that's what Ter is doing to bootstrap 3.0.  Changing the
backend of ANTLR 2 for a new target, on the other hand, is a major task as
Monty points out--the xxCodeGenerator.java files could stand some major
refactorings.  Each runs to 120-150K in size.

--Loring

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Monty Zukowski
> Sent: Saturday, January 22, 2005 10:32 AM
> To: Bryan Ewbank
> Cc: ANTLR Interest
> Subject: Re: [antlr-interest] StringTemplate 2.1 release!
> 
> Bryan Ewbank wrote:
> > Is it feasible to use StringTemplate for code generation in 2.7.5?
> > I'd really like to see, for example, C code generation w/o an
> > associated library.
> >
> 
> Well, if you're generating the code, you can do it any way you want with
> respect to libraries.
> 
> If you were hoping for C as a target language for  2.7.5 you're out of
> luck, that's extremely unlikely to happen until version 3.
> 
> Monty

From tribble at deantribble.com  Sat Jan 22 12:57:54 2005
From: tribble at deantribble.com (Dean Tribble)
Date: Sat Jan 22 14:02:06 2005
Subject: [antlr-interest] Writing a two pass compiler.
In-Reply-To: <CAEDC536-6CA6-11D9-8B55-000393B5606C@codetransform.com>
Message-ID: <Pine.LNX.4.33.0501221246320.5192-100000@linserv.e-dean.com>

Depending on the grammar, you may be able to use Antlr's support for 
switching parsers and/or grammars in mid parse.  I made use of that in the 
parser for the E grammar.  You can find a version (not complete) in 
http://www.erights.org/e-impls/e-on-e/egrammar/index.html.  In particular, 
the various constructs beginning with "quasi" in the e.g file connect to 
the quasi.g file, which is a subgrammar.  The QUASIOPEN item in the lexer 
changes the active lexer, and the corresponding token in the QuasiString 
construct in the parser changes the parser.  Note that this is all based 
on the standard approach within ANTLR for combining multiple grammars, 
with the primary exception that antlr does not provide sufficient support 
for *popping* out of a nested grammar.  The result was that I had to 
add parser behavior to pop teh nested grammar.

I have a newer, not yet posted, version that ended up simplifying this 
such that I no longer use a separate parser for the sub-language.  I also 
made subclasses of the lexer and parser types to make managing the lexer 
selection support a little easier.  It should be done enough in a week or 
so, but email if it owuld be useful sooner than that.

On Sat, 22 Jan 2005, Monty Zukowski wrote:
> 	From: 	  monty@codetransform.com
> 	Subject: 	Re: [antlr-interest] Writing a two pass compiler.
> 	Date: 	January 21, 2005 8:21:28 AM PST
> 	To: 	  olczyk2002@yahoo.com
> 
> \On Jan 20, 2005, at 8:47 PM, Thaddeus Olczyk wrote:
> > I have a grammar for a language which I discover is
> > written quite poorly. Certain types of strings can
> > have different meanings depending on context, so
> > I cannot unambiguously tokenise the strings.
> > Mainly this is do to the fact that there is
> > no way to distinguish text data from "source".
> >
> > Having examined the language closely, I believe it
> > can be parsed using antlr to generate a two pass
> > compiler. Pass2 being a context sensitive parse.
> >
> > A difficuly for me is that I've only written a few
> > very trivial parsers ( at the calcualtor level ). I
> > was wondering if there were any simple samples of
> > antlr being used to implement a two pass compiler to
> > guide
> > me along the way.
> >
> 
> I'm not aware of any full blown examples of two pass parsing.  I do 
> have a small example of something similar, where I embed another parser 
> in a TokenFilter in order to disambiguate strings, numbers and labels 
> based on things like whether they follow a GOTO or not.  Read my 
> article at http://www.codetransform.com/filterexample.html and then 
> post any questions here.  Perhaps you will have some tricky examples 
> you will need help with.  If so please post some sample code to be 
> parsed as well as your best guess for the rules involved.
> 
> Monty Zukowski
> 
> ANTLR & Java Consultant -- http://www.codetransform.com
> ANSI C/GCC transformation toolkit -- 
> http://www.codetransform.com/gcc.html
> Embrace the Decay -- http://www.codetransform.com/EmbraceDecay.html
> 
> 

From alan-antlr-interest at engrm.com  Sat Jan 22 18:43:51 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Sat Jan 22 18:43:53 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <41F29C39.9050206@codetransform.com>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
Message-ID: <20050123024351.GA18310@maribor.izzy.net>

* Monty Zukowski <monty@codetransform.com> [2005-01-22 16:32]:
> Bryan Ewbank wrote:
> >Is it feasible to use StringTemplate for code generation in 2.7.5? 
> >I'd really like to see, for example, C code generation w/o an
> >associated library.
> >
> 
> Well, if you're generating the code, you can do it any way you want with 
> respect to libraries.
> 
> If you were hoping for C as a target language for  2.7.5 you're out of 
> luck, that's extremely unlikely to happen until version 3.

    Is there an alpha or beta of version 3 available?

--
Alan Gutierrez - alan@engrm.com
From parrt at cs.usfca.edu  Sun Jan 23 11:33:25 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sun Jan 23 11:27:06 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <20050123024351.GA18310@maribor.izzy.net>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
Message-ID: <A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>


On Jan 22, 2005, at 6:43 PM, Alan Gutierrez wrote:
>> If you were hoping for C as a target language for  2.7.5 you're out of
>> luck, that's extremely unlikely to happen until version 3.
>
>     Is there an alpha or beta of version 3 available?

Hi Alan,

Unfortunately, it is months off before it's ready for early access.  
I've made huge progress, but need to finish thinking about trees and 
then implement them.  Then tree parsers.  Then I can release.  If all 
goes well, I'm thinking May early access.

Regards,
Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From alan-antlr-interest at engrm.com  Sun Jan 23 23:24:27 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Sun Jan 23 23:24:30 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
Message-ID: <20050124072427.GA29835@maribor.izzy.net>

* Terence Parr <parrt@cs.usfca.edu> [2005-01-23 14:27]:
> 
> On Jan 22, 2005, at 6:43 PM, Alan Gutierrez wrote:
> >>If you were hoping for C as a target language for  2.7.5 you're out of
> >>luck, that's extremely unlikely to happen until version 3.
> >
> >    Is there an alpha or beta of version 3 available?

> Unfortunately, it is months off before it's ready for early access.  
> I've made huge progress, but need to finish thinking about trees and 
> then implement them.  Then tree parsers.  Then I can release.  If all 
> goes well, I'm thinking May early access.

    Good. Gives me plenty of time to learn ANTLR 2.7.x. :^)

--
Alan Gutierrez - alan@engrm.com
> 
> 
> 
From ric.klaren at gmail.com  Tue Jan 25 01:57:11 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Tue Jan 25 01:57:17 2005
Subject: Fwd: [antlr-interest] ANTLR, C++ and UNICODE
In-Reply-To: <bc607a4e050124234677bd81cd@mail.gmail.com>
References: <3adf6db8041028062852d19760@mail.gmail.com>
	<20050124223734.9947.qmail@web30201.mail.mud.yahoo.com>
	<bc607a4e050124234677bd81cd@mail.gmail.com>
Message-ID: <bc607a4e05012501574962f5@mail.gmail.com>

Can people stop posting to the yahoogroups thing !? Although it's
already pretty stupid of yahoo that for some it seems to work and for
me the reply bounces....

---------- Forwarded message ----------
From: Ric Klaren <ric.klaren@gmail.com>
Date: Tue, 25 Jan 2005 08:46:48 +0100
Subject: Re: [antlr-interest] ANTLR, C++ and UNICODE
To: antlr-interest@yahoogroups.com

On Mon, 24 Jan 2005 14:37:33 -0800 (PST), Peggy Fieland
<madcapmaggie@yahoo.com> wrote:
> What is the state of UNICODE support for ANTLR C++
> mode?  I need to support UNICODE input.  Is there a
> patch I can apply?

2.7.5 prereleases contain an example that adds some unicode support.
It basically shows a CharScanner subclass that can deal with UTF8 on
the input side, it's more a proof of concept than production code. I
guess that if the codegen changes are sufficient one could turn it
into something usable in production environment.

I requested feedback for it a while back with a snapshot release.
Since no feedback ever came on the subject of the unicode I did not do
anything further with it (I myself have no real stuff to test unicode
with, so I need some community involvement to help testing/fleshing it
out to something usable)

Since we're in the 2.7.5 prerelease track and 2.7.5 will go out any
moment the last configure/makefile tweaks are done, 2.7.5 will
probably not see good unicode support. 2.7.6 might if people provide
feedback.

Cheers,

Ric
From rui-l-goncalves at ptinovacao.pt  Tue Jan 25 08:28:57 2005
From: rui-l-goncalves at ptinovacao.pt (Rui Alberto L. =?ISO-8859-1?Q?Gon=E7alves?=)
Date: Tue Jan 25 08:27:14 2005
Subject: [antlr-interest] parentheses sequence validation
Message-ID: <1106670537.2581.20.camel@localhost.localdomain>

Hi,
I'm just starting with antlr. Sorry if I'm asking a really basic
question.

I'm trying to write a grammatic that should validade if
a sequence of parentheses is well formed.
Here's my grammatic:
................................................
 class ExpressionParser extends Parser;
options { buildAST=true; }
                                                                                                                            expr : LPAREN^ (expr)* RPAREN!;
                                                                                                                            class ExpressionLexer extends Lexer;
options {
  filter=false;
  interactive  = true;
}
                                                                                                                           LPAREN : '(' ;
RPAREN : ')' ;
                                                                                                                             WS    : (' ' | '\t' | '\r' | '\n') {$setType(Token.SKIP);} ;

.....................................................

this is working well, except when the input sequence
ends with extra right parentheses.

Ex: ((()())()) : Validated OK
(() : The error is thrown: expecting RPAREN, found : OK

BUT when trying validate the expression: ()) no error is thrown!!!

Why this is happening ? Thanks for any help.

Rui

-- 

From mail at martin-probst.com  Tue Jan 25 08:47:40 2005
From: mail at martin-probst.com (Martin Probst)
Date: Tue Jan 25 08:47:45 2005
Subject: [antlr-interest] parentheses sequence validation
In-Reply-To: <1106670537.2581.20.camel@localhost.localdomain>
References: <1106670537.2581.20.camel@localhost.localdomain>
Message-ID: <36339.194.39.131.40.1106671660.14431.squirrel@webmailer.hosteurope.de>

Hi,

> Ex: ((()())()) : Validated OK
> (() : The error is thrown: expecting RPAREN, found : OK
>
> BUT when trying validate the expression: ()) no error is thrown!!!

You need to check for the EOF condition. In your case your parser just
stops parsing if it can't continue to match rules. The trailing ')' is
silently ignored. Fix it by writing:

expr: LPAREN (expr)* RPAREN EOF!

( EOF is the meta-token for the End-Of-File, the ! operator keeps it out
of your parse tree).

Regards,
Martin
From moviem at web.de  Tue Jan 25 09:40:18 2005
From: moviem at web.de (Tomasz Bluszcz)
Date: Tue Jan 25 09:40:20 2005
Subject: [antlr-interest] Syntactic predicate or not...
Message-ID: <GCENJBNDIDEDENFIGNENEEOECAAA.moviem@web.de>

Hi,
my lexer contains the following rules...
The difference between LegalName and LegalNameEx is that the LegalNameEx
containst the special character '.'  and the first char must not be a
letter.
My problem is to write the right LEGALNAME_OR_LEGALNAMEEX_OR_INT rule... I
think it is completely wrong..
Is it necessary to use a syntactic pradicate?


Many thanks ... Tom


protected DIGIT		:('0'..'9');
protected INT		:(MINUS)? ( DIGIT )+;

protected DOT		:'.';
protected LETTER		:('a'..'z' | 'A'..'Z' | '_');

protected LEGALNAME
options {
	testLiterals = true;
	paraphrase = "LegalName";
} :(LETTER) (LETTER|DIGIT)*;

protected	LEGALNAMEEX
options {
	testLiterals = true;
	paraphrase = "LegalNameEx";
} : ( DOT | LETTER | DIGIT )+;


LEGALNAME_OR_LEGALNAMEEX_OR_INT
options {
	testLiterals = true;
	paraphrase = "LegalName_OR_LegalNameEx_OR_Int";
}	
	:(( DOT | DIGIT | BACKSLASH )+) => LEGALNAMEEX 
	|( LETTER (LETTER|DIGIT)*) => LEGALNAME { $setType(LEGALNAME); }
	|( INT ) { $setType(INT); }
	;


From christopher.d.schultz at comcast.net  Tue Jan 25 09:41:40 2005
From: christopher.d.schultz at comcast.net (Christopher Schultz)
Date: Tue Jan 25 09:43:53 2005
Subject: [antlr-interest] parentheses sequence validation
In-Reply-To: <36339.194.39.131.40.1106671660.14431.squirrel@webmailer.hosteurope.de>
References: <1106670537.2581.20.camel@localhost.localdomain>
	<36339.194.39.131.40.1106671660.14431.squirrel@webmailer.hosteurope.de>
Message-ID: <41F684D4.9010402@comcast.net>

Martin,

> You need to check for the EOF condition. In your case your parser just
> stops parsing if it can't continue to match rules. The trailing ')' is
> silently ignored. Fix it by writing:
> 
> expr: LPAREN (expr)* RPAREN EOF!
> 
> ( EOF is the meta-token for the End-Of-File, the ! operator keeps it out
> of your parse tree).

I have a followup question about this. I wrote an expression evaluator 
that is similar to one of the examples available but supports strings, 
floating point, function calls, etc. and had the same sort of problem.

I changed by top-level expression to something like this:

    expr: some_lower_level_expr EOF ;

And half of my unit tests failed when using parenthesis. Anything ending 
in a ) would fail. For example:

    1 + 2

was fine but

    ( 1 + 2 )

would fail with a message like "expected ) but got NULL".

Just for kicks, I tried:

    ( 1 + 2 ))

but I got a similar message (or even worse, I think I got "expected ), 
got )" which is pretty silly.

I ended up doing this:

    expr: some_lower_level_expr EOF?


and made the EOF optional. Seems pretty stupid, but now everything works.

I posted a question a week or so about this with no response. Heres a link:

http://www.antlr.org/pipermail/antlr-interest/2005-January/010906.html

I'd love an explanation of why this happens.

Thanks,
-chris
From ric.klaren at gmail.com  Tue Jan 25 09:45:02 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Tue Jan 25 09:45:04 2005
Subject: Fwd: [antlr-interest] ANTLR, C++ and UNICODE
In-Reply-To: <20050125155647.34100.qmail@web30207.mail.mud.yahoo.com>
References: <bc607a4e05012501574962f5@mail.gmail.com>
	<20050125155647.34100.qmail@web30207.mail.mud.yahoo.com>
Message-ID: <bc607a4e05012509456c779061@mail.gmail.com>

CC'ing back to the list since this reply got loads of relevant stuff
for the list as well.

On Tue, 25 Jan 2005 07:56:47 -0800 (PST), Peggy Fieland
<madcapmaggie@yahoo.com> wrote:
> I need unicode support (UTF 8 will do).
...<snip>...
>

Have a look at the prerelease 2.7.5 snapshot it provides a rudimentary
way to approach things with a custom charscanner/inputbuffer. I have
no real life parsing problem/data that I can use to really test it
other than the 'this seems to work' status it is in now. The parts of
interest are in the examples/cpp/unicode example. Since the release of
the devel snapshot in september I had no feedback on this stuff.

Currently the example decodes UTF8 in the UnicodeCharBuffer class to
32bit values that are used inside the UnicodeCharScanner. After a
token is recognized the values are reencoded in UTF8 and stored in
std:string just for the proof of concept.

Things to be done are:
- adding more decoding schemes to the CharBuffer (and probably making
it efficient/autosensing/increase the enhancability of it) also what
is practical for this side of the stuff?
- find out what the practical ways are to store the recognized token
text. std::string is probably not the best (duh). I've heart many bad
comments with respect to wchar/wstring, I got the impression not many
people use it (?). There are of course the IBM ICU libraries, but I
would not like adding those as a standard dependency. For this I need
feedback from people actually using unicode. I only meddle with it
since people seem to want it. I have no experience with it other than
reading some specs/whitepapers.
- I did not try yet what it does with character literals/literals
table checks. Might need codegen tweaks?
- The error reporting probably needs an upgrade/change for unicode,
yet this depends on the way unicode strings are stored in tokens.
Probably also needs codegen tweaks and/or an extra grammar option for
C++. Might be an idea to take along internationalization changes as
well.
- probably a better encoding of bitsets is necessary for unicode and
anltr needs to generate them faster. It works now but it isn't fast
and it's bigger than necessary.

I have no personal 'itch' to fix unicode other than some people in the
community would like it. Practical feedback/testing with respect to
the prototype stuff would bring unicode support for C++ quicker.

> When is 2.7.6 due to come out?

When there's enough interesting changes to warrant a release (usable
C++ unicode would probably be a reason).

Cheers,

Ric
From ric.klaren at gmail.com  Tue Jan 25 10:10:02 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Tue Jan 25 10:10:07 2005
Subject: [antlr-interest] Syntactic predicate or not...
In-Reply-To: <GCENJBNDIDEDENFIGNENEEOECAAA.moviem@web.de>
References: <GCENJBNDIDEDENFIGNENEEOECAAA.moviem@web.de>
Message-ID: <bc607a4e050125101061988b9b@mail.gmail.com>

On Tue, 25 Jan 2005 18:40:18 +0100, Tomasz Bluszcz <moviem@web.de> wrote:
> The difference between LegalName and LegalNameEx is that the LegalNameEx
> containst the special character '.'  and the first char must not be a
> letter.
> My problem is to write the right LEGALNAME_OR_LEGALNAMEEX_OR_INT rule... I
> think it is completely wrong..

Something like this?

LEGALNAME_OR_LEGALNAMEEX { bool sawdot = false; }:
  LETTER (LETTER|DIGIT|DOT { sawdot = true; } )*
  { if( sawdot) { $setType(LEGALNAMEEX); } else { $setType(LEGALNAME); }
  }
| DOT ( DOT | LETTER | DIGIT )* { $setType(LEGALNAMEEX); }
;

General strategy: assume it's the one thing when you encounter
something that makes it the other thing patch the return value.

I'm missing the backslash from your predicate in the LEGALNAMEEX rule
you provided so not sure if this is 100% what you want or something
got lost in pruning for posting to the list.

The INT rule can be non protected with this if I'm not mistaken.

Hmmm you say that LEGALNAMEEX cannot start with a letter... Then this
would be better (sawndigit = sawnondigit):

LEGALNAME_OR_LEGALNAMEEX { bool sawnd = false; }:
  LETTER (LETTER|DIGIT)* { $setType(LEGALNAME); }
| (DOT { sawndigit = true; } | DIGIT )
  ( DOT { sawndigit = true; }  | LETTER { sawndigit = true; } | DIGIT )*
  { if ( sawndigit ) { $setType(INT); } else { $setType(LEGALNAMEEX);} }
;

Add LEGALNAME/LEGALNAMEEX/INT to the tokens section where needed.

Excuse the crappy layout and C++-isms if present. (I did not test the
rules in antlr but I think they should be ok)

> Is it necessary to use a syntactic pradicate?

Don't think so in this case.

Cheers,

Ric
From rodrigobamboo at gmail.com  Tue Jan 25 10:11:53 2005
From: rodrigobamboo at gmail.com (Rodrigo B. de Oliveira)
Date: Tue Jan 25 10:11:55 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
Message-ID: <5917478b050125101146a89fc2@mail.gmail.com>

Hi Ter,

Please consider the idea of releasing an early version without any
tree support at all. I'd love to migrate the boo parser to 3.0 and get
the performance boost :)

3.0 would also make it more feasible to have the boo parser written in
boo, something I'd love to have just for the fun of it.

Please, please, please. :)
Rodrigo

On Sun, 23 Jan 2005 11:33:25 -0800, Terence Parr <parrt@cs.usfca.edu> wrote:
> 
> On Jan 22, 2005, at 6:43 PM, Alan Gutierrez wrote:
> >> If you were hoping for C as a target language for  2.7.5 you're out of
> >> luck, that's extremely unlikely to happen until version 3.
> >
> >     Is there an alpha or beta of version 3 available?
> 
> Hi Alan,
> 
> Unfortunately, it is months off before it's ready for early access.
> I've made huge progress, but need to finish thinking about trees and
> then implement them.  Then tree parsers.  Then I can release.  If all
> goes well, I'm thinking May early access.
> 
> Regards,
> Ter
> --
> CS Professor & Grad Director, University of San Francisco
> Creator, ANTLR Parser Generator, http://www.antlr.org
> Cofounder, http://www.jguru.com
> Cofounder, http://www.knowspam.net enjoy email again!
>
From nan.zhang at sympatico.ca  Tue Jan 25 10:34:48 2005
From: nan.zhang at sympatico.ca (Nan Zhang)
Date: Tue Jan 25 10:33:04 2005
Subject: [antlr-interest] Is there a way to output tokenstream generated by
	lexer to a file?
Message-ID: <004a01c5030c$926c2920$0300a8c0@nancyzhang>

say, tokens.txt, so that I could take a look at the token stream.
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050125/711621ca/attachment.html
From monty at codetransform.com  Tue Jan 25 07:47:14 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Tue Jan 25 10:47:24 2005
Subject: [antlr-interest] Is there a way to output tokenstream generated
	by	lexer to a file?
In-Reply-To: <004a01c5030c$926c2920$0300a8c0@nancyzhang>
References: <004a01c5030c$926c2920$0300a8c0@nancyzhang>
Message-ID: <41F66A02.1010102@codetransform.com>

Nan Zhang wrote:
> say, tokens.txt, so that I could take a look at the token stream.
> Thanks.

One way would be to use -traceLexer when invoking ANTLR.
Another would be to make your own TokenStreamFilter which does that.

Monty
From parrt at cs.usfca.edu  Tue Jan 25 11:11:23 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan 25 11:05:04 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <5917478b050125101146a89fc2@mail.gmail.com>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
	<5917478b050125101146a89fc2@mail.gmail.com>
Message-ID: <E7944B12-6F04-11D9-B638-000A95891192@cs.usfca.edu>

On Jan 25, 2005, at 10:11 AM, Rodrigo B. de Oliveira wrote:
> Hi Ter,
>
> Please consider the idea of releasing an early version without any
> tree support at all. I'd love to migrate the boo parser to 3.0 and get
> the performance boost :)
>
> 3.0 would also make it more feasible to have the boo parser written in
> boo, something I'd love to have just for the fun of it.
>
> Please, please, please. :)

Hi Rodrigo,

Don't worry...soon it will be "put up or shut up" time. ;)  Meaning, I 
have bragged about this 3.0 for long enough that pretty soon I'll have 
to show something. ;) hahahahaha!

The problem is that the tool is still in "look at what I'm working on 
in my garage" mode, which means that any bad input makes it crash.  
There are no error messages for bad semantics; well, not enough.  
Further, the overall performance will not amaze you at this point.  I'm 
generating a horribly inefficient list of IFs instead of switches for 
DFAs etc...  Still the general overhead is low enough that w/o 
optimization I'm a wee bit faster than 2.x parsers, naturally depending 
heavily on the grammar.  Oh, and no documentation at all so far.  As 
Fred Brooks says in his Mythical Man Month, slapping some code together 
is about 1/3 of a product. ;)

My plan is to:

1. make 3.0 enforce syntax / semantics for existing functionality
2. do a refactoring / grooming / clean up pass
3. write up my tree construction / tree walking proposal
4. get feedback to tree stuff and then implement
5. early release with a few examples and my "blogs" as doc

I *hope* that I'll have a light load this semester, which is seems to 
be the case.  I'll tentatively say that May is a good early release 
time with or without the completed tree stuff.

BTW, integrating StringTemplate for rewrite rules seems to be a simple 
extension of my tree rewrite stuff; might make it in as well.  Look for 
my article on ANTLR+StringTemplate coming soon to a theatre near you.

Sometime in the next 9 months you'll see a GUI built by Jean Bovet, a 
graduate student here at USF. :)

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!

From alan-antlr-interest at engrm.com  Tue Jan 25 11:17:55 2005
From: alan-antlr-interest at engrm.com (Alan Gutierrez)
Date: Tue Jan 25 11:17:59 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <E7944B12-6F04-11D9-B638-000A95891192@cs.usfca.edu>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
	<5917478b050125101146a89fc2@mail.gmail.com>
	<E7944B12-6F04-11D9-B638-000A95891192@cs.usfca.edu>
Message-ID: <20050125191755.GF6349@maribor.izzy.net>

* Terence Parr <parrt@cs.usfca.edu> [2005-01-25 14:05]:
> On Jan 25, 2005, at 10:11 AM, Rodrigo B. de Oliveira wrote:
> >Hi Ter,
> >
> >Please consider the idea of releasing an early version without any
> >tree support at all. I'd love to migrate the boo parser to 3.0 and get
> >the performance boost :)
> >
> >3.0 would also make it more feasible to have the boo parser written in
> >boo, something I'd love to have just for the fun of it.
> >
> >Please, please, please. :)

    [snip]


> Sometime in the next 9 months you'll see a GUI built by Jean Bovet, a 
> graduate student here at USF. :)

    Eclipse based? I'm using an ANTLR/Eclipse plugin. It's really
    nice.

--
Alan Gutierrez - alan@engrm.com
From parrt at cs.usfca.edu  Tue Jan 25 11:31:24 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Tue Jan 25 11:25:02 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <20050125191755.GF6349@maribor.izzy.net>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
	<5917478b050125101146a89fc2@mail.gmail.com>
	<E7944B12-6F04-11D9-B638-000A95891192@cs.usfca.edu>
	<20050125191755.GF6349@maribor.izzy.net>
Message-ID: <B3491D02-6F07-11D9-B638-000A95891192@cs.usfca.edu>


On Jan 25, 2005, at 11:17 AM, Alan Gutierrez wrote:

>> Sometime in the next 9 months you'll see a GUI built by Jean Bovet, a
>> graduate student here at USF. :)
>
>     Eclipse based? I'm using an ANTLR/Eclipse plugin. It's really
>     nice.

Hi Alan,

Well, eclipse never made sense to me, but I know it's much more popular 
than Intellij (as that is $400 a pop).  We plan on a standalone GUI at 
first to student the problem and will then worry about integration with 
IDEs. :)

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!

From Loring.G.Craymer at jpl.nasa.gov  Tue Jan 25 12:48:46 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Tue Jan 25 12:48:50 2005
Subject: [antlr-interest] StringTemplate 2.1 release!
In-Reply-To: <B3491D02-6F07-11D9-B638-000A95891192@cs.usfca.edu>
References: <3BC09A5E-6CAE-11D9-9D29-000A95891192@cs.usfca.edu>
	<dd3a065f0501221258136c7045@mail.gmail.com>
	<41F29C39.9050206@codetransform.com>
	<20050123024351.GA18310@maribor.izzy.net>
	<A69323F6-6D75-11D9-B638-000A95891192@cs.usfca.edu>
	<5917478b050125101146a89fc2@mail.gmail.com>
	<E7944B12-6F04-11D9-B638-000A95891192@cs.usfca.edu>
	<20050125191755.GF6349@maribor.izzy.net>
	<B3491D02-6F07-11D9-B638-000A95891192@cs.usfca.edu>
Message-ID: <6.1.1.1.2.20050125123553.02016b30@mail.jpl.nasa.gov>


Ter--

The eclipse plugin architecture is very nice for supporting development and 
it is very easy to avoid incorporating any dependencies on eclipse into an 
application.  Eclipse also supports building standalone "rich client 
platform" applications if you really want to go the standalone 
route.  Eclipse licensing is very friendly to commercial use.  Doing an NIH 
standalone makes very little sense to anyone (or at least to me) who has 
used eclipse as an application base.

--Loring

At 11:31 AM 1/25/2005, Terence Parr wrote:

>On Jan 25, 2005, at 11:17 AM, Alan Gutierrez wrote:
>
>>>Sometime in the next 9 months you'll see a GUI built by Jean Bovet, a
>>>graduate student here at USF. :)
>>
>>     Eclipse based? I'm using an ANTLR/Eclipse plugin. It's really
>>     nice.
>
>Hi Alan,
>
>Well, eclipse never made sense to me, but I know it's much more popular 
>than Intellij (as that is $400 a pop).  We plan on a standalone GUI at 
>first to student the problem and will then worry about integration with 
>IDEs. :)
>
>Ter
>--
>CS Professor & Grad Director, University of San Francisco
>Creator, ANTLR Parser Generator, http://www.antlr.org
>Cofounder, http://www.jguru.com
>Cofounder, http://www.knowspam.net enjoy email again!


From moviem at web.de  Tue Jan 25 22:10:43 2005
From: moviem at web.de (Tomasz Bluszcz)
Date: Tue Jan 25 22:10:43 2005
Subject: [antlr-interest] AW: Syntactic predicate or not...
In-Reply-To: <GCENJBNDIDEDENFIGNENEEOECAAA.moviem@web.de>
Message-ID: <GCENJBNDIDEDENFIGNENEEOICAAA.moviem@web.de>

Thx... This strategy works fine... :)

Tom

> -----Urspr?ngliche Nachricht-----
> Von: Tomasz Bluszcz [mailto:moviem@web.de]
> Gesendet: Dienstag, 25. Januar 2005 18:40
> An: antlr-interest@antlr.org
> Betreff: Syntactic predicate or not...
>
>
> Hi,
> my lexer contains the following rules...
> The difference between LegalName and LegalNameEx is that the LegalNameEx
> containst the special character '.'  and the first char must not be a
> letter.
> My problem is to write the right LEGALNAME_OR_LEGALNAMEEX_OR_INT rule... I
> think it is completely wrong..
> Is it necessary to use a syntactic pradicate?
>
>
> Many thanks ... Tom
>
>
> protected DIGIT		:('0'..'9');
> protected INT		:(MINUS)? ( DIGIT )+;
>
> protected DOT		:'.';
> protected LETTER		:('a'..'z' | 'A'..'Z' | '_');
>
> protected LEGALNAME
> options {
> 	testLiterals = true;
> 	paraphrase = "LegalName";
> } :(LETTER) (LETTER|DIGIT)*;
>
> protected	LEGALNAMEEX
> options {
> 	testLiterals = true;
> 	paraphrase = "LegalNameEx";
> } : ( DOT | LETTER | DIGIT )+;
>
>
> LEGALNAME_OR_LEGALNAMEEX_OR_INT
> options {
> 	testLiterals = true;
> 	paraphrase = "LegalName_OR_LegalNameEx_OR_Int";
> }
> 	:(( DOT | DIGIT | BACKSLASH )+) => LEGALNAMEEX
> 	|( LETTER (LETTER|DIGIT)*) => LEGALNAME { $setType(LEGALNAME); }
> 	|( INT ) { $setType(INT); }
> 	;
>
>

From Peter.Robinson at t-online.de  Wed Jan 26 12:34:06 2005
From: Peter.Robinson at t-online.de (Peter Robinson)
Date: Wed Jan 26 12:33:25 2005
Subject: [antlr-interest] Syntactic predicates cause unexplainable
	compilation errors in different partsof the code
Message-ID: <1106771646.3230.12.camel@localhost.localdomain>



Gene-ref ::= SEQUENCE {
     A VisibleString OPTIONAL ,  
     B VisibleString OPTIONAL ,  
    C VisibleString OPTIONAL ,    
    D VisibleString OPTIONAL , 
    E BOOLEAN DEFAULT FALSE ,   
    F SET OF Dbtag OPTIONAL ,   
    G SET OF VisibleString OPTIONAL ,
    H  VisibleString OPTIONAL } 
  END




Dear ANTLR list,

First of all thanks to you all for being a helpful and informative list.
I recently have been trying to learn antlr and cannot now imagine using
things like lex/yacc with which I previously occasionally did things.

I am now trying to parse a file structure from NCBI in ASN.1 format. The
specification of a small part of the entire thing is as follows  ( I
have replaced some keywords with the letters A-H for clarity). Any one
of the entries is optional and is followed by a comma if there is going
to be another line. There are Gene-ref entries with only one entry (and
no comma).


Gene-ref ::= SEQUENCE {
     A VisibleString OPTIONAL ,  
     B VisibleString OPTIONAL ,  
    C VisibleString OPTIONAL ,    
    D VisibleString OPTIONAL , 
    E BOOLEAN DEFAULT FALSE ,   
    F SET OF Dbtag OPTIONAL ,   
    G SET OF VisibleString OPTIONAL ,
    H  VisibleString OPTIONAL } 
  END

After trying constructs such as (",")? and getting nondeterminateness
warnings, I tried my hand at a syntactic predicate as follows:

generef_line returns [myJavaObject ... ]
{
	String s;
	Dbtag d;
}: GENE_KW "{" 
       (	( A STRING ",")=>
	   A  s1:STRING { System.out.println(s1.getText()); }  ","
	|  A  s2:STRING { System.out.println(s2.getText()); }
	)?
	(  (B STRING ",")=>
	   B s3:STRING { System.out.println(s3.getText()); } ","
	|  B s4:STRING {  System.out.println(s4.getText()); }
	)?
	AND SO ON...
        
        "}"
;


However, this now causes unexplainable compilation errors in other parts
of the code (about 400 lines of grammar etc) to appear, in code that
**worked perfectly fine** before. What is going on?? and is there a
better way to parse the above construct? Thanks, Peter

-- 
Peter N. Robinson
peter.robinson@t-online.de
peter.robinson@charite.de
http://www.charite.de/ch/medgen/robinson/

From Loring.G.Craymer at jpl.nasa.gov  Wed Jan 26 13:48:47 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Wed Jan 26 13:48:52 2005
Subject: [antlr-interest] Syntactic predicates cause
	unexplainable	compilation errors in different partsof the code
In-Reply-To: <1106771646.3230.12.camel@localhost.localdomain>
References: <1106771646.3230.12.camel@localhost.localdomain>
Message-ID: <6.1.1.1.2.20050126134437.01d629b0@mail.jpl.nasa.gov>

This is one of those cases that is usually handled by factoring out the comma:

gene_ref:
       gene_refline ("," gene_refline)*
       ;

However, I think what you are really running into is ANTLR 2's approximate 
LLk.  If you look at the generated code (without the synpreds), I think 
that you will find that it does the right thing.

--Loring


At 12:34 PM 1/26/2005, Peter Robinson wrote:


>Gene-ref ::= SEQUENCE {
>      A VisibleString OPTIONAL ,
>      B VisibleString OPTIONAL ,
>     C VisibleString OPTIONAL ,
>     D VisibleString OPTIONAL ,
>     E BOOLEAN DEFAULT FALSE ,
>     F SET OF Dbtag OPTIONAL ,
>     G SET OF VisibleString OPTIONAL ,
>     H  VisibleString OPTIONAL }
>   END
>
>
>
>
>Dear ANTLR list,
>
>First of all thanks to you all for being a helpful and informative list.
>I recently have been trying to learn antlr and cannot now imagine using
>things like lex/yacc with which I previously occasionally did things.
>
>I am now trying to parse a file structure from NCBI in ASN.1 format. The
>specification of a small part of the entire thing is as follows  ( I
>have replaced some keywords with the letters A-H for clarity). Any one
>of the entries is optional and is followed by a comma if there is going
>to be another line. There are Gene-ref entries with only one entry (and
>no comma).
>
>
>Gene-ref ::= SEQUENCE {
>      A VisibleString OPTIONAL ,
>      B VisibleString OPTIONAL ,
>     C VisibleString OPTIONAL ,
>     D VisibleString OPTIONAL ,
>     E BOOLEAN DEFAULT FALSE ,
>     F SET OF Dbtag OPTIONAL ,
>     G SET OF VisibleString OPTIONAL ,
>     H  VisibleString OPTIONAL }
>   END
>
>After trying constructs such as (",")? and getting nondeterminateness
>warnings, I tried my hand at a syntactic predicate as follows:
>
>generef_line returns [myJavaObject ... ]
>{
>         String s;
>         Dbtag d;
>}: GENE_KW "{"
>        (        ( A STRING ",")=>
>            A  s1:STRING { System.out.println(s1.getText()); }  ","
>         |  A  s2:STRING { System.out.println(s2.getText()); }
>         )?
>         (  (B STRING ",")=>
>            B s3:STRING { System.out.println(s3.getText()); } ","
>         |  B s4:STRING {  System.out.println(s4.getText()); }
>         )?
>         AND SO ON...
>
>         "}"
>;
>
>
>However, this now causes unexplainable compilation errors in other parts
>of the code (about 400 lines of grammar etc) to appear, in code that
>**worked perfectly fine** before. What is going on?? and is there a
>better way to parse the above construct? Thanks, Peter
>
>--
>Peter N. Robinson
>peter.robinson@t-online.de
>peter.robinson@charite.de
>http://www.charite.de/ch/medgen/robinson/


From Peter.Robinson at t-online.de  Wed Jan 26 14:11:47 2005
From: Peter.Robinson at t-online.de (Peter Robinson)
Date: Wed Jan 26 14:10:59 2005
Subject: [antlr-interest] Syntactic predicates cause
	unexplainable	compilation errors in different partsof the code
In-Reply-To: <6.1.1.1.2.20050126134437.01d629b0@mail.jpl.nasa.gov>
References: <1106771646.3230.12.camel@localhost.localdomain>
	<6.1.1.1.2.20050126134437.01d629b0@mail.jpl.nasa.gov>
Message-ID: <1106777507.3230.32.camel@localhost.localdomain>

On Wed, 2005-01-26 at 22:48, Loring Craymer wrote:
> This is one of those cases that is usually handled by factoring out the comma:
> 
> gene_ref:
>        gene_refline ("," gene_refline)*
>        ;
> 

Thanks, I did consider that but was stumped because of the following.
When I parse a GeneRef object, I create a Java object to store the info
that in turn gets passed further up. I need to initialize up to 6
different variables in this object depending on which type of
gene_refline are found (mainly strings, but also more complicated
structures). This is why I wanted to try to do everything in one rule so
that I would always have the reference to the GeneRef object handy...

gene_ref returns [GeneRef gr=null]
{
	String s;
} GENEREF_KW { gr = new GeneRef(); }
	s=gene_refline { gr.addString(s); }  // But there are 6
					//different types of String 					//variable to be initialied
			//depending on what type of gene_refline



> However, I think what you are really running into is ANTLR 2's approximate 
> LLk.  If you look at the generated code (without the synpreds), I think 
> that you will find that it does the right thing.
> 

It was actually (nearly) correct, but since a bunch of downstream
analyses depend on correct parsing, I would somehow like to get rid of
all error messages...


Monty, thanks for your reply. Yes I did look at the ASN.1 grammar on the
website, but (given that I am not that well versed in ASN.1, at least
not yet) I was not able to adapt that to my needs...




> --Loring
> 
> 
> At 12:34 PM 1/26/2005, Peter Robinson wrote:
> 
> 
> >Gene-ref ::= SEQUENCE {
> >      A VisibleString OPTIONAL ,
> >      B VisibleString OPTIONAL ,
> >     C VisibleString OPTIONAL ,
> >     D VisibleString OPTIONAL ,
> >     E BOOLEAN DEFAULT FALSE ,
> >     F SET OF Dbtag OPTIONAL ,
> >     G SET OF VisibleString OPTIONAL ,
> >     H  VisibleString OPTIONAL }
> >   END
> >
> >
> >
> >
> >Dear ANTLR list,
> >
> >First of all thanks to you all for being a helpful and informative list.
> >I recently have been trying to learn antlr and cannot now imagine using
> >things like lex/yacc with which I previously occasionally did things.
> >
> >I am now trying to parse a file structure from NCBI in ASN.1 format. The
> >specification of a small part of the entire thing is as follows  ( I
> >have replaced some keywords with the letters A-H for clarity). Any one
> >of the entries is optional and is followed by a comma if there is going
> >to be another line. There are Gene-ref entries with only one entry (and
> >no comma).
> >
> >
> >Gene-ref ::= SEQUENCE {
> >      A VisibleString OPTIONAL ,
> >      B VisibleString OPTIONAL ,
> >     C VisibleString OPTIONAL ,
> >     D VisibleString OPTIONAL ,
> >     E BOOLEAN DEFAULT FALSE ,
> >     F SET OF Dbtag OPTIONAL ,
> >     G SET OF VisibleString OPTIONAL ,
> >     H  VisibleString OPTIONAL }
> >   END
> >
> >After trying constructs such as (",")? and getting nondeterminateness
> >warnings, I tried my hand at a syntactic predicate as follows:
> >
> >generef_line returns [myJavaObject ... ]
> >{
> >         String s;
> >         Dbtag d;
> >}: GENE_KW "{"
> >        (        ( A STRING ",")=>
> >            A  s1:STRING { System.out.println(s1.getText()); }  ","
> >         |  A  s2:STRING { System.out.println(s2.getText()); }
> >         )?
> >         (  (B STRING ",")=>
> >            B s3:STRING { System.out.println(s3.getText()); } ","
> >         |  B s4:STRING {  System.out.println(s4.getText()); }
> >         )?
> >         AND SO ON...
> >
> >         "}"
> >;
> >
> >
> >However, this now causes unexplainable compilation errors in other parts
> >of the code (about 400 lines of grammar etc) to appear, in code that
> >**worked perfectly fine** before. What is going on?? and is there a
> >better way to parse the above construct? Thanks, Peter
> >
> >--
> >Peter N. Robinson
> >peter.robinson@t-online.de
> >peter.robinson@charite.de
> >http://www.charite.de/ch/medgen/robinson/
-- 
Peter N. Robinson
peter.robinson@t-online.de
peter.robinson@charite.de
http://www.charite.de/ch/medgen/robinson/

From Loring.G.Craymer at jpl.nasa.gov  Wed Jan 26 14:54:25 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Wed Jan 26 14:54:31 2005
Subject: [antlr-interest] Syntactic predicates cause	unexplainable
	compilation errors in different partsof the code
In-Reply-To: <1106777507.3230.32.camel@localhost.localdomain>
References: <1106771646.3230.12.camel@localhost.localdomain>
	<6.1.1.1.2.20050126134437.01d629b0@mail.jpl.nasa.gov>
	<1106777507.3230.32.camel@localhost.localdomain>
Message-ID: <6.1.1.1.2.20050126142611.01d97600@mail.jpl.nasa.gov>

At 02:11 PM 1/26/2005, Peter Robinson wrote:
>On Wed, 2005-01-26 at 22:48, Loring Craymer wrote:
> > This is one of those cases that is usually handled by factoring out the 
> comma:
> >
> > gene_ref:
> >        gene_refline ("," gene_refline)*
> >        ;
> >
>
>Thanks, I did consider that but was stumped because of the following.
>When I parse a GeneRef object, I create a Java object to store the info
>that in turn gets passed further up. I need to initialize up to 6
>different variables in this object depending on which type of
>gene_refline are found (mainly strings, but also more complicated
>structures). This is why I wanted to try to do everything in one rule so
>that I would always have the reference to the GeneRef object handy...

I'd handle this case by having gene_refline be passed a GeneRef argument 
unless there is a reason for insisting on order of keywords (either order 
is needed for evaluation, or you are producing a syntax checker).


>gene_ref returns [GeneRef gr=null]
>{
>         String s;
>} GENEREF_KW { gr = new GeneRef(); }
>         s=gene_refline { gr.addString(s); }  // But there are 6
>                                         //different types of 
> String                                     //variable to be initialied
>                         //depending on what type of gene_refline
>
>
>
> > However, I think what you are really running into is ANTLR 2's approximate
> > LLk.  If you look at the generated code (without the synpreds), I think
> > that you will find that it does the right thing.
> >
>
>It was actually (nearly) correct, but since a bunch of downstream

Would it do the right thing, though?  Usually, the if statements have 
cross-product conditionals (if ((LA(1) == A || LA(1) ==B) && (LA(2) == 
STRING) || LA(2) == BOOLEAN)))
which are not strictly correct, but the case statements impose the correct 
orderings when matching tokens.

>analyses depend on correct parsing, I would somehow like to get rid of
>all error messages...

A good goal--every time I run into this consequence of the LLk-approx, I 
get paranoid.  There is an inline option to suppress the nondeterminism 
warnings when you can verify that the generated code would work properly, 
but I tend to avoid that myself.

--Loring



>Monty, thanks for your reply. Yes I did look at the ASN.1 grammar on the
>website, but (given that I am not that well versed in ASN.1, at least
>not yet) I was not able to adapt that to my needs...
>
>
>
>
> > --Loring
> >
> >
> > At 12:34 PM 1/26/2005, Peter Robinson wrote:
> >
> >
> > >Gene-ref ::= SEQUENCE {
> > >      A VisibleString OPTIONAL ,
> > >      B VisibleString OPTIONAL ,
> > >     C VisibleString OPTIONAL ,
> > >     D VisibleString OPTIONAL ,
> > >     E BOOLEAN DEFAULT FALSE ,
> > >     F SET OF Dbtag OPTIONAL ,
> > >     G SET OF VisibleString OPTIONAL ,
> > >     H  VisibleString OPTIONAL }
> > >   END
> > >
> > >
> > >
> > >
> > >Dear ANTLR list,
> > >
> > >First of all thanks to you all for being a helpful and informative list.
> > >I recently have been trying to learn antlr and cannot now imagine using
> > >things like lex/yacc with which I previously occasionally did things.
> > >
> > >I am now trying to parse a file structure from NCBI in ASN.1 format. The
> > >specification of a small part of the entire thing is as follows  ( I
> > >have replaced some keywords with the letters A-H for clarity). Any one
> > >of the entries is optional and is followed by a comma if there is going
> > >to be another line. There are Gene-ref entries with only one entry (and
> > >no comma).
> > >
> > >
> > >Gene-ref ::= SEQUENCE {
> > >      A VisibleString OPTIONAL ,
> > >      B VisibleString OPTIONAL ,
> > >     C VisibleString OPTIONAL ,
> > >     D VisibleString OPTIONAL ,
> > >     E BOOLEAN DEFAULT FALSE ,
> > >     F SET OF Dbtag OPTIONAL ,
> > >     G SET OF VisibleString OPTIONAL ,
> > >     H  VisibleString OPTIONAL }
> > >   END
> > >
> > >After trying constructs such as (",")? and getting nondeterminateness
> > >warnings, I tried my hand at a syntactic predicate as follows:
> > >
> > >generef_line returns [myJavaObject ... ]
> > >{
> > >         String s;
> > >         Dbtag d;
> > >}: GENE_KW "{"
> > >        (        ( A STRING ",")=>
> > >            A  s1:STRING { System.out.println(s1.getText()); }  ","
> > >         |  A  s2:STRING { System.out.println(s2.getText()); }
> > >         )?
> > >         (  (B STRING ",")=>
> > >            B s3:STRING { System.out.println(s3.getText()); } ","
> > >         |  B s4:STRING {  System.out.println(s4.getText()); }
> > >         )?
> > >         AND SO ON...
> > >
> > >         "}"
> > >;
> > >
> > >
> > >However, this now causes unexplainable compilation errors in other parts
> > >of the code (about 400 lines of grammar etc) to appear, in code that
> > >**worked perfectly fine** before. What is going on?? and is there a
> > >better way to parse the above construct? Thanks, Peter
> > >
> > >--
> > >Peter N. Robinson
> > >peter.robinson@t-online.de
> > >peter.robinson@charite.de
> > >http://www.charite.de/ch/medgen/robinson/
>--
>Peter N. Robinson
>peter.robinson@t-online.de
>peter.robinson@charite.de
>http://www.charite.de/ch/medgen/robinson/


From muztabafuad at yahoo.com  Wed Jan 26 20:33:33 2005
From: muztabafuad at yahoo.com (Muztaba Fuad)
Date: Wed Jan 26 20:33:35 2005
Subject: [antlr-interest] Need Help
Message-ID: <20050127043333.23304.qmail@web14710.mail.yahoo.com>

Hi!
I'm new to ANTLR. I'm trying to pre-process java
source code in a certain way. I used the java grammer
from the antlr web site and get my lexer & parser and
using those, I got the AST. Now how to traverse the
AST to get the information i need from the code? I
would be very glad if somebody point me to the right
direction/hint/code snippets/examples/documents to
solve my problem.

Thanks.

Fuad.



		
__________________________________ 
Do you Yahoo!? 
Yahoo! Mail - Helps protect you from nasty viruses. 
http://promotions.yahoo.com/new_mail
From bluejohn-colladit6408 at mailblocks.com  Thu Jan 27 02:28:32 2005
From: bluejohn-colladit6408 at mailblocks.com (bluejohn-colladit6408@mailblocks.com)
Date: Thu Jan 27 02:28:35 2005
Subject: [antlr-interest] Generic Jaxen Navigator
In-Reply-To: <6.1.1.1.2.20050126142611.01d97600@mail.jpl.nasa.gov>
References: <1106771646.3230.12.camel@localhost.localdomain>	<6.1.1.1.2.20050126134437.01d629b0@mail.jpl.nasa.gov>	<1106777507.3230.32.camel@localhost.localdomain>
	<6.1.1.1.2.20050126142611.01d97600@mail.jpl.nasa.gov>
Message-ID: <20050127102833.95B15DC75C@www.antlr.org>

Hello all,

has anyone ever tried to create a generic Navigator for Jaxen: one that 
could be used traverse any AST using XPath?
Dan Sheppard created one for PMD (http://pmd.sourceforge.net), but it's 
fairly bound to the grammar they selected.

Regards,
      Johan
From ewbank at gmail.com  Thu Jan 27 08:31:24 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Thu Jan 27 08:31:26 2005
Subject: [antlr-interest] guessing w/ predicates
Message-ID: <dd3a065f05012708316cedea83@mail.gmail.com>

Hi Folks,

I'm seeing something during the guessing phase of tree walkers that
has me puzzled.

If I write a rule that has syntactic predicates for *every*
alternative, it seems that guessing would pass if one of the
predicates matched - there's no need for further exploration.

For example:

a
  : (b) => b
  | c
  ;

b
  : (X) => #(X ( a )* )
  | (Y) => #(Y ( a )* )
  | (Z) => #(Z ( a )* )
  ;

c
  : bad:. { err << "illegal node: " << bad; }
  ;

I would expect that guessing from production "a", when drilling into "b", would
just check the syntactic predicates for "b" - that is, X|Y|Z, and then succeed.

What I'm seeing is that it checks X, then drills down into the
production to see if "a" matches recursively -- this seems
counterintuitive (to me, anyway) because "b" requires going into the
production when the predicate matches.  If guessing goes into the
production after the predicate, and the production fails, then
guessing will reject that path incorrectly.

I rewrote "a" to be what I expected to happen:

a
   : ( X | Y | Z ) => b
   | c
   ;

but this is a maintenance problem because now X, Y, and Z occur in two
predicates.

Do I misunderstand the purpose of syntactic predicates?
From T.Lindig at gmx.de  Thu Jan 27 12:03:33 2005
From: T.Lindig at gmx.de (T.Lindig)
Date: Thu Jan 27 12:15:02 2005
Subject: [antlr-interest] Is it a BUG in the Lexer-Rule-Checker?
Message-ID: <41F94915.9050307@gmx.de>

Hi,

don't know, if this is the right place for bug reports, but i can't 
found a better one.

I working with ANTLR 2.7.4

the folowing Lexer-Grammer brings a "lexical nondeterminism" warning.

 >>>>>>>>>> begin <<<<<<<<<<<<<<<<<
class COMALexer extends Lexer;

options {
   k=3;
}

PREPROCESSOR:
   "#test"
   (PREPRO_INLINE_WS)?   //here we get the warning
   (SL_COMMENT)?
;

protected
PREPRO_INLINE_WS :
   (
     INLINE_SPACE
   | ML_COMMENT
   )+
;

protected
INLINE_SPACE
   :   ' ' | '\t' | '\f'
   ;

// multiple-line comments
ML_COMMENT
   :
     "/*" ( options{greedy=false;} :  . )*
     "*/"
     { $setType(Token.SKIP); }
   ;

// Single-line comments
SL_COMMENT
   :  "//" ( ~('\n'|'\r'))*
   { $setType(Token.SKIP); }
;


// Whitespace -- ignored
WS:
   ( INLINE_SPACE )+
   { $setType(Token.SKIP); }
;

 >>>>>>>>>>>>>>>>>>>>>>> end <<<<<<<<<<<<<<<<<<<<<<


ANTLR Parser Generator   Version 2.7.4   1989-2004 jGuru.com
CommentTest.g:9:3: warning:lexical nondeterminism between alts 1 and 2 
of block upon
CommentTest.g:9:3:     k==1:'/'
CommentTest.g:9:3:     k==2:<end-of-token>,'/'
CommentTest.g:9:3:     k==3:<end-of-token>,'\t','\u000c',' 
','#','*','/','e','s','t'


but if i substitute the PREPRO_INLINE_WS token in the PREPROCESSOR rule 
like here:

PREPROCESSOR:
   "#test"
   ( INLINE_SPACE | ML_COMMENT )*
   (SL_COMMENT)?
;

I will get no warning. know also ANTLR see, that this code is correct.

so, is it a bug in ANTLR or did i looked over something?

Thanks for help,
Tobias
From nbsherid at secsme.org.au  Thu Jan 27 12:35:48 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Thu Jan 27 12:35:51 2005
Subject: [antlr-interest] guessing w/ predicates
In-Reply-To: <dd3a065f05012708316cedea83@mail.gmail.com>
Message-ID: <000001c504af$c8d33540$0500a8c0@nigel>


> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Bryan Ewbank
> Sent: Friday, 28 January 2005 3:31 AM
> To: ANTLR Interest
> Subject: [antlr-interest] guessing w/ predicates
> 
> Hi Folks,
> 
> I'm seeing something during the guessing phase of tree walkers that
> has me puzzled.
> 
> If I write a rule that has syntactic predicates for *every*
> alternative, it seems that guessing would pass if one of the
> predicates matched - there's no need for further exploration.
> 
> For example:
> 
> a
>   : (b) => b
>   | c
>   ;
> 
> b
>   : (X) => #(X ( a )* )
>   | (Y) => #(Y ( a )* )
>   | (Z) => #(Z ( a )* )
>   ;
> 
> c
>   : bad:. { err << "illegal node: " << bad; }
>   ;
> 
> I would expect that guessing from production "a", when drilling into "b",
> would
> just check the syntactic predicates for "b" - that is, X|Y|Z, and then
> succeed.
> 
> What I'm seeing is that it checks X, then drills down into the
> production to see if "a" matches recursively -- this seems
> counterintuitive (to me, anyway) because "b" requires going into the
> production when the predicate matches.  If guessing goes into the
> production after the predicate, and the production fails, then
> guessing will reject that path incorrectly.
> 
> I rewrote "a" to be what I expected to happen:
> 
> a
>    : ( X | Y | Z ) => b
>    | c
>    ;
> 
> but this is a maintenance problem because now X, Y, and Z occur in two
> predicates.
> 
> Do I misunderstand the purpose of syntactic predicates?

Go have a look at the code that is generated, and this will help you
understand what is going on.

With or without syntactic predicates, ANTLR will still try to follow the
rules. So seeing X, Y or Z will always go to alternative 'b'. If there is an
ambiguity or lack of enough look-ahead, then the first alternative that
matches is chosen greedily.

When you add a syntactic predicate, the alternatives are still tested in the
same order (so it only really makes sense to put the syntactic predicate on
the first one or two alternatives). However, the predicate simply tests
whether this alternative is suitable before continuing. The lexer/parser is
switched into "guessing" mode and the syntactic predicate tested. If the
predicate is found to be true, then "guessing" mode is turned off, the input
stream is rewound to the beginning again, and the alternative with the
tested syntactic predicate is then followed to consume the input.

For example, with k=1,

a: A A
 | A B;

The first alternative is always chosen... if "A B" is seen then an error is
reported. Alternatively, we can add the syntactic predicate:

a: (A A) => A A
 | A B;

In this case, if the token found is an 'A', then select alternative 1,
switch into "guessing" mode and consume the two 'A' tokens - if the two 'A'
tokens are found, then the predicate is true, so rewind the input and
execute alternative 1 without "guessing". If the predicate is false, then it
tries the next alternative (possibly with another syntactic predicate).

The syntactic predicate can contain tokens and other rules. If you specify
tokens, then the code generated is something like:

	// Switch to guessing mode and try out the syntactic predicate
guessing = true;
	boolean synPred001 = true;
	int x = mark ();

	try {
		consume (A);
		consume (A);

	} catch (ANTLRException e) {
		synPred001 = false;
		guessing = false;
	}

	// Rewind the input stream
	rewind (x);

	// If the syntactic predicate is true, then carry out the
alternative
	if (synPred001)
	{
		consume (A);
		consume (A);

	} else {
		// Try some other alternative
		...
	}

If you use rules in your syntactic predicate, then actual rules will be
called to test out the predicate:

	// Switch to guessing mode and try out the syntactic predicate
	guessing = true;
	boolean synPred001 = true;
	int x = mark ();

	try {
		consume (A);
		mySubrule();

	} catch (ANTLRException e) {
		synPred001 = false;
		guessing = false;
	}

	// Rewind the input stream 
	rewind (x);

	// If the syntactic predicate is true, then carry out the
alternative
	if (synPred001)
	{
		consume (A);
		mySubrule();

	} else {
		// Try some other alternative
		...
	}


However, in your example, it looks like you are trying to add the syntactic
predicate to rule 'a' because there is non-determinism between rules 'b' and
'c' that affects rule 'a'. Unfortunately, you pretty much have to put the
syntactic predicate in rule 'a' but you only need as much input as required
to disambiguate the alternatives. So in this case:

 a: (X X | Y Y) => b
  | c;
 
 b: X X
  | Y Y
  | Z Z;
 
 c: X A
  | Y B;

You can rearrange the ordering of the alternatives to simplify the syntactic
predicates as well, if this makes sense in your particular case.

Hope this helps!

Cheers

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435


From nbsherid at secsme.org.au  Thu Jan 27 12:50:12 2005
From: nbsherid at secsme.org.au (Nigel Sheridan-Smith)
Date: Thu Jan 27 12:50:12 2005
Subject: [antlr-interest] Is it a BUG in the Lexer-Rule-Checker?
In-Reply-To: <41F94915.9050307@gmx.de>
Message-ID: <000001c504b1$cc05ecb0$0500a8c0@nigel>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of T.Lindig
> Sent: Friday, 28 January 2005 7:04 AM
> To: antlr-interest@antlr.org
> Subject: [antlr-interest] Is it a BUG in the Lexer-Rule-Checker?
> 
> Hi,
> 
> don't know, if this is the right place for bug reports, but i can't
> found a better one.
> 
> I working with ANTLR 2.7.4
> 
> the folowing Lexer-Grammer brings a "lexical nondeterminism" warning.
> 
>  >>>>>>>>>> begin <<<<<<<<<<<<<<<<<
> class COMALexer extends Lexer;
> 
> options {
>    k=3;
> }
> 
> PREPROCESSOR:
>    "#test"
>    (PREPRO_INLINE_WS)?   //here we get the warning
>    (SL_COMMENT)?
> ;
> 
> protected
> PREPRO_INLINE_WS :
>    (
>      INLINE_SPACE
>    | ML_COMMENT
>    )+
> ;
> 
> protected
> INLINE_SPACE
>    :   ' ' | '\t' | '\f'
>    ;
> 
> // multiple-line comments
> ML_COMMENT
>    :
>      "/*" ( options{greedy=false;} :  . )*
>      "*/"
>      { $setType(Token.SKIP); }
>    ;
> 
> // Single-line comments
> SL_COMMENT
>    :  "//" ( ~('\n'|'\r'))*
>    { $setType(Token.SKIP); }
> ;
> 
> 
> // Whitespace -- ignored
> WS:
>    ( INLINE_SPACE )+
>    { $setType(Token.SKIP); }
> ;
> 
>  >>>>>>>>>>>>>>>>>>>>>>> end <<<<<<<<<<<<<<<<<<<<<<
> 
> 
> ANTLR Parser Generator   Version 2.7.4   1989-2004 jGuru.com
> CommentTest.g:9:3: warning:lexical nondeterminism between alts 1 and 2
> of block upon
> CommentTest.g:9:3:     k==1:'/'
> CommentTest.g:9:3:     k==2:<end-of-token>,'/'
> CommentTest.g:9:3:     k==3:<end-of-token>,'\t','\u000c','
> ','#','*','/','e','s','t'
> 
> 
> but if i substitute the PREPRO_INLINE_WS token in the PREPROCESSOR rule
> like here:
> 
> PREPROCESSOR:
>    "#test"
>    ( INLINE_SPACE | ML_COMMENT )*
>    (SL_COMMENT)?
> ;
> 
> I will get no warning. know also ANTLR see, that this code is correct.
> 
> so, is it a bug in ANTLR or did i looked over something?
> 


No bug... you might get a SL_COMMENT that is part of the PREPROCESSOR token
or part of its own token. 

Nigel

--
Nigel Sheridan-Smith
PhD research student

Faculty of Engineering
University of Technology, Sydney
Phone: 02 9514 7946
Fax: 02 9514 2435


From tusharjog at gmail.com  Fri Jan 28 00:29:27 2005
From: tusharjog at gmail.com (Tushar Jog)
Date: Fri Jan 28 00:29:29 2005
Subject: [antlr-interest] Issue with antlr 2.7.5rc2
Message-ID: <41da8b4c05012800296358ba9d@mail.gmail.com>

Hello,

please help me with this.

on creating a DerivedGrammar (Parser and Lexer) from a BaseGrammer
(Parser and Lexer) ,
the new literals introduced in DerivedGrammar do not find there way into
DerivedGrammarLexer.cpp    DerivedGrammar::initLiterals()  function,
while the following files
DerivedGrammarTokenTypes.txt
DerivedGrammarTokenTypes.hpp
show that the new literals have been added here.

I am using the cpp code generation of antlr.

On hand editing DerivedGrammarLexer.cpp to add the new literals to
initLiterals() function, the DerivedGrammar parser correctly recognizes
the new literals as literals as opposed to identifiers.

Is this a know or new bug ? Or is this behaviour expected ?

The expandedGrammar.g file looks OK though, so I suspect that this is 
a cpp code generator issue.

Also, how does one submit BUG FIX requests for antlr ?

regards
Tushar
From ric.klaren at gmail.com  Fri Jan 28 04:53:04 2005
From: ric.klaren at gmail.com (Ric Klaren)
Date: Fri Jan 28 04:53:06 2005
Subject: [antlr-interest] Issue with antlr 2.7.5rc2
In-Reply-To: <41da8b4c05012800296358ba9d@mail.gmail.com>
References: <41da8b4c05012800296358ba9d@mail.gmail.com>
Message-ID: <bc607a4e0501280453446ec44a@mail.gmail.com>

On Fri, 28 Jan 2005 02:29:27 -0600, Tushar Jog <tusharjog@gmail.com> wrote:
> on creating a DerivedGrammar (Parser and Lexer) from a BaseGrammer
> (Parser and Lexer) ,
> the new literals introduced in DerivedGrammar do not find there way into
> DerivedGrammarLexer.cpp    DerivedGrammar::initLiterals()  function,
> while the following files
> DerivedGrammarTokenTypes.txt
> DerivedGrammarTokenTypes.hpp
> show that the new literals have been added here.
> 
> I am using the cpp code generation of antlr.
> 
> On hand editing DerivedGrammarLexer.cpp to add the new literals to
> initLiterals() function, the DerivedGrammar parser correctly recognizes
> the new literals as literals as opposed to identifiers.
> 
> Is this a know or new bug ? Or is this behaviour expected ?

It's the first time I hear of this behaviour.
 
> The expandedGrammar.g file looks OK though, so I suspect that this is
> a cpp code generator issue.

C++ mode does basically the same as Java mode (or at least it should)

Could you send me the input files/pruned down input files that show
the behaviour and I'll have a look at it.

> Also, how does one submit BUG FIX requests for antlr ?

The list is a good spot, Terence is also a good person to start with,
C++ stuff you can directly take up with me, I assume the other backend
maintainers also have no trouble with being mailed directly.

Cheers,

Ric
From ewbank at gmail.com  Fri Jan 28 07:35:44 2005
From: ewbank at gmail.com (Bryan Ewbank)
Date: Fri Jan 28 07:35:46 2005
Subject: [antlr-interest] guessing w/ predicates
In-Reply-To: <000001c504af$c8d33540$0500a8c0@nigel>
References: <dd3a065f05012708316cedea83@mail.gmail.com>
	<000001c504af$c8d33540$0500a8c0@nigel>
Message-ID: <dd3a065f05012807353a779736@mail.gmail.com>

This is exactly what I expected, but not what I'm seeing.  What I see
is that during evalutation of once syntactic predicate (guessing==1)
any syntactic predicate encountered is processed (with guessing==2),
and if it is accepted then the guarded alternative is traversed (with
guessing==1) to determine if it matches.

Only if the alternative itself passes will guessing finally be exited
and the input rewound.

I think this is incorrect because the syntactic predicate should force
evalaution into that branch (and throw an exception later w/
guessing==0).

I'm working on getting a testcase that demonstrates the problem I'm seeing.

Nigel said:
> When you add a syntactic predicate, the alternatives are still tested in the
> same order (so it only really makes sense to put the syntactic predicate on
> the first one or two alternatives). However, the predicate simply tests
> whether this alternative is suitable before continuing. The lexer/parser is
> switched into "guessing" mode and the syntactic predicate tested. If the
> predicate is found to be true, then "guessing" mode is turned off, the input
> stream is rewound to the beginning again, and the alternative with the
> tested syntactic predicate is then followed to consume the input.
From Loring.G.Craymer at jpl.nasa.gov  Fri Jan 28 12:21:40 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Fri Jan 28 12:21:43 2005
Subject: [antlr-interest] guessing w/ predicates
In-Reply-To: <dd3a065f05012807353a779736@mail.gmail.com>
References: <dd3a065f05012708316cedea83@mail.gmail.com>
	<000001c504af$c8d33540$0500a8c0@nigel>
	<dd3a065f05012807353a779736@mail.gmail.com>
Message-ID: <6.1.1.1.2.20050128121229.01f8c6a0@mail.jpl.nasa.gov>

Bryan--

Unless I am misreading what you wrote, this sounds like expected 
behavior.  The only difference between processing in guessing mode (within 
the scope of a synpred) and non-guessing mode is that exceptions cause 
failure of a synpred and back off a level of guessing when caught.

--Loring

At 07:35 AM 1/28/2005, Bryan Ewbank wrote:
>This is exactly what I expected, but not what I'm seeing.  What I see
>is that during evalutation of once syntactic predicate (guessing==1)
>any syntactic predicate encountered is processed (with guessing==2),
>and if it is accepted then the guarded alternative is traversed (with
>guessing==1) to determine if it matches.
>
>Only if the alternative itself passes will guessing finally be exited
>and the input rewound.
>
>I think this is incorrect because the syntactic predicate should force
>evalaution into that branch (and throw an exception later w/
>guessing==0).
>
>I'm working on getting a testcase that demonstrates the problem I'm seeing.
>
>Nigel said:
> > When you add a syntactic predicate, the alternatives are still tested 
> in the
> > same order (so it only really makes sense to put the syntactic predicate on
> > the first one or two alternatives). However, the predicate simply tests
> > whether this alternative is suitable before continuing. The lexer/parser is
> > switched into "guessing" mode and the syntactic predicate tested. If the
> > predicate is found to be true, then "guessing" mode is turned off, the 
> input
> > stream is rewound to the beginning again, and the alternative with the
> > tested syntactic predicate is then followed to consume the input.


From parrt at cs.usfca.edu  Fri Jan 28 17:52:03 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Fri Jan 28 17:45:38 2005
Subject: [antlr-interest] ANTLR 2.7.5 released!
Message-ID: <08e6292535c486c55ed7711e90350bff@cs.usfca.edu>

Howdy,

After lots of hard work by:

o Ric Klaren (C++)
o Micheal Jordan, Kunle Odutola and Anthony Oguntimehin (C#)
o Wolfgang H?felinger and Marq Kole (Python)

we have a 2.7.5 release. :)

http://www.antlr.org/download.html

The major new feature of course is the Python generator.  "Tell all 
your friends, now, ya hear?" ;)

Wolfgang has put a huge amount of time into the configuration / build 
as well as building RPMs and some M$ installers. :)

Regards,
Terence

From johnh at kuberaconsulting.com  Sat Jan 29 07:37:27 2005
From: johnh at kuberaconsulting.com (John Harding)
Date: Sat Jan 29 07:37:30 2005
Subject: [antlr-interest] ANTLR 2.7.5 released!
In-Reply-To: <08e6292535c486c55ed7711e90350bff@cs.usfca.edu>
References: <08e6292535c486c55ed7711e90350bff@cs.usfca.edu>
Message-ID: <41FBADB7.6050705@kuberaconsulting.com>

What happened to the web site? It comes up empty at 9:36am CST.

John

Terence Parr wrote:

> Howdy,
>
> After lots of hard work by:
>
> o Ric Klaren (C++)
> o Micheal Jordan, Kunle Odutola and Anthony Oguntimehin (C#)
> o Wolfgang H?felinger and Marq Kole (Python)
>
> we have a 2.7.5 release. :)
>
> http://www.antlr.org/download.html
>
> The major new feature of course is the Python generator.  "Tell all 
> your friends, now, ya hear?" ;)
>
> Wolfgang has put a huge amount of time into the configuration / build 
> as well as building RPMs and some M$ installers. :)
>
> Regards,
> Terence
>
>


-- 
John Harding
Fairfield, Iowa
http://counter.li.org 263331
http://www.kuberaconsulting.com
http://www.mum.edu

From parrt at cs.usfca.edu  Sat Jan 29 10:01:34 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sat Jan 29 10:01:36 2005
Subject: [antlr-interest] ANTLR 2.7.5 released!
In-Reply-To: <41FBADB7.6050705@kuberaconsulting.com>
References: <08e6292535c486c55ed7711e90350bff@cs.usfca.edu>
	<41FBADB7.6050705@kuberaconsulting.com>
Message-ID: <D005B322-721F-11D9-BA97-000393BB647E@cs.usfca.edu>

Sorry about that...seems to have a file descriptor leak in the server 
software...i think i know where it is; probably the new search stuff ;)

back now.

Ter
On Jan 29, 2005, at 7:37 AM, John Harding wrote:

> What happened to the web site? It comes up empty at 9:36am CST.
>
> John
>
> Terence Parr wrote:
>
>> Howdy,
>>
>> After lots of hard work by:
>>
>> o Ric Klaren (C++)
>> o Micheal Jordan, Kunle Odutola and Anthony Oguntimehin (C#)
>> o Wolfgang H?felinger and Marq Kole (Python)
>>
>> we have a 2.7.5 release. :)
>>
>> http://www.antlr.org/download.html
>>
>> The major new feature of course is the Python generator.  "Tell all 
>> your friends, now, ya hear?" ;)
>>
>> Wolfgang has put a huge amount of time into the configuration / build 
>> as well as building RPMs and some M$ installers. :)
>>
>> Regards,
>> Terence
>>
>>
>
>
> -- 
> John Harding
> Fairfield, Iowa
> http://counter.li.org 263331
> http://www.kuberaconsulting.com
> http://www.mum.edu
>

From parrt at cs.usfca.edu  Sun Jan 30 11:47:07 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sun Jan 30 11:40:39 2005
Subject: [antlr-interest] added attributes/dynamic scoping blog entry
Message-ID: <16adb8961ef7dd48b186c26f682d74c7@cs.usfca.edu>

Howdy,

Added info on the current implementation of the attribute and dynamic 
scoping stuff.

http://www.antlr.org/blog/antlr3/rewrite.tml

Please let me know if you see anything totally hosed. ;)

Working on the tree blog now...

Ter

From pauljlucas at mac.com  Sun Jan 30 11:48:23 2005
From: pauljlucas at mac.com (Paul J. Lucas)
Date: Sun Jan 30 11:48:25 2005
Subject: [antlr-interest] Ignoring comments in predicates problem
Message-ID: <Pine.LNX.4.44.0501301116360.2294-100000@g4.pauljlucas.org>

Given:

    protected Ignore
        :   (   WhiteSpaceChar
            |   "(:" ( options { greedy = false; } : . )* ":)"
            )+
        ;

    protected Keywords
        :   // ...
        |   (Identifier (Ignore)? '(' ~':')=> Identifier {
                $setType( FUNCTION_NAME );
            }
        ;

That is "Ignore" is used in predicates to ignore either whitespace or comments
-- a comment in XQuery is (: like this :)

I do get a "nongreedy block may exit incorrectly due to limitations of linear
approximate lookahead" warning for "Ignore".

If I have an "Idenfitier" optionally followed by "Ignore" followed by '(' but
not followed by a ':', then I have a function name.  I want to handle all the
cases of:

    foo( ...
    foo ( ...
    foo (: comment :) ( ...

That is allow zero or more whitespaces or comments in between the Identifier
and the '('.  The second case above doesn't work.

For the ANTLR-generated code for "Ignore" I get in part:

    switch ( LA(1)) {
    case '\t':  case '\n':  case '\r':  case ' ':
    {
        mWhiteSpaceChar(false);
        break;
    }
    case '(':
    {
        match("(:");

The execution enters the '(' case above, but then match() throws a
RecognitionException because it doesn't match "(:".  Back in the "Keywords"
ANTLR-generated code, it's:

    try {
        mIdentifier(false);
        if ((_tokenSet_6.member(LA(1))) && (_tokenSet_7.member(LA(2)))) {
            mIgnore(false);
        }
        else if ((LA(1)=='(') && (_tokenSet_8.member(LA(2)))) {
        }
        else {
            throw new NoViableAltForCharException((char)LA(1), getFilename(), getLine(), getColumn());
        }
        match('(');
        matchNot(':');
    }
    catch (RecognitionException pe) {
        synPredMatched255 = false;
    }

What I *want* to happen is for execution to pick up at the "else if" above, but
since mIgnore throws a RecognitionException, it jumps to the "catch" which is
*not* what I want.

It seems to me that the ANTLR-generated code for "Ignore" should *not* throw a
RecognitionException for my second case.  Why doesn't the generated code
explicitly check for ':' after '(' and if the character is *not* ':' simply
exit?

How can I get what I want?

- Paul

From parrt at cs.usfca.edu  Sun Jan 30 15:09:07 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Sun Jan 30 15:02:40 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
Message-ID: <c548335d25a9297a19a8d7a7a9ef71ff@cs.usfca.edu>

Howdy,

After a lot of typing (and I mean a lot), you'll see my ANTLR 3.0 tree 
construction proposal.  After the proposal, you'll see my long stream 
of consciousness as I wander through the design process (you can 
probably ignore that part).

http://www.antlr.org/blog/antlr3/trees.tml

I include a summary of the current opposition to this proposal.  So far 
I have one smart guy for (Sriram Srinivasan has seen an overview of 
this) and one smart guy against (Loring Craymer). ;)

There are lots of details that will get shaken out when I implement 
whatever we decide, but the broad strokes are there.

Whew...enough typing for a while.

Ter

From Loring.G.Craymer at jpl.nasa.gov  Sun Jan 30 21:50:02 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Sun Jan 30 21:50:06 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <c548335d25a9297a19a8d7a7a9ef71ff@cs.usfca.edu>
Message-ID: <200501310550.j0V5o2x5023975@eis-msg-012.jpl.nasa.gov>

Well, I do have to respond.  For those interested in working with an
implementation of more complete functionality, I am hoping to release 2.8
this week.  Micheal Jor got the C# code generation working Saturday; I'm
folding in the 2.7.5 stuff now.  Open Channel has set up a website for the
release, but there are still some minor licensing issues to either fix or
live with.  This will be labeled a "beta" release; as soon as I get that
out, I can work with Marq and Wolfgang to get the python code generation
upgraded for tree rewriting.

2.8 tree construction has the following features:
1.)  Tree "actions":  ^{ <tree fragment spec> }
	Within a tree action, AST structures are specified in a notation
that mirrors tree walker syntax.  Tree actions support inline tree
construction; the contents of a tree action are added to the current tree
under construction.  [As a side note, the tree action syntax is most of the
complexity to which Ter refers to in his article--he prefers specifying the
complete output.  More on that below.]
2.)  Tree constructors:  ^( <root> <body> )
	Tree constructors can nest, and are recognized by #( <root> <body> )
constructs.
3.)  Node constructors:  ^[<node description>]
	Node constructors may appear either inside or outside a tree action
and are the mechanism for adding "imaginary" nodes.  Outside a tree action,
node constructors may be suffixed with ^ (^[...]^) to make it the root of
the current rule.
4.)  Alternatives and construction predicates:  ^{ {<test>}? A | B }
	Construction predicates are used to conditionally determine which
constructs to add to a tree.  They are the complement to semantic predicates
and are a way of capturing semantics in a tree syntax.  In the fragment, if
<test> is true, A is added to the tree under construction; otherwise, B is
added.
5.)  Restart tree:  { => <fragment> }
	Erase the partial tree already specified.  [I originally used
"RETURN" for lack of a better idea; I changed this to "=>" as part of the
discussions Ter and I had on his proposal.]
6.)  "Copy" and "Reuse":  AST construction control
	Copy duplicates a node and its children; Reuse (in 2.8) incorporates
an input tree fragment into an output tree.  For 3.0, it would make sense to
use "Copy" to replicate a payload (to allow later editing), and Reuse to
allow more than one reference to a single payload.

2.8 tree construction is slightly awkward because of a need to "!" nodes
that would be used in tree actions.  Otherwise, links are added in via
normal construction and you can get circular linkages.  This should be fixed
in 3.0; an efficient implementation is pretty straightforward following what
I have done in 2.8 with the addition of the payload and carrier AST
decomposition.


My objections to Ter's proposal are broader than he mentions.  I would add
4.)  His => syntax cannot be mixed with the current ^ and ! annotation.
Frankly, I consider having two distinct tree rewrite syntaxes to be a
kludge, at best.
5.)  Ambiguities result from using his => in the presence of alternatives
within a rule.  This is especially true if the alternatives contain similar
sets of tokens.  One possible solution is to use labels on nodes, but then
alternatives have to have distinct labels for nodes.  One of the features
that was very handy in PCCTS was that you could have a rule fragment like 
( a:A | a:B) and then reference a in an action (for 3.0, you could also
reference attributes of a).

The major functional difference between the two approaches is that Ter's
approach does not allow inline tree construction.  [He also has not yet
included construction predicates, although I think that I have him almost
convinced that they are essential.]  The "cost" of this restriction (what
Ter refers to as "complexity" is the use of ^{ ... } to enclose rewrites.  I
consider this crippling, but Ter's argument is that this is an aid to
understanding.  [I did point out that the last time I heard him use that
argument, predicate hoisting disappeared from 2.0.  He agreed. (:=< ]
However, I think that the "simplicity" may be illusory:  consider

Foo :
    A B
    (C | D | E) => C A B | D A B | E A B ;

Is (C D E) => intended as a syntactic predicate or not? Probably not, but I
do not think that it would be hard to construct an example that was truly
ambiguous to the human eye.  Is it a rewrite or a typo?


One other point on using ^^ for rules and ^ for subrules.  I don't like
changing to ^^ for rules (neither did Ter when we talked--the
information-theoretic argument is that ^ should be used in the more common
case) and have come around to liking his original proposal that ^ is
restricted to a subrule when the subrule is labeled--that fits in well with
an explicit rewrite syntax because the label could then be used in a rewrite
statement.

--Loring


> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Terence Parr
> Sent: Sunday, January 30, 2005 3:09 PM
> To: ANTLR Interest
> Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
> 
> Howdy,
> 
> After a lot of typing (and I mean a lot), you'll see my ANTLR 3.0 tree
> construction proposal.  After the proposal, you'll see my long stream
> of consciousness as I wander through the design process (you can
> probably ignore that part).
> 
> http://www.antlr.org/blog/antlr3/trees.tml
> 
> I include a summary of the current opposition to this proposal.  So far
> I have one smart guy for (Sriram Srinivasan has seen an overview of
> this) and one smart guy against (Loring Craymer). ;)
> 
> There are lots of details that will get shaken out when I implement
> whatever we decide, but the broad strokes are there.
> 
> Whew...enough typing for a while.
> 
> Ter

From sunshine at public.kherson.ua  Sun Jan 30 22:58:27 2005
From: sunshine at public.kherson.ua (Ruslan Zasukhin)
Date: Sun Jan 30 22:58:37 2005
Subject: [antlr-interest] ANTLR 3.0 is going to have Lexer as fast as FLEX ?
Message-ID: <BE23A3B3.2871A%sunshine@public.kherson.ua>

Hi All,

Anybody can confirm this ?

It seems I have read talk about automates for Lexer 3.0
This give a hope.  :-)

Any news when 3.0 should be ready ?
When is expected its beta testing ?


-- 
Best regards,
Ruslan Zasukhin      [ I feel the need...the need for speed ]
-------------------------------------------------------------
e-mail: ruslan@paradigmasoft.com
web: http://www.paradigmasoft.com

To subscribe to the Valentina mail list go to:
http://lists.macserve.net/mailman/listinfo/valentina
-------------------------------------------------------------


From Loring.G.Craymer at jpl.nasa.gov  Sun Jan 30 23:45:12 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Sun Jan 30 23:45:15 2005
Subject: [antlr-interest] ANTLR 3.0 is going to have Lexer as fast as FLEX
	?
In-Reply-To: <BE23A3B3.2871A%sunshine@public.kherson.ua>
Message-ID: <200501310745.j0V7jCx5010443@eis-msg-012.jpl.nasa.gov>

Ruslan--

Vern Paxson put many years into making flex as fast as humanly possible.
Doing as well would be difficult, especially since one of the design goals
for ANTLR 3 is to maintain the human readability of generated code.

That said, ANTLR 3 lexers will be much faster than ANTLR 2 lexers; Ter has
some data on that that I believe he posted to the list.

Ter has said "May" for early availability; however, that could change.

--Loring

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Ruslan Zasukhin
> Sent: Sunday, January 30, 2005 10:58 PM
> To: 'ANTLR Interest'
> Subject: [antlr-interest] ANTLR 3.0 is going to have Lexer as fast as FLEX
> ?
> 
> Hi All,
> 
> Anybody can confirm this ?
> 
> It seems I have read talk about automates for Lexer 3.0
> This give a hope.  :-)
> 
> Any news when 3.0 should be ready ?
> When is expected its beta testing ?
> 
> 
> --
> Best regards,
> Ruslan Zasukhin      [ I feel the need...the need for speed ]
> -------------------------------------------------------------
> e-mail: ruslan@paradigmasoft.com
> web: http://www.paradigmasoft.com
> 
> To subscribe to the Valentina mail list go to:
> http://lists.macserve.net/mailman/listinfo/valentina
> -------------------------------------------------------------


From Jim.O'Connor at microfocus.com  Mon Jan 31 08:27:39 2005
From: Jim.O'Connor at microfocus.com (Jim O'Connor)
Date: Mon Jan 31 11:26:57 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
Message-ID: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>

Hi Terence,
  I have reactions from my perspective (how can they not be?).  I considered
a few general goals. 
1. What is the learning cost to using Antlr? 

	I use as example "How do I get line numbers from my AST?" In version
2.7.4 and earlier, the necessity of understanding the CommonAST, BaseAST,
Token structure is a barrier to an "educated" user.  Maybe this is a good
thing.
	What is my point?  Tree construction syntax is already a barrier to
overcome to reading Antlr grammars.  To what point is "new/better"
functionality increasing the "learning barrier" for doing simple things?  

Note 1: I haven't used String Template.  Will that be a necessity to
understand Antlr 3.0?
Note 2: I like the effect of ^^.

2. Predicates, Tree construction and actions.
	To use old/current terminology, guessing = 0 means execute an
action.  Consider a rule

Oldstylepredicate :
	a b c => a b c
	| blah blah ;


Assume I have actions on "a", "b", and "c".  These must get executed in
order.

Newstyletree :
	a b c => c c a a b b
	| blah blah ;

The actions on rules "a", "b", and "c" will get executed out of order and
multiple times.  This comment may reveal some strange kind of ignorance.  I
have to be intelligent enough to realize the effect, but stupid enough to do
it.

3. Predicates, Tree construction and actions, again.

	Would it be useful to change the designator from "=>" to something
else?  Again, the "stuff" on the right can be in any order!!!  I guess I am
stuck on the matching order.

4. Missing the whole point.
	The desired effect is to produce a tree that is in the "correct"
order.  This leads to more efficient tree traversal and better ordered
actions in the tree grammar.  The proposal addresses these issues.  Does it
do away with the manual manipulation of the trees?  The imaginary nodes
appears to be a stumbling block.  Or can a @attribute.Imaginary.THISTHING be
created in a header section be used anywhere?

Jim
P.S. Sorry, this is what you get when you're supposed to be doing other work
and "waste" the time considering theoretical Antlr issues.  Hope this is
useful.



> -----Original Message-----
> From: Terence Parr [mailto:parrt@cs.usfca.edu]
> Sent: Sunday, January 30, 2005 6:09 PM
> To: ANTLR Interest
> Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
> 
> Howdy,
> 
> After a lot of typing (and I mean a lot), you'll see my ANTLR 3.0 tree
> construction proposal.  After the proposal, you'll see my long stream
> of consciousness as I wander through the design process (you can
> probably ignore that part).
> 
> http://www.antlr.org/blog/antlr3/trees.tml
> 
> I include a summary of the current opposition to this proposal.  So far
> I have one smart guy for (Sriram Srinivasan has seen an overview of
> this) and one smart guy against (Loring Craymer). ;)
> 
> There are lots of details that will get shaken out when I implement
> whatever we decide, but the broad strokes are there.
> 
> Whew...enough typing for a while.
> 
> Ter
> 
> 
> 
> This message has been scanned for viruses by MailController -
> www.MailController.altohiway.com
From Bharath.Sundararaman at starthis.com  Mon Jan 31 13:29:54 2005
From: Bharath.Sundararaman at starthis.com (Bharath Sundararaman)
Date: Mon Jan 31 13:29:56 2005
Subject: [antlr-interest] Lexer/Parser invocation
Message-ID: <B1180416E5C44E49AE556D23DBB45B29061190@webmail.starthis.com>

Hi all,

I am using ANTLR as my CC tool and I have a routine that passes source
code as a string to my compiler. The question is, if I did not want to
create instances of the lexer/parser every single time I pass a string,
how would I do it?

In other words, I want to avoid doing this every time:

Lexer l = new lexer("source code goes here");
Parser p = new Parser(l); // l is the Lexer object
Parser.topRule(); // top most rule

I use ANTLR in a Java based environment and I saw the following post on
the grp:

http://www.antlr.org/pipermail/antlr-interest/2004-June/008230.html

I could not find the method signatures listed in this post. For example,
the parser constructor seems to have a pointer (in C++) to a lexer and
symbol_information? (Slightly lost here)

Any ideas?

Thanks!

B.

-----Original Message-----
From: antlr-interest-bounces@antlr.org
[mailto:antlr-interest-bounces@antlr.org] On Behalf Of Loring Craymer
Sent: Monday, January 31, 2005 1:45 AM
To: 'ANTLR Interest'
Subject: RE: [antlr-interest] ANTLR 3.0 is going to have Lexer as fast
as FLEX?

Ruslan--

Vern Paxson put many years into making flex as fast as humanly possible.
Doing as well would be difficult, especially since one of the design
goals
for ANTLR 3 is to maintain the human readability of generated code.

That said, ANTLR 3 lexers will be much faster than ANTLR 2 lexers; Ter
has
some data on that that I believe he posted to the list.

Ter has said "May" for early availability; however, that could change.

--Loring

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Ruslan Zasukhin
> Sent: Sunday, January 30, 2005 10:58 PM
> To: 'ANTLR Interest'
> Subject: [antlr-interest] ANTLR 3.0 is going to have Lexer as fast as
FLEX
> ?
> 
> Hi All,
> 
> Anybody can confirm this ?
> 
> It seems I have read talk about automates for Lexer 3.0
> This give a hope.  :-)
> 
> Any news when 3.0 should be ready ?
> When is expected its beta testing ?
> 
> 
> --
> Best regards,
> Ruslan Zasukhin      [ I feel the need...the need for speed ]
> -------------------------------------------------------------
> e-mail: ruslan@paradigmasoft.com
> web: http://www.paradigmasoft.com
> 
> To subscribe to the Valentina mail list go to:
> http://lists.macserve.net/mailman/listinfo/valentina
> -------------------------------------------------------------


From mail at martin-probst.com  Mon Jan 31 13:41:47 2005
From: mail at martin-probst.com (Martin Probst)
Date: Mon Jan 31 13:42:04 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
Message-ID: <1107207707.13287.5.camel@narr.homeip.net>

Hi,

> 	What is my point?  Tree construction syntax is already a barrier to
> overcome to reading Antlr grammars. 

It might be too late or just insignificant and certainly somewhat
offtopic but here is my users perspective: I find the ANTLR style of
defining tree construction _very_ strange. IMHO it's close to code
obfuscation with all these ^, !, :, =, # and []. 
I would really prefer it if ANTLR would stick to some clear keywords and
maybe find a way of distinguishing ANTLR actions (e.g. where you do
$setType and similar things) and actions in the target language.
The readability of tree construction syntax is really very poor at the
moment.

Regards,
Martin

From parrt at cs.usfca.edu  Mon Jan 31 13:52:07 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 13:45:41 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
Message-ID: <d3f15bb614e688f6b02a598d3eecf35c@cs.usfca.edu>

On Jan 31, 2005, at 8:27 AM, Jim O'Connor wrote:
> 1. What is the learning cost to using Antlr?
>
> 	I use as example "How do I get line numbers from my AST?" In version
> 2.7.4 and earlier, the necessity of understanding the CommonAST, 
> BaseAST,
> Token structure is a barrier to an "educated" user.  Maybe this is a 
> good
> thing.

Hi Jim :)

Nah, getting line numbers should be easy.  In the new AST node 
structure, the payload will usually be the token (which is up to you 
and you can do it w/o ever seeing the AST class def) and you can say:

((Token)node.payload).getLine()

or whatever.

> 	What is my point?  Tree construction syntax is already a barrier to
> overcome to reading Antlr grammars.

Do you mean the ^ and ! operators or the #(a,b,c,d) syntax?

>  To what point is "new/better"
> functionality increasing the "learning barrier" for doing simple 
> things?

My goal is to make it easier to understand.

> Note 1: I haven't used String Template.  Will that be a necessity to
> understand Antlr 3.0?

Nope...it will not be included in the initial release most likely.  If 
you want to build a new target back end then you need ST. :)

> Note 2: I like the effect of ^^.

me too.  It fills lots of current deficiencies.

> 2. Predicates, Tree construction and actions.
> 	To use old/current terminology, guessing = 0 means execute an
> action.  Consider a rule
>
> Oldstylepredicate :
> 	a b c => a b c
> 	| blah blah ;

I'm wondering if I want to use '->' instead of '=>' as '=>' means 
syntactic predicate.

> Assume I have actions on "a", "b", and "c".  These must get executed in
> order.
>
> Newstyletree :
> 	a b c => c c a a b b
> 	| blah blah ;
>
> The actions on rules "a", "b", and "c" will get executed out of order 
> and
> multiple times.  This comment may reveal some strange kind of 
> ignorance.  I
> have to be intelligent enough to realize the effect, but stupid enough 
> to do
> it.

Yep, i've not made this clear.  It only calls a b c once.  The c c a a 
b b is the rewrite portion and is generated not matched.  The 
generation happens with the *result* of calling a b c on the left side.

> 3. Predicates, Tree construction and actions, again.
>
> 	Would it be useful to change the designator from "=>" to something
> else?

I'm thinking -> not => :)

> 4. Missing the whole point.
> 	The desired effect is to produce a tree that is in the "correct"
> order.  This leads to more efficient tree traversal and better ordered
> actions in the tree grammar.  The proposal addresses these issues.  
> Does it
> do away with the manual manipulation of the trees?

Hopefully in all but the weirdest cases.

>  The imaginary nodes
> appears to be a stumbling block.  Or can a 
> @attribute.Imaginary.THISTHING be
> created in a header section be used anywhere?

Actually imaginary nodes are handled particularly nicely.  Imagine 
adding a DECL imaginary node:

decl : "int" ID ';' => ^(DECL "int" ID) ;

or

decl : "int" ID ';' -> ^(DECL "int" ID) ;

using the -> instead.

With just my operators you cannot add the imaginary node.  Loring's 
stuff could easily add the imaginary node I believe.

> Jim
> P.S. Sorry, this is what you get when you're supposed to be doing 
> other work
> and "waste" the time considering theoretical Antlr issues.  Hope this 
> is
> useful.

It is very useful.  Thanks!

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com
Cofounder, http://www.knowspam.net enjoy email again!



From parrt at cs.usfca.edu  Mon Jan 31 13:56:36 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 13:50:29 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <1107207707.13287.5.camel@narr.homeip.net>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
	<1107207707.13287.5.camel@narr.homeip.net>
Message-ID: <f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>

On Jan 31, 2005, at 1:41 PM, Martin Probst wrote:
> Hi,
>
>> 	What is my point?  Tree construction syntax is already a barrier to
>> overcome to reading Antlr grammars.
>
> It might be too late or just insignificant and certainly somewhat
> offtopic but here is my users perspective: I find the ANTLR style of
> defining tree construction _very_ strange. IMHO it's close to code
> obfuscation with all these ^, !, :, =, # and [].

Well, the ^ and ! should be very clear, right?  You are merely 
specifying what is a subtree root and what is to be ignored.  It's the 
interaction with #(...) etc... in 2.x that is confusing I think.

> I would really prefer it if ANTLR would stick to some clear keywords 
> and
> maybe find a way of distinguishing ANTLR actions (e.g. where you do
> $setType and similar things) and actions in the target language.

I'm trying to avoid having any special stuff in actions. :)  The 
rewrites help a lot.  I don't anticipate needing actions to build trees 
at the moment.

> The readability of tree construction syntax is really very poor at the
> moment.

Thanks for the feedback!

Do you think the new rewrite stuff would be easy to understand? Some of 
surely would.  For example, build a flat tree with elements reordered:

r : A B => B A ;

Will that help do you think or is it just as bad?  I really want to get 
this right!

What are your thoughts on Loring's counter-proposal?

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From parrt at cs.usfca.edu  Mon Jan 31 14:05:11 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 13:58:44 2005
Subject: [antlr-interest] Ignoring comments in predicates problem
In-Reply-To: <Pine.LNX.4.44.0501301116360.2294-100000@g4.pauljlucas.org>
References: <Pine.LNX.4.44.0501301116360.2294-100000@g4.pauljlucas.org>
Message-ID: <286050e2f8eb32149f96f2518ea265cf@cs.usfca.edu>

On Jan 30, 2005, at 11:48 AM, Paul J. Lucas wrote:
> Given:
>
>     protected Ignore
>         :   (   WhiteSpaceChar
>             |   "(:" ( options { greedy = false; } : . )* ":)"
>             )+
>         ;
>
>     protected Keywords
>         :   // ...
>         |   (Identifier (Ignore)? '(' ~':')=> Identifier {
>                 $setType( FUNCTION_NAME );
>             }
>         ;
>
> That is "Ignore" is used in predicates to ignore either whitespace or 
> comments
> -- a comment in XQuery is (: like this :)
>
> I do get a "nongreedy block may exit incorrectly due to limitations of 
> linear
> approximate lookahead" warning for "Ignore".

Hi Paul, I believe in this case the warning is overly careful.  As long 
as the follow set is exactly a single sequence of chars, it will always 
work.

> If I have an "Idenfitier" optionally followed by "Ignore" followed by 
> '(' but
> not followed by a ':', then I have a function name.  I want to handle 
> all the
> cases of:
>
>     foo( ...
>     foo ( ...
>     foo (: comment :) ( ...
>
> That is allow zero or more whitespaces or comments in between the 
> Identifier
> and the '('.  The second case above doesn't work.

I assume that the "foo (" is indeed not followed by a ':'.

> For the ANTLR-generated code for "Ignore" I get in part:
>
>     switch ( LA(1)) {
>     case '\t':  case '\n':  case '\r':  case ' ':
>     {
>         mWhiteSpaceChar(false);
>         break;
>     }
>     case '(':
>     {
>         match("(:");
>
> The execution enters the '(' case above, but then match() throws a
> RecognitionException because it doesn't match "(:".  Back in the 
> "Keywords"
> ANTLR-generated code, it's:
>
>     try {
>         mIdentifier(false);
>         if ((_tokenSet_6.member(LA(1))) && 
> (_tokenSet_7.member(LA(2)))) {
>             mIgnore(false);
>         }
>         else if ((LA(1)=='(') && (_tokenSet_8.member(LA(2)))) {
>         }
>         else {
>             throw new NoViableAltForCharException((char)LA(1), 
> getFilename(), getLine(), getColumn());
>         }
>         match('(');
>         matchNot(':');
>     }
>     catch (RecognitionException pe) {
>         synPredMatched255 = false;
>     }
>
> What I *want* to happen is for execution to pick up at the "else if" 
> above, but
> since mIgnore throws a RecognitionException, it jumps to the "catch" 
> which is
> *not* what I want.
>
> It seems to me that the ANTLR-generated code for "Ignore" should *not* 
> throw a
> RecognitionException for my second case.  Why doesn't the generated 
> code
> explicitly check for ':' after '(' and if the character is *not* ':' 
> simply
> exit?

Hmm...this is odd.  You have k>=2 I see.  It should not enter ignore if 
there is no "(:".  Can you tell me what the _tokenSet_7 set looks like 
from:

>         if ((_tokenSet_6.member(LA(1))) && 
> (_tokenSet_7.member(LA(2)))) {
>             mIgnore(false);
>         }
>         else if ((LA(1)=='(') && (_tokenSet_8.member(LA(2)))) {
>         }

it should not enter this first IF and should go to the second else.  If 
you turn on the codeGenBitSetThreshold to a big number option (or 
whatever it's called) it should list the chars it's testing for LA(2).

I think that is our key.

> How can I get what I want?

You could swat the fly with a hammer (read that "hack" it) by adding a 
semantic predicate:

         |   (Identifier (({LA(1)=='('&&LA(2)!=':')||(is whitespace)}? 
Ignore)? '(' ~':')=> ...

Shouldn't be necessary though...let's explore the lookahead set.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From mail at martin-probst.com  Mon Jan 31 14:14:33 2005
From: mail at martin-probst.com (Martin Probst)
Date: Mon Jan 31 14:14:47 2005
Subject: [antlr-interest] Ignoring comments in predicates problem
In-Reply-To: <286050e2f8eb32149f96f2518ea265cf@cs.usfca.edu>
References: <Pine.LNX.4.44.0501301116360.2294-100000@g4.pauljlucas.org>
	<286050e2f8eb32149f96f2518ea265cf@cs.usfca.edu>
Message-ID: <1107209673.13287.13.camel@narr.homeip.net>

Hi,
as I wrote to Paul in an accidental off-list message (maybe some day
I'll learn how to use my email program ... maybe) I ran into this too.

In my Lexer I've had:
NEXT:
	(...)
	APOS_ATTR_CONTENT
	| APOS

protected APOS_ATTR_CONTENT:
	  ENTITY
	| CHAR_REF
	| ESCAPED_APOS
	| ( ... more CHARS ... )

protected ESCAPED_APOS:
	'\''! '\'',

With k=2 this generated something like:
if (LA(1) == '\'')
	mESCAPED_APOS();

I would expect it to stop matching APOS_ATTR_CONTENT when it sees a
single APOS and return a new token, then match the APOS as a single
token. If I find the time tomorrow I might narrow it down to a single
test.

Regards,
Martin

From mail at martin-probst.com  Mon Jan 31 14:34:02 2005
From: mail at martin-probst.com (Martin Probst)
Date: Mon Jan 31 14:34:31 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
	<1107207707.13287.5.camel@narr.homeip.net>
	<f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>
Message-ID: <1107210842.13287.30.camel@narr.homeip.net>

Hi,

I didn't have the time to really dig into that. Getting rid of #() and
#[] sounds good to me. Also removing {} actions for tree construction
etc. seems to be a good idea. ^^ on subrules is a thing I've been
looking for several times too.
I've never used tree rewriting though so I cannot be any help regarding
that. I'm just feeling uneasy with my ANTLR code because every time I
read it it takes me quite some time to figure out what the heck I'm
doing in there ;-)

> Do you think the new rewrite stuff would be easy to understand? Some of 
> surely would.  For example, build a flat tree with elements reordered:
> 
> r : A B => B A ;

You really should use a different operator in this case. Parsers and
Lexers share the same operators (as they are basically the same as far
as I understand) so the user assumes this for tree parsers too. 
And this just looks like a wrong syntactic predicate.

Loring's stuff looks a little bit more consistent - ^{ } for actions,
^() for trees, ^[] for nodes. I'm not enough into it to decide what's
better.

BTW is there currently a way of specifying that a (sub-)rule should stop
matching and exit? I've found myself trying to specify:
( A B => subruleB
| A C => subruleC
| else => return
)

Regards,
Martin

From parrt at cs.usfca.edu  Mon Jan 31 14:57:08 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 14:50:40 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <1107210842.13287.30.camel@narr.homeip.net>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
	<1107207707.13287.5.camel@narr.homeip.net>
	<f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>
	<1107210842.13287.30.camel@narr.homeip.net>
Message-ID: <637b0e898b2af15ffac2a782185e06cc@cs.usfca.edu>


On Jan 31, 2005, at 2:34 PM, Martin Probst wrote:

> Hi,
>
> I didn't have the time to really dig into that. Getting rid of #() and
> #[] sounds good to me. Also removing {} actions for tree construction
> etc. seems to be a good idea. ^^ on subrules is a thing I've been
> looking for several times too.
> I've never used tree rewriting though so I cannot be any help regarding
> that. I'm just feeling uneasy with my ANTLR code because every time I
> read it it takes me quite some time to figure out what the heck I'm
> doing in there ;-)

Agreed.  I'm trying hard to improve with a simpler approach :)

>> Do you think the new rewrite stuff would be easy to understand? Some 
>> of
>> surely would.  For example, build a flat tree with elements reordered:
>>
>> r : A B => B A ;
>
> You really should use a different operator in this case. Parsers and
> Lexers share the same operators (as they are basically the same as far
> as I understand) so the user assumes this for tree parsers too.
> And this just looks like a wrong syntactic predicate.

I agree.  Ok, let's use -> instead.

> Loring's stuff looks a little bit more consistent - ^{ } for actions,
> ^() for trees, ^[] for nodes. I'm not enough into it to decide what's
> better.

First note that ^(..) and ^[...] are the things you say you didn't like 
(except with # instead of ^) ;)

Anyway, I use ^(...) for tree:

r : A B -> ^(A B) ;

is the same as:

r : A^ B ;

^[] for a node is useful when it's an operator; since I wouldn't allow 
that, i was thinking of using something similar in the tree rewrite:

r : A B -> ^(DECL[args] A B) ;

where DECL[args] is like a constructor call to a node with imaginary 
DECL as the type and args as the other args.

With luck you won't need ^{actions} as operators, though in the rewrite 
section I'm thinking they may prove useful as in:

r : A B -> ^(A B {an-expr-for-2nd-child} ) ;

> BTW is there currently a way of specifying that a (sub-)rule should 
> stop
> matching and exit? I've found myself trying to specify:
> ( A B => subruleB
> | A C => subruleC
> | else => return
> )

That should happen automatically right?  If it doesn't match the first 
two and you have a blank third, it should continue:

( A B =>
| A C =>
|
)

Stop matching? Or, do you mean "match a production only if not followed 
by blort"?

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From mail at martin-probst.com  Mon Jan 31 15:56:37 2005
From: mail at martin-probst.com (Martin Probst)
Date: Mon Jan 31 15:56:58 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <637b0e898b2af15ffac2a782185e06cc@cs.usfca.edu>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
	<1107207707.13287.5.camel@narr.homeip.net>
	<f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>
	<1107210842.13287.30.camel@narr.homeip.net>
	<637b0e898b2af15ffac2a782185e06cc@cs.usfca.edu>
Message-ID: <1107215797.13287.44.camel@narr.homeip.net>


> First note that ^(..) and ^[...] are the things you say you didn't like 
> (except with # instead of ^) ;)

Well no, I said (or meant to say) I didn't like it in curly braces.

a!:
	b:myB c:myC foo:myD { #a = #(#foo,#(#[FOO],#b,#c)); }

Is not really intuitive. How would this translate to the new scheme?

a:
	^(^(FOO[]^ myB myC) myD^)

If you take node construction out of the {} actions it should be clearly
visible that it's an "imaginary" constructed node and not being matched.
Maybe use [FOO(args)]? This looks a little bit ambigous with
a:
	b[foo];
b[AST foo]: ...

> That should happen automatically right?  If it doesn't match the first 
> two and you have a blank third, it should continue:
> 
> ( A B =>
> | A C =>
> |
> )
> 
> Stop matching? Or, do you mean "match a production only if not followed 
> by blort"?

Uhm, I think your code does what I meant in the first place. I'll try
and see tomorrow. I once had the impression it somewhat tried to match
one of the rules only matched by syntactic predicates at that time,
though I've done a lot of nasty fiddling with that code block.

Anyway what I read seems like a good improvement from the current stuff,
at least to me. I'm going to bed now as it's 1 AM in Good Ol' Europe,
have a good night and ship ANTLR 3 soon ;-)

Regards,
Martin

From open.zone at virgin.net  Mon Jan 31 16:13:53 2005
From: open.zone at virgin.net (Micheal J)
Date: Mon Jan 31 16:01:28 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <c548335d25a9297a19a8d7a7a9ef71ff@cs.usfca.edu>
Message-ID: <001101c507f2$ea352a40$7c02a8c0@hercules>

> After a lot of typing (and I mean a lot), you'll see my ANTLR 
> 3.0 tree 
> construction proposal.  After the proposal, you'll see my long stream 
> of consciousness as I wander through the design process (you can 
> probably ignore that part).
> 
http://www.antlr.org/blog/antlr3/trees.tml


First thoughts that popped into my head:


1 Why mess with existing syntax at all?
---------------------------------------

By this I mean, while I recognized the benefits of ^^, I'm also rather
concerned that existing grammars would need to be rewritten and it wouldn't
be doable in any automatic fashion.


2 Rewrite rules are sexy!
---------------------------------------

I like the idea of rewrite rules. So much so in fact that I think they
should be orthogonal to the existing inline notation used in ANTLR 2.x
(mixing them [in a rule?] should be prevented). And they needn't be cryptic.
How about these rewrites (no pun intended <chuckle>) of grammar fragments in
your blog:

decl 
 : "var" (ID ':' type ';')+ 
   $rewrite_rules
   {
   	^("var" ^(':' ID type)+) 
   }

expr 
 : left=mul_expr PLUS right=mul_expr
   $rewrite_rules
   {
   	$condition(@right.type==INT && Integer.parseInt(@right.text)==0 &&
            @left.type==INT && Integer.parseInt(@left.text)==0)
        -> $empty
        
        $condition(right.type==INT && Integer.parseInt(@right.text)==0) 
        -> left
        
        $condition(left.type==INT && Integer.parseInt(@left.text)==0)   
        -> right
        
        $default -> ^(PLUS left right) // default case   
        
        // Alternatively, we can forego the $default keywords (as in not
support it at all) thus:
        // ^(PLUS left right) // default case   
   }
 ;


3. Separate Token and AST node class declaration sections
---------------------------------------------------------

We've gone over this before but the TreeDL approach (it is meant as just a
label, I know it wasn't invented/pioneered by TreeDL) of declaring node
types should be adopted. Apart from the obvious benefits that we've
discussed previously, it allows one to be even more language-agnostic. Take
the 'expr' rule above. Occurences of "Integer.parseInt()" are just plain
ugly from a langauge-neutral grammar perspective. 

We could have something like this instead (based on ideas expressed in
http://www.antlr.org/pipermail/antlr-interest/2004-November/010027.html
):

grammar P;

AST
{
    abstract node Expression
    {
    }

    node BinaryExpression : Expression
    {
        child     left   : Expression;
        child     right  : Expression;
	  attribute lexeme : String;	  
	  accessor  value  : int;  	// will generate:
						//   -- getValue() in
C++/Java_1.4-
						//   -- readonly Value
property in C#/Java_1.5+
						// User needs to provide the
implementation.
						//
					  	// [Perhaps ANTLR generates
uncompilable code in the
						//  body and a copy of the
comment supplied with the 
						//  declaration. This might
read:
						//     "Returns the integer
value of the lexeme."
						// ]
						// @see-also 'mutator'  -
for setXX/XX
						// @see-also 'property' -
for getXX/XX and setXX/XX
    }
}

tokens
{
   PLUS<AST=BinaryExpression>
   MINUS<AST=BinaryExpression>
}

expr 
 : left=mul_expr PLUS right=mul_expr
   $rewrite_rules
   {
   	$condition(@right.type==INT && @right.value==0 &&
            @left.type==INT && @left.value==0)
        -> $empty
        
        $condition(right.type==INT && @right.value==0) 
        -> left
        
        $condition(left.type==INT && @left.value==0)   
        -> right
        
        $default -> ^(PLUS left right) // default case   
   }
 ;


Cheers,

Micheal
ANTLR/C#


From open.zone at virgin.net  Mon Jan 31 16:40:33 2005
From: open.zone at virgin.net (Micheal J)
Date: Mon Jan 31 16:28:07 2005
Subject: [antlr-interest] Lexer/Parser invocation
In-Reply-To: <B1180416E5C44E49AE556D23DBB45B29061190@webmail.starthis.com>
Message-ID: <001601c507f6$a37d1500$7c02a8c0@hercules>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org 
> [mailto:antlr-interest-bounces@antlr.org] On Behalf Of 
> Bharath Sundararaman
> Sent: 31 January 2005 21:30
> To: ANTLR Interest
> Subject: [antlr-interest] Lexer/Parser invocation
> 
> 
> Hi all,
> 
> I am using ANTLR as my CC tool and I have a routine that 
> passes source code as a string to my compiler. The question 
> is, if I did not want to create instances of the lexer/parser 
> every single time I pass a string, how would I do it?

<SNIP>

> Any ideas?

In C# you can use the resetState() methods thus:
	lexer.resetState(streamOrString);
	parser.resetState();
	parser.topRule();

The implementation of the resetState() methods in C# should tell you all you
need to know.


Alternatively, the ANTLR 2.8experimental release has inbuilt
resetState()-like support for all langauges. It currently uses methods named
reset() however. See Loring's earlier post about when it might be available.

Micheal
ANTLR/C#

From parrt at cs.usfca.edu  Mon Jan 31 16:48:55 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 16:42:28 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <200501310550.j0V5o2x5023975@eis-msg-012.jpl.nasa.gov>
References: <200501310550.j0V5o2x5023975@eis-msg-012.jpl.nasa.gov>
Message-ID: <c25651ad9e13c402df020a69b98774d2@cs.usfca.edu>

On Jan 30, 2005, at 9:50 PM, Loring Craymer wrote:
> Well, I do have to respond.  For those interested in working with an
> implementation of more complete functionality, I am hoping to release 
> 2.8
> this week.  Micheal Jor got the C# code generation working Saturday; 
> I'm
> folding in the 2.7.5 stuff now.  Open Channel has set up a website for 
> the
> release, but there are still some minor licensing issues to either fix 
> or
> live with.  This will be labeled a "beta" release; as soon as I get 
> that
> out, I can work with Marq and Wolfgang to get the python code 
> generation
> upgraded for tree rewriting.

Yes, some interesting work in Loring's 2.8experimental.  Note that we 
are exploring ideas in it not dictating the future direction. ;)

> 2.8 tree construction has the following features:
> 1.)  Tree "actions":  ^{ <tree fragment spec> }
> 	Within a tree action, AST structures are specified in a notation
> that mirrors tree walker syntax.  Tree actions support inline tree
> construction; the contents of a tree action are added to the current 
> tree
> under construction.  [As a side note, the tree action syntax is most 
> of the
> complexity to which Ter refers to in his article--he prefers 
> specifying the
> complete output.  More on that below.]

Yup.  I like the "match this and generate that" style like an output 
tree template rather than having to figure out the emergent behavior.  
The operators ^ and ! are like that--you have to figure out what it 
will build, but they are so damn terse and useful that I will leave 
them in.

I like separating concerns.  If you've seen my StringTemplate stuff 
you'll note that I find generating code with a bunch of print 
statements entangled with logic is unsatisfying.  The same is true of 
grammars.  I don't like mixing the tree generation in the recognition 
part, hence, I've tried to move everything to the end of the 
production.  The ^ and ! are so terse and effective that I'm willing to 
live with the entanglement there.

> 2.)  Tree constructors:  ^( <root> <body> )
> 	Tree constructors can nest, and are recognized by #( <root> <body> )
> constructs.

this makes that tree a child of the currently constructed tree for the 
rule, right?

> 3.)  Node constructors:  ^[<node description>]

Does this add a child to the current tree?  I guess so.

> 	Node constructors may appear either inside or outside a tree action
> and are the mechanism for adding "imaginary" nodes.  Outside a tree 
> action,
> node constructors may be suffixed with ^ (^[...]^) to make it the root 
> of
> the current rule.
> 4.)  Alternatives and construction predicates:  ^{ {<test>}? A | B }
> 	Construction predicates are used to conditionally determine which
> constructs to add to a tree.  They are the complement to semantic 
> predicates
> and are a way of capturing semantics in a tree syntax.  In the 
> fragment, if
> <test> is true, A is added to the tree under construction; otherwise, 
> B is
> added.

Yup...we need that.

> 5.)  Restart tree:  { => <fragment> }
> 	Erase the partial tree already specified.  [I originally used
> "RETURN" for lack of a better idea; I changed this to "=>" as part of 
> the
> discussions Ter and I had on his proposal.]
> 6.)  "Copy" and "Reuse":  AST construction control
> 	Copy duplicates a node and its children; Reuse (in 2.8) incorporates
> an input tree fragment into an output tree.  For 3.0, it would make 
> sense to
> use "Copy" to replicate a payload (to allow later editing), and Reuse 
> to
> allow more than one reference to a single payload.
>
> 2.8 tree construction is slightly awkward because of a need to "!" 
> nodes
> that would be used in tree actions.  Otherwise, links are added in via
> normal construction and you can get circular linkages.  This should be 
> fixed
> in 3.0; an efficient implementation is pretty straightforward 
> following what
> I have done in 2.8 with the addition of the payload and carrier AST
> decomposition.
>
>
> My objections to Ter's proposal are broader than he mentions.  I would 
> add
> 4.)  His => syntax cannot be mixed with the current ^ and ! annotation.

On purpose as this is one of the problems currently I feel.  The 
interactions of the two constructions cause confusion.

> Frankly, I consider having two distinct tree rewrite syntaxes to be a
> kludge, at best.

Noted, but I disagree.

> 5.)  Ambiguities result from using his => in the presence of 
> alternatives
> within a rule.

How so?

>  This is especially true if the alternatives contain similar
> sets of tokens.  One possible solution is to use labels on nodes, but 
> then
> alternatives have to have distinct labels for nodes.  One of the 
> features
> that was very handy in PCCTS was that you could have a rule fragment 
> like
> ( a:A | a:B) and then reference a in an action (for 3.0, you could also
> reference attributes of a).

Yes, you will be able to reuse a label.  Naturally you can have a => 
per alternative; shouldn't be a problem.

> The major functional difference between the two approaches is that 
> Ter's
> approach does not allow inline tree construction.

On purpose.

>  [He also has not yet
> included construction predicates, although I think that I have him 
> almost
> convinced that they are essential.]

Actually you'll find that in my proposal.  I recall suggesting the pred 
syntax to you back at the oregon meeting. ;)

>   The "cost" of this restriction (what
> Ter refers to as "complexity" is the use of ^{ ... } to enclose 
> rewrites.  I
> consider this crippling, but Ter's argument is that this is an aid to
> understanding.

Until I see an example that I cannot handle that is real, you've not 
convinced me that we need the extra functionality.

>  [I did point out that the last time I heard him use that
> argument, predicate hoisting disappeared from 2.0.  He agreed. (:=< ]

I didn't have time to implement the predicates and used people's 
confusion as an excuse ;)  I look back and am amazed I got antlr out at 
all during my start up days...

> However, I think that the "simplicity" may be illusory:  consider
>
> Foo :
>     A B
>     (C | D | E) => C A B | D A B | E A B ;
>
> Is (C D E) => intended as a syntactic predicate or not? Probably not, 
> but I
> do not think that it would be hard to construct an example that was 
> truly
> ambiguous to the human eye.  Is it a rewrite or a typo?

I'm using -> now.  This was never intended as a predicate.  The stuff 
to the right is generated not recognized.  There is no such thing as 
pipe | on the right hand side.   That example doesn't make sense in my 
world.  You could do this though:

foo : A B (a=C | a=D | a=E) -> ^(@a A B) ;

which I think is pretty clear.  (note @a is an attribute reference and 
intentionally make them standout from rule element references).  You 
are labeling what is matched in the subrule.

We can explore labeling the entire subrule as well.  No reason not to 
allow

foo : A B a=(C|D|E) -> ^(@a A B) ;

I was holding off on syntactic predicates in the new version to see 
what LL(*) would do for us.  I truly believe in an evolutionary 
approach to building software.  Build only what you need, when you need 
it.

> One other point on using ^^ for rules and ^ for subrules.  I don't like
> changing to ^^ for rules (neither did Ter when we talked--the
> information-theoretic argument is that ^ should be used in the more 
> common
> case)

I don't like the backward incompatibility, but ^ seems more "local" 
than ^^ so I think we should use ^^ to mean "root of entire subtree for 
rule", though it make take a few more char in general.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From monty at codetransform.com  Mon Jan 31 13:56:39 2005
From: monty at codetransform.com (Monty Zukowski)
Date: Mon Jan 31 16:56:48 2005
Subject: [antlr-interest] Ignoring comments in predicates problem
In-Reply-To: <286050e2f8eb32149f96f2518ea265cf@cs.usfca.edu>
References: <Pine.LNX.4.44.0501301116360.2294-100000@g4.pauljlucas.org>
	<286050e2f8eb32149f96f2518ea265cf@cs.usfca.edu>
Message-ID: <41FEA997.4020604@codetransform.com>

Terence Parr wrote:
> On Jan 30, 2005, at 11:48 AM, Paul J. Lucas wrote:
> Hmm...this is odd.  You have k>=2 I see.  It should not enter ignore if 
> there is no "(:".  Can you tell me what the _tokenSet_7 set looks like 
> from:
> 
>>         if ((_tokenSet_6.member(LA(1))) && (_tokenSet_7.member(LA(2)))) {
>>             mIgnore(false);
>>         }
>>         else if ((LA(1)=='(') && (_tokenSet_8.member(LA(2)))) {
>>         }
> 
> 

By the way folks, you do that by turning the option 
'codeGenBitsetThreshold' very high, like 999999;  Then it won't use 
bitsets unless there are 999999 elements in them....

Monty
From parrt at cs.usfca.edu  Mon Jan 31 17:28:26 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 17:22:00 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <1107215797.13287.44.camel@narr.homeip.net>
References: <3AC103F1B7EEEC48A855ACB1D2819E91038D693E@rock-corpmail.microfocus.com>
	<1107207707.13287.5.camel@narr.homeip.net>
	<f38c1a3f0ef86bd6173c71ddba9ea0c3@cs.usfca.edu>
	<1107210842.13287.30.camel@narr.homeip.net>
	<637b0e898b2af15ffac2a782185e06cc@cs.usfca.edu>
	<1107215797.13287.44.camel@narr.homeip.net>
Message-ID: <f2ff1eb3ea4c8ad45d8e5ba5e15a0fdb@cs.usfca.edu>

On Jan 31, 2005, at 3:56 PM, Martin Probst wrote:
>> First note that ^(..) and ^[...] are the things you say you didn't 
>> like
>> (except with # instead of ^) ;)
>
> Well no, I said (or meant to say) I didn't like it in curly braces.

  Agreed.  I'm trying to get everything out of actions.

> a!:
> 	b:myB c:myC foo:myD { #a = #(#foo,#(#[FOO],#b,#c)); }
>
> Is not really intuitive. How would this translate to the new scheme?
>
> a:
> 	^(^(FOO[]^ myB myC) myD^)

It would become:

a : myB myC myD -> ^(myD ^(FOO myB myC))
    ;

How does that look to you?  Looks good to me. :)  About as clean and 
straightforward as you can get.

Loring, what would your inline solution look like?  Should just need a 
^[FOO]^ or something, right?

> If you take node construction out of the {} actions it should be 
> clearly
> visible that it's an "imaginary" constructed node and not being 
> matched.

Yes, there can be an ambiguity with respect to referencing elements.

> Maybe use [FOO(args)]?

Yes, i was thinking that FOO is actually shorthand for FOO[] with no 
arguments.  FOO[args] would call a different constructor the default 
constructor (factory method actually).  So if you have

a : FOO -> ^(FOO[] FOO) ;

you get

FOO
  |
FOO

where the top FOO is an imaginary node.  Just my first thought.

> Anyway what I read seems like a good improvement from the current 
> stuff,

Hooray!

> at least to me. I'm going to bed now as it's 1 AM in Good Ol' Europe,
> have a good night and ship ANTLR 3 soon ;-)

Sleep well!

Don't worry.  I'm working my ass off on ANTLR 3. :)  Once I nail down 
what the tree stuff looks like, I can implement quickly and then start 
cleaning up the tool for release and efficiency.  The runtime for ANTLR 
parsers/lexers is currently 22k in a jar. :)  The tree stuff will add 
some, but not that much really.  Maybe 3000 lines total of Java code.

Ter
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From hc7750 at 163.com  Mon Jan 31 18:01:50 2005
From: hc7750 at 163.com (=?gb2312?B?us6zrA==?=)
Date: Mon Jan 31 18:02:25 2005
Subject: [antlr-interest] why antlr not accept string as input stream?
Message-ID: <41FEE30E.000022.10644@m164.163.com>

e.g.

class MyParser extends Parser;
options
{
    k=2;
}

expr: NUMBER (PLUS|SUB) expr | NUMBER;



class MyLexer extends Lexer;
options
{
    k = 2;
}
PLUS: '+';
SUB: '-';
NUMBER: ('0'..'9')+;

WS: ( '\t'|'\f'|' '| ('\r'|'\n'|"\r\n"){newline();})+ {$setType(Token.SKIP);};

=============================================================================
import java.io.*;
import antlr.CommonAST;
import antlr.collections.AST;
import antlr.debug.misc.ASTFrame;
import java.util.*;
class Test{
   public static void main(String[] args) {
       try {
              MyLexer lexer = new MyLexer("12+23-34");
              MyParser parser = new MyParser(lexer);
              parser.expr();
	      
       } catch(Exception e) {
             System.err.println("exception: "+e);
       }
  }
}
=================================================================

Then an error occurs :

C:\Documents and Settings\Administrator\1>javac Test.java
Test.java:9: cannot resolve symbol
symbol  : constructor MyLexer (java.lang.String)
location: class MyLexer
              MyLexer lexer = new MyLexer("12+23-34");;
                              ^
1 error

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050201/01282970/attachment.html
From parrt at cs.usfca.edu  Mon Jan 31 18:24:01 2005
From: parrt at cs.usfca.edu (Terence Parr)
Date: Mon Jan 31 18:17:33 2005
Subject: [antlr-interest] brief analysis of java.g's tree building in 2.x vs
	proposed 3.0
Message-ID: <64770ffa5173a2f9eabe55b7452c41f8@cs.usfca.edu>

Howdy,

The real test of any proposal is to see what it looks like in practice. 
  I have looked again at the java grammar.  Here is some useful info.

There are about 75 parser grammar rules.

There are 27 #(...) tree construction actions.  BUT, 21/27 are purely 
to add an imaginary node as the root of the rule's subtree.  I'm 
guessing the rewrite rules will work well for this.  For example, in 
2.x:

modifiers
     :   ( modifier )*
         {#modifiers = #([MODIFIERS, "MODIFIERS"], #modifiers);}
     ;

it becomes the following in 3.0:

modifiers
     :   ( modifier )* -> ^(MODIFIERS (modifier)*)
     ;

or more precisely

modifiers
     :   ( modifier )* -> ^(MODIFIERS["MODIFIERS"] (modifier)*)
     ;

though I hope the factor.create(int tokenType) method could ask for the 
token name and figure out "MODIFIERS" automatically; i'll assume for 
now it can.

Here's another 2.x java.g example:

implementsClause
     :   (  i:"implements"! identifier ( COMMA! identifier )* )?
         {#implementsClause = #(#[IMPLEMENTS_CLAUSE,"IMPLEMENTS_CLAUSE"],
                                  #implementsClause);}
     ;

In 3.0 syntax it would be perhaps:

implementsClause
     :   ( "implements" identifier ( COMMA identifier )* )? -> 
^(IMPLEMENTS_CLAUSE (identifier)+)
     ;

So, out of 75 rules, 6 real tree constructions were needed, all of 
which *appear* (but I could be wrong) to be covered by the new -> 
syntax.

Also of note, there are about 30 "set the token type" actions such as:

packageDefinition
         :       p:"package"^ {#p.setType(PACKAGE_DEF);} identifier SEMI!
         ;

in the new 3.0 syntax, you could use a rewrite to say:

packageDefinition
         :       "package" identifier SEMI -> ^("package" identifier)
         ;

which seems way better.

Oh, I've updated the proposal page to use -> instead of => and to 
address some of the concerns mentioned on the list.

Ter
PS	here's a nasty rule, which shows a weakness in my current scheme 
dealing with alternatives like Loring predicted I believe:

field!
     :   mods:modifiers
         (   h:ctorHead s:constructorBody // constructor
             {#field = #(#[CTOR_DEF,"CTOR_DEF"], mods, h, s);}

         |   cd:classDefinition[#mods]       // inner class
             {#field = #cd;}

         |   id:interfaceDefinition[#mods]   // inner interface
             {#field = #id;}

         |   t:typeSpec[false]  // method or variable declaration(s)
             (   IDENT  // the name of the method

                 LPAREN! param:parameterDeclarationList RPAREN!

                 rt:declaratorBrackets[#t]

                 (tc:throwsClause)?

                 ( s2:compoundStatement | SEMI )
                 {#field = #(#[METHOD_DEF,"METHOD_DEF"],
                              mods,
                              #(#[TYPE,"TYPE"],rt),
                              IDENT,
                              param,
                              tc,
                              s2);}
             |   v:variableDefinitions[#mods,#t] SEMI
                 {#field = #v;}
             )
         )

     |   "static" s3:compoundStatement
         {#field = #(#[STATIC_INIT,"STATIC_INIT"], s3);}

     |   s4:compoundStatement
         {#field = #(#[INSTANCE_INIT,"INSTANCE_INIT"], s4);}
     ;

Let me see what I'd like to do.  Ok, with the modifiers left-factored 
in front of that subrule, we need -> in subrules (which I have in 
proposal but said we might not need...seems we do).  Let's see:

field
     :   mods=modifiers
         (   ctorHead constructorBody // constructor
             -> ^(CTOR_DEF modifiers ctorHead constructorBody)

         |   classDefinition[@mods.ast]       // inner class

         |   interfaceDefinition[@mods.ast]   // inner interface

         |   t:typeSpec[false]  // method or variable declaration(s)
             (   IDENT  // the name of the method
                 LPAREN param:parameterDeclarationList RPAREN!
                 declaratorBrackets[@t.ast]
                 (throwsClause)?
                 ( compoundStatement | SEMI )
                 -> ^(METHOD_DEF
                            modifiers
                            ^(TYPE declaratorBrackets)
                            IDENT parameterDeclarationList throwsClause 
compoundStatement
                        )

             |   variableDefinitions[@mods.ast,@t.ast] SEMI
             )
         )

     |   "static" compoundStatement -> ^(STATIC_INIT compoundStatement)

     |   compoundStatement -> ^(INSTANCE_INIT compoundStatement)
     ;

I think that is more satisfying.  We need -> in subrules and apparently 
we need it to set the entire rule's subtree.  Ok, i'll add to the 
proposal.

Note that I still have to pass trees around to subrules and so on due 
to factoring of the grammar.  This will not affect tree construction.  
For example, I pass the modifiers tree to interfaceDefinition.  
Currently in 2.x it is:

interfaceDefinition![AST modifiers]
     :   "interface" IDENT
         // it might extend some other interfaces
         ie:interfaceExtends
         // now parse the body of the interface (looks like a class...)
         cb:classBlock
         {#interfaceDefinition = #(#[INTERFACE_DEF,"INTERFACE_DEF"],
                                     modifiers,IDENT,ie,cb);}
     ;

in 3.0 it would be:

interfaceDefinition[AST modifiers]
     :   "interface" IDENT
         // it might extend some other interfaces
         ie:interfaceExtends
         // now parse the body of the interface (looks like a class...)
         cb:classBlock
         -> ^(INTERFACE_DEF @modifiers IDENT interfaceExtends classBlock)
     ;

Hmm...alright.  Everything seems cool.  The @modifiers would get linked 
into the tree...hmm..something makes me uncomfortable about that.  I 
want only payloads not trees referenced and insert to avoid infinite 
loops resulting from cyclic trees.  I'll have to think about this.
--
CS Professor & Grad Director, University of San Francisco
Creator, ANTLR Parser Generator, http://www.antlr.org
Cofounder, http://www.jguru.com



From Loring.G.Craymer at jpl.nasa.gov  Mon Jan 31 18:19:06 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Mon Jan 31 18:19:08 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <c25651ad9e13c402df020a69b98774d2@cs.usfca.edu>
Message-ID: <200502010219.j112J6x5005978@eis-msg-012.jpl.nasa.gov>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Terence Parr
> Sent: Monday, January 31, 2005 4:49 PM
> To: 'ANTLR Interest'
> Subject: Re: [antlr-interest] ANTLR 3.0 tree construction proposal
> 
> On Jan 30, 2005, at 9:50 PM, Loring Craymer wrote:
> >  [He also has not yet
> > included construction predicates, although I think that I have him
> > almost
> > convinced that they are essential.]
> 
> Actually you'll find that in my proposal.  I recall suggesting the pred
> syntax to you back at the oregon meeting. ;)

Umm, not quite.  I had implemented this feature quite awhile before the
meeting (you can probably extract a post of mine from a couple of years
ago--time flies when you are working through red tape) and presented it
there as part of the tree rewrite syntax.  About the only things I have
changed since the Oregon meeting are the cosmetic changes (#{ -> ^{, etc.)
allowing ^ annotation of ^[...] constructs to insert a root.

--Loring

> Ter
> --
> CS Professor & Grad Director, University of San Francisco
> Creator, ANTLR Parser Generator, http://www.antlr.org
> Cofounder, http://www.jguru.com
> 


From hc7750 at 163.com  Mon Jan 31 18:19:41 2005
From: hc7750 at 163.com (=?gb2312?B?us6zrA==?=)
Date: Mon Jan 31 18:19:52 2005
Subject: [antlr-interest] i have a problem with multiplexing.Can anyone help
 me?
Message-ID: <41FEE73D.000032.10851@m164.163.com>

i've realized two separate grammars, one for java code analyse, the other for javadoc embedded in the java file.  Then i try to link them together using the 
technology multiplexing. The critical parts are as follows:
---------- in java.g ------------------
...

JAVADOC_OPEN:   "/**" 
               {
                    selector.select("javadocLexer");
                    
                    // create a parser to handle the javadoc comment
                    JavadocParser jdocparser = new JavadocParser(selector);
                    jdocparser.comment(); 
               };

...
---------- in javadoc.g ------------------
...

javadoc_comment
         : (options{greedy=true;}:STAR)*
           (  (AT)=>AT  javadoc_tag  |  description )
           javadoc_tags
           JAVADOC_CLOSE     //here without EOF, and i believe no need
           ;
...
...

JAVADOC_CLOSE: "*/" {selector.select("javaLexer");};
...

----------------------- Test.java---------------------------------

import java.io.*;
import antlr.CommonAST;
import antlr.collections.AST;
import antlr.debug.misc.ASTFrame;
import java.util.*;
import antlr.TokenStreamSelector;


class Test{
        
	public static void main(String[] args)
	{
		try {
	             TokenStreamSelector selector = new TokenStreamSelector();
			
		    JavaLexer mainLexer = new JavaLexer(
                                        new FileInputStream(args[0]));
		    mainLexer.selector = selector;
			
		    JavadocLexer docLexer = 
                             new JavadocLexer  (mainLexer.getInputState());
	             docLexer.selector = selector;
	                
	             selector.addInputStream(mainLexer, "javaLexer");
	             selector.addInputStream(docLexer, "javadocLexer");
	             selector.select("javaLexer");
	                
	             JavaParser parser = new JavaParser(selector);
		    parser.compilationUnit();
						
                }catch(Exception e) {
                	System.err.println("exception: "+e);
                }
         }
}
---------- java file for testing-------------------------------------------
package com;

import java.io.*;

//single-line comment

/*multi-line comment*/

public class A
{
    public A()
    {
    }
    
    /** 
     * javadoc comment
     *
     * @author hc
     * @version 1.0
     * @param i the first number
     * @param j the second number
     * @return the sum of two numbers
     * @cml my own defined javadoc tag for some special purpose
     */
    public int add(int i,int j)
    {
        return i+j;
    }
}
-----------------------------------------------------------------------------
Then i got the error message:
exception: line 24:5: expecting EOF, found 'public'


i've been bewildered by this problem for quite a few days and look forward to help.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://www.antlr.org/pipermail/antlr-interest/attachments/20050201/e565f2da/attachment.html
From Loring.G.Craymer at jpl.nasa.gov  Mon Jan 31 18:24:49 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Mon Jan 31 18:24:50 2005
Subject: [antlr-interest] ANTLR 3.0 tree construction proposal
In-Reply-To: <f2ff1eb3ea4c8ad45d8e5ba5e15a0fdb@cs.usfca.edu>
Message-ID: <200502010224.j112Omx5006616@eis-msg-012.jpl.nasa.gov>



> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Terence Parr
> Sent: Monday, January 31, 2005 5:28 PM
> To: ANTLR Interest
> Subject: Re: [antlr-interest] ANTLR 3.0 tree construction proposal
> 
> On Jan 31, 2005, at 3:56 PM, Martin Probst wrote:
> >> First note that ^(..) and ^[...] are the things you say you didn't
> >> like
> >> (except with # instead of ^) ;)
> >
> > Well no, I said (or meant to say) I didn't like it in curly braces.
> 
>   Agreed.  I'm trying to get everything out of actions.
> 
> > a!:
> > 	b:myB c:myC foo:myD { #a = #(#foo,#(#[FOO],#b,#c)); }
> >
> > Is not really intuitive. How would this translate to the new scheme?
> >
> > a:
> > 	^(^(FOO[]^ myB myC) myD^)
> 
> It would become:
> 
> a : myB myC myD -> ^(myD ^(FOO myB myC))
>     ;
> 
> How does that look to you?  Looks good to me. :)  About as clean and
> straightforward as you can get.
> 
> Loring, what would your inline solution look like?  Should just need a
> ^[FOO]^ or something, right?

Almost--Martin specifies two levels of trees, so it would look like

a:
	myB myC ^[FOO]^ myD^ ;

--Loring


From christopher.d.schultz at comcast.net  Mon Jan 31 18:24:56 2005
From: christopher.d.schultz at comcast.net (Christopher Schultz)
Date: Mon Jan 31 18:27:31 2005
Subject: [antlr-interest] why antlr not accept string as input stream?
In-Reply-To: <41FEE30E.000022.10644@m164.163.com>
References: <41FEE30E.000022.10644@m164.163.com>
Message-ID: <41FEE878.4060404@comcast.net>

To whom it may concern,

> class MyParser extends Parser;

[snip]

> MyLexer lexer = new MyLexer("12+23-34");

[snip]

> C:\Documents and Settings\Administrator\1>javac Test.java
> Test.java:9: cannot resolve symbol
> symbol : constructor MyLexer (java.lang.String)
> location: class MyLexer
> MyLexer lexer = new MyLexer("12+23-34");;
> ^
> 1 error

That's because the method takes an InputStream or a Reader, not a 
String. This is pretty clear from the tutorials and JavaDoc.

If you want to use a String, try this:

MyLexer lexer = new MyLexer(new java.io.StringReader("12 + 23 - 34"));

That ought to work out better for you.

-chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : http://www.antlr.org/pipermail/antlr-interest/attachments/20050131/aedd68e0/signature.bin
From Loring.G.Craymer at jpl.nasa.gov  Mon Jan 31 19:46:03 2005
From: Loring.G.Craymer at jpl.nasa.gov (Loring Craymer)
Date: Mon Jan 31 19:46:06 2005
Subject: [antlr-interest] brief analysis of java.g's tree building in 2.x
	vsproposed 3.0
In-Reply-To: <64770ffa5173a2f9eabe55b7452c41f8@cs.usfca.edu>
Message-ID: <200502010346.j113k2x5004787@eis-msg-012.jpl.nasa.gov>

I'm going to try to stop after this response.  There are a couple of inline
2.8 syntax variants below, but Ter has almost converged on 2.8 functionality
with his introduction of subrule rewrites.  Consider interchanging nodes:

foo :
    A B { A } C D ;

or
foo_a :
    A B { B A } C D ;

would be handled in Ter's syntax via

foo_ter :
    ( A B -> B A ) C D ;

and maybe even, using an empty subrule,
foo_t2 :
    A B ( -> A ) C D ;

All that is possibly missing is the capability of longer distance moves and
interoperability with the existing annotation mechanism.  However, I don't
see much difference here and I have to ask

Ter--

Unless I am mistaken, you have introduced the "complexity" that you
originally decried.  Am I correct in this?

--Loring

> -----Original Message-----
> From: antlr-interest-bounces@antlr.org [mailto:antlr-interest-
> bounces@antlr.org] On Behalf Of Terence Parr
> Sent: Monday, January 31, 2005 6:24 PM
> To: ANTLR Interest
> Subject: [antlr-interest] brief analysis of java.g's tree building in 2.x
> vsproposed 3.0
> 
> Howdy,
> 
> The real test of any proposal is to see what it looks like in practice.
>   I have looked again at the java grammar.  Here is some useful info.
> 
> There are about 75 parser grammar rules.
> 
> There are 27 #(...) tree construction actions.  BUT, 21/27 are purely
> to add an imaginary node as the root of the rule's subtree.  I'm
> guessing the rewrite rules will work well for this.  For example, in
> 2.x:
> 
> modifiers
>      :   ( modifier )*
>          {#modifiers = #([MODIFIERS, "MODIFIERS"], #modifiers);}
>      ;
>
> it becomes the following in 3.0:
> 
> modifiers
>      :   ( modifier )* -> ^(MODIFIERS (modifier)*)
>      ;
> 
> or more precisely
> 
> modifiers
>      :   ( modifier )* -> ^(MODIFIERS["MODIFIERS"] (modifier)*)
>      ;
> 
> though I hope the factor.create(int tokenType) method could ask for the
> token name and figure out "MODIFIERS" automatically; i'll assume for
> now it can.
> 
> Here's another 2.x java.g example:
> 
> implementsClause
>      :   (  i:"implements"! identifier ( COMMA! identifier )* )?
>          {#implementsClause = #(#[IMPLEMENTS_CLAUSE,"IMPLEMENTS_CLAUSE"],
>                                   #implementsClause);}
>      ;
> 
> In 3.0 syntax it would be perhaps:
> 
> implementsClause
>      :   ( "implements" identifier ( COMMA identifier )* )? ->
> ^(IMPLEMENTS_CLAUSE (identifier)+)
>      ;

In 2.8, it's
implementsClause
     :   ( "implements" identifier ( COMMA identifier )* )?
         ^[ IMPLEMENTS_CLAUSE,"IMPLEMENTS_CLAUSE"]^
     ;

> 
> Oh, I've updated the proposal page to use -> instead of => and to
> address some of the concerns mentioned on the list.
> 
> Ter
> PS	here's a nasty rule, which shows a weakness in my current scheme
> dealing with alternatives like Loring predicted I believe:
> 
> field!
>      :   mods:modifiers
>          (   h:ctorHead s:constructorBody // constructor
>              {#field = #(#[CTOR_DEF,"CTOR_DEF"], mods, h, s);}
> 
>          |   cd:classDefinition[#mods]       // inner class
>              {#field = #cd;}
> 
>          |   id:interfaceDefinition[#mods]   // inner interface
>              {#field = #id;}
> 
>          |   t:typeSpec[false]  // method or variable declaration(s)
>              (   IDENT  // the name of the method
> 
>                  LPAREN! param:parameterDeclarationList RPAREN!
> 
>                  rt:declaratorBrackets[#t]
> 
>                  (tc:throwsClause)?
> 
>                  ( s2:compoundStatement | SEMI )
>                  {#field = #(#[METHOD_DEF,"METHOD_DEF"],
>                               mods,
>                               #(#[TYPE,"TYPE"],rt),
>                               IDENT,
>                               param,
>                               tc,
>                               s2);}
>              |   v:variableDefinitions[#mods,#t] SEMI
>                  {#field = #v;}
>              )
>          )
> 
>      |   "static" s3:compoundStatement
>          {#field = #(#[STATIC_INIT,"STATIC_INIT"], s3);}
> 
>      |   s4:compoundStatement
>          {#field = #(#[INSTANCE_INIT,"INSTANCE_INIT"], s4);}
>      ;
> 
> Let me see what I'd like to do.  Ok, with the modifiers left-factored
> in front of that subrule, we need -> in subrules (which I have in
> proposal but said we might not need...seems we do).  Let's see:
> 
> field
>      :   mods=modifiers
>          (   ctorHead constructorBody // constructor
>              -> ^(CTOR_DEF modifiers ctorHead constructorBody)
> 
>          |   classDefinition[@mods.ast]       // inner class
> 
>          |   interfaceDefinition[@mods.ast]   // inner interface
> 
>          |   t:typeSpec[false]  // method or variable declaration(s)
>              (   IDENT  // the name of the method
>                  LPAREN param:parameterDeclarationList RPAREN!
>                  declaratorBrackets[@t.ast]
>                  (throwsClause)?
>                  ( compoundStatement | SEMI )
>                  -> ^(METHOD_DEF
>                             modifiers
>                             ^(TYPE declaratorBrackets)
>                             IDENT parameterDeclarationList throwsClause
> compoundStatement
>                         )
> 
>              |   variableDefinitions[@mods.ast,@t.ast] SEMI
>              )
>          )
> 
>      |   "static" compoundStatement -> ^(STATIC_INIT compoundStatement)
> 
>      |   compoundStatement -> ^(INSTANCE_INIT compoundStatement)
>      ;

The 2.8 field def (assuming 3.0 payloads) is
field!
     :   mods:modifiers
         (   h:ctorHead s:constructorBody // constructor
             ^[CTOR_DEF,"CTOR_DEF"]

         |   cd:classDefinition[#mods]       // inner class
             ^{ => cd }

         |   id:interfaceDefinition[#mods]   // inner interface
             ^{ => id }

         |   t:typeSpec[false] // method or variable declaration(s)
             ^{ ^( ^[TYPE,"TYPE"] t ) }

             (   IDENT  // the name of the method

                 LPAREN! param:parameterDeclarationList RPAREN!

                 rt:declaratorBrackets[#t]
                 (tc:throwsClause)?

                 ( s2:compoundStatement | SEMI )
                 ^[METHOD_DEF,"METHOD_DEF"]^
             |   v:variableDefinitions[#mods,#t] SEMI
                 ^{ => v }
             )
         )



